<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/*
<span class='line'>  2</span> 
<span class='line'>  3</span>   OpenLayers.js -- OpenLayers Map Viewer Library
<span class='line'>  4</span> 
<span class='line'>  5</span>   Copyright 2005-2010 OpenLayers Contributors, released under the Clear BSD
<span class='line'>  6</span>   license. Please see http://svn.openlayers.org/trunk/openlayers/license.txt
<span class='line'>  7</span>   for the full text of the license.
<span class='line'>  8</span> 
<span class='line'>  9</span>   Includes compressed code under the following licenses:
<span class='line'> 10</span> 
<span class='line'> 11</span>   (For uncompressed versions of the code used please see the
<span class='line'> 12</span>   OpenLayers SVN repository: &lt;http://openlayers.org/>)
<span class='line'> 13</span> 
<span class='line'> 14</span> */</span><span class="WHIT">
<span class='line'> 15</span> 
<span class='line'> 16</span> </span><span class="COMM">/* Contains portions of Prototype.js:
<span class='line'> 17</span>  *
<span class='line'> 18</span>  * Prototype JavaScript framework, version 1.4.0
<span class='line'> 19</span>  *  (c) 2005 Sam Stephenson &lt;sam@conio.net>
<span class='line'> 20</span>  *
<span class='line'> 21</span>  *  Prototype is freely distributable under the terms of an MIT-style license.
<span class='line'> 22</span>  *  For details, see the Prototype web site: http://prototype.conio.net/
<span class='line'> 23</span>  *
<span class='line'> 24</span>  *--------------------------------------------------------------------------*/</span><span class="WHIT">
<span class='line'> 25</span> 
<span class='line'> 26</span> </span><span class="COMM">/**  
<span class='line'> 27</span> *  
<span class='line'> 28</span> *  Contains portions of Rico &lt;http://openrico.org/>
<span class='line'> 29</span> * 
<span class='line'> 30</span> *  Copyright 2005 Sabre Airline Solutions  
<span class='line'> 31</span> *  
<span class='line'> 32</span> *  Licensed under the Apache License, Version 2.0 (the "License"); you
<span class='line'> 33</span> *  may not use this file except in compliance with the License. You
<span class='line'> 34</span> *  may obtain a copy of the License at
<span class='line'> 35</span> *  
<span class='line'> 36</span> *         http://www.apache.org/licenses/LICENSE-2.0  
<span class='line'> 37</span> *  
<span class='line'> 38</span> *  Unless required by applicable law or agreed to in writing, software
<span class='line'> 39</span> *  distributed under the License is distributed on an "AS IS" BASIS,
<span class='line'> 40</span> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
<span class='line'> 41</span> *  implied. See the License for the specific language governing
<span class='line'> 42</span> *  permissions and limitations under the License. 
<span class='line'> 43</span> *
<span class='line'> 44</span> **/</span><span class="WHIT">
<span class='line'> 45</span> 
<span class='line'> 46</span> </span><span class="COMM">/**
<span class='line'> 47</span>  * Contains XMLHttpRequest.js &lt;http://code.google.com/p/xmlhttprequest/>
<span class='line'> 48</span>  * Copyright 2007 Sergey Ilinsky (http://www.ilinsky.com)
<span class='line'> 49</span>  *
<span class='line'> 50</span>  * Licensed under the Apache License, Version 2.0 (the "License");
<span class='line'> 51</span>  * you may not use this file except in compliance with the License.
<span class='line'> 52</span>  * You may obtain a copy of the License at
<span class='line'> 53</span>  * http://www.apache.org/licenses/LICENSE-2.0
<span class='line'> 54</span>  */</span><span class="WHIT">
<span class='line'> 55</span> 
<span class='line'> 56</span> </span><span class="COMM">/**
<span class='line'> 57</span>  * Contains portions of Gears &lt;http://code.google.com/apis/gears/>
<span class='line'> 58</span>  *
<span class='line'> 59</span>  * Copyright 2007, Google Inc.
<span class='line'> 60</span>  *
<span class='line'> 61</span>  * Redistribution and use in source and binary forms, with or without
<span class='line'> 62</span>  * modification, are permitted provided that the following conditions are met:
<span class='line'> 63</span>  *
<span class='line'> 64</span>  *  1. Redistributions of source code must retain the above copyright notice,
<span class='line'> 65</span>  *     this list of conditions and the following disclaimer.
<span class='line'> 66</span>  *  2. Redistributions in binary form must reproduce the above copyright notice,
<span class='line'> 67</span>  *     this list of conditions and the following disclaimer in the documentation
<span class='line'> 68</span>  *     and/or other materials provided with the distribution.
<span class='line'> 69</span>  *  3. Neither the name of Google Inc. nor the names of its contributors may be
<span class='line'> 70</span>  *     used to endorse or promote products derived from this software without
<span class='line'> 71</span>  *     specific prior written permission.
<span class='line'> 72</span>  *
<span class='line'> 73</span>  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
<span class='line'> 74</span>  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
<span class='line'> 75</span>  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
<span class='line'> 76</span>  * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class='line'> 77</span>  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
<span class='line'> 78</span>  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
<span class='line'> 79</span>  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
<span class='line'> 80</span>  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
<span class='line'> 81</span>  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<span class='line'> 82</span>  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class='line'> 83</span>  *
<span class='line'> 84</span>  * Sets up google.gears.*, which is *the only* supported way to access Gears.
<span class='line'> 85</span>  *
<span class='line'> 86</span>  * Circumvent this file at your own risk!
<span class='line'> 87</span>  *
<span class='line'> 88</span>  * In the future, Gears may automatically define google.gears.* without this
<span class='line'> 89</span>  * file. Gears may use these objects to transparently fix bugs and compatibility
<span class='line'> 90</span>  * issues. Applications that use the code below will continue to work seamlessly
<span class='line'> 91</span>  * when that happens.
<span class='line'> 92</span>  */</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">OpenLayers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">singleFile</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">singleFile</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">OpenLayers</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.singleFile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scriptLocation</span><span class="PUNC">;</span><span class="NAME">window.OpenLayers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">_scriptName</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">singleFile</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"lib/OpenLayers.js"</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.js"</span><span class="PUNC">,</span><span class="NAME">_getScriptLocation</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">scriptLocation</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">scriptLocation</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="NAME">scriptLocation</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isOL</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"(^|(.*?\\/))("</span><span class="PUNC">+</span><span class="NAME">OpenLayers._scriptName</span><span class="PUNC">+</span><span class="STRN">")(\\?|$)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scripts</span><span class="PUNC">=</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">'script'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">scripts.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">scripts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">'src'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">src</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">=</span><span class="NAME">src.match</span><span class="PUNC">(</span><span class="NAME">isOL</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">scriptLocation</span><span class="PUNC">=</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">scriptLocation</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">singleFile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jsfiles</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="STRN">"OpenLayers/Util.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes/Class.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes/Bounds.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes/Element.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes/LonLat.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes/Pixel.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/BaseTypes/Size.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Console.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Tween.js"</span><span class="PUNC">,</span><span class="STRN">"Rico/Corner.js"</span><span class="PUNC">,</span><span class="STRN">"Rico/Color.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Ajax.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Events.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Request.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Request/XMLHttpRequest.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Projection.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Map.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Icon.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Marker.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Marker/Box.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Popup.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Tile.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Tile/Image.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Tile/Image/IFrame.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Tile/WFS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Image.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/SphericalMercator.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/EventPane.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/FixedZoomLevels.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Google.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Google/v3.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/VirtualEarth.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Yahoo.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/HTTPRequest.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Grid.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/MapGuide.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/MapServer.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/MapServer/Untiled.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/KaMap.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/KaMapCache.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/MultiMap.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Markers.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Text.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/WorldWind.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/ArcGIS93Rest.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/WMS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/WMS/Untiled.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/WMS/Post.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/WMTS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/ArcIMS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/GeoRSS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Boxes.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/XYZ.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/TMS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/TileCache.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Zoomify.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Popup/Anchored.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Popup/AnchoredBubble.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Popup/Framed.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Popup/FramedCloud.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Feature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Feature/Vector.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Feature/WFS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Click.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Hover.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Point.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Path.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Polygon.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Feature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Drag.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/RegularPolygon.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Box.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/MouseWheel.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Handler/Keyboard.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Attribution.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Button.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ZoomBox.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ZoomToMaxExtent.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/DragPan.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Navigation.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/MouseDefaults.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/MousePosition.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/OverviewMap.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/KeyboardDefaults.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/PanZoom.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/PanZoomBar.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ArgParser.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Permalink.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Scale.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ScaleLine.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Snapping.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Split.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/LayerSwitcher.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/DrawFeature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/DragFeature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ModifyFeature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Panel.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/SelectFeature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/NavigationHistory.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Measure.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/WMSGetFeatureInfo.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/WMTSGetFeatureInfo.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Graticule.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/TransformFeature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/SLDSelect.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/Rectangle.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/Collection.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/Point.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/MultiPoint.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/Curve.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/LineString.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/LinearRing.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/Polygon.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/MultiLineString.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/MultiPolygon.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Geometry/Surface.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Renderer.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Renderer/Elements.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Renderer/SVG.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Renderer/Canvas.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Renderer/VML.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Vector.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/Vector/RootContainer.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/Filter.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/Fixed.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/Cluster.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/Paging.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/BBOX.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/Save.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Strategy/Refresh.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Filter.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Filter/FeatureId.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Filter/Logical.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Filter/Comparison.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Filter/Spatial.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/HTTP.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/SQL.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/SQL/Gears.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/WFS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/WFS/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/WFS/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/WFS/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/SOS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Protocol/SOS/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/PointTrack.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/GML.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Style.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Style2.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/StyleMap.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Rule.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/XML.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Context.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/ArcXML.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/ArcXML/Features.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GML.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GML/Base.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GML/v2.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GML/v3.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Atom.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/KML.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GeoRSS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFSCapabilities.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFSCapabilities/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFSCapabilities/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFSCapabilities/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFSDescribeFeatureType.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSDescribeLayer.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSDescribeLayer/v1_1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WKT.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/OSM.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GPX.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Filter.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Filter/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Filter/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Filter/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SLD.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SLD/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SLD/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/OWSCommon/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/OWSCommon/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/OWSCommon/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/CSWGetDomain.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/CSWGetDomain/v2_0_2.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/CSWGetRecords.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/CSWGetRecords/v2_0_2.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFST.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFST/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFST/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WFST/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/Text.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/JSON.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/GeoJSON.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMC.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMC/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMC/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMC/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities/v1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities/v1_1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities/v1_1_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities/v1_1_1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities/v1_3.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSCapabilities/v1_3_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMSGetFeatureInfo.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SOSCapabilities.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SOSCapabilities/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SOSGetObservation.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/SOSGetFeatureOfInterest.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/OWSContext.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/OWSContext/v0_3_1.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMTSCapabilities.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Format/WMTSCapabilities/v1_0_0.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Layer/WFS.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/GetFeature.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/MouseToolbar.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/NavToolbar.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/PanPanel.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/Pan.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ZoomIn.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ZoomOut.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/ZoomPanel.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Control/EditingToolbar.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Symbolizer.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Symbolizer/Point.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Symbolizer/Line.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Symbolizer/Polygon.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Symbolizer/Text.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Symbolizer/Raster.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Lang.js"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers/Lang/en.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">agent</span><span class="PUNC">=</span><span class="NAME">navigator.userAgent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">docWrite</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">agent.match</span><span class="PUNC">(</span><span class="STRN">"MSIE"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">agent.match</span><span class="PUNC">(</span><span class="STRN">"Safari"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">docWrite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allScriptTags</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">jsfiles.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">host</span><span class="PUNC">=</span><span class="NAME">OpenLayers._getScriptLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"lib/"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">jsfiles.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">docWrite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">allScriptTags</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">"&lt;script src='"</span><span class="PUNC">+</span><span class="NAME">host</span><span class="PUNC">+</span><span class="NAME">jsfiles</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"'>&lt;/script>"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"script"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">s.src</span><span class="PUNC">=</span><span class="NAME">host</span><span class="PUNC">+</span><span class="NAME">jsfiles</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"head"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">?</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"head"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">document.body</span><span class="PUNC">;</span><span class="NAME">h.appendChild</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">docWrite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.write</span><span class="PUNC">(</span><span class="NAME">allScriptTags.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.VERSION_NUMBER</span><span class="PUNC">=</span><span class="STRN">"OpenLayers 2.10 -- $Revision: 10721 $"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.String</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">startsWith</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="NAME">sub</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">str.indexOf</span><span class="PUNC">(</span><span class="NAME">sub</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">contains</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="NAME">sub</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">str.indexOf</span><span class="PUNC">(</span><span class="NAME">sub</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">trim</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/^\s\s*/</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s\s*$/</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">camelize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oStringList</span><span class="PUNC">=</span><span class="NAME">str.split</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">camelizedString</span><span class="PUNC">=</span><span class="NAME">oStringList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">oStringList.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">oStringList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">camelizedString</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">s.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">s.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">camelizedString</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">format</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">template</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">window</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">replacement</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">subs</span><span class="PUNC">=</span><span class="NAME">match.split</span><span class="PUNC">(</span><span class="REGX">/\.+/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">subs.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">replacement</span><span class="PUNC">=</span><span class="NAME">context</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>100</span> </span><span class="NAME">replacement</span><span class="PUNC">=</span><span class="NAME">replacement</span><span class="PUNC">[</span><span class="NAME">subs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>101</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">replacement</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">replacement</span><span class="PUNC">=</span><span class="NAME">args</span><span class="PUNC">?</span><span class="NAME">replacement.apply</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">replacement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>102</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">replacement</span><span class="PUNC">==</span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">'undefined'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">replacement</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">template.replace</span><span class="PUNC">(</span><span class="NAME">OpenLayers.String.tokenRegEx</span><span class="PUNC">,</span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">tokenRegEx</span><span class="PUNC">:</span><span class="REGX">/\$\{([\w.]+?)\}/g</span><span class="PUNC">,</span><span class="NAME">numberRegEx</span><span class="PUNC">:</span><span class="REGX">/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/</span><span class="PUNC">,</span><span class="NAME">isNumeric</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.numberRegEx.test</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">numericIf</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.isNumeric</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">String.prototype.startsWith</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">String.prototype.startsWith</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sStart</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.String.startsWith'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.startsWith</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">sStart</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>103</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">String.prototype.contains</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">String.prototype.contains</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.String.contains'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.contains</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>104</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">String.prototype.trim</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">String.prototype.trim</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.String.trim'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>105</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">String.prototype.camelize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">String.prototype.camelize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.String.camelize'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.camelize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>106</span> </span><span class="NAME">OpenLayers.Number</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">decimalSeparator</span><span class="PUNC">:</span><span class="STRN">"."</span><span class="PUNC">,</span><span class="NAME">thousandsSeparator</span><span class="PUNC">:</span><span class="STRN">","</span><span class="PUNC">,</span><span class="NAME">limitSigDigs</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">num</span><span class="PUNC">,</span><span class="NAME">sig</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fig</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sig</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fig</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">num.toPrecision</span><span class="PUNC">(</span><span class="NAME">sig</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>107</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">fig</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">format</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">num</span><span class="PUNC">,</span><span class="NAME">dec</span><span class="PUNC">,</span><span class="NAME">tsep</span><span class="PUNC">,</span><span class="NAME">dsep</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">dec</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">dec</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">dec</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">tsep</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">tsep</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">tsep</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Number.thousandsSeparator</span><span class="PUNC">;</span><span class="NAME">dsep</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">dsep</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">dsep</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Number.decimalSeparator</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dec</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">num</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">num.toFixed</span><span class="PUNC">(</span><span class="NAME">dec</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>108</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="NAME">num.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parts.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">dec</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">dec</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>109</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">integer</span><span class="PUNC">=</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tsep</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">thousands</span><span class="PUNC">=</span><span class="REGX">/(-?[0-9]+)([0-9]{3})/</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">thousands.test</span><span class="PUNC">(</span><span class="NAME">integer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">integer</span><span class="PUNC">=</span><span class="NAME">integer.replace</span><span class="PUNC">(</span><span class="NAME">thousands</span><span class="PUNC">,</span><span class="STRN">"$1"</span><span class="PUNC">+</span><span class="NAME">tsep</span><span class="PUNC">+</span><span class="STRN">"$2"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>110</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dec</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">integer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rem</span><span class="PUNC">=</span><span class="NAME">parts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">?</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="STRN">"0"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dec</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rem</span><span class="PUNC">=</span><span class="NAME">rem</span><span class="PUNC">+</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">dec</span><span class="PUNC">-</span><span class="NAME">rem.length</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>111</span> </span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">integer</span><span class="PUNC">+</span><span class="NAME">dsep</span><span class="PUNC">+</span><span class="NAME">rem</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>112</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Number.prototype.limitSigDigs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Number.prototype.limitSigDigs</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sig</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.Number.limitSigDigs'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Number.limitSigDigs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">sig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>113</span> </span><span class="NAME">OpenLayers.Function</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">bind</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">Array.prototype.slice.apply</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newArgs</span><span class="PUNC">=</span><span class="NAME">args.concat</span><span class="PUNC">(</span><span class="NAME">Array.prototype.slice.apply</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">newArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">bindAsEventListener</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">func.call</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">||</span><span class="NAME">window.event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">False</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">True</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Function.prototype.bind</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Function.prototype.bind</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.Function.bind'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Array.prototype.unshift.apply</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Function.bind.apply</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>114</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Function.prototype.bindAsEventListener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Function.prototype.bindAsEventListener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.Function.bindAsEventListener'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>115</span> </span><span class="NAME">OpenLayers.Array</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">filter</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">,</span><span class="NAME">caller</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Array.prototype.filter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">selected</span><span class="PUNC">=</span><span class="NAME">array.filter</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">,</span><span class="NAME">caller</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">array.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">!=</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>116</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">=</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">caller</span><span class="PUNC">,</span><span class="NAME">val</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">selected.push</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>117</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Date</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">toISOString</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="STRN">"toISOString"</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">Date.prototype</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">date</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">date.toISOString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">num</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">num</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">str.length</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">=</span><span class="STRN">"0"</span><span class="PUNC">+</span><span class="NAME">str</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>118</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>119</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">date</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">date.getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">=</span><span class="STRN">"Invalid Date"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">date.getUTCFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>120</span> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">date.getUTCMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>121</span> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">date.getUTCDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"T"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>122</span> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">date.getUTCHours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>123</span> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">date.getUTCMinutes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>124</span> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">date.getUTCSeconds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>125</span> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">date.getUTCMilliseconds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"Z"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>126</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parse</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">date</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elapsed</span><span class="PUNC">=</span><span class="NAME">Date.parse</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">elapsed</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">date</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">elapsed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">=</span><span class="NAME">str.match</span><span class="PUNC">(</span><span class="REGX">/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">date</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">year</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">month</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">day</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">date</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">Date.UTC</span><span class="PUNC">(</span><span class="NAME">year</span><span class="PUNC">,</span><span class="NAME">month</span><span class="PUNC">,</span><span class="NAME">day</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hours</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minutes</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">secFrac</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seconds</span><span class="PUNC">=</span><span class="NAME">secFrac</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">milliseconds</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NUMB">1000</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">secFrac</span><span class="PUNC">-</span><span class="NAME">seconds</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">date.setUTCHours</span><span class="PUNC">(</span><span class="NAME">hours</span><span class="PUNC">,</span><span class="NAME">minutes</span><span class="PUNC">,</span><span class="NAME">seconds</span><span class="PUNC">,</span><span class="NAME">milliseconds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">!==</span><span class="STRN">"Z"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hoursOffset</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minutesOffset</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1000</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">60</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">hoursOffset</span><span class="PUNC">*</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">minutesOffset</span><span class="PUNC">*</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">date</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">date.getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">date</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="STRN">"invalid"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>127</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">date</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">&&</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">OpenLayers.Class.isPrototype</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extended</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">,</span><span class="NAME">Type</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Type</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Type</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">len</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">initialize</span><span class="PUNC">=</span><span class="NAME">Type.prototype.initialize</span><span class="PUNC">;</span><span class="NAME">Type.prototype.initialize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">extended</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Type</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">initialize</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">Type.prototype.initialize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">Type.prototype.initialize</span><span class="PUNC">=</span><span class="NAME">initialize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>128</span> </span><span class="NAME">parent</span><span class="PUNC">=</span><span class="NAME">Type.prototype</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">parent</span><span class="PUNC">=</span><span class="NAME">Type</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>129</span> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">extended</span><span class="PUNC">,</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>130</span> </span><span class="NAME">Class.prototype</span><span class="PUNC">=</span><span class="NAME">extended</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Class.isPrototype</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Class.create</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">&&</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">OpenLayers.Class.isPrototype</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Class.inherit</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superClass</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">proto</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">superClass</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Class.isPrototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mixin</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">mixin</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Class.isPrototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>131</span> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">proto</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>132</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">proto</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">==</span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>133</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>134</span> </span><span class="NAME">elements.push</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>135</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.isElement</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">&&</span><span class="NAME">o.nodeType</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window.$</span><span class="PUNC">===</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.$</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>136</span> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">destination</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">destination</span><span class="PUNC">=</span><span class="NAME">destination</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">source</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">destination</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>137</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceIsEvt</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window.Event</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">&&</span><span class="NAME">source</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">window.Event</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sourceIsEvt</span><span class="PUNC">&&</span><span class="NAME">source.hasOwnProperty</span><span class="PUNC">&&</span><span class="NAME">source.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'toString'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">destination.toString</span><span class="PUNC">=</span><span class="NAME">source.toString</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>138</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">destination</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">array.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">array.splice</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>139</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.clearArray</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'array = []'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">array.length</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">array.indexOf</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.indexOf</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">array.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>140</span> </span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">overflow</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.id</span><span class="PUNC">=</span><span class="NAME">id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>141</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.left</span><span class="PUNC">=</span><span class="NAME">px.x</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">element.style.top</span><span class="PUNC">=</span><span class="NAME">px.y</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>142</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.width</span><span class="PUNC">=</span><span class="NAME">sz.w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">element.style.height</span><span class="PUNC">=</span><span class="NAME">sz.h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>143</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.position</span><span class="PUNC">=</span><span class="NAME">position</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>144</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.border</span><span class="PUNC">=</span><span class="NAME">border</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>145</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">overflow</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.overflow</span><span class="PUNC">=</span><span class="NAME">overflow</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>146</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0.0</span><span class="PUNC">&&</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.filter</span><span class="PUNC">=</span><span class="STRN">'alpha(opacity='</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">*</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="NAME">element.style.opacity</span><span class="PUNC">=</span><span class="NAME">opacity</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.filter</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">element.style.opacity</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgURL</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">overflow</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dom</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">imgURL</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">dom.style.backgroundImage</span><span class="PUNC">=</span><span class="STRN">'url('</span><span class="PUNC">+</span><span class="NAME">imgURL</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>147</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="STRN">"OpenLayersDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>148</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">position</span><span class="PUNC">=</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>149</span> </span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">dom</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">overflow</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.createImage</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgURL</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">,</span><span class="NAME">delayDisplay</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">image</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"img"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="STRN">"OpenLayersDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>150</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">position</span><span class="PUNC">=</span><span class="STRN">"relative"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>151</span> </span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">delayDisplay</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">image.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">,</span><span class="STRN">"load"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.onImageLoad</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">,</span><span class="STRN">"error"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.onImageLoadError</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>152</span> </span><span class="NAME">image.style.alt</span><span class="PUNC">=</span><span class="NAME">id</span><span class="PUNC">;</span><span class="NAME">image.galleryImg</span><span class="PUNC">=</span><span class="STRN">"no"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">imgURL</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">image.src</span><span class="PUNC">=</span><span class="NAME">imgURL</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>153</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">image</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.setOpacity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.onImageLoad</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.viewRequestID</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">&&</span><span class="NAME">this.viewRequestID</span><span class="PUNC">==</span><span class="NAME">this.map.viewRequestID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.style.display</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>154</span> </span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="STRN">"olImageLoadError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.IMAGE_RELOAD_ATTEMPTS</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.onImageLoadError</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._attempts</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._attempts</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">this._attempts</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._attempts</span><span class="PUNC">&lt;=</span><span class="NAME">OpenLayers.IMAGE_RELOAD_ATTEMPTS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">urls</span><span class="PUNC">=</span><span class="NAME">this.urls</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">urls</span><span class="PUNC">&&</span><span class="NAME">urls</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">&&</span><span class="NAME">urls.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">this.src.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">current_url</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">current_url</span><span class="PUNC">=</span><span class="NAME">urls</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">src.indexOf</span><span class="PUNC">(</span><span class="NAME">current_url</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>155</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">guess</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">urls.length</span><span class="PUNC">*</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">new_url</span><span class="PUNC">=</span><span class="NAME">urls</span><span class="PUNC">[</span><span class="NAME">guess</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">new_url</span><span class="PUNC">==</span><span class="NAME">current_url</span><span class="PUNC">&&</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">&lt;</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">guess</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">urls.length</span><span class="PUNC">*</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">new_url</span><span class="PUNC">=</span><span class="NAME">urls</span><span class="PUNC">[</span><span class="NAME">guess</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>156</span> </span><span class="NAME">this.src</span><span class="PUNC">=</span><span class="NAME">src.replace</span><span class="PUNC">(</span><span class="NAME">current_url</span><span class="PUNC">,</span><span class="NAME">new_url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.src</span><span class="PUNC">=</span><span class="NAME">this.src</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="STRN">"olImageLoadError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>157</span> </span><span class="NAME">this.style.display</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.alphaHackNeeded</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.alphaHack</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.alphaHackNeeded</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">arVersion</span><span class="PUNC">=</span><span class="NAME">navigator.appVersion.split</span><span class="PUNC">(</span><span class="STRN">"MSIE"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">version</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">arVersion</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filter</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">filter</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">document.body.filters</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>158</span> </span><span class="NAME">OpenLayers.Util.alphaHackNeeded</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">filter</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">version</span><span class="PUNC">>=</span><span class="NUMB">5.5</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">version</span><span class="PUNC">&lt;</span><span class="NUMB">7</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>159</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.alphaHackNeeded</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.modifyAlphaImageDiv</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgURL</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">sizing</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">div.childNodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">imgURL</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">img.src</span><span class="PUNC">=</span><span class="NAME">imgURL</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>160</span> </span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="NAME">div.id</span><span class="PUNC">+</span><span class="STRN">"_innerImage"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="STRN">"relative"</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.alphaHack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">div.style.display</span><span class="PUNC">!=</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">div.style.display</span><span class="PUNC">=</span><span class="STRN">"inline-block"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>161</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sizing</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sizing</span><span class="PUNC">=</span><span class="STRN">"scale"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>162</span> </span><span class="NAME">div.style.filter</span><span class="PUNC">=</span><span class="STRN">"progid:DXImageTransform.Microsoft"</span><span class="PUNC">+</span><span class="STRN">".AlphaImageLoader(src='"</span><span class="PUNC">+</span><span class="NAME">img.src</span><span class="PUNC">+</span><span class="STRN">"', "</span><span class="PUNC">+</span><span class="STRN">"sizingMethod='"</span><span class="PUNC">+</span><span class="NAME">sizing</span><span class="PUNC">+</span><span class="STRN">"')"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">div.style.opacity</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0.0</span><span class="PUNC">&&</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">div.style.opacity</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">div.style.filter</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" alpha(opacity="</span><span class="PUNC">+</span><span class="NAME">div.style.opacity</span><span class="PUNC">*</span><span class="NUMB">100</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>163</span> </span><span class="NAME">img.style.filter</span><span class="PUNC">=</span><span class="STRN">"alpha(opacity=0)"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgURL</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">sizing</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">,</span><span class="NAME">delayDisplay</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createImage</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">div.appendChild</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">delayDisplay</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">img.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="STRN">"load"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.onImageLoad</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="STRN">"error"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.onImageLoadError</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>164</span> </span><span class="NAME">OpenLayers.Util.modifyAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgURL</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">,</span><span class="NAME">sizing</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.upperCaseObject</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uObject</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">uObject</span><span class="PUNC">[</span><span class="NAME">key.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">object</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>165</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uObject</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">to</span><span class="PUNC">,</span><span class="NAME">from</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">to</span><span class="PUNC">=</span><span class="NAME">to</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fromIsEvt</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window.Event</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">&&</span><span class="NAME">from</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">window.Event</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">from</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">to</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">fromIsEvt</span><span class="PUNC">&&</span><span class="NAME">from.hasOwnProperty</span><span class="PUNC">&&</span><span class="NAME">from.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">to.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">to</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">from</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>166</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">fromIsEvt</span><span class="PUNC">&&</span><span class="NAME">from</span><span class="PUNC">&&</span><span class="NAME">from.hasOwnProperty</span><span class="PUNC">&&</span><span class="NAME">from.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'toString'</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">to.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'toString'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">to.toString</span><span class="PUNC">=</span><span class="NAME">from.toString</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>167</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getParameterString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">paramsArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">params</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">!=</span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">encodedValue</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">==</span><span class="STRN">'object'</span><span class="PUNC">&&</span><span class="NAME">value.constructor</span><span class="PUNC">==</span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">encodedItemArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">value.length</span><span class="PUNC">;</span><span class="NAME">itemIndex</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">itemIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">item</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">itemIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">encodedItemArray.push</span><span class="PUNC">(</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">item</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>168</span> </span><span class="NAME">encodedValue</span><span class="PUNC">=</span><span class="NAME">encodedItemArray.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>169</span> </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">encodedValue</span><span class="PUNC">=</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>170</span> </span><span class="NAME">paramsArray.push</span><span class="PUNC">(</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"="</span><span class="PUNC">+</span><span class="NAME">encodedValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>171</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">paramsArray.join</span><span class="PUNC">(</span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.urlAppend</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">paramStr</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newUrl</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">paramStr</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="REGX">/[?&]/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">newUrl</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">parts.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="STRN">" "</span><span class="PUNC">?</span><span class="NAME">paramStr</span><span class="PUNC">:</span><span class="NAME">parts.length</span><span class="PUNC">?</span><span class="STRN">"&"</span><span class="PUNC">+</span><span class="NAME">paramStr</span><span class="PUNC">:</span><span class="STRN">"?"</span><span class="PUNC">+</span><span class="NAME">paramStr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>172</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newUrl</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.ImgPath</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.ImgPath</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">OpenLayers._getScriptLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"img/"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.Try</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnValue</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lambda</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">returnValue</span><span class="PUNC">=</span><span class="NAME">lambda</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>173</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getNodes</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.Try</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util._getNodes</span><span class="PUNC">(</span><span class="NAME">p.documentElement.childNodes</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util._getNodes</span><span class="PUNC">(</span><span class="NAME">p.childNodes</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util._getNodes</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">retArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeName</span><span class="PUNC">==</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">retArray.push</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>174</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">retArray</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getTagText</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getNodes</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">result.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>175</span> </span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>176</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">childNodes.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result.childNodes</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>177</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">childNodes.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getXmlNodeValue</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.Try</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">val</span><span class="PUNC">=</span><span class="NAME">node.text</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">val</span><span class="PUNC">=</span><span class="NAME">node.textContent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>178</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">val</span><span class="PUNC">=</span><span class="NAME">node.firstChild.nodeValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">val</span><span class="PUNC">=</span><span class="NAME">node.textContent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.mouseLeft</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">evt.relatedTarget</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">evt.relatedTarget</span><span class="PUNC">:</span><span class="NAME">evt.toElement</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">!=</span><span class="NAME">div</span><span class="PUNC">&&</span><span class="NAME">target</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">target</span><span class="PUNC">=</span><span class="NAME">target.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>179</span> </span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">!=</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.DEFAULT_PRECISION</span><span class="PUNC">=</span><span class="NUMB">14</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">number</span><span class="PUNC">,</span><span class="NAME">precision</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">precision</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">precision</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.DEFAULT_PRECISION</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>180</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">number</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">precision</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">number</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">number</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">number</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">number</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toPrecision</span><span class="PUNC">(</span><span class="NAME">precision</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>181</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">number</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.deg</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">*</span><span class="NUMB">180</span><span class="PUNC">/</span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.VincentyConstants</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NUMB">6378137</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NUMB">6356752.3142</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">298.257223563</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.distVincenty</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.VincentyConstants</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">ct.a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">ct.b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">ct.f</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">L</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">(</span><span class="NAME">p2.lon</span><span class="PUNC">-</span><span class="NAME">p1.lon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">U1</span><span class="PUNC">=</span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.tan</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">(</span><span class="NAME">p1.lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">U2</span><span class="PUNC">=</span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.tan</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">(</span><span class="NAME">p2.lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinU1</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">U1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">cosU1</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">U1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinU2</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">U2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">cosU2</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">U2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lambda</span><span class="PUNC">=</span><span class="NAME">L</span><span class="PUNC">,</span><span class="NAME">lambdaP</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iterLimit</span><span class="PUNC">=</span><span class="NUMB">20</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">lambda</span><span class="PUNC">-</span><span class="NAME">lambdaP</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">12</span><span class="PUNC">&&</span><span class="PUNC">--</span><span class="NAME">iterLimit</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinLambda</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">lambda</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">cosLambda</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">lambda</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinSigma</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">cosU2</span><span class="PUNC">*</span><span class="NAME">sinLambda</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cosU2</span><span class="PUNC">*</span><span class="NAME">sinLambda</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>182</span> </span><span class="PUNC">(</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">sinU2</span><span class="PUNC">-</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">cosU2</span><span class="PUNC">*</span><span class="NAME">cosLambda</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">sinU2</span><span class="PUNC">-</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">cosU2</span><span class="PUNC">*</span><span class="NAME">cosLambda</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sinSigma</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>183</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosSigma</span><span class="PUNC">=</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">sinU2</span><span class="PUNC">+</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">cosU2</span><span class="PUNC">*</span><span class="NAME">cosLambda</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sigma</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">sinSigma</span><span class="PUNC">,</span><span class="NAME">cosSigma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alpha</span><span class="PUNC">=</span><span class="NAME">Math.asin</span><span class="PUNC">(</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">cosU2</span><span class="PUNC">*</span><span class="NAME">sinLambda</span><span class="PUNC">/</span><span class="NAME">sinSigma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosSqAlpha</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">alpha</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">alpha</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cos2SigmaM</span><span class="PUNC">=</span><span class="NAME">cosSigma</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">sinU2</span><span class="PUNC">/</span><span class="NAME">cosSqAlpha</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">C</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">/</span><span class="NUMB">16</span><span class="PUNC">*</span><span class="NAME">cosSqAlpha</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="NAME">cosSqAlpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">lambdaP</span><span class="PUNC">=</span><span class="NAME">lambda</span><span class="PUNC">;</span><span class="NAME">lambda</span><span class="PUNC">=</span><span class="NAME">L</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">C</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">f</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">alpha</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">sigma</span><span class="PUNC">+</span><span class="NAME">C</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cos2SigmaM</span><span class="PUNC">+</span><span class="NAME">C</span><span class="PUNC">*</span><span class="NAME">cosSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>184</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iterLimit</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NaN</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>185</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uSq</span><span class="PUNC">=</span><span class="NAME">cosSqAlpha</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">A</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">/</span><span class="NUMB">16384</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">4096</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">768</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">320</span><span class="PUNC">-</span><span class="NUMB">175</span><span class="PUNC">*</span><span class="NAME">uSq</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">=</span><span class="NAME">uSq</span><span class="PUNC">/</span><span class="NUMB">1024</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">256</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">128</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">74</span><span class="PUNC">-</span><span class="NUMB">47</span><span class="PUNC">*</span><span class="NAME">uSq</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaSigma</span><span class="PUNC">=</span><span class="NAME">B</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cos2SigmaM</span><span class="PUNC">+</span><span class="NAME">B</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cosSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>186</span> </span><span class="NAME">B</span><span class="PUNC">/</span><span class="NUMB">6</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">A</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">sigma</span><span class="PUNC">-</span><span class="NAME">deltaSigma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">s.toFixed</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.destinationVincenty</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">brng</span><span class="PUNC">,</span><span class="NAME">dist</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="PUNC">=</span><span class="NAME">u.VincentyConstants</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">ct.a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">ct.b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">ct.f</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lon1</span><span class="PUNC">=</span><span class="NAME">lonlat.lon</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lat1</span><span class="PUNC">=</span><span class="NAME">lonlat.lat</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">dist</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alpha1</span><span class="PUNC">=</span><span class="NAME">u.rad</span><span class="PUNC">(</span><span class="NAME">brng</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinAlpha1</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">alpha1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosAlpha1</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">alpha1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tanU1</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.tan</span><span class="PUNC">(</span><span class="NAME">u.rad</span><span class="PUNC">(</span><span class="NAME">lat1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosU1</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">tanU1</span><span class="PUNC">*</span><span class="NAME">tanU1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sinU1</span><span class="PUNC">=</span><span class="NAME">tanU1</span><span class="PUNC">*</span><span class="NAME">cosU1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sigma1</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">tanU1</span><span class="PUNC">,</span><span class="NAME">cosAlpha1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinAlpha</span><span class="PUNC">=</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">sinAlpha1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosSqAlpha</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">sinAlpha</span><span class="PUNC">*</span><span class="NAME">sinAlpha</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uSq</span><span class="PUNC">=</span><span class="NAME">cosSqAlpha</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">A</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">/</span><span class="NUMB">16384</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">4096</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">768</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">320</span><span class="PUNC">-</span><span class="NUMB">175</span><span class="PUNC">*</span><span class="NAME">uSq</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">B</span><span class="PUNC">=</span><span class="NAME">uSq</span><span class="PUNC">/</span><span class="NUMB">1024</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">256</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">128</span><span class="PUNC">+</span><span class="NAME">uSq</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">74</span><span class="PUNC">-</span><span class="NUMB">47</span><span class="PUNC">*</span><span class="NAME">uSq</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sigma</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">A</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sigmaP</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sigma</span><span class="PUNC">-</span><span class="NAME">sigmaP</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">1</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">12</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cos2SigmaM</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">sigma1</span><span class="PUNC">+</span><span class="NAME">sigma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinSigma</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">sigma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosSigma</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">sigma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaSigma</span><span class="PUNC">=</span><span class="NAME">B</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cos2SigmaM</span><span class="PUNC">+</span><span class="NAME">B</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cosSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>187</span> </span><span class="NAME">B</span><span class="PUNC">/</span><span class="NUMB">6</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sigmaP</span><span class="PUNC">=</span><span class="NAME">sigma</span><span class="PUNC">;</span><span class="NAME">sigma</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NAME">A</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">deltaSigma</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>188</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">-</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">cosSigma</span><span class="PUNC">*</span><span class="NAME">cosAlpha1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lat2</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">cosSigma</span><span class="PUNC">+</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="NAME">cosAlpha1</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">sinAlpha</span><span class="PUNC">*</span><span class="NAME">sinAlpha</span><span class="PUNC">+</span><span class="NAME">tmp</span><span class="PUNC">*</span><span class="NAME">tmp</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lambda</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="NAME">sinAlpha1</span><span class="PUNC">,</span><span class="NAME">cosU1</span><span class="PUNC">*</span><span class="NAME">cosSigma</span><span class="PUNC">-</span><span class="NAME">sinU1</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="NAME">cosAlpha1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">C</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">/</span><span class="NUMB">16</span><span class="PUNC">*</span><span class="NAME">cosSqAlpha</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="NAME">cosSqAlpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">L</span><span class="PUNC">=</span><span class="NAME">lambda</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">C</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">f</span><span class="PUNC">*</span><span class="NAME">sinAlpha</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">sigma</span><span class="PUNC">+</span><span class="NAME">C</span><span class="PUNC">*</span><span class="NAME">sinSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">cos2SigmaM</span><span class="PUNC">+</span><span class="NAME">C</span><span class="PUNC">*</span><span class="NAME">cosSigma</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">*</span><span class="NAME">cos2SigmaM</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">revAz</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">sinAlpha</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">tmp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">lon1</span><span class="PUNC">+</span><span class="NAME">u.deg</span><span class="PUNC">(</span><span class="NAME">L</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">u.deg</span><span class="PUNC">(</span><span class="NAME">lat2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">||</span><span class="NAME">window.location.href</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">paramsString</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.String.contains</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">=</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.contains</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="STRN">"#"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">url.length</span><span class="PUNC">;</span><span class="NAME">paramsString</span><span class="PUNC">=</span><span class="NAME">url.substring</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="NAME">end</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>189</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pairs</span><span class="PUNC">=</span><span class="NAME">paramsString.split</span><span class="PUNC">(</span><span class="REGX">/[&;]/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">pairs.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keyValue</span><span class="PUNC">=</span><span class="NAME">pairs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'='</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">keyValue</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="NAME">decodeURIComponent</span><span class="PUNC">(</span><span class="NAME">keyValue</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">keyValue</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">decodeURIComponent</span><span class="PUNC">(</span><span class="NAME">value.replace</span><span class="PUNC">(</span><span class="REGX">/\+/g</span><span class="PUNC">,</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>190</span> </span><span class="NAME">parameters</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>191</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getArgs</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"methodDeprecated"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'newMethod'</span><span class="PUNC">:</span><span class="STRN">'OpenLayers.Util.getParameters'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.lastSeqID</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">prefix</span><span class="PUNC">=</span><span class="STRN">"id_"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>192</span> </span><span class="NAME">OpenLayers.Util.lastSeqID</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">+</span><span class="NAME">OpenLayers.Util.lastSeqID</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'inches'</span><span class="PUNC">:</span><span class="NUMB">1.0</span><span class="PUNC">,</span><span class="STRN">'ft'</span><span class="PUNC">:</span><span class="NUMB">12.0</span><span class="PUNC">,</span><span class="STRN">'mi'</span><span class="PUNC">:</span><span class="NUMB">63360.0</span><span class="PUNC">,</span><span class="STRN">'m'</span><span class="PUNC">:</span><span class="NUMB">39.3701</span><span class="PUNC">,</span><span class="STRN">'km'</span><span class="PUNC">:</span><span class="NUMB">39370.1</span><span class="PUNC">,</span><span class="STRN">'dd'</span><span class="PUNC">:</span><span class="NUMB">4374754</span><span class="PUNC">,</span><span class="STRN">'yd'</span><span class="PUNC">:</span><span class="NUMB">36</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"in"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.INCHES_PER_UNIT.inches</span><span class="PUNC">;</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"degrees"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.INCHES_PER_UNIT.dd</span><span class="PUNC">;</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"nmi"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1852</span><span class="PUNC">*</span><span class="NAME">OpenLayers.INCHES_PER_UNIT.m</span><span class="PUNC">;</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">=</span><span class="NUMB">0.02540005080010160020</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"Inch"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT.inches</span><span class="PUNC">,</span><span class="STRN">"Meter"</span><span class="PUNC">:</span><span class="NUMB">1.0</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Foot"</span><span class="PUNC">:</span><span class="NUMB">0.30480060960121920243</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IFoot"</span><span class="PUNC">:</span><span class="NUMB">0.30480000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"ClarkeFoot"</span><span class="PUNC">:</span><span class="NUMB">0.3047972651151</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"SearsFoot"</span><span class="PUNC">:</span><span class="NUMB">0.30479947153867624624</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"GoldCoastFoot"</span><span class="PUNC">:</span><span class="NUMB">0.30479971018150881758</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IInch"</span><span class="PUNC">:</span><span class="NUMB">0.02540000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"MicroInch"</span><span class="PUNC">:</span><span class="NUMB">0.00002540000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Mil"</span><span class="PUNC">:</span><span class="NUMB">0.00000002540000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Centimeter"</span><span class="PUNC">:</span><span class="NUMB">0.01000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Kilometer"</span><span class="PUNC">:</span><span class="NUMB">1000.00000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Yard"</span><span class="PUNC">:</span><span class="NUMB">0.91440182880365760731</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"SearsYard"</span><span class="PUNC">:</span><span class="NUMB">0.914398414616029</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianYard"</span><span class="PUNC">:</span><span class="NUMB">0.91439853074444079983</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianYd37"</span><span class="PUNC">:</span><span class="NUMB">0.91439523</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianYd62"</span><span class="PUNC">:</span><span class="NUMB">0.9143988</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianYd75"</span><span class="PUNC">:</span><span class="NUMB">0.9143985</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianFoot"</span><span class="PUNC">:</span><span class="NUMB">0.30479951</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianFt37"</span><span class="PUNC">:</span><span class="NUMB">0.30479841</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianFt62"</span><span class="PUNC">:</span><span class="NUMB">0.3047996</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IndianFt75"</span><span class="PUNC">:</span><span class="NUMB">0.3047995</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Mile"</span><span class="PUNC">:</span><span class="NUMB">1609.34721869443738887477</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IYard"</span><span class="PUNC">:</span><span class="NUMB">0.91440000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IMile"</span><span class="PUNC">:</span><span class="NUMB">1609.34400000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"NautM"</span><span class="PUNC">:</span><span class="NUMB">1852.00000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Lat-66"</span><span class="PUNC">:</span><span class="NUMB">110943.316488932731</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Lat-83"</span><span class="PUNC">:</span><span class="NUMB">110946.25736872234125</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Decimeter"</span><span class="PUNC">:</span><span class="NUMB">0.10000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Millimeter"</span><span class="PUNC">:</span><span class="NUMB">0.00100000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Dekameter"</span><span class="PUNC">:</span><span class="NUMB">10.00000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Decameter"</span><span class="PUNC">:</span><span class="NUMB">10.00000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Hectometer"</span><span class="PUNC">:</span><span class="NUMB">100.00000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"GermanMeter"</span><span class="PUNC">:</span><span class="NUMB">1.0000135965</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"CaGrid"</span><span class="PUNC">:</span><span class="NUMB">0.999738</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"ClarkeChain"</span><span class="PUNC">:</span><span class="NUMB">20.1166194976</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"GunterChain"</span><span class="PUNC">:</span><span class="NUMB">20.11684023368047</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"BenoitChain"</span><span class="PUNC">:</span><span class="NUMB">20.116782494375872</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"SearsChain"</span><span class="PUNC">:</span><span class="NUMB">20.11676512155</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"ClarkeLink"</span><span class="PUNC">:</span><span class="NUMB">0.201166194976</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"GunterLink"</span><span class="PUNC">:</span><span class="NUMB">0.2011684023368047</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"BenoitLink"</span><span class="PUNC">:</span><span class="NUMB">0.20116782494375872</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"SearsLink"</span><span class="PUNC">:</span><span class="NUMB">0.2011676512155</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Rod"</span><span class="PUNC">:</span><span class="NUMB">5.02921005842012</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IntnlChain"</span><span class="PUNC">:</span><span class="NUMB">20.1168</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"IntnlLink"</span><span class="PUNC">:</span><span class="NUMB">0.201168</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Perch"</span><span class="PUNC">:</span><span class="NUMB">5.02921005842012</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Pole"</span><span class="PUNC">:</span><span class="NUMB">5.02921005842012</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Furlong"</span><span class="PUNC">:</span><span class="NUMB">201.1684023368046</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Rood"</span><span class="PUNC">:</span><span class="NUMB">3.778266898</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"CapeFoot"</span><span class="PUNC">:</span><span class="NUMB">0.3047972615</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Brealey"</span><span class="PUNC">:</span><span class="NUMB">375.00000000000000000000</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"ModAmFt"</span><span class="PUNC">:</span><span class="NUMB">0.304812252984505969011938</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"Fathom"</span><span class="PUNC">:</span><span class="NUMB">1.8288</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"NautM-UK"</span><span class="PUNC">:</span><span class="NUMB">1853.184</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"50kilometers"</span><span class="PUNC">:</span><span class="NUMB">50000.0</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">,</span><span class="STRN">"150kilometers"</span><span class="PUNC">:</span><span class="NUMB">150000.0</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"mm"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Meter"</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">1000.0</span><span class="PUNC">,</span><span class="STRN">"cm"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Meter"</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">100.0</span><span class="PUNC">,</span><span class="STRN">"dm"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Meter"</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">100.0</span><span class="PUNC">,</span><span class="STRN">"km"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Meter"</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1000.0</span><span class="PUNC">,</span><span class="STRN">"kmi"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"nmi"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"fath"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Fathom"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"ch"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"IntnlChain"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"link"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"IntnlLink"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"us-in"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"inches"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"us-ft"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Foot"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"us-yd"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Yard"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"us-ch"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"GunterChain"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"us-mi"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"Mile"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"ind-yd"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"IndianYd37"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"ind-ft"</span><span class="PUNC">:</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="STRN">"IndianFt37"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"ind-ch"</span><span class="PUNC">:</span><span class="NUMB">20.11669506</span><span class="PUNC">/</span><span class="NAME">OpenLayers.METERS_PER_INCH</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.DOTS_PER_INCH</span><span class="PUNC">=</span><span class="NUMB">72</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.normalizeScale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">normScale</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">></span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NUMB">1.0</span><span class="PUNC">/</span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">scale</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">normScale</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">units</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">units</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">units</span><span class="PUNC">=</span><span class="STRN">"degrees"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>193</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">normScale</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.normalizeScale</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">normScale</span><span class="PUNC">*</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="NAME">units</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">OpenLayers.DOTS_PER_INCH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>194</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getScaleFromResolution</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">,</span><span class="NAME">units</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">units</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">units</span><span class="PUNC">=</span><span class="STRN">"degrees"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>195</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">[</span><span class="NAME">units</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">OpenLayers.DOTS_PER_INCH</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.safeStopPropagation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.pagePosition</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">forElement</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueT</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">valueL</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">forElement</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">forElement</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">==</span><span class="NAME">document.body</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">,</span><span class="STRN">'position'</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'absolute'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>196</span> </span><span class="NAME">valueT</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">element.offsetTop</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">valueL</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">element.offsetLeft</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">element</span><span class="PUNC">;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">element.offsetParent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"pagePositionFailed"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'elemId'</span><span class="PUNC">:</span><span class="NAME">element.id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>197</span> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">forElement</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">valueT</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">element.scrollTop</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">valueL</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">element.scrollLeft</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>198</span> </span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">valueL</span><span class="PUNC">,</span><span class="NAME">valueT</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.isEquivalentUrl</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url1</span><span class="PUNC">,</span><span class="NAME">url2</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">ignoreCase</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">ignorePort80</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">ignoreHash</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">urlObj1</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUrlObject</span><span class="PUNC">(</span><span class="NAME">url1</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">urlObj2</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUrlObject</span><span class="PUNC">(</span><span class="NAME">url2</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">urlObj1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">!==</span><span class="STRN">"args"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">urlObj1</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">urlObj2</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>199</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">urlObj1.args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">urlObj1.args</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">urlObj2.args</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>200</span> </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">urlObj2.args</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>201</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">urlObj2.args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>202</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.createUrlObject</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="REGX">/^\w+:\/\//</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">=</span><span class="NAME">window.location</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">port</span><span class="PUNC">=</span><span class="NAME">loc.port</span><span class="PUNC">?</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">loc.port</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fullUrl</span><span class="PUNC">=</span><span class="NAME">loc.protocol</span><span class="PUNC">+</span><span class="STRN">"//"</span><span class="PUNC">+</span><span class="NAME">loc.host.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">port</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">fullUrl</span><span class="PUNC">+</span><span class="NAME">url</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="NAME">loc.pathname.split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">parts.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">fullUrl</span><span class="PUNC">+</span><span class="NAME">parts.join</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">url</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>203</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.ignoreCase</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">url.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>204</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'a'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.href</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">urlObject</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">urlObject.host</span><span class="PUNC">=</span><span class="NAME">a.host.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">urlObject.protocol</span><span class="PUNC">=</span><span class="NAME">a.protocol</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.ignorePort80</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">urlObject.port</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a.port</span><span class="PUNC">==</span><span class="STRN">"80"</span><span class="PUNC">||</span><span class="NAME">a.port</span><span class="PUNC">==</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="NAME">a.port</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">urlObject.port</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a.port</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">||</span><span class="NAME">a.port</span><span class="PUNC">==</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"80"</span><span class="PUNC">:</span><span class="NAME">a.port</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>205</span> </span><span class="NAME">urlObject.hash</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">options.ignoreHash</span><span class="PUNC">||</span><span class="NAME">a.hash</span><span class="PUNC">===</span><span class="STRN">"#"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="NAME">a.hash</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queryString</span><span class="PUNC">=</span><span class="NAME">a.search</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">queryString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">qMark</span><span class="PUNC">=</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">queryString</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">qMark</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">url.substr</span><span class="PUNC">(</span><span class="NAME">qMark</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>206</span> </span><span class="NAME">urlObject.args</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="NAME">queryString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">urlObject.pathname</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a.pathname.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">a.pathname</span><span class="PUNC">:</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">a.pathname</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">urlObject</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.removeTail</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">head</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">qMark</span><span class="PUNC">=</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hashMark</span><span class="PUNC">=</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">qMark</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">head</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">hashMark</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">url.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">hashMark</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">url</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">head</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">hashMark</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">url.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">qMark</span><span class="PUNC">,</span><span class="NAME">hashMark</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">url.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">qMark</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>207</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">head</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">browserName</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ua</span><span class="PUNC">=</span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ua.indexOf</span><span class="PUNC">(</span><span class="STRN">"opera"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">browserName</span><span class="PUNC">=</span><span class="STRN">"opera"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ua.indexOf</span><span class="PUNC">(</span><span class="STRN">"msie"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">browserName</span><span class="PUNC">=</span><span class="STRN">"msie"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ua.indexOf</span><span class="PUNC">(</span><span class="STRN">"safari"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">browserName</span><span class="PUNC">=</span><span class="STRN">"safari"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ua.indexOf</span><span class="PUNC">(</span><span class="STRN">"mozilla"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ua.indexOf</span><span class="PUNC">(</span><span class="STRN">"firefox"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">browserName</span><span class="PUNC">=</span><span class="STRN">"firefox"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">browserName</span><span class="PUNC">=</span><span class="STRN">"mozilla"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>208</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">browserName</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getRenderedDimensions</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">container.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">containerElement</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.containerElement</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">options.containerElement</span><span class="PUNC">:</span><span class="NAME">document.body</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">size.w</span><span class="PUNC">;</span><span class="NAME">container.style.width</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size.h</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">size.h</span><span class="PUNC">;</span><span class="NAME">container.style.height</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>209</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.displayClass</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">container.className</span><span class="PUNC">=</span><span class="NAME">options.displayClass</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>210</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">content.innerHTML</span><span class="PUNC">=</span><span class="NAME">contentHTML</span><span class="PUNC">;</span><span class="NAME">content.style.overflow</span><span class="PUNC">=</span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">content.childNodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">content.childNodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">)</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="NAME">content.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style.overflow</span><span class="PUNC">=</span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>211</span> </span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">containerElement.appendChild</span><span class="PUNC">(</span><span class="NAME">container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentHasPositionAbsolute</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">=</span><span class="NAME">container.parentNode</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">&&</span><span class="NAME">parent.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"body"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentPosition</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="STRN">"position"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parentPosition</span><span class="PUNC">==</span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parentHasPositionAbsolute</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parentPosition</span><span class="PUNC">&&</span><span class="NAME">parentPosition</span><span class="PUNC">!=</span><span class="STRN">"static"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>212</span> </span><span class="NAME">parent</span><span class="PUNC">=</span><span class="NAME">parent.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>213</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">parentHasPositionAbsolute</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">container.style.position</span><span class="PUNC">=</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>214</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">content.scrollWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">container.style.width</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>215</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">content.scrollHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>216</span> </span><span class="NAME">container.removeChild</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">containerElement.removeChild</span><span class="PUNC">(</span><span class="NAME">container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getScrollbarWidth</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollbarWidth</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util._scrollbarWidth</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">scrollbarWidth</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scr</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inn</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wNoScroll</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wScroll</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">scr</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">scr.style.position</span><span class="PUNC">=</span><span class="STRN">'absolute'</span><span class="PUNC">;</span><span class="NAME">scr.style.top</span><span class="PUNC">=</span><span class="STRN">'-1000px'</span><span class="PUNC">;</span><span class="NAME">scr.style.left</span><span class="PUNC">=</span><span class="STRN">'-1000px'</span><span class="PUNC">;</span><span class="NAME">scr.style.width</span><span class="PUNC">=</span><span class="STRN">'100px'</span><span class="PUNC">;</span><span class="NAME">scr.style.height</span><span class="PUNC">=</span><span class="STRN">'50px'</span><span class="PUNC">;</span><span class="NAME">scr.style.overflow</span><span class="PUNC">=</span><span class="STRN">'hidden'</span><span class="PUNC">;</span><span class="NAME">inn</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">inn.style.width</span><span class="PUNC">=</span><span class="STRN">'100%'</span><span class="PUNC">;</span><span class="NAME">inn.style.height</span><span class="PUNC">=</span><span class="STRN">'200px'</span><span class="PUNC">;</span><span class="NAME">scr.appendChild</span><span class="PUNC">(</span><span class="NAME">inn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">scr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">wNoScroll</span><span class="PUNC">=</span><span class="NAME">inn.offsetWidth</span><span class="PUNC">;</span><span class="NAME">scr.style.overflow</span><span class="PUNC">=</span><span class="STRN">'scroll'</span><span class="PUNC">;</span><span class="NAME">wScroll</span><span class="PUNC">=</span><span class="NAME">inn.offsetWidth</span><span class="PUNC">;</span><span class="NAME">document.body.removeChild</span><span class="PUNC">(</span><span class="NAME">document.body.lastChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util._scrollbarWidth</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">wNoScroll</span><span class="PUNC">-</span><span class="NAME">wScroll</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">scrollbarWidth</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util._scrollbarWidth</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>217</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">scrollbarWidth</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.getFormattedLonLat</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">coordinate</span><span class="PUNC">,</span><span class="NAME">axis</span><span class="PUNC">,</span><span class="NAME">dmsOption</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dmsOption</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">dmsOption</span><span class="PUNC">=</span><span class="STRN">'dms'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>218</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">abscoordinate</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">coordinate</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>219</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordinatedegrees</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">abscoordinate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordinateminutes</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">abscoordinate</span><span class="PUNC">-</span><span class="NAME">coordinatedegrees</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempcoordinateminutes</span><span class="PUNC">=</span><span class="NAME">coordinateminutes</span><span class="PUNC">;</span><span class="NAME">coordinateminutes</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">coordinateminutes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordinateseconds</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">tempcoordinateminutes</span><span class="PUNC">-</span><span class="NAME">coordinateminutes</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordinateseconds</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">coordinateseconds</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordinateseconds</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coordinatedegrees</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordinatedegrees</span><span class="PUNC">=</span><span class="STRN">"0"</span><span class="PUNC">+</span><span class="NAME">coordinatedegrees</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>220</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">coordinatedegrees</span><span class="PUNC">+</span><span class="STRN">"\u00B0"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dmsOption.indexOf</span><span class="PUNC">(</span><span class="STRN">'dm'</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coordinateminutes</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordinateminutes</span><span class="PUNC">=</span><span class="STRN">"0"</span><span class="PUNC">+</span><span class="NAME">coordinateminutes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>221</span> </span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">coordinateminutes</span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dmsOption.indexOf</span><span class="PUNC">(</span><span class="STRN">'dms'</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coordinateseconds</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordinateseconds</span><span class="PUNC">=</span><span class="STRN">"0"</span><span class="PUNC">+</span><span class="NAME">coordinateseconds</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>222</span> </span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">coordinateseconds</span><span class="PUNC">+</span><span class="STRN">'"'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>223</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">axis</span><span class="PUNC">==</span><span class="STRN">"lon"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">coordinate</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"W"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"E"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">coordinate</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"S"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"N"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>224</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Rico</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Rico.Corner</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">round</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._setOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">=</span><span class="NAME">this.options.color</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.color</span><span class="PUNC">==</span><span class="STRN">"fromElement"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">color</span><span class="PUNC">=</span><span class="NAME">this._background</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>225</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bgColor</span><span class="PUNC">=</span><span class="NAME">this.options.bgColor</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.bgColor</span><span class="PUNC">==</span><span class="STRN">"fromParent"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">bgColor</span><span class="PUNC">=</span><span class="NAME">this._background</span><span class="PUNC">(</span><span class="NAME">e.offsetParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>226</span> </span><span class="NAME">this._roundCornersImpl</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">changeColor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">theDiv</span><span class="PUNC">,</span><span class="NAME">newColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">theDiv.style.backgroundColor</span><span class="PUNC">=</span><span class="NAME">newColor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">spanElements</span><span class="PUNC">=</span><span class="NAME">theDiv.parentNode.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"span"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">currIdx</span><span class="PUNC">&lt;</span><span class="NAME">spanElements.length</span><span class="PUNC">;</span><span class="NAME">currIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">spanElements</span><span class="PUNC">[</span><span class="NAME">currIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style.backgroundColor</span><span class="PUNC">=</span><span class="NAME">newColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">changeOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">theDiv</span><span class="PUNC">,</span><span class="NAME">newOpacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mozillaOpacity</span><span class="PUNC">=</span><span class="NAME">newOpacity</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ieOpacity</span><span class="PUNC">=</span><span class="STRN">'alpha(opacity='</span><span class="PUNC">+</span><span class="NAME">newOpacity</span><span class="PUNC">*</span><span class="NUMB">100</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="NAME">theDiv.style.opacity</span><span class="PUNC">=</span><span class="NAME">mozillaOpacity</span><span class="PUNC">;</span><span class="NAME">theDiv.style.filter</span><span class="PUNC">=</span><span class="NAME">ieOpacity</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">spanElements</span><span class="PUNC">=</span><span class="NAME">theDiv.parentNode.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"span"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currIdx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">currIdx</span><span class="PUNC">&lt;</span><span class="NAME">spanElements.length</span><span class="PUNC">;</span><span class="NAME">currIdx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">spanElements</span><span class="PUNC">[</span><span class="NAME">currIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style.opacity</span><span class="PUNC">=</span><span class="NAME">mozillaOpacity</span><span class="PUNC">;</span><span class="NAME">spanElements</span><span class="PUNC">[</span><span class="NAME">currIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style.filter</span><span class="PUNC">=</span><span class="NAME">ieOpacity</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">reRound</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">theDiv</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topRico</span><span class="PUNC">=</span><span class="NAME">theDiv.parentNode.childNodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomRico</span><span class="PUNC">=</span><span class="NAME">theDiv.parentNode.childNodes</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">theDiv.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">topRico</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">theDiv.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">bottomRico</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.round</span><span class="PUNC">(</span><span class="NAME">theDiv.parentNode</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_roundCornersImpl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._renderBorder</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>227</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isTopRounded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._roundTopCorners</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>228</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isBottomRounded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._roundBottomCorners</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_renderBorder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderValue</span><span class="PUNC">=</span><span class="STRN">"1px solid "</span><span class="PUNC">+</span><span class="NAME">this._borderColor</span><span class="PUNC">(</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderL</span><span class="PUNC">=</span><span class="STRN">"border-left: "</span><span class="PUNC">+</span><span class="NAME">borderValue</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderR</span><span class="PUNC">=</span><span class="STRN">"border-right: "</span><span class="PUNC">+</span><span class="NAME">borderValue</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="STRN">"style='"</span><span class="PUNC">+</span><span class="NAME">borderL</span><span class="PUNC">+</span><span class="STRN">";"</span><span class="PUNC">+</span><span class="NAME">borderR</span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="NAME">el.innerHTML</span><span class="PUNC">=</span><span class="STRN">"&lt;div "</span><span class="PUNC">+</span><span class="NAME">style</span><span class="PUNC">+</span><span class="STRN">">"</span><span class="PUNC">+</span><span class="NAME">el.innerHTML</span><span class="PUNC">+</span><span class="STRN">"&lt;/div>"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_roundTopCorners</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">corner</span><span class="PUNC">=</span><span class="NAME">this._createCorner</span><span class="PUNC">(</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.options.numSlices</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">corner.appendChild</span><span class="PUNC">(</span><span class="NAME">this._createCornerSlice</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="STRN">"top"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>229</span> </span><span class="NAME">el.style.paddingTop</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">el.insertBefore</span><span class="PUNC">(</span><span class="NAME">corner</span><span class="PUNC">,</span><span class="NAME">el.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_roundBottomCorners</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">corner</span><span class="PUNC">=</span><span class="NAME">this._createCorner</span><span class="PUNC">(</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.options.numSlices</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">corner.appendChild</span><span class="PUNC">(</span><span class="NAME">this._createCornerSlice</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="STRN">"bottom"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>230</span> </span><span class="NAME">el.style.paddingBottom</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">el.appendChild</span><span class="PUNC">(</span><span class="NAME">corner</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_createCorner</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">corner</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">corner.style.backgroundColor</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._isTransparent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"transparent"</span><span class="PUNC">:</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">corner</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_createCornerSlice</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"span"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inStyle</span><span class="PUNC">=</span><span class="NAME">slice.style</span><span class="PUNC">;</span><span class="NAME">inStyle.backgroundColor</span><span class="PUNC">=</span><span class="NAME">color</span><span class="PUNC">;</span><span class="NAME">inStyle.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">inStyle.height</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="NAME">inStyle.overflow</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="NAME">inStyle.fontSize</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderColor</span><span class="PUNC">=</span><span class="NAME">this._borderColor</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.border</span><span class="PUNC">&&</span><span class="NAME">n</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inStyle.borderTopStyle</span><span class="PUNC">=</span><span class="STRN">"solid"</span><span class="PUNC">;</span><span class="NAME">inStyle.borderTopWidth</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="NAME">inStyle.borderLeftWidth</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">inStyle.borderRightWidth</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">inStyle.borderBottomWidth</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">inStyle.height</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">inStyle.borderColor</span><span class="PUNC">=</span><span class="NAME">borderColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>231</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">borderColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inStyle.borderColor</span><span class="PUNC">=</span><span class="NAME">borderColor</span><span class="PUNC">;</span><span class="NAME">inStyle.borderStyle</span><span class="PUNC">=</span><span class="STRN">"solid"</span><span class="PUNC">;</span><span class="NAME">inStyle.borderWidth</span><span class="PUNC">=</span><span class="STRN">"0px 1px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>232</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.options.compact</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">==</span><span class="PUNC">(</span><span class="NAME">this.options.numSlices</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inStyle.height</span><span class="PUNC">=</span><span class="STRN">"2px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>233</span> </span><span class="NAME">this._setMargin</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._setBorder</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_setOptions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">corners</span><span class="PUNC">:</span><span class="STRN">"all"</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">:</span><span class="STRN">"fromElement"</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">:</span><span class="STRN">"fromParent"</span><span class="PUNC">,</span><span class="NAME">blend</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">compact</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">this.options</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.options.numSlices</span><span class="PUNC">=</span><span class="NAME">this.options.compact</span><span class="PUNC">?</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isTransparent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.options.blend</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_whichSideTop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._hasString</span><span class="PUNC">(</span><span class="NAME">this.options.corners</span><span class="PUNC">,</span><span class="STRN">"all"</span><span class="PUNC">,</span><span class="STRN">"top"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>234</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"tl"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"tr"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>235</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"tl"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"left"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"tr"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"right"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>236</span> </span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_whichSideBottom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._hasString</span><span class="PUNC">(</span><span class="NAME">this.options.corners</span><span class="PUNC">,</span><span class="STRN">"all"</span><span class="PUNC">,</span><span class="STRN">"bottom"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>237</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"bl"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"br"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>238</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"bl"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"left"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.corners.indexOf</span><span class="PUNC">(</span><span class="STRN">"br"</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"right"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>239</span> </span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_borderColor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">==</span><span class="STRN">"transparent"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bgColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.options.border</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.blend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._blend</span><span class="PUNC">(</span><span class="NAME">bgColor</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_setMargin</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">corners</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">marginSize</span><span class="PUNC">=</span><span class="NAME">this._marginSize</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">whichSide</span><span class="PUNC">=</span><span class="NAME">corners</span><span class="PUNC">==</span><span class="STRN">"top"</span><span class="PUNC">?</span><span class="NAME">this._whichSideTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this._whichSideBottom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">whichSide</span><span class="PUNC">==</span><span class="STRN">"left"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">el.style.marginLeft</span><span class="PUNC">=</span><span class="NAME">marginSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.marginRight</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>240</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">whichSide</span><span class="PUNC">==</span><span class="STRN">"right"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">el.style.marginRight</span><span class="PUNC">=</span><span class="NAME">marginSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.marginLeft</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>241</span> </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">el.style.marginLeft</span><span class="PUNC">=</span><span class="NAME">marginSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.marginRight</span><span class="PUNC">=</span><span class="NAME">marginSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_setBorder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">corners</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">borderSize</span><span class="PUNC">=</span><span class="NAME">this._borderSize</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">whichSide</span><span class="PUNC">=</span><span class="NAME">corners</span><span class="PUNC">==</span><span class="STRN">"top"</span><span class="PUNC">?</span><span class="NAME">this._whichSideTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this._whichSideBottom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">whichSide</span><span class="PUNC">==</span><span class="STRN">"left"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">el.style.borderLeftWidth</span><span class="PUNC">=</span><span class="NAME">borderSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.borderRightWidth</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>242</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">whichSide</span><span class="PUNC">==</span><span class="STRN">"right"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">el.style.borderRightWidth</span><span class="PUNC">=</span><span class="NAME">borderSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.borderLeftWidth</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>243</span> </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">el.style.borderLeftWidth</span><span class="PUNC">=</span><span class="NAME">borderSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.borderRightWidth</span><span class="PUNC">=</span><span class="NAME">borderSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>244</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.border</span><span class="PUNC">!=</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">el.style.borderLeftWidth</span><span class="PUNC">=</span><span class="NAME">borderSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">el.style.borderRightWidth</span><span class="PUNC">=</span><span class="NAME">borderSize</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_marginSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isTransparent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>245</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">marginSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blendedMarginSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compactMarginSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">smBlendedMarginSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.compact</span><span class="PUNC">&&</span><span class="NAME">this.options.blend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">smBlendedMarginSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.compact</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">compactMarginSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.blend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">blendedMarginSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">marginSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_borderSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">transparentBorderSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blendedBorderSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">compactBorderSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">actualBorderSizes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.compact</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.options.blend</span><span class="PUNC">||</span><span class="NAME">this._isTransparent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.compact</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">compactBorderSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.blend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">blendedBorderSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">actualBorderSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isTransparent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">transparentBorderSizes</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>246</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_hasString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">str.indexOf</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_blend</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c1</span><span class="PUNC">,</span><span class="NAME">c2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cc1</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Rico.Color.createFromHex</span><span class="PUNC">(</span><span class="NAME">c1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">cc1.blend</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Rico.Color.createFromHex</span><span class="PUNC">(</span><span class="NAME">c2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cc1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_background</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Rico.Color.createColorFromBackground</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">asHex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"#ffffff"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_isTransparent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.options.color</span><span class="PUNC">==</span><span class="STRN">"transparent"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_isTopRounded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._hasString</span><span class="PUNC">(</span><span class="NAME">this.options.corners</span><span class="PUNC">,</span><span class="STRN">"all"</span><span class="PUNC">,</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="STRN">"tl"</span><span class="PUNC">,</span><span class="STRN">"tr"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_isBottomRounded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._hasString</span><span class="PUNC">(</span><span class="NAME">this.options.corners</span><span class="PUNC">,</span><span class="STRN">"all"</span><span class="PUNC">,</span><span class="STRN">"bottom"</span><span class="PUNC">,</span><span class="STRN">"bl"</span><span class="PUNC">,</span><span class="STRN">"br"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_hasSingleTextChild</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el.childNodes.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">el.childNodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeType</span><span class="PUNC">==</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">visible</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">!=</span><span class="STRN">'none'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toggle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">display</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Element.visible</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">'hide'</span><span class="PUNC">:</span><span class="STRN">'show'</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element</span><span class="PUNC">[</span><span class="NAME">display</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hide</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.display</span><span class="PUNC">=</span><span class="STRN">'none'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">show</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.style.display</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">remove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">element.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getHeight</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element.offsetHeight</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getDimensions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="STRN">'display'</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">'none'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">element.offsetWidth</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">element.offsetHeight</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>247</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">els</span><span class="PUNC">=</span><span class="NAME">element.style</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalVisibility</span><span class="PUNC">=</span><span class="NAME">els.visibility</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalPosition</span><span class="PUNC">=</span><span class="NAME">els.position</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalDisplay</span><span class="PUNC">=</span><span class="NAME">els.display</span><span class="PUNC">;</span><span class="NAME">els.visibility</span><span class="PUNC">=</span><span class="STRN">'hidden'</span><span class="PUNC">;</span><span class="NAME">els.position</span><span class="PUNC">=</span><span class="STRN">'absolute'</span><span class="PUNC">;</span><span class="NAME">els.display</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalWidth</span><span class="PUNC">=</span><span class="NAME">element.clientWidth</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalHeight</span><span class="PUNC">=</span><span class="NAME">element.clientHeight</span><span class="PUNC">;</span><span class="NAME">els.display</span><span class="PUNC">=</span><span class="NAME">originalDisplay</span><span class="PUNC">;</span><span class="NAME">els.position</span><span class="PUNC">=</span><span class="NAME">originalPosition</span><span class="PUNC">;</span><span class="NAME">els.visibility</span><span class="PUNC">=</span><span class="NAME">originalVisibility</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">originalWidth</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">originalHeight</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hasClass</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">names</span><span class="PUNC">=</span><span class="NAME">element.className</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">names</span><span class="PUNC">&&</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"(^|\\s)"</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">+</span><span class="STRN">"(\\s|$)"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">names</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addClass</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Element.hasClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.className</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">element.className</span><span class="PUNC">?</span><span class="STRN">" "</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>248</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeClass</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">names</span><span class="PUNC">=</span><span class="NAME">element.className</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">names</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.className</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">names.replace</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"(^|\\s+)"</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">+</span><span class="STRN">"(\\s+|$)"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>249</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toggleClass</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.hasClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>250</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">&&</span><span class="NAME">element.style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">element.style</span><span class="PUNC">[</span><span class="NAME">OpenLayers.String.camelize</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.defaultView</span><span class="PUNC">&&</span><span class="NAME">document.defaultView.getComputedStyle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">css</span><span class="PUNC">=</span><span class="NAME">document.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">css</span><span class="PUNC">?</span><span class="NAME">css.getPropertyValue</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.currentStyle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">element.currentStyle</span><span class="PUNC">[</span><span class="NAME">OpenLayers.String.camelize</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>251</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">positions</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'left'</span><span class="PUNC">,</span><span class="STRN">'top'</span><span class="PUNC">,</span><span class="STRN">'right'</span><span class="PUNC">,</span><span class="STRN">'bottom'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.opera</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">positions</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="STRN">'position'</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'static'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="STRN">'auto'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>252</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">==</span><span class="STRN">'auto'</span><span class="PUNC">?</span><span class="KEYW">null</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Size</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.w</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.h</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="STRN">"w="</span><span class="PUNC">+</span><span class="NAME">this.w</span><span class="PUNC">+</span><span class="STRN">",h="</span><span class="PUNC">+</span><span class="NAME">this.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">,</span><span class="NAME">this.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sz</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equals</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">==</span><span class="NAME">sz.w</span><span class="PUNC">&&</span><span class="NAME">this.h</span><span class="PUNC">==</span><span class="NAME">sz.h</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.h</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">sz.w</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">sz.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>253</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Size"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">log</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">debug</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">info</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">warn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">error</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">userError</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">assert</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dir</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dirxml</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">trace</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">group</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">groupEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">time</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">timeEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">profile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">profileEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">count</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Console"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scripts</span><span class="PUNC">=</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"script"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">scripts.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">scripts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">src.indexOf</span><span class="PUNC">(</span><span class="STRN">"firebug.js"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">console</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Console</span><span class="PUNC">,</span><span class="NAME">console</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Icon</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">calculateOffset</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imageDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">calculateOffset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.offset</span><span class="PUNC">=</span><span class="NAME">offset</span><span class="PUNC">?</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">this.size.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">this.size.h</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.calculateOffset</span><span class="PUNC">=</span><span class="NAME">calculateOffset</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="STRN">"OL_Icon_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.imageDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.erase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.imageDiv.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.imageDiv.innerHTML</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.imageDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Icon</span><span class="PUNC">(</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.size</span><span class="PUNC">,</span><span class="NAME">this.offset</span><span class="PUNC">,</span><span class="NAME">this.calculateOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>254</span> </span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setUrl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>255</span> </span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.size</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.imageDiv</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">erase</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.imageDiv.parentNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.remove</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.px</span><span class="PUNC">=</span><span class="NAME">px</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>256</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.px</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.display</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.calculateOffset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.offset</span><span class="PUNC">=</span><span class="NAME">this.calculateOffset</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>257</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsetPx</span><span class="PUNC">=</span><span class="NAME">this.px.offset</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.modifyAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">offsetPx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">display</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imageDiv.style.display</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isDrawn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isDrawn</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.imageDiv</span><span class="PUNC">&&</span><span class="NAME">this.imageDiv.parentNode</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.imageDiv.parentNode.nodeType</span><span class="PUNC">!=</span><span class="NUMB">11</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">isDrawn</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Icon"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">backgroundColor</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">border</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">contentDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">groupDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">closeDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">autoSize</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">minSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="STRN">"olPopup"</span><span class="PUNC">,</span><span class="NAME">contentDisplayClass</span><span class="PUNC">:</span><span class="STRN">"olPopupContent"</span><span class="PUNC">,</span><span class="NAME">padding</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">disableFirefoxOverflowHack</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">fixPadding</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.padding</span><span class="PUNC">==</span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.padding</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">this.padding</span><span class="PUNC">,</span><span class="NAME">this.padding</span><span class="PUNC">,</span><span class="NAME">this.padding</span><span class="PUNC">,</span><span class="NAME">this.padding</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">panMapIfOutOfView</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">keepInMap</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">closeOnMove</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">,</span><span class="NAME">closeBoxCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>258</span> </span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">id</span><span class="PUNC">;</span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat</span><span class="PUNC">;</span><span class="NAME">this.contentSize</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">contentSize</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">contentSize</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Popup.WIDTH</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Popup.HEIGHT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">contentHTML</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentHTML</span><span class="PUNC">=</span><span class="NAME">contentHTML</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>259</span> </span><span class="NAME">this.backgroundColor</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Popup.COLOR</span><span class="PUNC">;</span><span class="NAME">this.opacity</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Popup.OPACITY</span><span class="PUNC">;</span><span class="NAME">this.border</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Popup.BORDER</span><span class="PUNC">;</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.className</span><span class="PUNC">=</span><span class="NAME">this.displayClass</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">groupDivId</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_GroupDiv"</span><span class="PUNC">;</span><span class="NAME">this.groupDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">groupDivId</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"relative"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.div.id</span><span class="PUNC">+</span><span class="STRN">"_contentDiv"</span><span class="PUNC">;</span><span class="NAME">this.contentDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.contentSize.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"relative"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.contentDiv.className</span><span class="PUNC">=</span><span class="NAME">this.contentDisplayClass</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.groupDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">closeBox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addCloseBox</span><span class="PUNC">(</span><span class="NAME">closeBoxCallback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>260</span> </span><span class="NAME">this.registerEvents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.contentHTML</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.backgroundColor</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.opacity</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.border</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.closeOnMove</span><span class="PUNC">&&</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.unregister</span><span class="PUNC">(</span><span class="STRN">"movestart"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.hide</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>261</span> </span><span class="NAME">this.events.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>262</span> </span><span class="NAME">this.closeDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.div.removeChild</span><span class="PUNC">(</span><span class="NAME">this.groupDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.groupDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.removePopup</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>263</span> </span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.autoSize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.minSize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.maxSize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.padding</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.panMapIfOutOfView</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.map.getLayerPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>264</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.closeOnMove</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"movestart"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.hide</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>265</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.disableFirefoxOverflowHack</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'firefox'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"movestart"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">document.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentOverflow</span><span class="PUNC">=</span><span class="NAME">style.getPropertyValue</span><span class="PUNC">(</span><span class="STRN">"overflow"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentOverflow</span><span class="PUNC">!=</span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentDiv._oldOverflow</span><span class="PUNC">=</span><span class="NAME">currentOverflow</span><span class="PUNC">;</span><span class="NAME">this.contentDiv.style.overflow</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldOverflow</span><span class="PUNC">=</span><span class="NAME">this.contentDiv._oldOverflow</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oldOverflow</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentDiv.style.overflow</span><span class="PUNC">=</span><span class="NAME">oldOverflow</span><span class="PUNC">;</span><span class="NAME">this.contentDiv._oldOverflow</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>266</span> </span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.autoSize</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setSize</span><span class="PUNC">(</span><span class="NAME">this.contentSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>267</span> </span><span class="NAME">this.setBackgroundColor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setOpacity</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setBorder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setContentHTML</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.panMapIfOutOfView</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panIntoView</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>268</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updatePosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.map.getLayerPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.left</span><span class="PUNC">=</span><span class="NAME">px.x</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.div.style.top</span><span class="PUNC">=</span><span class="NAME">px.y</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">visible</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Element.visible</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toggle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.visible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">show</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.show</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.panMapIfOutOfView</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panIntoView</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hide</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.hide</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contentSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">contentSize.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contentDivPadding</span><span class="PUNC">=</span><span class="NAME">this.getContentDivPadding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wPadding</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.left</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hPadding</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.top</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.bottom</span><span class="PUNC">;</span><span class="NAME">this.fixPadding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">wPadding</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.padding.left</span><span class="PUNC">+</span><span class="NAME">this.padding.right</span><span class="PUNC">;</span><span class="NAME">hPadding</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.padding.top</span><span class="PUNC">+</span><span class="NAME">this.padding.bottom</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">closeDivWidth</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.closeDiv.style.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">wPadding</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">closeDivWidth</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>269</span> </span><span class="NAME">this.size.w</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">wPadding</span><span class="PUNC">;</span><span class="NAME">this.size.h</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">hPadding</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"msie"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentSize.w</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.left</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">;</span><span class="NAME">this.contentSize.h</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.bottom</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.top</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>270</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.width</span><span class="PUNC">=</span><span class="NAME">this.size.w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.div.style.height</span><span class="PUNC">=</span><span class="NAME">this.size.h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>271</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentDiv.style.width</span><span class="PUNC">=</span><span class="NAME">contentSize.w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.contentDiv.style.height</span><span class="PUNC">=</span><span class="NAME">contentSize.h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preparedHTML</span><span class="PUNC">=</span><span class="STRN">"&lt;div class='"</span><span class="PUNC">+</span><span class="NAME">this.contentDisplayClass</span><span class="PUNC">+</span><span class="STRN">"'>"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>272</span> </span><span class="NAME">this.contentDiv.innerHTML</span><span class="PUNC">+</span><span class="STRN">"&lt;/div>"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">containerElement</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.map.layerContainerDiv</span><span class="PUNC">:</span><span class="NAME">document.body</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">realSize</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getRenderedDimensions</span><span class="PUNC">(</span><span class="NAME">preparedHTML</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="NAME">this.displayClass</span><span class="PUNC">,</span><span class="NAME">containerElement</span><span class="PUNC">:</span><span class="NAME">containerElement</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">safeSize</span><span class="PUNC">=</span><span class="NAME">this.getSafeContentSize</span><span class="PUNC">(</span><span class="NAME">realSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newSize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">safeSize.equals</span><span class="PUNC">(</span><span class="NAME">realSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newSize</span><span class="PUNC">=</span><span class="NAME">realSize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fixedSize</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">fixedSize.w</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">safeSize.w</span><span class="PUNC">&lt;</span><span class="NAME">realSize.w</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">safeSize.w</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">fixedSize.h</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">safeSize.h</span><span class="PUNC">&lt;</span><span class="NAME">realSize.h</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">safeSize.h</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fixedSize.w</span><span class="PUNC">&&</span><span class="NAME">fixedSize.h</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newSize</span><span class="PUNC">=</span><span class="NAME">safeSize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clippedSize</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getRenderedDimensions</span><span class="PUNC">(</span><span class="NAME">preparedHTML</span><span class="PUNC">,</span><span class="NAME">fixedSize</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="NAME">this.contentDisplayClass</span><span class="PUNC">,</span><span class="NAME">containerElement</span><span class="PUNC">:</span><span class="NAME">containerElement</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentOverflow</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">,</span><span class="STRN">"overflow"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">currentOverflow</span><span class="PUNC">!=</span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">clippedSize.equals</span><span class="PUNC">(</span><span class="NAME">safeSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollBar</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getScrollbarWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fixedSize.w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">clippedSize.h</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">scrollBar</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">clippedSize.w</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">scrollBar</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>273</span> </span><span class="NAME">newSize</span><span class="PUNC">=</span><span class="NAME">this.getSafeContentSize</span><span class="PUNC">(</span><span class="NAME">clippedSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>274</span> </span><span class="NAME">this.setSize</span><span class="PUNC">(</span><span class="NAME">newSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBackgroundColor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backgroundColor</span><span class="PUNC">=</span><span class="NAME">color</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>275</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.backgroundColor</span><span class="PUNC">=</span><span class="NAME">this.backgroundColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.opacity</span><span class="PUNC">=</span><span class="NAME">opacity</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>276</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.opacity</span><span class="PUNC">=</span><span class="NAME">this.opacity</span><span class="PUNC">;</span><span class="NAME">this.div.style.filter</span><span class="PUNC">=</span><span class="STRN">'alpha(opacity='</span><span class="PUNC">+</span><span class="NAME">this.opacity</span><span class="PUNC">*</span><span class="NUMB">100</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBorder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">border</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.border</span><span class="PUNC">=</span><span class="NAME">border</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>277</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.border</span><span class="PUNC">=</span><span class="NAME">this.border</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setContentHTML</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contentHTML</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">contentHTML</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentHTML</span><span class="PUNC">=</span><span class="NAME">contentHTML</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>278</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.contentHTML</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.contentHTML</span><span class="PUNC">!=</span><span class="NAME">this.contentDiv.innerHTML</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentDiv.innerHTML</span><span class="PUNC">=</span><span class="NAME">this.contentHTML</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.autoSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.registerImageListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.updateSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">registerImageListeners</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onImgLoad</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.popup.updateSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.popup.visible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.popup.panMapIfOutOfView</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.popup.panIntoView</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>279</span> </span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">this.img</span><span class="PUNC">,</span><span class="STRN">"load"</span><span class="PUNC">,</span><span class="NAME">this.img._onImageLoad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">images</span><span class="PUNC">=</span><span class="NAME">this.contentDiv.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"img"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">images.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">images</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">img.width</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">img.height</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'popup'</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="STRN">'img'</span><span class="PUNC">:</span><span class="NAME">img</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">img._onImgLoad</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">onImgLoad</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="STRN">'load'</span><span class="PUNC">,</span><span class="NAME">img._onImgLoad</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getSafeContentSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">safeContentSize</span><span class="PUNC">=</span><span class="NAME">size.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contentDivPadding</span><span class="PUNC">=</span><span class="NAME">this.getContentDivPadding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wPadding</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.left</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hPadding</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.top</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.bottom</span><span class="PUNC">;</span><span class="NAME">this.fixPadding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">wPadding</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.padding.left</span><span class="PUNC">+</span><span class="NAME">this.padding.right</span><span class="PUNC">;</span><span class="NAME">hPadding</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.padding.top</span><span class="PUNC">+</span><span class="NAME">this.padding.bottom</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">closeDivWidth</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.closeDiv.style.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">wPadding</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">closeDivWidth</span><span class="PUNC">+</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>280</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.minSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">safeContentSize.w</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">safeContentSize.w</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.minSize.w</span><span class="PUNC">-</span><span class="NAME">wPadding</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">safeContentSize.h</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">safeContentSize.h</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.minSize.h</span><span class="PUNC">-</span><span class="NAME">hPadding</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>281</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.maxSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">safeContentSize.w</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">safeContentSize.w</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.maxSize.w</span><span class="PUNC">-</span><span class="NAME">wPadding</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">safeContentSize.h</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">safeContentSize.h</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.maxSize.h</span><span class="PUNC">-</span><span class="NAME">hPadding</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>282</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">&&</span><span class="NAME">this.map.size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extraX</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">extraY</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.keepInMap</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.panMapIfOutOfView</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.map.getPixelFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.relativePosition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"tr"</span><span class="PUNC">:</span><span class="NAME">extraX</span><span class="PUNC">=</span><span class="NAME">px.x</span><span class="PUNC">;</span><span class="NAME">extraY</span><span class="PUNC">=</span><span class="NAME">this.map.size.h</span><span class="PUNC">-</span><span class="NAME">px.y</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"tl"</span><span class="PUNC">:</span><span class="NAME">extraX</span><span class="PUNC">=</span><span class="NAME">this.map.size.w</span><span class="PUNC">-</span><span class="NAME">px.x</span><span class="PUNC">;</span><span class="NAME">extraY</span><span class="PUNC">=</span><span class="NAME">this.map.size.h</span><span class="PUNC">-</span><span class="NAME">px.y</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"bl"</span><span class="PUNC">:</span><span class="NAME">extraX</span><span class="PUNC">=</span><span class="NAME">this.map.size.w</span><span class="PUNC">-</span><span class="NAME">px.x</span><span class="PUNC">;</span><span class="NAME">extraY</span><span class="PUNC">=</span><span class="NAME">px.y</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"br"</span><span class="PUNC">:</span><span class="NAME">extraX</span><span class="PUNC">=</span><span class="NAME">px.x</span><span class="PUNC">;</span><span class="NAME">extraY</span><span class="PUNC">=</span><span class="NAME">px.y</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="NAME">extraX</span><span class="PUNC">=</span><span class="NAME">px.x</span><span class="PUNC">;</span><span class="NAME">extraY</span><span class="PUNC">=</span><span class="NAME">this.map.size.h</span><span class="PUNC">-</span><span class="NAME">px.y</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>283</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="PUNC">=</span><span class="NAME">this.map.size.h</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>284</span> </span><span class="NAME">this.map.paddingForPopups.top</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>285</span> </span><span class="NAME">this.map.paddingForPopups.bottom</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>286</span> </span><span class="NAME">hPadding</span><span class="PUNC">-</span><span class="NAME">extraY</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="PUNC">=</span><span class="NAME">this.map.size.w</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>287</span> </span><span class="NAME">this.map.paddingForPopups.left</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>288</span> </span><span class="NAME">this.map.paddingForPopups.right</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>289</span> </span><span class="NAME">wPadding</span><span class="PUNC">-</span><span class="NAME">extraX</span><span class="PUNC">;</span><span class="NAME">safeContentSize.w</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">safeContentSize.w</span><span class="PUNC">,</span><span class="NAME">maxX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">safeContentSize.h</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">safeContentSize.h</span><span class="PUNC">,</span><span class="NAME">maxY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>290</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">safeContentSize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getContentDivPadding</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contentDivPadding</span><span class="PUNC">=</span><span class="NAME">this._contentDivPadding</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">contentDivPadding</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div.parentNode</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>291</span> </span><span class="NAME">contentDivPadding</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">,</span><span class="STRN">"padding-left"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">,</span><span class="STRN">"padding-bottom"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">,</span><span class="STRN">"padding-right"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">,</span><span class="STRN">"padding-top"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._contentDivPadding</span><span class="PUNC">=</span><span class="NAME">contentDivPadding</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div.parentNode</span><span class="PUNC">==</span><span class="NAME">document.body</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.body.removeChild</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.style.display</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>292</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contentDivPadding</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addCloseBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.closeDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_close"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="NUMB">17</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.closeDiv.className</span><span class="PUNC">=</span><span class="STRN">"olPopupCloseBox"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contentDivPadding</span><span class="PUNC">=</span><span class="NAME">this.getContentDivPadding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.closeDiv.style.right</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.closeDiv.style.top</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.top</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">closePopup</span><span class="PUNC">=</span><span class="NAME">callback</span><span class="PUNC">||</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">closePopup</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">panIntoView</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mapSize</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origTL</span><span class="PUNC">=</span><span class="NAME">this.map.getViewPortPxFromLayerPx</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.div.style.left</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.div.style.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newTL</span><span class="PUNC">=</span><span class="NAME">origTL.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">origTL.x</span><span class="PUNC">&lt;</span><span class="NAME">this.map.paddingForPopups.left</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newTL.x</span><span class="PUNC">=</span><span class="NAME">this.map.paddingForPopups.left</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>293</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">origTL.x</span><span class="PUNC">+</span><span class="NAME">this.size.w</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">(</span><span class="NAME">mapSize.w</span><span class="PUNC">-</span><span class="NAME">this.map.paddingForPopups.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newTL.x</span><span class="PUNC">=</span><span class="NAME">mapSize.w</span><span class="PUNC">-</span><span class="NAME">this.map.paddingForPopups.right</span><span class="PUNC">-</span><span class="NAME">this.size.w</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>294</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">origTL.y</span><span class="PUNC">&lt;</span><span class="NAME">this.map.paddingForPopups.top</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newTL.y</span><span class="PUNC">=</span><span class="NAME">this.map.paddingForPopups.top</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>295</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">origTL.y</span><span class="PUNC">+</span><span class="NAME">this.size.h</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">(</span><span class="NAME">mapSize.h</span><span class="PUNC">-</span><span class="NAME">this.map.paddingForPopups.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newTL.y</span><span class="PUNC">=</span><span class="NAME">mapSize.h</span><span class="PUNC">-</span><span class="NAME">this.map.paddingForPopups.bottom</span><span class="PUNC">-</span><span class="NAME">this.size.h</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>296</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">=</span><span class="NAME">origTL.x</span><span class="PUNC">-</span><span class="NAME">newTL.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">origTL.y</span><span class="PUNC">-</span><span class="NAME">newTL.y</span><span class="PUNC">;</span><span class="NAME">this.map.pan</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">registerEvents</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mousedown"</span><span class="PUNC">:</span><span class="NAME">this.onmousedown</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.onmousemove</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">:</span><span class="NAME">this.onmouseup</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">:</span><span class="NAME">this.onclick</span><span class="PUNC">,</span><span class="STRN">"mouseout"</span><span class="PUNC">:</span><span class="NAME">this.onmouseout</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">:</span><span class="NAME">this.ondblclick</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onmousedown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.mousedown</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onmousemove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.mousedown</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onmouseup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.mousedown</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.mousedown</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onclick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onmouseout</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.mousedown</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">ondblclick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Popup"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.WIDTH</span><span class="PUNC">=</span><span class="NUMB">200</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.HEIGHT</span><span class="PUNC">=</span><span class="NUMB">200</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.COLOR</span><span class="PUNC">=</span><span class="STRN">"white"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.OPACITY</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.BORDER</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">container</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">root</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">extent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">locked</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">resolution</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">containerID</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.container</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">containerID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.container</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.extent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">supported</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">resolutionChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.extent</span><span class="PUNC">=</span><span class="NAME">extent.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">resolutionChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">size.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getResolution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="NAME">this.resolution</span><span class="PUNC">||</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.resolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">feature.style</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>297</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">feature.geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bounds.intersectsBounds</span><span class="PUNC">(</span><span class="NAME">this.extent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">display</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>298</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rendered</span><span class="PUNC">=</span><span class="NAME">this.drawGeometry</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">feature.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.display</span><span class="PUNC">!=</span><span class="STRN">"none"</span><span class="PUNC">&&</span><span class="NAME">style.label</span><span class="PUNC">&&</span><span class="NAME">rendered</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">=</span><span class="NAME">feature.geometry.getCentroid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.labelXOffset</span><span class="PUNC">||</span><span class="NAME">style.labelYOffset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">xOffset</span><span class="PUNC">=</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">style.labelXOffset</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">style.labelXOffset</span><span class="PUNC">;</span><span class="NAME">yOffset</span><span class="PUNC">=</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">style.labelYOffset</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">style.labelYOffset</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">location.move</span><span class="PUNC">(</span><span class="NAME">xOffset</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">,</span><span class="NAME">yOffset</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>299</span> </span><span class="NAME">this.drawText</span><span class="PUNC">(</span><span class="NAME">feature.id</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.removeText</span><span class="PUNC">(</span><span class="NAME">feature.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>300</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rendered</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureIdFromEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">eraseFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">features</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>301</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.eraseGeometry</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">,</span><span class="NAME">feature.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.removeText</span><span class="PUNC">(</span><span class="NAME">feature.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">eraseGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">renderer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getRenderLayerId</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.container.id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">applyDefaultSymbolizer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Renderer.defaultSymbolizer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">symbolizer.stroke</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">result.strokeWidth</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">result.strokeColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>302</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">symbolizer.fill</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">result.fillColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>303</span> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Renderer"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.defaultSymbolizer</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="STRN">"#000000"</span><span class="PUNC">,</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="STRN">"#000000"</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Symbolizer</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">zIndex</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Type</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Type</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Symbolizer"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">centerLonLat</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.left</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>304</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bottom</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bottom</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>305</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.right</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>306</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.top</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="NAME">this.bottom</span><span class="PUNC">,</span><span class="NAME">this.right</span><span class="PUNC">,</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equals</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">==</span><span class="NAME">bounds.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">==</span><span class="NAME">bounds.right</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">==</span><span class="NAME">bounds.top</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">==</span><span class="NAME">bounds.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>307</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="STRN">"left-bottom=("</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">this.bottom</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="WHIT">
<span class='line'>308</span> </span><span class="PUNC">+</span><span class="STRN">" right-top=("</span><span class="PUNC">+</span><span class="NAME">this.right</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">this.top</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toArray</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">reverseAxisOrder</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">reverseAxisOrder</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">this.bottom</span><span class="PUNC">,</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="NAME">this.top</span><span class="PUNC">,</span><span class="NAME">this.right</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="NAME">this.bottom</span><span class="PUNC">,</span><span class="NAME">this.right</span><span class="PUNC">,</span><span class="NAME">this.top</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toBBOX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">decimal</span><span class="PUNC">,</span><span class="NAME">reverseAxisOrder</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">decimal</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">decimal</span><span class="PUNC">=</span><span class="NUMB">6</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>309</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mult</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NAME">decimal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmin</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">*</span><span class="NAME">mult</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">mult</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ymin</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">*</span><span class="NAME">mult</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">mult</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmax</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">*</span><span class="NAME">mult</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">mult</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ymax</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">*</span><span class="NAME">mult</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">mult</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">reverseAxisOrder</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ymin</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">xmin</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">ymax</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">xmax</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">xmin</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">ymin</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">xmax</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">ymax</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">,</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">,</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getWidth</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">-</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getHeight</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCenterPixel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">+</span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">+</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCenterLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.centerLonLat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.centerLonLat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">+</span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">+</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>310</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.centerLonLat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">scale</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ratio</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">origin</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">origin</span><span class="PUNC">=</span><span class="NAME">this.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>311</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origx</span><span class="PUNC">,</span><span class="NAME">origy</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">origin.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.LonLat"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">origx</span><span class="PUNC">=</span><span class="NAME">origin.lon</span><span class="PUNC">;</span><span class="NAME">origy</span><span class="PUNC">=</span><span class="NAME">origin.lat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">origx</span><span class="PUNC">=</span><span class="NAME">origin.x</span><span class="PUNC">;</span><span class="NAME">origy</span><span class="PUNC">=</span><span class="NAME">origin.y</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>312</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">-</span><span class="NAME">origx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">+</span><span class="NAME">origx</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">-</span><span class="NAME">origy</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">+</span><span class="NAME">origy</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">-</span><span class="NAME">origx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">+</span><span class="NAME">origx</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">origy</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">+</span><span class="NAME">origy</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">add</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"boundsAddError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>313</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">this.bottom</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">this.right</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">this.top</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">extend</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">object.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.LonLat"</span><span class="PUNC">:</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">object.lon</span><span class="PUNC">,</span><span class="NAME">object.lat</span><span class="PUNC">,</span><span class="NAME">object.lon</span><span class="PUNC">,</span><span class="NAME">object.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">:</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">object.x</span><span class="PUNC">,</span><span class="NAME">object.y</span><span class="PUNC">,</span><span class="NAME">object.x</span><span class="PUNC">,</span><span class="NAME">object.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Bounds"</span><span class="PUNC">:</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">object</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>314</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.centerLonLat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">&lt;</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.left</span><span class="PUNC">=</span><span class="NAME">bounds.left</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>315</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">bounds.bottom</span><span class="PUNC">&lt;</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bottom</span><span class="PUNC">=</span><span class="NAME">bounds.bottom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>316</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">bounds.right</span><span class="PUNC">></span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.right</span><span class="PUNC">=</span><span class="NAME">bounds.right</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>317</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">bounds.top</span><span class="PUNC">></span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.top</span><span class="PUNC">=</span><span class="NAME">bounds.top</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">containsLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ll</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">ll.lon</span><span class="PUNC">,</span><span class="NAME">ll.lat</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">containsPixel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">,</span><span class="NAME">px.y</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">contains</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">inclusive</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inclusive</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>318</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">y</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>319</span> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contains</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">contains</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">>=</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;=</span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">>=</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">&lt;=</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">contains</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">></span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">></span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>320</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contains</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">intersectsBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">inclusive</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inclusive</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>321</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersects</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mightTouch</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">==</span><span class="NAME">bounds.right</span><span class="PUNC">||</span><span class="NAME">this.right</span><span class="PUNC">==</span><span class="NAME">bounds.left</span><span class="PUNC">||</span><span class="NAME">this.top</span><span class="PUNC">==</span><span class="NAME">bounds.bottom</span><span class="PUNC">||</span><span class="NAME">this.bottom</span><span class="PUNC">==</span><span class="NAME">bounds.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">inclusive</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">mightTouch</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inBottom</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bounds.bottom</span><span class="PUNC">>=</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">bounds.bottom</span><span class="PUNC">&lt;=</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">>=</span><span class="NAME">bounds.bottom</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.bottom</span><span class="PUNC">&lt;=</span><span class="NAME">bounds.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inTop</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bounds.top</span><span class="PUNC">>=</span><span class="NAME">this.bottom</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">bounds.top</span><span class="PUNC">&lt;=</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">></span><span class="NAME">bounds.bottom</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">&lt;</span><span class="NAME">bounds.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inLeft</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">>=</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">&lt;=</span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">>=</span><span class="NAME">bounds.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.left</span><span class="PUNC">&lt;=</span><span class="NAME">bounds.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inRight</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bounds.right</span><span class="PUNC">>=</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">bounds.right</span><span class="PUNC">&lt;=</span><span class="NAME">this.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">>=</span><span class="NAME">bounds.left</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.right</span><span class="PUNC">&lt;=</span><span class="NAME">bounds.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">intersects</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">inBottom</span><span class="PUNC">||</span><span class="NAME">inTop</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">inLeft</span><span class="PUNC">||</span><span class="NAME">inRight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>322</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersects</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">containsBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">partial</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">partial</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">partial</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>323</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">inclusive</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inclusive</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>324</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomLeft</span><span class="PUNC">=</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">,</span><span class="NAME">bounds.bottom</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomRight</span><span class="PUNC">=</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">bounds.right</span><span class="PUNC">,</span><span class="NAME">bounds.bottom</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topLeft</span><span class="PUNC">=</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">,</span><span class="NAME">bounds.top</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topRight</span><span class="PUNC">=</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">bounds.right</span><span class="PUNC">,</span><span class="NAME">bounds.top</span><span class="PUNC">,</span><span class="NAME">inclusive</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">partial</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">bottomLeft</span><span class="PUNC">||</span><span class="NAME">bottomRight</span><span class="PUNC">||</span><span class="NAME">topLeft</span><span class="PUNC">||</span><span class="NAME">topRight</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">bottomLeft</span><span class="PUNC">&&</span><span class="NAME">bottomRight</span><span class="PUNC">&&</span><span class="NAME">topLeft</span><span class="PUNC">&&</span><span class="NAME">topRight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">determineQuadrant</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">quadrant</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">quadrant</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">lonlat.lat</span><span class="PUNC">&lt;</span><span class="NAME">center.lat</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"b"</span><span class="PUNC">:</span><span class="STRN">"t"</span><span class="PUNC">;</span><span class="NAME">quadrant</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">&lt;</span><span class="NAME">center.lon</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"l"</span><span class="PUNC">:</span><span class="STRN">"r"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">quadrant</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">transform</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.centerLonLat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ll</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'x'</span><span class="PUNC">:</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">:</span><span class="NAME">this.bottom</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lr</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'x'</span><span class="PUNC">:</span><span class="NAME">this.right</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">:</span><span class="NAME">this.bottom</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ul</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'x'</span><span class="PUNC">:</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">:</span><span class="NAME">this.top</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ur</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'x'</span><span class="PUNC">:</span><span class="NAME">this.right</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">:</span><span class="NAME">this.top</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.left</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">ll.x</span><span class="PUNC">,</span><span class="NAME">ul.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.bottom</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">ll.y</span><span class="PUNC">,</span><span class="NAME">lr.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.right</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">lr.x</span><span class="PUNC">,</span><span class="NAME">ur.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.top</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">ul.y</span><span class="PUNC">,</span><span class="NAME">ur.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wrapDateLine</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">leftTolerance</span><span class="PUNC">=</span><span class="NAME">options.leftTolerance</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rightTolerance</span><span class="PUNC">=</span><span class="NAME">options.rightTolerance</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newBounds</span><span class="PUNC">=</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">newBounds.left</span><span class="PUNC">&lt;</span><span class="NAME">maxExtent.left</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">newBounds.right</span><span class="PUNC">-</span><span class="NAME">rightTolerance</span><span class="PUNC">)</span><span class="PUNC">&lt;=</span><span class="NAME">maxExtent.left</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newBounds</span><span class="PUNC">=</span><span class="NAME">newBounds.add</span><span class="PUNC">(</span><span class="NAME">maxExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>325</span> </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">newBounds.left</span><span class="PUNC">+</span><span class="NAME">leftTolerance</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NAME">maxExtent.right</span><span class="PUNC">&&</span><span class="NAME">newBounds.right</span><span class="PUNC">></span><span class="NAME">maxExtent.right</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newBounds</span><span class="PUNC">=</span><span class="NAME">newBounds.add</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">maxExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>326</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newBounds</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Bounds"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Bounds.fromString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">str.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds.fromArray</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Bounds.fromArray</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bbox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">bbox</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">bbox</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">bbox</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">bbox</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Bounds.fromSize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">size.h</span><span class="PUNC">,</span><span class="NAME">size.w</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Bounds.oppositeQuadrant</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">quadrant</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">opp</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">opp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">quadrant.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'t'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">'b'</span><span class="PUNC">:</span><span class="STRN">'t'</span><span class="PUNC">;</span><span class="NAME">opp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">quadrant.charAt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'l'</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">'r'</span><span class="PUNC">:</span><span class="STRN">'l'</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">opp</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">lon</span><span class="PUNC">:</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">:</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lon</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.lat</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="STRN">"lon="</span><span class="PUNC">+</span><span class="NAME">this.lon</span><span class="PUNC">+</span><span class="STRN">",lat="</span><span class="PUNC">+</span><span class="NAME">this.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toShortString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.lon</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">this.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">this.lon</span><span class="PUNC">,</span><span class="NAME">this.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">add</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">lat</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"lonlatAddError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>327</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">this.lon</span><span class="PUNC">+</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.lat</span><span class="PUNC">+</span><span class="NAME">OpenLayers.Util.toFloat</span><span class="PUNC">(</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ll</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ll</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equals</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.lon</span><span class="PUNC">==</span><span class="NAME">ll.lon</span><span class="PUNC">&&</span><span class="NAME">this.lat</span><span class="PUNC">==</span><span class="NAME">ll.lat</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.lon</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.lat</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">ll.lon</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">ll.lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>328</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">transform</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'x'</span><span class="PUNC">:</span><span class="NAME">this.lon</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">:</span><span class="NAME">this.lat</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.lon</span><span class="PUNC">=</span><span class="NAME">point.x</span><span class="PUNC">;</span><span class="NAME">this.lat</span><span class="PUNC">=</span><span class="NAME">point.y</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wrapDateLine</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newLonLat</span><span class="PUNC">=</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">newLonLat.lon</span><span class="PUNC">&lt;</span><span class="NAME">maxExtent.left</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newLonLat.lon</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">maxExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>329</span> </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">newLonLat.lon</span><span class="PUNC">></span><span class="NAME">maxExtent.right</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newLonLat.lon</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">maxExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>330</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newLonLat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.LonLat"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.LonLat.fromString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="PUNC">=</span><span class="NAME">str.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">pair</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pair</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="STRN">"x="</span><span class="PUNC">+</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="STRN">",y="</span><span class="PUNC">+</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equals</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">==</span><span class="NAME">px.x</span><span class="PUNC">&&</span><span class="NAME">this.y</span><span class="PUNC">==</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>331</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">add</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"pixelAddError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>332</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">this.add</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">,</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>333</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Pixel"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">allowSelection</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">title</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">autoActivate</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">active</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">handler</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">eventListeners</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"activate"</span><span class="PUNC">,</span><span class="STRN">"deactivate"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.displayClass</span><span class="PUNC">=</span><span class="NAME">this.CLASS_NAME.replace</span><span class="PUNC">(</span><span class="STRN">"OpenLayers."</span><span class="PUNC">,</span><span class="STRN">"ol"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\./g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.on</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>334</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.events</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.un</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>335</span> </span><span class="NAME">this.events.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>336</span> </span><span class="NAME">this.eventListeners</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handler</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handler.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handler</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>337</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handlers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.handlers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handlers.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.handlers</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>338</span> </span><span class="NAME">this.handlers</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>339</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.removeControl</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handler</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handler.setMap</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.className</span><span class="PUNC">=</span><span class="NAME">this.displayClass</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.allowSelection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.className</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" olControlNoSelect"</span><span class="PUNC">;</span><span class="NAME">this.div.setAttribute</span><span class="PUNC">(</span><span class="STRN">"unselectable"</span><span class="PUNC">,</span><span class="STRN">"on"</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.onselectstart</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.False</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>340</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.title</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.title</span><span class="PUNC">=</span><span class="NAME">this.title</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>341</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="NAME">px.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>342</span> </span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">this.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.left</span><span class="PUNC">=</span><span class="NAME">px.x</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.div.style.top</span><span class="PUNC">=</span><span class="NAME">px.y</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>343</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handler</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handler.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>344</span> </span><span class="NAME">this.active</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="NAME">this.displayClass.replace</span><span class="PUNC">(</span><span class="REGX">/ /g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"Active"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>345</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"activate"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handler</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handler.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>346</span> </span><span class="NAME">this.active</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="NAME">this.displayClass.replace</span><span class="PUNC">(</span><span class="REGX">/ /g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"Active"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>347</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"deactivate"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>348</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.TYPE_BUTTON</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.TYPE_TOGGLE</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.TYPE_TOOL</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">code</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">defaultCode</span><span class="PUNC">:</span><span class="STRN">"en"</span><span class="PUNC">,</span><span class="NAME">getCode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Lang.code</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Lang.setCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>349</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Lang.code</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setCode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">code</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lang</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">code</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">code</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"msie"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">navigator.userLanguage</span><span class="PUNC">:</span><span class="NAME">navigator.language</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>350</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="NAME">code.split</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lang</span><span class="PUNC">=</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>351</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">testLang</span><span class="PUNC">=</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">'-'</span><span class="PUNC">+</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="NAME">testLang</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lang</span><span class="PUNC">=</span><span class="NAME">testLang</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>352</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">lang</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="STRN">'Failed to find OpenLayers.Lang.'</span><span class="PUNC">+</span><span class="NAME">parts.join</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">' dictionary, falling back to default language'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">lang</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Lang.defaultCode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>353</span> </span><span class="NAME">OpenLayers.Lang.code</span><span class="PUNC">=</span><span class="NAME">lang</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">translate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dictionary</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="NAME">OpenLayers.Lang.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">message</span><span class="PUNC">=</span><span class="NAME">dictionary</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">message</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">message</span><span class="PUNC">=</span><span class="NAME">key</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>354</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">message</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.format</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>355</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">message</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Lang.translate</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.Anchored</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Popup</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">relativePosition</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">keepInMap</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">,</span><span class="NAME">closeBoxCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newArguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">,</span><span class="NAME">closeBoxCallback</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newArguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.anchor</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.anchor</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.relativePosition</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">show</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.updatePosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.prototype.show.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldRelativePosition</span><span class="PUNC">=</span><span class="NAME">this.relativePosition</span><span class="PUNC">;</span><span class="NAME">this.relativePosition</span><span class="PUNC">=</span><span class="NAME">this.calculateRelativePosition</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">this.calculateNewPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newArguments</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">newPx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.prototype.moveTo.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newArguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.relativePosition</span><span class="PUNC">!=</span><span class="NAME">oldRelativePosition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.updateRelativePosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contentSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.prototype.setSize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.map.getLayerPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateRelativePosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromLayerPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">quadrant</span><span class="PUNC">=</span><span class="NAME">extent.determineQuadrant</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds.oppositeQuadrant</span><span class="PUNC">(</span><span class="NAME">quadrant</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateRelativePosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateNewPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">px.offset</span><span class="PUNC">(</span><span class="NAME">this.anchor.offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.size</span><span class="PUNC">||</span><span class="NAME">this.contentSize</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.relativePosition.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'t'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">newPx.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">size.h</span><span class="PUNC">+</span><span class="NAME">this.anchor.size.h</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.anchor.size.h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.relativePosition.charAt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'l'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">newPx.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">+</span><span class="NAME">this.anchor.size.w</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.anchor.size.w</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Popup.Anchored"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.Canvas</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Renderer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">canvas</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">features</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">containerID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.root</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.container.appendChild</span><span class="PUNC">(</span><span class="NAME">this.root</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas</span><span class="PUNC">=</span><span class="NAME">this.root.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.features</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">eraseGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eraseFeatures</span><span class="PUNC">(</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">featureId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">supported</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canvas</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">canvas.getContext</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.extent</span><span class="PUNC">=</span><span class="NAME">extent.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">size.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.root.style.width</span><span class="PUNC">=</span><span class="NAME">size.w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.root.style.height</span><span class="PUNC">=</span><span class="NAME">size.h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.root.width</span><span class="PUNC">=</span><span class="NAME">size.w</span><span class="PUNC">;</span><span class="NAME">this.root.height</span><span class="PUNC">=</span><span class="NAME">size.h</span><span class="PUNC">;</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">feature.style</span><span class="PUNC">;</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.applyDefaultSymbolizer</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">feature.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">=</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Collection"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiPoint"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiLineString"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiPolygon"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawGeometry</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>356</span> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>357</span> </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">:</span><span class="NAME">this.drawPoint</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">:</span><span class="NAME">this.drawLineString</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">:</span><span class="NAME">this.drawLinearRing</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">:</span><span class="NAME">this.drawPolygon</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawExternalGraphic</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Image</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphicTitle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">img.title</span><span class="PUNC">=</span><span class="NAME">style.graphicTitle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>358</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">style.graphicWidth</span><span class="PUNC">||</span><span class="NAME">style.graphicHeight</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">style.graphicHeight</span><span class="PUNC">||</span><span class="NAME">style.graphicWidth</span><span class="PUNC">;</span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">?</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">?</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">style.graphicXOffset</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">style.graphicXOffset</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">style.graphicYOffset</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">style.graphicYOffset</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">img</span><span class="PUNC">:</span><span class="NAME">img</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">xOffset</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">yOffset</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">height</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">:</span><span class="NAME">style.graphicOpacity</span><span class="PUNC">||</span><span class="NAME">style.fillOpacity</span><span class="PUNC">,</span><span class="NAME">canvas</span><span class="PUNC">:</span><span class="NAME">this.canvas</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">img.onload</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.canvas.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.opacity</span><span class="PUNC">;</span><span class="NAME">this.canvas.drawImage</span><span class="PUNC">(</span><span class="NAME">this.img</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">this.width</span><span class="PUNC">,</span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">img.src</span><span class="PUNC">=</span><span class="NAME">style.externalGraphic</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setCanvasStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"fill"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.canvas.globalAlpha</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">'fillOpacity'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.canvas.fillStyle</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">'fillColor'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"stroke"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.canvas.globalAlpha</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">'strokeOpacity'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.canvas.strokeStyle</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">'strokeColor'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.canvas.lineWidth</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">'strokeWidth'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.canvas.globalAlpha</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.canvas.lineWidth</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphic</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawExternalGraphic</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fill</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.arc</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">style.pointRadius</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>359</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.stroke</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.arc</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">style.pointRadius</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"reset"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLineString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.stroke</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.moveTo</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">start</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.lineTo</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>360</span> </span><span class="NAME">this.canvas.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>361</span> </span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"reset"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLinearRing</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fill</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.moveTo</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">start</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">geometry.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.lineTo</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>362</span> </span><span class="NAME">this.canvas.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>363</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.stroke</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.moveTo</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">start</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.lineTo</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>364</span> </span><span class="NAME">this.canvas.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>365</span> </span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"reset"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPolygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawLinearRing</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawLinearRing</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="STRN">'#000000'</span><span class="PUNC">,</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="STRN">'#000000'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">fontColor</span><span class="PUNC">:</span><span class="STRN">"#000000"</span><span class="PUNC">,</span><span class="NAME">labelAlign</span><span class="PUNC">:</span><span class="STRN">"cm"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="PUNC">=</span><span class="NAME">this.getLocalXY</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"reset"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.fillStyle</span><span class="PUNC">=</span><span class="NAME">style.fontColor</span><span class="PUNC">;</span><span class="NAME">this.canvas.globalAlpha</span><span class="PUNC">=</span><span class="NAME">style.fontOpacity</span><span class="PUNC">||</span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fontStyle</span><span class="PUNC">=</span><span class="NAME">style.fontWeight</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">style.fontSize</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">style.fontFamily</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.canvas.fillText</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelAlign</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Renderer.Canvas.LABEL_ALIGN</span><span class="PUNC">[</span><span class="NAME">style.labelAlign</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="STRN">"center"</span><span class="PUNC">;</span><span class="NAME">this.canvas.font</span><span class="PUNC">=</span><span class="NAME">fontStyle</span><span class="PUNC">;</span><span class="NAME">this.canvas.textAlign</span><span class="PUNC">=</span><span class="NAME">labelAlign</span><span class="PUNC">;</span><span class="NAME">this.canvas.fillText</span><span class="PUNC">(</span><span class="NAME">style.label</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.canvas.mozDrawText</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.canvas.mozTextStyle</span><span class="PUNC">=</span><span class="NAME">fontStyle</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.canvas.mozMeasureText</span><span class="PUNC">(</span><span class="NAME">style.label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">style.labelAlign</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"l"</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"r"</span><span class="PUNC">:</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"c"</span><span class="PUNC">:</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>366</span> </span><span class="NAME">this.canvas.translate</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.mozDrawText</span><span class="PUNC">(</span><span class="NAME">style.label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.canvas.translate</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">pt</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>367</span> </span><span class="NAME">this.setCanvasStyle</span><span class="PUNC">(</span><span class="STRN">"reset"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLocalXY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.extent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">extent.left</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">extent.top</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">point.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.canvas.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.root.width</span><span class="PUNC">,</span><span class="NAME">this.root.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.features</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureIdFromEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">loc.lon</span><span class="PUNC">-</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">loc.lat</span><span class="PUNC">-</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">loc.lon</span><span class="PUNC">+</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">loc.lat</span><span class="PUNC">+</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geom</span><span class="PUNC">=</span><span class="NAME">bounds.toGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feat</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.features.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">feat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>368</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">feat</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry.intersects</span><span class="PUNC">(</span><span class="NAME">geom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">feat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>369</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">eraseFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">features</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>370</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>371</span> </span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.locked</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.canvas.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.root.width</span><span class="PUNC">,</span><span class="NAME">this.root.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelMap</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.features.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>372</span> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">feature.geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>373</span> </span><span class="NAME">this.drawGeometry</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.label</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">labelMap.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>374</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">labelMap.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">item</span><span class="PUNC">=</span><span class="NAME">labelMap</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.drawText</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry.getCentroid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">item</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Renderer.Canvas"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.Canvas.LABEL_ALIGN</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"l"</span><span class="PUNC">:</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="STRN">"r"</span><span class="PUNC">:</span><span class="STRN">"right"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.ElementsIndexer</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">maxZIndex</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">order</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">indices</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">compare</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">yOrdering</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.compare</span><span class="PUNC">=</span><span class="NAME">yOrdering</span><span class="PUNC">?</span><span class="NAME">OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER</span><span class="PUNC">:</span><span class="NAME">OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER</span><span class="PUNC">;</span><span class="NAME">this.order</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.indices</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.maxZIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">insert</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.exists</span><span class="PUNC">(</span><span class="NAME">newNode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.remove</span><span class="PUNC">(</span><span class="NAME">newNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>375</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeId</span><span class="PUNC">=</span><span class="NAME">newNode.id</span><span class="PUNC">;</span><span class="NAME">this.determineZIndex</span><span class="PUNC">(</span><span class="NAME">newNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">leftIndex</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rightIndex</span><span class="PUNC">=</span><span class="NAME">this.order.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">middle</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">rightIndex</span><span class="PUNC">-</span><span class="NAME">leftIndex</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">middle</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">leftIndex</span><span class="PUNC">+</span><span class="NAME">rightIndex</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">placement</span><span class="PUNC">=</span><span class="NAME">this.compare</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newNode</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">this.order</span><span class="PUNC">[</span><span class="NAME">middle</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">placement</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">leftIndex</span><span class="PUNC">=</span><span class="NAME">middle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">rightIndex</span><span class="PUNC">=</span><span class="NAME">middle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>376</span> </span><span class="NAME">this.order.splice</span><span class="PUNC">(</span><span class="NAME">rightIndex</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">nodeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.indices</span><span class="PUNC">[</span><span class="NAME">nodeId</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this.getZIndex</span><span class="PUNC">(</span><span class="NAME">newNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getNextElement</span><span class="PUNC">(</span><span class="NAME">rightIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">remove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeId</span><span class="PUNC">=</span><span class="NAME">node.id</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">arrayIndex</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.order</span><span class="PUNC">,</span><span class="NAME">nodeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arrayIndex</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.order.splice</span><span class="PUNC">(</span><span class="NAME">arrayIndex</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.indices</span><span class="PUNC">[</span><span class="NAME">nodeId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.order.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastId</span><span class="PUNC">=</span><span class="NAME">this.order</span><span class="PUNC">[</span><span class="NAME">this.order.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.maxZIndex</span><span class="PUNC">=</span><span class="NAME">this.indices</span><span class="PUNC">[</span><span class="NAME">lastId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.maxZIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.order</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.indices</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.maxZIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">exists</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.indices</span><span class="PUNC">[</span><span class="NAME">node.id</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node._style.graphicZIndex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">determineZIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zIndex</span><span class="PUNC">=</span><span class="NAME">node._style.graphicZIndex</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zIndex</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zIndex</span><span class="PUNC">=</span><span class="NAME">this.maxZIndex</span><span class="PUNC">;</span><span class="NAME">node._style.graphicZIndex</span><span class="PUNC">=</span><span class="NAME">zIndex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zIndex</span><span class="PUNC">></span><span class="NAME">this.maxZIndex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.maxZIndex</span><span class="PUNC">=</span><span class="NAME">zIndex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNextElement</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextIndex</span><span class="PUNC">=</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextIndex</span><span class="PUNC">&lt;</span><span class="NAME">this.order.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextElement</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">this.order</span><span class="PUNC">[</span><span class="NAME">nextIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextElement</span><span class="PUNC">==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nextElement</span><span class="PUNC">=</span><span class="NAME">this.getNextElement</span><span class="PUNC">(</span><span class="NAME">nextIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>377</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nextElement</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.ElementsIndexer"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.ElementsIndexer.IndexingMethods</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">Z_ORDER</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">indexer</span><span class="PUNC">,</span><span class="NAME">newNode</span><span class="PUNC">,</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newZIndex</span><span class="PUNC">=</span><span class="NAME">indexer.getZIndex</span><span class="PUNC">(</span><span class="NAME">newNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextZIndex</span><span class="PUNC">=</span><span class="NAME">indexer.getZIndex</span><span class="PUNC">(</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">returnVal</span><span class="PUNC">=</span><span class="NAME">newZIndex</span><span class="PUNC">-</span><span class="NAME">nextZIndex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>378</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Z_ORDER_DRAWING_ORDER</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">indexer</span><span class="PUNC">,</span><span class="NAME">newNode</span><span class="PUNC">,</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">=</span><span class="NAME">OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER</span><span class="PUNC">(</span><span class="NAME">indexer</span><span class="PUNC">,</span><span class="NAME">newNode</span><span class="PUNC">,</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextNode</span><span class="PUNC">&&</span><span class="NAME">returnVal</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">returnVal</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>379</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Z_ORDER_Y_ORDER</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">indexer</span><span class="PUNC">,</span><span class="NAME">newNode</span><span class="PUNC">,</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">=</span><span class="NAME">OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER</span><span class="PUNC">(</span><span class="NAME">indexer</span><span class="PUNC">,</span><span class="NAME">newNode</span><span class="PUNC">,</span><span class="NAME">nextNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextNode</span><span class="PUNC">&&</span><span class="NAME">returnVal</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">nextNode._boundsBottom</span><span class="PUNC">-</span><span class="NAME">newNode._boundsBottom</span><span class="PUNC">;</span><span class="NAME">returnVal</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">result</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>380</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.Elements</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Renderer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">rendererRoot</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">root</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">vectorRoot</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">textRoot</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">xmlns</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">indexer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">BACKGROUND_ID_SUFFIX</span><span class="PUNC">:</span><span class="STRN">"_background"</span><span class="PUNC">,</span><span class="NAME">LABEL_ID_SUFFIX</span><span class="PUNC">:</span><span class="STRN">"_label"</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">containerID</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot</span><span class="PUNC">=</span><span class="NAME">this.createRenderRoot</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.root</span><span class="PUNC">=</span><span class="NAME">this.createRoot</span><span class="PUNC">(</span><span class="STRN">"_root"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.vectorRoot</span><span class="PUNC">=</span><span class="NAME">this.createRoot</span><span class="PUNC">(</span><span class="STRN">"_vroot"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.textRoot</span><span class="PUNC">=</span><span class="NAME">this.createRoot</span><span class="PUNC">(</span><span class="STRN">"_troot"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.root.appendChild</span><span class="PUNC">(</span><span class="NAME">this.vectorRoot</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.root.appendChild</span><span class="PUNC">(</span><span class="NAME">this.textRoot</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">this.root</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.container.appendChild</span><span class="PUNC">(</span><span class="NAME">this.rendererRoot</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">options.zIndexing</span><span class="PUNC">||</span><span class="NAME">options.yOrdering</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.indexer</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.ElementsIndexer</span><span class="PUNC">(</span><span class="NAME">options.yOrdering</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.root</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.xmlns</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root</span><span class="PUNC">=</span><span class="NAME">this.vectorRoot</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">root.firstChild</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root.removeChild</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>381</span> </span><span class="NAME">root</span><span class="PUNC">=</span><span class="NAME">this.textRoot</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">root.firstChild</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root.removeChild</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>382</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.indexer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.indexer.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNodeType</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">=</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rendered</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Collection"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiPoint"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiLineString"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiPolygon"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rendered</span><span class="PUNC">=</span><span class="NAME">this.drawGeometry</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">rendered</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>383</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rendered</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">rendered</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.display</span><span class="PUNC">!=</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.backgroundGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.redrawBackgroundNode</span><span class="PUNC">(</span><span class="NAME">geometry.id</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>384</span> </span><span class="NAME">rendered</span><span class="PUNC">=</span><span class="NAME">this.redrawNode</span><span class="PUNC">(</span><span class="NAME">geometry.id</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>385</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">rendered</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">geometry.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node._style.backgroundGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">geometry.id</span><span class="PUNC">+</span><span class="NAME">this.BACKGROUND_ID_SUFFIX</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>386</span> </span><span class="NAME">node.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>387</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rendered</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redrawNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.applyDefaultSymbolizer</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">this.getNodeType</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node._featureId</span><span class="PUNC">=</span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="NAME">node._boundsBottom</span><span class="PUNC">=</span><span class="NAME">geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bottom</span><span class="PUNC">;</span><span class="NAME">node._geometryClass</span><span class="PUNC">=</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">;</span><span class="NAME">node._style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">drawResult</span><span class="PUNC">=</span><span class="NAME">this.drawGeometryNode</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drawResult</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>388</span> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">drawResult.node</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.indexer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">insert</span><span class="PUNC">=</span><span class="NAME">this.indexer.insert</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">insert</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.vectorRoot.insertBefore</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">insert</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.vectorRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.parentNode</span><span class="PUNC">!==</span><span class="NAME">this.vectorRoot</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.vectorRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>389</span> </span><span class="NAME">this.postDraw</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">drawResult.complete</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redrawBackgroundNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">backgroundStyle</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.externalGraphic</span><span class="PUNC">=</span><span class="NAME">backgroundStyle.backgroundGraphic</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.graphicXOffset</span><span class="PUNC">=</span><span class="NAME">backgroundStyle.backgroundXOffset</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.graphicYOffset</span><span class="PUNC">=</span><span class="NAME">backgroundStyle.backgroundYOffset</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.graphicZIndex</span><span class="PUNC">=</span><span class="NAME">backgroundStyle.backgroundGraphicZIndex</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.graphicWidth</span><span class="PUNC">=</span><span class="NAME">backgroundStyle.backgroundWidth</span><span class="PUNC">||</span><span class="NAME">backgroundStyle.graphicWidth</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.graphicHeight</span><span class="PUNC">=</span><span class="NAME">backgroundStyle.backgroundHeight</span><span class="PUNC">||</span><span class="NAME">backgroundStyle.graphicHeight</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.backgroundGraphic</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.backgroundXOffset</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.backgroundYOffset</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">backgroundStyle.backgroundGraphicZIndex</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.redrawNode</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">+</span><span class="NAME">this.BACKGROUND_ID_SUFFIX</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">backgroundStyle</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawGeometryNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">node._style</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'isFilled'</span><span class="PUNC">:</span><span class="NAME">style.fill</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="NAME">style.fill</span><span class="PUNC">,</span><span class="STRN">'isStroked'</span><span class="PUNC">:</span><span class="NAME">style.stroke</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">style.strokeWidth</span><span class="PUNC">:</span><span class="NAME">style.stroke</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">drawn</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphic</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.isFilled</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">options.isStroked</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>390</span> </span><span class="NAME">drawn</span><span class="PUNC">=</span><span class="NAME">this.drawPoint</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">:</span><span class="NAME">options.isFilled</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">drawn</span><span class="PUNC">=</span><span class="NAME">this.drawLineString</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">:</span><span class="NAME">drawn</span><span class="PUNC">=</span><span class="NAME">this.drawLinearRing</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">:</span><span class="NAME">drawn</span><span class="PUNC">=</span><span class="NAME">this.drawPolygon</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Surface"</span><span class="PUNC">:</span><span class="NAME">drawn</span><span class="PUNC">=</span><span class="NAME">this.drawSurface</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Rectangle"</span><span class="PUNC">:</span><span class="NAME">drawn</span><span class="PUNC">=</span><span class="NAME">this.drawRectangle</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>391</span> </span><span class="NAME">node._options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drawn</span><span class="PUNC">!=</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">:</span><span class="NAME">this.setStyle</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">complete</span><span class="PUNC">:</span><span class="NAME">drawn</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">postDraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLineString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLinearRing</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPolygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawRectangle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawCircle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawSurface</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">+</span><span class="NAME">this.LABEL_ID_SUFFIX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.textRoot.removeChild</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureIdFromEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">=</span><span class="NAME">evt.target</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">useElement</span><span class="PUNC">=</span><span class="NAME">target</span><span class="PUNC">&&</span><span class="NAME">target.correspondingUseElement</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">useElement</span><span class="PUNC">?</span><span class="NAME">useElement</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">||</span><span class="NAME">evt.srcElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureId</span><span class="PUNC">=</span><span class="NAME">node._featureId</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">eraseGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiPoint"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiLineString"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.MultiPolygon"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Collection"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eraseGeometry</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">geometry.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">&&</span><span class="NAME">element.parentNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.geometry.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">element.geometry</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>392</span> </span><span class="NAME">element.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.indexer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.indexer.remove</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>393</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element._style.backgroundGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">backgroundId</span><span class="PUNC">=</span><span class="NAME">geometry.id</span><span class="PUNC">+</span><span class="NAME">this.BACKGROUND_ID_SUFFIX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bElem</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">backgroundId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bElem</span><span class="PUNC">&&</span><span class="NAME">bElem.parentNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">bElem.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">bElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">nodeFactory</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.nodeTypeCompare</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.createNode</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>394</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">nodeTypeCompare</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">renderer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root</span><span class="PUNC">=</span><span class="NAME">this.root</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">renderer.root.parentNode</span><span class="PUNC">==</span><span class="NAME">this.rendererRoot</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root</span><span class="PUNC">=</span><span class="NAME">renderer.root</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>395</span> </span><span class="NAME">root.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">renderer.rendererRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">root</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getRenderLayerId</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.root.parentNode.parentNode.id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isComplexSymbol</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">graphicName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">graphicName</span><span class="PUNC">!=</span><span class="STRN">"circle"</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">graphicName</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Renderer.Elements"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.symbol</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"star"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">350</span><span class="PUNC">,</span><span class="NUMB">75</span><span class="PUNC">,</span><span class="NUMB">379</span><span class="PUNC">,</span><span class="NUMB">161</span><span class="PUNC">,</span><span class="NUMB">469</span><span class="PUNC">,</span><span class="NUMB">161</span><span class="PUNC">,</span><span class="NUMB">397</span><span class="PUNC">,</span><span class="NUMB">215</span><span class="PUNC">,</span><span class="NUMB">423</span><span class="PUNC">,</span><span class="NUMB">301</span><span class="PUNC">,</span><span class="NUMB">350</span><span class="PUNC">,</span><span class="NUMB">250</span><span class="PUNC">,</span><span class="NUMB">277</span><span class="PUNC">,</span><span class="NUMB">301</span><span class="PUNC">,</span><span class="NUMB">303</span><span class="PUNC">,</span><span class="NUMB">215</span><span class="PUNC">,</span><span class="NUMB">231</span><span class="PUNC">,</span><span class="NUMB">161</span><span class="PUNC">,</span><span class="NUMB">321</span><span class="PUNC">,</span><span class="NUMB">161</span><span class="PUNC">,</span><span class="NUMB">350</span><span class="PUNC">,</span><span class="NUMB">75</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"cross"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">25</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NUMB">35</span><span class="PUNC">,</span><span class="NUMB">75</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">65</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">75</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NUMB">65</span><span class="PUNC">,</span><span class="NUMB">25</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">35</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"square"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"triangle"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Symbolizer.Line</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Symbolizer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Symbolizer.Line"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Symbolizer.Point</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">externalGraphic</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">graphicWidth</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">graphicHeight</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">graphicOpacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">graphicXOffset</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">graphicYOffset</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">rotation</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">graphicName</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Symbolizer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Symbolizer.Point"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Symbolizer.Polygon</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Symbolizer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Symbolizer.Polygon"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Symbolizer.Raster</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Symbolizer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Symbolizer.Raster"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Symbolizer.Text</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">label</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fontFamily</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fontSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fontWeight</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fontStyle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Symbolizer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Symbolizer.Text"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Tween</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">INTERVAL</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NAME">easing</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">begin</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">finish</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">duration</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">time</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">interval</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">playing</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">easing</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.easing</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">easing</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">easing</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Easing.Expo.easeOut</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">start</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">begin</span><span class="PUNC">,</span><span class="NAME">finish</span><span class="PUNC">,</span><span class="NAME">duration</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.playing</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.begin</span><span class="PUNC">=</span><span class="NAME">begin</span><span class="PUNC">;</span><span class="NAME">this.finish</span><span class="PUNC">=</span><span class="NAME">finish</span><span class="PUNC">;</span><span class="NAME">this.duration</span><span class="PUNC">=</span><span class="NAME">duration</span><span class="PUNC">;</span><span class="NAME">this.callbacks</span><span class="PUNC">=</span><span class="NAME">options.callbacks</span><span class="PUNC">;</span><span class="NAME">this.time</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.interval</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.clearInterval</span><span class="PUNC">(</span><span class="NAME">this.interval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.interval</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>396</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.callbacks</span><span class="PUNC">&&</span><span class="NAME">this.callbacks.start</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callbacks.start.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.begin</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>397</span> </span><span class="NAME">this.interval</span><span class="PUNC">=</span><span class="NAME">window.setInterval</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.play</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.INTERVAL</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">stop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.playing</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>398</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.callbacks</span><span class="PUNC">&&</span><span class="NAME">this.callbacks.done</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callbacks.done.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.finish</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>399</span> </span><span class="NAME">window.clearInterval</span><span class="PUNC">(</span><span class="NAME">this.interval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.interval</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.playing</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">play</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.begin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.begin</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.finish</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">f</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="STRN">'invalid value for Tween'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>400</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this.easing.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.time</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">this.duration</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>401</span> </span><span class="NAME">this.time</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.callbacks</span><span class="PUNC">&&</span><span class="NAME">this.callbacks.eachStep</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callbacks.eachStep.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>402</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.time</span><span class="PUNC">></span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.stop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Tween"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Easing</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Easing"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Easing.Linear</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">easeIn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">easeOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">easeInOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Easing.Linear"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Easing.Expo</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">easeIn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">easeOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">==</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">easeInOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">==</span><span class="NAME">d</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">--</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Easing.Expo"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Easing.Quad</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">easeIn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">easeOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">easeInOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">*</span><span class="NAME">t</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Easing.Quad"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.ArgParser</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">center</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">displayProjection</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.map.controls.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">control</span><span class="PUNC">=</span><span class="NAME">this.map.controls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">!=</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">control.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Control.ArgParser"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">control.displayProjection</span><span class="PUNC">!=</span><span class="NAME">this.displayProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.displayProjection</span><span class="PUNC">=</span><span class="NAME">control.displayProjection</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>403</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>404</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NAME">this.map.controls.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layers</span><span class="PUNC">=</span><span class="NAME">args.layers</span><span class="PUNC">;</span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">'addlayer'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.configureLayers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.configureLayers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>405</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.lat</span><span class="PUNC">&&</span><span class="NAME">args.lon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.center</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">args.lon</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">args.lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.zoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoom</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">args.zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>406</span> </span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">'changebaselayer'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.setCenter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setCenter</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map.baseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.unregister</span><span class="PUNC">(</span><span class="STRN">'changebaselayer'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.setCenter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.displayProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.center.transform</span><span class="PUNC">(</span><span class="NAME">this.displayProjection</span><span class="PUNC">,</span><span class="NAME">this.map.getProjectionObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>407</span> </span><span class="NAME">this.map.setCenter</span><span class="PUNC">(</span><span class="NAME">this.center</span><span class="PUNC">,</span><span class="NAME">this.zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">configureLayers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers.length</span><span class="PUNC">==</span><span class="NAME">this.map.layers.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.unregister</span><span class="PUNC">(</span><span class="STRN">'addlayer'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.configureLayers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.layers.charAt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">==</span><span class="STRN">"B"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">==</span><span class="STRN">"T"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">==</span><span class="STRN">"F"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.setVisibility</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">==</span><span class="STRN">"T"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.ArgParser"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.Attribution</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">separator</span><span class="PUNC">:</span><span class="STRN">", "</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"removelayer"</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="STRN">"addlayer"</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="STRN">"changelayer"</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="STRN">"changebaselayer"</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'changebaselayer'</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="STRN">'changelayer'</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="STRN">'addlayer'</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="STRN">'removelayer'</span><span class="PUNC">:</span><span class="NAME">this.updateAttribution</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.updateAttribution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateAttribution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributions</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">&&</span><span class="NAME">this.map.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.map.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.attribution</span><span class="PUNC">&&</span><span class="NAME">layer.getVisibility</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">attributions</span><span class="PUNC">,</span><span class="NAME">layer.attribution</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attributions.push</span><span class="PUNC">(</span><span class="NAME">layer.attribution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>408</span> </span><span class="NAME">this.div.innerHTML</span><span class="PUNC">=</span><span class="NAME">attributions.join</span><span class="PUNC">(</span><span class="NAME">this.separator</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.Attribution"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.LayerSwitcher</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">roundedCorner</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">roundedCornerColor</span><span class="PUNC">:</span><span class="STRN">"darkblue"</span><span class="PUNC">,</span><span class="NAME">layerStates</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layersDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">baseLayersDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">baseLayers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">dataLbl</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">dataLayersDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">dataLayers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minimizeDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maximizeDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">ascending</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layerStates</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.minimizeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.maximizeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearLayersArray</span><span class="PUNC">(</span><span class="STRN">"base"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearLayersArray</span><span class="PUNC">(</span><span class="STRN">"data"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"addlayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="STRN">"changelayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="STRN">"removelayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="STRN">"changebaselayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"addlayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="STRN">"changelayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="STRN">"removelayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="STRN">"changebaselayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.loadContents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.outsideViewport</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.minimizeControl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>409</span> </span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clearLayersArray</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layersType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">layersType</span><span class="PUNC">+</span><span class="STRN">"Layers"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">layer.inputElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">layer.labelSpan</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>410</span> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">layersType</span><span class="PUNC">+</span><span class="STRN">"LayersDiv"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">layersType</span><span class="PUNC">+</span><span class="STRN">"Layers"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">checkRedraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">redraw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.layerStates.length</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.map.layers.length</span><span class="PUNC">!=</span><span class="NAME">this.layerStates.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">redraw</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layerStates.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerState</span><span class="PUNC">=</span><span class="NAME">this.layerStates</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">layerState.name</span><span class="PUNC">!=</span><span class="NAME">layer.name</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">layerState.inRange</span><span class="PUNC">!=</span><span class="NAME">layer.inRange</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">layerState.id</span><span class="PUNC">!=</span><span class="NAME">layer.id</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">layerState.visibility</span><span class="PUNC">!=</span><span class="NAME">layer.visibility</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">redraw</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>411</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">redraw</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.checkRedraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>412</span> </span><span class="NAME">this.clearLayersArray</span><span class="PUNC">(</span><span class="STRN">"base"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearLayersArray</span><span class="PUNC">(</span><span class="STRN">"data"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">containsOverlays</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">containsBaseLayers</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.map.layers.length</span><span class="PUNC">;</span><span class="NAME">this.layerStates</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.layerStates</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'name'</span><span class="PUNC">:</span><span class="NAME">layer.name</span><span class="PUNC">,</span><span class="STRN">'visibility'</span><span class="PUNC">:</span><span class="NAME">layer.visibility</span><span class="PUNC">,</span><span class="STRN">'inRange'</span><span class="PUNC">:</span><span class="NAME">layer.inRange</span><span class="PUNC">,</span><span class="STRN">'id'</span><span class="PUNC">:</span><span class="NAME">layer.id</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>413</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="PUNC">=</span><span class="NAME">this.map.layers.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.ascending</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layers.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>414</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">baseLayer</span><span class="PUNC">=</span><span class="NAME">layer.isBaseLayer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.displayInLayerSwitcher</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">containsBaseLayers</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">containsOverlays</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>415</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checked</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">==</span><span class="NAME">this.map.baseLayer</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">layer.getVisibility</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputElem</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"input"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">inputElem.id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_input_"</span><span class="PUNC">+</span><span class="NAME">layer.name</span><span class="PUNC">;</span><span class="NAME">inputElem.name</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_baseLayers"</span><span class="PUNC">:</span><span class="NAME">layer.name</span><span class="PUNC">;</span><span class="NAME">inputElem.type</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"radio"</span><span class="PUNC">:</span><span class="STRN">"checkbox"</span><span class="PUNC">;</span><span class="NAME">inputElem.value</span><span class="PUNC">=</span><span class="NAME">layer.name</span><span class="PUNC">;</span><span class="NAME">inputElem.checked</span><span class="PUNC">=</span><span class="NAME">checked</span><span class="PUNC">;</span><span class="NAME">inputElem.defaultChecked</span><span class="PUNC">=</span><span class="NAME">checked</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">baseLayer</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">layer.inRange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputElem.disabled</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>416</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'inputElem'</span><span class="PUNC">:</span><span class="NAME">inputElem</span><span class="PUNC">,</span><span class="STRN">'layer'</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="STRN">'layerSwitcher'</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">inputElem</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.onInputClick</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelSpan</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"span"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">labelSpan</span><span class="PUNC">,</span><span class="STRN">"labelSpan"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>417</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">baseLayer</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">layer.inRange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">labelSpan.style.color</span><span class="PUNC">=</span><span class="STRN">"gray"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>418</span> </span><span class="NAME">labelSpan.innerHTML</span><span class="PUNC">=</span><span class="NAME">layer.name</span><span class="PUNC">;</span><span class="NAME">labelSpan.style.verticalAlign</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"bottom"</span><span class="PUNC">:</span><span class="STRN">"baseline"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">labelSpan</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.onInputClick</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">br</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"br"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">groupArray</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.baseLayers</span><span class="PUNC">:</span><span class="NAME">this.dataLayers</span><span class="PUNC">;</span><span class="NAME">groupArray.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'layer'</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="STRN">'inputElem'</span><span class="PUNC">:</span><span class="NAME">inputElem</span><span class="PUNC">,</span><span class="STRN">'labelSpan'</span><span class="PUNC">:</span><span class="NAME">labelSpan</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">groupDiv</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">baseLayer</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.baseLayersDiv</span><span class="PUNC">:</span><span class="NAME">this.dataLayersDiv</span><span class="PUNC">;</span><span class="NAME">groupDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">inputElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">groupDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">labelSpan</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">groupDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">br</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>419</span> </span><span class="NAME">this.dataLbl.style.display</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">containsOverlays</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">this.baseLbl.style.display</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">containsBaseLayers</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onInputClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.inputElem.disabled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.inputElem.type</span><span class="PUNC">==</span><span class="STRN">"radio"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.inputElem.checked</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.layer.map.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.inputElem.checked</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">this.inputElem.checked</span><span class="PUNC">;</span><span class="NAME">this.layerSwitcher.updateMap</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>420</span> </span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onLayerClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.updateMap</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.baseLayers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerEntry</span><span class="PUNC">=</span><span class="NAME">this.baseLayers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layerEntry.inputElem.checked</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">layerEntry.layer</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>421</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.dataLayers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerEntry</span><span class="PUNC">=</span><span class="NAME">this.dataLayers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">layerEntry.layer.setVisibility</span><span class="PUNC">(</span><span class="NAME">layerEntry.inputElem.checked</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">maximizeControl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.width</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.div.style.height</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.showControls</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">minimizeControl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.width</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">this.div.style.height</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">this.showControls</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">showControls</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">minimize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.maximizeDiv.style.display</span><span class="PUNC">=</span><span class="NAME">minimize</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">this.minimizeDiv.style.display</span><span class="PUNC">=</span><span class="NAME">minimize</span><span class="PUNC">?</span><span class="STRN">"none"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.style.display</span><span class="PUNC">=</span><span class="NAME">minimize</span><span class="PUNC">?</span><span class="STRN">"none"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">loadContents</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.mouseUp</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="NAME">this.ignoreEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.mouseDown</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="NAME">this.ignoreEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_layersDiv"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.layersDiv</span><span class="PUNC">,</span><span class="STRN">"layersDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.baseLbl</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.baseLbl.innerHTML</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"baseLayer"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.baseLbl</span><span class="PUNC">,</span><span class="STRN">"baseLbl"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.baseLayersDiv</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.baseLayersDiv</span><span class="PUNC">,</span><span class="STRN">"baseLayersDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dataLbl</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dataLbl.innerHTML</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"overlays"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.dataLbl</span><span class="PUNC">,</span><span class="STRN">"dataLbl"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dataLayersDiv</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.dataLayersDiv</span><span class="PUNC">,</span><span class="STRN">"dataLayersDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.ascending</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.baseLbl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.baseLayersDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.dataLbl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.dataLayersDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.dataLbl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.dataLayersDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.baseLbl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layersDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.baseLayersDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>422</span> </span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.layersDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.roundedCorner</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Rico.Corner.round</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">corners</span><span class="PUNC">:</span><span class="STRN">"tl bl"</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">:</span><span class="STRN">"transparent"</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">:</span><span class="NAME">this.roundedCornerColor</span><span class="PUNC">,</span><span class="NAME">blend</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Rico.Corner.changeOpacity</span><span class="PUNC">(</span><span class="NAME">this.layersDiv</span><span class="PUNC">,</span><span class="NUMB">0.75</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>423</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgLocation</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">imgLocation</span><span class="PUNC">+</span><span class="STRN">'layer-switcher-maximize.png'</span><span class="PUNC">;</span><span class="NAME">this.maximizeDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="STRN">"OpenLayers_Control_MaximizeDiv"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">img</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.maximizeDiv</span><span class="PUNC">,</span><span class="STRN">"maximizeDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.maximizeDiv.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.maximizeDiv</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.maximizeControl</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.maximizeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">imgLocation</span><span class="PUNC">+</span><span class="STRN">'layer-switcher-minimize.png'</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.minimizeDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="STRN">"OpenLayers_Control_MinimizeDiv"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">img</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.minimizeDiv</span><span class="PUNC">,</span><span class="STRN">"minimizeDiv"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.minimizeDiv.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.minimizeDiv</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.minimizeControl</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.minimizeDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">ignoreEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mouseDown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.isMouseDown</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.ignoreEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mouseUp</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isMouseDown</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.isMouseDown</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.ignoreEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.LayerSwitcher"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.PanZoom</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">slideFactor</span><span class="PUNC">:</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NAME">slideRatio</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">buttons</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control.PanZoom.X</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Control.PanZoom.Y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.removeButtons</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.buttons</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.position</span><span class="PUNC">;</span><span class="NAME">this.buttons</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centered</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">+</span><span class="NAME">sz.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"panup"</span><span class="PUNC">,</span><span class="STRN">"north-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px.y</span><span class="PUNC">=</span><span class="NAME">centered.y</span><span class="PUNC">+</span><span class="NAME">sz.h</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"panleft"</span><span class="PUNC">,</span><span class="STRN">"west-mini.png"</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"panright"</span><span class="PUNC">,</span><span class="STRN">"east-mini.png"</span><span class="PUNC">,</span><span class="NAME">px.add</span><span class="PUNC">(</span><span class="NAME">sz.w</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"pandown"</span><span class="PUNC">,</span><span class="STRN">"south-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"zoomin"</span><span class="PUNC">,</span><span class="STRN">"zoom-plus-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"zoomworld"</span><span class="PUNC">,</span><span class="STRN">"zoom-world-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"zoomout"</span><span class="PUNC">,</span><span class="STRN">"zoom-minus-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">5</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_addButton</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">img</span><span class="PUNC">,</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgLocation</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">img</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">btn</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgLocation</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">,</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.buttonDown</span><span class="PUNC">,</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.doubleClick</span><span class="PUNC">,</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.doubleClick</span><span class="PUNC">,</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">btn.action</span><span class="PUNC">=</span><span class="NAME">id</span><span class="PUNC">;</span><span class="NAME">btn.map</span><span class="PUNC">=</span><span class="NAME">this.map</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.slideRatio</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">slideFactorPixels</span><span class="PUNC">=</span><span class="NAME">this.slideFactor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getSlideFactor</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">slideFactorPixels</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">slideRatio</span><span class="PUNC">=</span><span class="NAME">this.slideRatio</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getSlideFactor</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">dim</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">slideRatio</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>424</span> </span><span class="NAME">btn.getSlideFactor</span><span class="PUNC">=</span><span class="NAME">getSlideFactor</span><span class="PUNC">;</span><span class="NAME">this.buttons.push</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">btn</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_removeButton</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">btn.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">btn.getSlideFactor</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.div.removeChild</span><span class="PUNC">(</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.buttons</span><span class="PUNC">,</span><span class="NAME">btn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeButtons</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.buttons.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">--</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._removeButton</span><span class="PUNC">(</span><span class="NAME">this.buttons</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">doubleClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">buttonDown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Event.isLeftClick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>425</span> </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.action</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"panup"</span><span class="PUNC">:</span><span class="NAME">this.map.pan</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">this.getSlideFactor</span><span class="PUNC">(</span><span class="STRN">"h"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"pandown"</span><span class="PUNC">:</span><span class="NAME">this.map.pan</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.getSlideFactor</span><span class="PUNC">(</span><span class="STRN">"h"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"panleft"</span><span class="PUNC">:</span><span class="NAME">this.map.pan</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">this.getSlideFactor</span><span class="PUNC">(</span><span class="STRN">"w"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"panright"</span><span class="PUNC">:</span><span class="NAME">this.map.pan</span><span class="PUNC">(</span><span class="NAME">this.getSlideFactor</span><span class="PUNC">(</span><span class="STRN">"w"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"zoomin"</span><span class="PUNC">:</span><span class="NAME">this.map.zoomIn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"zoomout"</span><span class="PUNC">:</span><span class="NAME">this.map.zoomOut</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"zoomworld"</span><span class="PUNC">:</span><span class="NAME">this.map.zoomToMaxExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>426</span> </span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.PanZoom"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.PanZoom.X</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.PanZoom.Y</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.ScaleLine</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">maxWidth</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NAME">topOutUnits</span><span class="PUNC">:</span><span class="STRN">"km"</span><span class="PUNC">,</span><span class="NAME">topInUnits</span><span class="PUNC">:</span><span class="STRN">"m"</span><span class="PUNC">,</span><span class="NAME">bottomOutUnits</span><span class="PUNC">:</span><span class="STRN">"mi"</span><span class="PUNC">,</span><span class="NAME">bottomInUnits</span><span class="PUNC">:</span><span class="STRN">"ft"</span><span class="PUNC">,</span><span class="NAME">eTop</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">eBottom</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">geodesic</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.eTop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eTop</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.eTop.className</span><span class="PUNC">=</span><span class="NAME">this.displayClass</span><span class="PUNC">+</span><span class="STRN">"Top"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theLen</span><span class="PUNC">=</span><span class="NAME">this.topInUnits.length</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.eTop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.topOutUnits</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.topInUnits</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eTop.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.eTop.style.visibility</span><span class="PUNC">=</span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>427</span> </span><span class="NAME">this.eBottom</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.eBottom.className</span><span class="PUNC">=</span><span class="NAME">this.displayClass</span><span class="PUNC">+</span><span class="STRN">"Bottom"</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.eBottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.bottomOutUnits</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.bottomInUnits</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eBottom.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.eBottom.style.visibility</span><span class="PUNC">=</span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>428</span> </span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">'moveend'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.update</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.update</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getBarLen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">maxLen</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">digits</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.log</span><span class="PUNC">(</span><span class="NAME">maxLen</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">Math.log</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pow10</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NAME">digits</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">firstChar</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">maxLen</span><span class="PUNC">/</span><span class="NAME">pow10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">barLen</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">firstChar</span><span class="PUNC">></span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">barLen</span><span class="PUNC">=</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">firstChar</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">barLen</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">barLen</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>429</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">barLen</span><span class="PUNC">*</span><span class="NAME">pow10</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">update</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">res</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>430</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">curMapUnits</span><span class="PUNC">=</span><span class="NAME">this.map.getUnits</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inches</span><span class="PUNC">=</span><span class="NAME">OpenLayers.INCHES_PER_UNIT</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSizeData</span><span class="PUNC">=</span><span class="NAME">this.maxWidth</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">*</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">curMapUnits</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geodesicRatio</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.geodesic</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSizeGeodesic</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.map.getGeodesicPixelSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">w</span><span class="PUNC">||</span><span class="NUMB">0.000001</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.maxWidth</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSizeKilometers</span><span class="PUNC">=</span><span class="NAME">maxSizeData</span><span class="PUNC">/</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="STRN">"km"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">geodesicRatio</span><span class="PUNC">=</span><span class="NAME">maxSizeGeodesic</span><span class="PUNC">/</span><span class="NAME">maxSizeKilometers</span><span class="PUNC">;</span><span class="NAME">maxSizeData</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">geodesicRatio</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>431</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topUnits</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomUnits</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">maxSizeData</span><span class="PUNC">></span><span class="NUMB">100000</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">topUnits</span><span class="PUNC">=</span><span class="NAME">this.topOutUnits</span><span class="PUNC">;</span><span class="NAME">bottomUnits</span><span class="PUNC">=</span><span class="NAME">this.bottomOutUnits</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">topUnits</span><span class="PUNC">=</span><span class="NAME">this.topInUnits</span><span class="PUNC">;</span><span class="NAME">bottomUnits</span><span class="PUNC">=</span><span class="NAME">this.bottomInUnits</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>432</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topMax</span><span class="PUNC">=</span><span class="NAME">maxSizeData</span><span class="PUNC">/</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">topUnits</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomMax</span><span class="PUNC">=</span><span class="NAME">maxSizeData</span><span class="PUNC">/</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">bottomUnits</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topRounded</span><span class="PUNC">=</span><span class="NAME">this.getBarLen</span><span class="PUNC">(</span><span class="NAME">topMax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomRounded</span><span class="PUNC">=</span><span class="NAME">this.getBarLen</span><span class="PUNC">(</span><span class="NAME">bottomMax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">topMax</span><span class="PUNC">=</span><span class="NAME">topRounded</span><span class="PUNC">/</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">curMapUnits</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">topUnits</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">bottomMax</span><span class="PUNC">=</span><span class="NAME">bottomRounded</span><span class="PUNC">/</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">curMapUnits</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">inches</span><span class="PUNC">[</span><span class="NAME">bottomUnits</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topPx</span><span class="PUNC">=</span><span class="NAME">topMax</span><span class="PUNC">/</span><span class="NAME">res</span><span class="PUNC">/</span><span class="NAME">geodesicRatio</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomPx</span><span class="PUNC">=</span><span class="NAME">bottomMax</span><span class="PUNC">/</span><span class="NAME">res</span><span class="PUNC">/</span><span class="NAME">geodesicRatio</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eBottom.style.visibility</span><span class="PUNC">==</span><span class="STRN">"visible"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eBottom.style.width</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">bottomPx</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.eBottom.innerHTML</span><span class="PUNC">=</span><span class="NAME">bottomRounded</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">bottomUnits</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>433</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eTop.style.visibility</span><span class="PUNC">==</span><span class="STRN">"visible"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eTop.style.width</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">topPx</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.eTop.innerHTML</span><span class="PUNC">=</span><span class="NAME">topRounded</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">topUnits</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.ScaleLine"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">observers</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">KEY_BACKSPACE</span><span class="PUNC">:</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NAME">KEY_TAB</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="NAME">KEY_RETURN</span><span class="PUNC">:</span><span class="NUMB">13</span><span class="PUNC">,</span><span class="NAME">KEY_ESC</span><span class="PUNC">:</span><span class="NUMB">27</span><span class="PUNC">,</span><span class="NAME">KEY_LEFT</span><span class="PUNC">:</span><span class="NUMB">37</span><span class="PUNC">,</span><span class="NAME">KEY_UP</span><span class="PUNC">:</span><span class="NUMB">38</span><span class="PUNC">,</span><span class="NAME">KEY_RIGHT</span><span class="PUNC">:</span><span class="NUMB">39</span><span class="PUNC">,</span><span class="NAME">KEY_DOWN</span><span class="PUNC">:</span><span class="NUMB">40</span><span class="PUNC">,</span><span class="NAME">KEY_DELETE</span><span class="PUNC">:</span><span class="NUMB">46</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">event.target</span><span class="PUNC">||</span><span class="NAME">event.srcElement</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isLeftClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">event.which</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">event.which</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">event.button</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">event.button</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isRightClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">event.which</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">event.which</span><span class="PUNC">==</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">event.button</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">event.button</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">stop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">allowDefault</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">allowDefault</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">event.preventDefault</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">event.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">event.returnValue</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>434</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">event.stopPropagation</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">event.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">event.cancelBubble</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">findElement</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Event.element</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">element.parentNode</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">element.tagName</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">element.tagName.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="NAME">tagName.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">element.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>435</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">observe</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementParam</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">,</span><span class="NAME">useCapture</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">elementParam</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">useCapture</span><span class="PUNC">=</span><span class="NAME">useCapture</span><span class="PUNC">||</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">'keypress'</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">navigator.appVersion.match</span><span class="PUNC">(</span><span class="REGX">/Konqueror|Safari|KHTML/</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">element.attachEvent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">name</span><span class="PUNC">=</span><span class="STRN">'keydown'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>436</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.observers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.observers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>437</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">element._eventCacheID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idPrefix</span><span class="PUNC">=</span><span class="STRN">"eventCacheID_"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">idPrefix</span><span class="PUNC">=</span><span class="NAME">element.id</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">idPrefix</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>438</span> </span><span class="NAME">element._eventCacheID</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">idPrefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>439</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cacheID</span><span class="PUNC">=</span><span class="NAME">element._eventCacheID</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>440</span> </span><span class="NAME">this.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'element'</span><span class="PUNC">:</span><span class="NAME">element</span><span class="PUNC">,</span><span class="STRN">'name'</span><span class="PUNC">:</span><span class="NAME">name</span><span class="PUNC">,</span><span class="STRN">'observer'</span><span class="PUNC">:</span><span class="NAME">observer</span><span class="PUNC">,</span><span class="STRN">'useCapture'</span><span class="PUNC">:</span><span class="NAME">useCapture</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.addEventListener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.addEventListener</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">,</span><span class="NAME">useCapture</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.attachEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.attachEvent</span><span class="PUNC">(</span><span class="STRN">'on'</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">stopObservingElement</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementParam</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">elementParam</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cacheID</span><span class="PUNC">=</span><span class="NAME">element._eventCacheID</span><span class="PUNC">;</span><span class="NAME">this._removeElementObservers</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_removeElementObservers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementObservers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elementObservers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">elementObservers.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">entry</span><span class="PUNC">=</span><span class="NAME">elementObservers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">entry.element</span><span class="PUNC">,</span><span class="NAME">entry.name</span><span class="PUNC">,</span><span class="NAME">entry.observer</span><span class="PUNC">,</span><span class="NAME">entry.useCapture</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">removed</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Event.stopObserving.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">stopObserving</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementParam</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">,</span><span class="NAME">useCapture</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">useCapture</span><span class="PUNC">=</span><span class="NAME">useCapture</span><span class="PUNC">||</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">elementParam</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cacheID</span><span class="PUNC">=</span><span class="NAME">element._eventCacheID</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">'keypress'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">navigator.appVersion.match</span><span class="PUNC">(</span><span class="REGX">/Konqueror|Safari|KHTML/</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">element.detachEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">name</span><span class="PUNC">=</span><span class="STRN">'keydown'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>441</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">foundEntry</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elementObservers</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elementObservers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">foundEntry</span><span class="PUNC">&&</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">elementObservers.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cacheEntry</span><span class="PUNC">=</span><span class="NAME">elementObservers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">cacheEntry.name</span><span class="PUNC">==</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">cacheEntry.observer</span><span class="PUNC">==</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">cacheEntry.useCapture</span><span class="PUNC">==</span><span class="NAME">useCapture</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">elementObservers.splice</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elementObservers.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>442</span> </span><span class="NAME">foundEntry</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>443</span> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>444</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">foundEntry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element.removeEventListener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.removeEventListener</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">,</span><span class="NAME">useCapture</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">&&</span><span class="NAME">element.detachEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element.detachEvent</span><span class="PUNC">(</span><span class="STRN">'on'</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">observer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>445</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">foundEntry</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unloadCache</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Event</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cacheID</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elementObservers</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">[</span><span class="NAME">cacheID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event._removeElementObservers.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">elementObservers</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>446</span> </span><span class="NAME">OpenLayers.Event.observers</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Event"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">'unload'</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Event.unloadCache</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.Event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">window.Event</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Event</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Event</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>447</span> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">BROWSER_EVENTS</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"mouseover"</span><span class="PUNC">,</span><span class="STRN">"mouseout"</span><span class="PUNC">,</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="STRN">"rightclick"</span><span class="PUNC">,</span><span class="STRN">"dblrightclick"</span><span class="PUNC">,</span><span class="STRN">"resize"</span><span class="PUNC">,</span><span class="STRN">"focus"</span><span class="PUNC">,</span><span class="STRN">"blur"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">listeners</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">object</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">eventTypes</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">eventHandler</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fallThrough</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">includeXY</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">clearMouseListener</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">eventTypes</span><span class="PUNC">,</span><span class="NAME">fallThrough</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.object</span><span class="PUNC">=</span><span class="NAME">object</span><span class="PUNC">;</span><span class="NAME">this.fallThrough</span><span class="PUNC">=</span><span class="NAME">fallThrough</span><span class="PUNC">;</span><span class="NAME">this.listeners</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.eventHandler</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.handleBrowserEvent</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearMouseListener</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.clearMouseCache</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.eventTypes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">eventTypes</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">eventTypes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addEventType</span><span class="PUNC">(</span><span class="NAME">eventTypes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>448</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.attachToElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.element.hasScrollEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">"scroll"</span><span class="PUNC">,</span><span class="NAME">this.clearMouseListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>449</span> </span><span class="NAME">this.element</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.listeners</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.object</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.eventTypes</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.fallThrough</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.eventHandler</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addEventType</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.eventTypes.push</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">eventName</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">attachToElement</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>450</span> </span><span class="NAME">this.element</span><span class="PUNC">=</span><span class="NAME">element</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.BROWSER_EVENTS.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventType</span><span class="PUNC">=</span><span class="NAME">this.BROWSER_EVENTS</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.addEventType</span><span class="PUNC">(</span><span class="NAME">eventType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">eventType</span><span class="PUNC">,</span><span class="NAME">this.eventHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>451</span> </span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="STRN">"dragstart"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">on</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">!=</span><span class="STRN">"scope"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.register</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">object.scope</span><span class="PUNC">,</span><span class="NAME">object</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">register</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.eventTypes</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">this.object</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>452</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="PUNC">=</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">listeners.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">:</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">:</span><span class="NAME">func</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">registerPriority</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">this.object</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>453</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="PUNC">=</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">listeners</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">listeners.unshift</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">:</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">:</span><span class="NAME">func</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">un</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">!=</span><span class="STRN">"scope"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unregister</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">object.scope</span><span class="PUNC">,</span><span class="NAME">object</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unregister</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">this.object</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>454</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="PUNC">=</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">listeners</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">listeners.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">listeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="NAME">obj</span><span class="PUNC">&&</span><span class="NAME">listeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">func</span><span class="PUNC">==</span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">listeners.splice</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">remove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">triggerEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="PUNC">=</span><span class="NAME">this.listeners</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">listeners</span><span class="PUNC">||</span><span class="NAME">listeners.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>455</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">evt</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>456</span> </span><span class="NAME">evt.object</span><span class="PUNC">=</span><span class="NAME">this.object</span><span class="PUNC">;</span><span class="NAME">evt.element</span><span class="PUNC">=</span><span class="NAME">this.element</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">evt.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">evt.type</span><span class="PUNC">=</span><span class="NAME">type</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>457</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="PUNC">=</span><span class="NAME">listeners.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">continueChain</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">listeners.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">=</span><span class="NAME">listeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">continueChain</span><span class="PUNC">=</span><span class="NAME">callback.func.apply</span><span class="PUNC">(</span><span class="NAME">callback.obj</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">continueChain</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">continueChain</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>458</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fallThrough</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>459</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continueChain</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">handleBrowserEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.includeXY</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">evt.xy</span><span class="PUNC">=</span><span class="NAME">this.getMousePosition</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>460</span> </span><span class="NAME">this.triggerEvent</span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clearMouseCache</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.element.scrolls</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.element.lefttop</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.element.offsets</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getMousePosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.includeXY</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearMouseCache</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.element.hasScrollEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">"scroll"</span><span class="PUNC">,</span><span class="NAME">this.clearMouseListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.element.hasScrollEvent</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>461</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.element.scrolls</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.element.scrolls</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">document.documentElement.scrollLeft</span><span class="PUNC">||</span><span class="NAME">document.body.scrollLeft</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">document.documentElement.scrollTop</span><span class="PUNC">||</span><span class="NAME">document.body.scrollTop</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>462</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.element.lefttop</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.element.lefttop</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">document.documentElement.clientLeft</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">document.documentElement.clientTop</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>463</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.element.offsets</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.element.offsets</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.pagePosition</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.element.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.element.scrolls</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.element.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.element.scrolls</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>464</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">evt.clientX</span><span class="PUNC">+</span><span class="NAME">this.element.scrolls</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.element.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>465</span> </span><span class="PUNC">-</span><span class="NAME">this.element.lefttop</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">evt.clientY</span><span class="PUNC">+</span><span class="NAME">this.element.scrolls</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.element.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>466</span> </span><span class="PUNC">-</span><span class="NAME">this.element.lefttop</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Events"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">externalProjection</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">internalProjection</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">keepData</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">read</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.userError</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"readNotImplemented"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">write</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.userError</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"writeNotImplemented"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Format"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"ar"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"وصلة دائمة"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"الطبقة الاساسية"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"القراءة غير محققة."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"الكتابة غير محققة"</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"خطأ عند تحميل الملف جي ام ال ${url}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"النسبة = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"غ"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"شر"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"شم"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"ج"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"be-tarask"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Неапрацаваны вынік запыту ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Сталая спасылка"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Слаі"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Базавы слой"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Аглядная мапа працуе толькі калі яна мае тую ж праекцыю, што і асноўная мапа"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Функцыянальнасьць чытаньня ня створаная."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Функцыянальнасьць запісу ня створаная."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Немагчыма абнавіць магчымасьць, для якога не існуе FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Памылка загрузкі файла GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Ваш браўзэр не падтрымлівае вэктарную графіку. У цяперашні момант падтрымліваюцца: ${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : кампанэнт павінен быць ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent выкліканы для слоя бяз рэндэру. Звычайна гэта азначае, што Вы зьнішчылі слой, але пакінулі зьвязаны зь ім апрацоўшчык."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Уласьцівасьць minZoomLevel прызначана толькі для выкарыстаньня са слаямі вытворнымі ад FixedZoomLevels. Тое, што  гэты wfs-слой правяраецца на minZoomLevel — рэха прошлага. Але мы ня можам выдаліць гэтую магчымасьць, таму што ад яе залежаць некаторыя заснаваныя на OL дастасаваньні. Тым ня менш, праверка minZoomLevel будзе выдаленая ў вэрсіі 3.0. Калі ласка, выкарыстоўваеце замест яе ўстаноўкі мінімальнага/максымальнага памераў, як апісана тут: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-транзакцыя: ПОСЬПЕХ ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-транзакцыя: ПАМЫЛКА ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Не атрымалася загрузіць слой Google. \x3cbr\x3e\x3cbr\x3eКаб пазбавіцца гэтага паведамленьня, выберыце новы базавы слой у сьпісе ў верхнім правым куце.\x3cbr\x3e\x3cbr\x3e Хутчэй за ўсё, прычына ў тым, што скрыпт бібліятэкі Google Maps ня быў уключаныя альбо не ўтрымлівае слушны API-ключ для Вашага сайта.\x3cbr\x3e\x3cbr\x3eРаспрацоўшчыкам: Для таго, каб даведацца як зрабіць так, каб усё працавала, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eнацісьніце тут\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Немагчыма загрузіць слой ${layerType}.\x3cbr\x3e\x3cbr\x3eКаб пазбавіцца гэтага паведамленьня, выберыце новы базавы слой у сьпісе ў верхнім правым куце.\x3cbr\x3e\x3cbr\x3eХутчэй за ўсё, прычына ў тым, што скрыпт бібліятэкі ${layerLib} ня быў слушна ўключаны.\x3cbr\x3e\x3cbr\x3eРаспрацоўшчыкам: Для таго, каб даведацца як зрабіць так, каб усё працавала, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eнацісьніце тут\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Маштаб = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"З"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"У"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"Пн"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"Пд"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Вы паспрабавалі дадаць слой ${layerName} на мапу, але ён ужо дададзены"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Вы выкарыстоўваеце ўстаноўку \'reproject\' для слоя ${layerName}. Гэтая ўстаноўка зьяўляецца састарэлай: яна выкарыстоўвалася для падтрымкі паказу зьвестак на камэрцыйных базавых мапах, але гэта функцыя цяпер рэалізаваная ў убудаванай падтрымцы сфэрычнай праекцыі Мэркатара. Дадатковая інфармацыя ёсьць на http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Гэты мэтад састарэлы і будзе выдалены ў вэрсіі 3.0. Калі ласка, замест яго выкарыстоўвайце ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Вам неабходна падаць абодва значэньні x і y для функцыі складаньня."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Вам неабходна падаць абодва значэньні lon і lat для функцыі складаньня."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Вам неабходна падаць абодва значэньні x і y для функцыі складаньня."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Тып геамэтрыі не падтрымліваецца: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition failed: верагодна элемэнт з ідэнтыфікатарам ${elemId} займае няслушнае месца."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluate не рэалізаваны для гэтага тыпу фільтру."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"bg"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Постоянна препратка"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Основен слой"</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Грешка при зареждане на GML файл ${url}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Мащаб = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Опитахте да добавите слой ${layerName} в картата, но той вече е добавен"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Този метод е остарял и ще бъде премахват в 3.0. Вместо него използвайте ${newMethod}."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"br"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Distro evel reked anveret ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Peurliamm"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Gwiskadoù"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Gwiskad diazez"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Ne\'z ar gartenn lec\'hiañ en-dro nemet pa vez heñvel ar banndres anezhi ha hini ar gartenn bennañ"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"N\'eo ket emplementet al lenn."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"N\'eo ket emplementet ar skrivañ."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"N\'haller ket hizivaat un elfenn ma n\'eus ket a niverenn-anaout (FID) eviti."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fazi e-ser kargañ ar restr GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"N\'eo ket skoret an daskor vektorel gant ho merdeer. Setu aze an daskorerioù skoret evit ar poent :\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : bez\' e tlefe ar parzh besañ eus ar seurt ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"Galvet eo bet getFeatureFromEvent called war ur gwiskad hep daskorer. Kement-se a dalvez ez eus bet freuzet ur gwiskad hag hoc\'h eus miret un embreger bennak stag outañ."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Ne zleer implijout ar perzh minZoomLevel nemet evit gwiskadoù FixedZoomLevels-descendent. Ar fed ma wiria ar gwiskad WHS-se hag-eñ ez eus eus minZoomLevel zo un aspadenn gozh. Koulskoude n\'omp ket evit e ziverkañ kuit da derriñ arloadoù diazezet war OL a c\'hallfe bezañ stag outañ. Setu perak eo dispredet -- Lamet kuit e vo ar gwiriañ minZoomLevel a-is er stumm 3.0. Ober gant an arventennoù bihanañ/brasañ evel deskrivet amañ e plas : http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Treuzgread WFS : MAT EO ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Treuzgread WFS Transaction: C\'HWITET ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"N\'eus ket bet gallet kargañ ar gwiskad Google ent reizh.\x3cbr\x3e\x3cbr\x3eEvit en em zizober eus ar c\'hemenn-mañ, dibabit ur BaseLayer nevez en diuzer gwiskadoù er c\'horn dehoù el laez.\x3cbr\x3e\x3cbr\x3eSur a-walc\'h eo peogwir n\'eo ket bet ensoc\'het levraoueg Google Maps pe neuze ne glot ket an alc\'hwez API gant ho lec\'hienn.\x3cbr\x3e\x3cbr\x3eDiorroerien : Evit reizhañ an dra-se, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eclick here\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"N\'haller ket kargañ ar gwiskad ${layerType} ent reizh.\x3cbr\x3e\x3cbr\x3eEvit en em zizober eus ar c\'hemenn-mañ, dibabit ur BaseLayer nevez en diuzer gwiskadoù er c\'horn dehoù el laez.\x3cbr\x3e\x3cbr\x3eSur a-walc\'h eo peogwir n\'eo ket bet ensoc\'het mat al levraoueg ${layerLib}.\x3cbr\x3e\x3cbr\x3eDiorroerien : Evit gouzout penaos reizhañ an dra-se, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eclick here\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Skeul = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"K"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"R"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Klasket hoc\'h eus ouzhpennañ ar gwiskad : ${layerName} d\'ar gartenn, met ouzhpennet e oa bet c\'hoazh"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Emaoc\'h oc\'h implijout an dibarzh \'reproject\' war ar gwiskad ${layerName}. Dispredet eo an dibarzh-mañ : bet eo hag e talveze da ziskwel roadennoù war-c\'horre kartennoù diazez kenwerzhel, un dra hag a c\'haller ober bremañ gant an arc\'hwel dre skor banndres boullek Mercator. Muioc\'h a ditouroù a c\'haller da gaout war http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Dispredet eo an daore-se ha tennet e vo kuit eus ar stumm 3.0. Grit gant ${newMethod} e plas."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Rekis eo tremen an div dalvoudenn x ha y d\'an arc\'hwel add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Rekis eo tremen an div dalvoudenn hedred ha ledred d\'an arc\'hwel add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Rekis eo tremen an div dalvoudenn x ha y d\'an arc\'hwel add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Seurt mentoniezh anskoret : ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"C\'hwitet eo OpenLayers.Util.pagePosition : marteze emañ lec\'hiet fall an elfenn id ${elemId}."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"N\'eo ket bet emplementet ar priziañ evit seurt siloù c\'hoazh."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang.ca</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Resposta a petició no gestionada ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Enllaç permanent"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Capes addicionals"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Capa Base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"El mapa de referència només funciona si té la mateixa projecció que el mapa principal"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lectura no implementada."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Escriptura no implementada."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"No es pot actualitzar un element per al que no existeix FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Error carregant el fitxer GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"El seu navegador no suporta renderització vectorial. Els renderitzadors suportats actualment són:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : el component ha de ser de tipus ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent ha estat cridat des d'una capa sense renderizador. Això normalment vol dir que "</span><span class="PUNC">+</span><span class="STRN">"s'ha eliminat una capa, però no el handler associat a ella."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"La propietat minZoomLevel s'ha d'utilitzar només "</span><span class="PUNC">+</span><span class="STRN">"amb les capes que tenen FixedZoomLevels. El fet que "</span><span class="PUNC">+</span><span class="STRN">"una capa wfs comprovi minZoomLevel és una relíquia del "</span><span class="PUNC">+</span><span class="STRN">"passat. No podem, però, eliminar-la sense trencar "</span><span class="PUNC">+</span><span class="STRN">"les aplicacions d'OpenLayers que en puguin dependre. "</span><span class="PUNC">+</span><span class="STRN">"Així doncs estem fent-la obsoleta -- la comprovació "</span><span class="PUNC">+</span><span class="STRN">"minZoomLevel s'eliminarà a la versió 3.0. Feu servir "</span><span class="PUNC">+</span><span class="STRN">"els paràmetres min/max resolution en substitució, tal com es descriu aquí: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transacció WFS: CORRECTA ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transacció WFS: HA FALLAT ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"La capa Google no s'ha pogut carregar correctament.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Per evitar aquest missatge, seleccioneu una nova Capa Base "</span><span class="PUNC">+</span><span class="STRN">"al gestor de capes de la cantonada superior dreta.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Probablement això és degut a que l'script de la biblioteca de "</span><span class="PUNC">+</span><span class="STRN">"Google Maps no ha estat inclòs a la vostra pàgina, o no "</span><span class="PUNC">+</span><span class="STRN">"conté la clau de l'API correcta per a la vostra adreça.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Desenvolupadors: Per obtenir consells sobre com fer anar això, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>féu clic aquí&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Per evitar aquest missatge, seleccioneu una nova Capa Base "</span><span class="PUNC">+</span><span class="STRN">"al gestor de capes de la cantonada superior dreta.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Probablement això és degut a que l'script de la biblioteca "</span><span class="PUNC">+</span><span class="STRN">"${layerLib} "</span><span class="PUNC">+</span><span class="STRN">"no ha estat inclòs a la vostra pàgina.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Desenvolupadors: Per obtenir consells sobre com fer anar això, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>féu clic aquí&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Escala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">'O'</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">'E'</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">'N'</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">'S'</span><span class="PUNC">,</span><span class="STRN">'graticule'</span><span class="PUNC">:</span><span class="STRN">'Retícula'</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Heu intentat afegir la capa: ${layerName} al mapa, però ja ha estat afegida anteriorment"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Esteu fent servir l'opció 'reproject' a la capa "</span><span class="PUNC">+</span><span class="STRN">"${layerName}. Aquesta opció és obsoleta: el seu ús fou concebut "</span><span class="PUNC">+</span><span class="STRN">"per suportar la visualització de dades sobre mapes base comercials, "</span><span class="PUNC">+</span><span class="STRN">"però ara aquesta funcionalitat s'hauria d'assolir mitjançant el suport "</span><span class="PUNC">+</span><span class="STRN">"de la projecció Spherical Mercator. Més informació disponible a "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Aquest mètode és obsolet i s'eliminarà a la versió 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Si us plau feu servir em mètode alternatiu ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Ha de proporcionar els valors x i y a la funció add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Ha de proporcionar els valors lon i lat a la funció add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Ha de proporcionar els valors x i y a la funció add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Tipus de geometria no suportada: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition ha fallat: l'element amb id ${elemId} pot estar fora de lloc."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluate no està implementat per aquest tipus de filtre."</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"cs-CZ"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Nezpracovaná návratová hodnota ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Trvalý odkaz"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Překryvné vrstvy"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Podkladové vrstvy"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Přehledka pracuje správně pouze tehdy, pokud je ve stejné projekci jako hlavní mapa"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Read není implementováno."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Write není implementováno."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Nelze aktualizovat prvek, pro který neexistuje FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Chyba při načítání souboru GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Váš prohlížeč nepodporuje vykreslování vektorů. Momentálně podporované nástroje jsou::\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : komponenta by měla být ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent bylo zavoláno na vrstvě, která nemá vykreslovač. To obyčejně znamená, že jste odstranil vrstvu, ale ne rutinu s ní asociovanou."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Vlastnost minZoomLevel by se měla používat pouze s potomky FixedZoomLevels vrstvami. To znamená, že vrstva wfs kontroluje, zda-li minZoomLevel není zbytek z minulosti.Nelze to ovšem vyjmout bez možnosti, že bychom rozbili aplikace postavené na OL, které by na tom mohly záviset. Proto tuto vlastnost nedoporučujeme používat --  kontrola minZoomLevel bude odstraněna ve verzi 3.0. Použijte prosím raději nastavení min/max podle příkaldu popsaného na: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: ÚSPĚCH ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: CHYBA ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Nepodařilo se správně načíst vrstvu Google.\x3cbr\x3e\x3cbr\x3eAbyste se zbavili této zprávy, zvolte jinou základní vrstvu v přepínači vrstev.\x3cbr\x3e\x3cbr\x3eTo se většinou stává, pokud nebyl načten skript, nebo neobsahuje správný klíč pro API pro tuto stránku.\x3cbr\x3e\x3cbr\x3eVývojáři: Pro pomoc, aby tohle fungovalo , \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eklikněte sem\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"The ${layerType} Layer was unable to load correctly.\x3cbr\x3e\x3cbr\x3eTo get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.\x3cbr\x3e\x3cbr\x3eMost likely, this is because the ${layerLib} library script was either not correctly included.\x3cbr\x3e\x3cbr\x3eDevelopers: For help getting this working correctly, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eclick here\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Měřítko = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Pokusili jste se přidat vrstvu: ${layerName} do mapy, ale tato vrstva je již v mapě přítomna."</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Použil jste volbu \'reproject\' ve vrstvě ${layerName}. Tato volba není doporučená: byla zde proto, aby bylo možno zobrazovat data z okomerčních serverů, ale tato funkce je nyní zajištěna pomocí podpory Spherical Mercator. Více informací naleznete na http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Tato metoda je zavržená a bude ve verzi 3.0 odstraněna. Prosím, použijte raději ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Pro přídavnou funkci musíte zadat obě souřadnice x a y."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Pro přídavnou funkci musíte zadat obě souřadnice lon a lat."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Pro přídavnou funkci musíte zadat obě souřadnice x a y."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nepodporovaný typ geometrie: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition selhalo: element s  id ${elemId} je asi umístěn chybně."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">'da-DK'</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"En ikke håndteret forespørgsel returnerede ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Kortlag"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Baggrundslag"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Oversigtskortet fungerer kun når det har samme projektion som hovedkortet"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Læsning er ikke implementeret."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Skrivning er ikke implementeret."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Kan ikke opdateret en feature (et objekt) der ikke har et FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fejlede under indlæsning af GML fil ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Din browser understøtter ikke vektor visning. Følgende vektor visninger understøttes:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : komponenten skal være en ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent blev kaldt på et lag uden en visning. Dette betyder som regel at du "</span><span class="PUNC">+</span><span class="STRN">"har destrueret et lag, men ikke de håndteringer der var tilknyttet."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Egenskaben minZoomLevel er kun beregnet til brug "</span><span class="PUNC">+</span><span class="STRN">"med FixedZoomLevels. At dette WFS lag kontrollerer "</span><span class="PUNC">+</span><span class="STRN">"minZoomLevel egenskaben, er et levn fra en tidligere "</span><span class="PUNC">+</span><span class="STRN">"version. Vi kan desværre ikke fjerne dette uden at risikere "</span><span class="PUNC">+</span><span class="STRN">"at ødelægge eksisterende OL baserede programmer der "</span><span class="PUNC">+</span><span class="STRN">" benytter denne funktionalitet. "</span><span class="PUNC">+</span><span class="STRN">"Egenskaben bør derfor ikke anvendes, og minZoomLevel "</span><span class="PUNC">+</span><span class="STRN">"kontrollen herunder vil blive fjernet i version 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Benyt istedet min/max opløsnings indstillingerne, som "</span><span class="PUNC">+</span><span class="STRN">"er beskrevet her: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS transaktion: LYKKEDES ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS transaktion: MISLYKKEDES ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Google laget kunne ikke indlæses.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"For at fjerne denne besked, vælg et nyt bagrundskort i "</span><span class="PUNC">+</span><span class="STRN">"lagskifteren i øverste højre hjørne.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Fejlen skyldes formentlig at Google Maps bibliotekts "</span><span class="PUNC">+</span><span class="STRN">"scriptet ikke er inkluderet, eller ikke indeholder den "</span><span class="PUNC">+</span><span class="STRN">"korrkte API nøgle for dit site.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Udviklere: For hjælp til at få dette til at fungere, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>klik her&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"${layerType}-laget kunne ikke indlæses.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"For at fjerne denne besked, vælg et nyt bagrundskort i "</span><span class="PUNC">+</span><span class="STRN">"lagskifteren i øverste højre hjørne.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Fejlen skyldes formentlig at ${layerLib} bibliotekts "</span><span class="PUNC">+</span><span class="STRN">"scriptet ikke er inkluderet.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Udviklere: For hjælp til at få dette til at fungere, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>klik her&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Målforhold = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Du har forsøgt at tilføje laget: ${layerName} til kortet, men det er allerede tilføjet"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Du anvender indstillingen 'reproject' på laget ${layerName}."</span><span class="PUNC">+</span><span class="STRN">"Denne indstilling bør ikke længere anvendes. Den var beregnet "</span><span class="PUNC">+</span><span class="STRN">"til at vise data ovenpå kommercielle grundkort, men den funktionalitet "</span><span class="PUNC">+</span><span class="STRN">"bør nu opnås ved at anvende Spherical Mercator understøttelsen. "</span><span class="PUNC">+</span><span class="STRN">"Mere information er tilgængelig her: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Denne funktion bør ikke længere anvendes, og vil blive fjernet i version 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Anvend venligst funktionen ${newMethod} istedet."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Du skal angive både x og y værdier i kaldet til add funktionen."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Du skal angive både lon og lat værdier i kaldet til add funktionen."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Du skal angive både x og y værdier i kaldet til add funktionen."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Geometri typen: ${geomType} er ikke understøttet."</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition fejlede: elementet med id ${elemId} er måske placeret forkert."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluering er ikke implementeret for denne filter type."</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"de"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Unbehandelte Anfragerückmeldung ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Grundkarte"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Die Übersichtskarte funktioniert nur, wenn sie dieselbe Projektion wie die Hauptkarte verwendet"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lesen nicht implementiert."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Schreiben nicht implementiert."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Ein Feature, für das keine FID existiert, kann nicht aktualisiert werden."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fehler beim Laden der GML-Datei ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Ihr Browser unterstützt keine Vektordarstellung. Aktuell unterstützte Renderer:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: Komponente muss vom Typ ${geomType} sein"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent wurde vom einem Layer ohne Renderer aufgerufen. Dies bedeutet normalerweise, dass ein Layer entfernt wurde, aber nicht Handler, die auf ihn verweisen."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft ist nur für die Verwendung mit \x3ccode\x3eFixedZoomLevels\x3c/code\x3e-untergeordneten Layers vorgesehen. Das dieser \x3ctt\x3ewfs\x3c/tt\x3e-Layer die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft überprüft ist ein Relikt der Vergangenheit. Wir können diese Überprüfung nicht entfernen, ohne das OL basierende Applikationen nicht mehr funktionieren. Daher markieren wir es als veraltet - die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Überprüfung wird in Version 3.0 entfernt werden. Bitte verwenden Sie stattdessen die Min-/Max-Lösung, wie sie unter http://trac.openlayers.org/wiki/SettingZoomLevels beschrieben ist."</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transaktion: Erfolgreich ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transaktion: Fehlgeschlagen ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Der Google-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, wählen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der Google-Maps-Bibliothek nicht eingebunden wurde oder keinen gültigen API-Schlüssel für Ihre URL enthält.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3edas Wiki\x3c/a\x3e für Hilfe zum korrekten Einbinden des Google-Layers"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Der ${layerType}-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, wählen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der \'${layerLib}\'-Bibliothek nicht eingebunden wurde.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3edas Wiki\x3c/a\x3e für Hilfe zum korrekten Einbinden von Layern"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Maßstab = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Sie versuchen den Layer „${layerName}“ zur Karte hinzuzufügen, er wurde aber bereits hinzugefügt"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Sie verwenden die „Reproject“-Option des Layers ${layerName}. Diese Option ist veraltet: Sie wurde entwickelt um die Anzeige von Daten auf kommerziellen Basiskarten zu unterstützen, aber diese Funktion sollte jetzt durch Unterstützung der „Spherical Mercator“ erreicht werden. Weitere Informationen sind unter http://trac.openlayers.org/wiki/SphericalMercator verfügbar."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Die Methode ist veraltet und wird in 3.0 entfernt. Bitte verwende stattdessen ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Beide Werte (x und y) müssen der add-Funktion übergeben werden."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Beide Werte (lon und lat) müssen der add-Funktion übergeben werden."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Beide Werte (x und y) müssen der add-Funktion übergeben werden."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nicht unterstützter Geometrie-Typ: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition fehlgeschlagen: Element mit Id ${elemId} möglicherweise falsch platziert."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"„evaluate“ ist für diesen Filter-Typ nicht implementiert."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"el"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Κλίμακα ~ 1 : ${scaleDenom}"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang.en</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Unhandled request return ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Base Layer"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"The overview map only works when it is in the same projection as the main map"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Read not implemented."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Write not implemented."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Can't update a feature for which there is no FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Error in loading GML file ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : component should be an ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent called on layer with no renderer. This usually means you "</span><span class="PUNC">+</span><span class="STRN">"destroyed a layer, but not some handler which is associated with it."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"The minZoomLevel property is only intended for use "</span><span class="PUNC">+</span><span class="STRN">"with the FixedZoomLevels-descendent layers. That this "</span><span class="PUNC">+</span><span class="STRN">"wfs layer checks for minZoomLevel is a relic of the"</span><span class="PUNC">+</span><span class="STRN">"past. We cannot, however, remove it without possibly "</span><span class="PUNC">+</span><span class="STRN">"breaking OL based applications that may depend on it."</span><span class="PUNC">+</span><span class="STRN">" Therefore we are deprecating it -- the minZoomLevel "</span><span class="PUNC">+</span><span class="STRN">"check below will be removed at 3.0. Please instead "</span><span class="PUNC">+</span><span class="STRN">"use min/max resolution setting as described here: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: SUCCESS ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: FAILED ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"The Google Layer was unable to load correctly.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"To get rid of this message, select a new BaseLayer "</span><span class="PUNC">+</span><span class="STRN">"in the layer switcher in the upper-right corner.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Most likely, this is because the Google Maps library "</span><span class="PUNC">+</span><span class="STRN">"script was either not included, or does not contain the "</span><span class="PUNC">+</span><span class="STRN">"correct API key for your site.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Developers: For help getting this working correctly, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>click here&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"The ${layerType} Layer was unable to load correctly.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"To get rid of this message, select a new BaseLayer "</span><span class="PUNC">+</span><span class="STRN">"in the layer switcher in the upper-right corner.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Most likely, this is because the ${layerLib} library "</span><span class="PUNC">+</span><span class="STRN">"script was not correctly included.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Developers: For help getting this working correctly, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>click here&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Scale = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">'W'</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">'E'</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">'N'</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">'S'</span><span class="PUNC">,</span><span class="STRN">'graticule'</span><span class="PUNC">:</span><span class="STRN">'Graticule'</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"You tried to add the layer: ${layerName} to the map, but it has already been added"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"You are using the 'reproject' option "</span><span class="PUNC">+</span><span class="STRN">"on the ${layerName} layer. This option is deprecated: "</span><span class="PUNC">+</span><span class="STRN">"its use was designed to support displaying data over commercial "</span><span class="PUNC">+</span><span class="STRN">"basemaps, but that functionality should now be achieved by using "</span><span class="PUNC">+</span><span class="STRN">"Spherical Mercator support. More information is available from "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"This method has been deprecated and will be removed in 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Please use ${newMethod} instead."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"You must pass both x and y values to the add function."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"You must pass both lon and lat values to the add function."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"You must pass both x and y values to the add function."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Unsupported geometry type: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluate is not implemented for this filter type."</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang.es</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Respuesta a petición no gestionada ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Enlace permanente"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Capas superpuestas"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Capa Base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"El mapa de vista general sólo funciona si está en la misma proyección que el mapa principal"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lectura no implementada."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Escritura no implementada."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"No se puede actualizar un elemento para el que no existe FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Error cargando el fichero GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Su navegador no soporta renderización vectorial. Los renderizadores soportados actualmente son:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : el componente debe ser del tipo ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent se ha llamado desde una capa sin renderizador. Esto normalmente quiere decir que "</span><span class="PUNC">+</span><span class="STRN">"se ha destruido una capa, pero no el manejador asociado a ella."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"La propiedad minZoomLevel debe sólo utilizarse "</span><span class="PUNC">+</span><span class="STRN">"con las capas que tienen FixedZoomLevels. El hecho de que "</span><span class="PUNC">+</span><span class="STRN">"una capa wfs compruebe minZoomLevel es una reliquia del "</span><span class="PUNC">+</span><span class="STRN">"pasado. Sin embargo, no podemos eliminarla sin discontinuar "</span><span class="PUNC">+</span><span class="STRN">"probablemente las aplicaciones OL que puedan depender de ello. "</span><span class="PUNC">+</span><span class="STRN">"Así pues estamos haciéndolo obsoleto --la comprobación "</span><span class="PUNC">+</span><span class="STRN">"minZoomLevel se eliminará en la versión 3.0. Utilice el ajuste "</span><span class="PUNC">+</span><span class="STRN">"de resolution min/max en su lugar, tal como se describe aquí: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transacción WFS: ÉXITO ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transacción WFS: FALLÓ ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"La capa Google no pudo ser cargada correctamente.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Para evitar este mensaje, seleccione una nueva Capa Base "</span><span class="PUNC">+</span><span class="STRN">"en el selector de capas en la esquina superior derecha.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Probablemente, esto se debe a que el script de la biblioteca de "</span><span class="PUNC">+</span><span class="STRN">"Google Maps no fue correctamente incluido en su página, o no "</span><span class="PUNC">+</span><span class="STRN">"contiene la clave del API correcta para su sitio.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Desarrolladores: Para ayudar a hacer funcionar esto correctamente, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>haga clic aquí&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"La capa ${layerType} no pudo ser cargada correctamente.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Para evitar este mensaje, seleccione una nueva Capa Base "</span><span class="PUNC">+</span><span class="STRN">"en el selector de capas en la esquina superior derecha.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Probablemente, esto se debe a que el script de "</span><span class="PUNC">+</span><span class="STRN">"la biblioteca ${layerLib} "</span><span class="PUNC">+</span><span class="STRN">"no fue correctamente incluido en su página.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Desarrolladores: Para ayudar a hacer funcionar esto correctamente, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>haga clic aquí&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Escala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">'O'</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">'E'</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">'N'</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">'S'</span><span class="PUNC">,</span><span class="STRN">'graticule'</span><span class="PUNC">:</span><span class="STRN">'Retícula'</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Intentó añadir la capa: ${layerName} al mapa, pero ya había sido añadida previamente"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Está usando la opción 'reproject' en la capa "</span><span class="PUNC">+</span><span class="STRN">"${layerName}. Esta opción es obsoleta: su uso fue diseñado "</span><span class="PUNC">+</span><span class="STRN">"para soportar la visualización de datos sobre mapas base comerciales, "</span><span class="PUNC">+</span><span class="STRN">"pero ahora esa funcionalidad debería conseguirse mediante el soporte "</span><span class="PUNC">+</span><span class="STRN">"de la proyección Spherical Mercator. Más información disponible en "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Este método es obsoleto y se eliminará en la versión 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Por favor utilice el método ${newMethod} en su lugar."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Debe proporcionar los valores x e y a la función add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Debe proporcionar los valores lon y lat a la función add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Debe proporcionar los valores x e y a la función add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Tipo de geometría no soportada: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition falló: el elemento con id ${elemId} puede haberse colocado de manera errónea."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluate no está implementado para este tipo de filtro."</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"fi"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Ikilinkki"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Kerrokset"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Peruskerros"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Yleiskuvakarttaa voi käyttää vain, kun sillä on sama projektio kuin pääkartalla."</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"L"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"I"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"P"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"E"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"fr"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Requête non gérée, retournant ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalien"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Calques"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Calque de base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"La carte de situation ne fonctionne que lorsque sa projection est la même que celle de la carte principale"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lecture non implémentée."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Ecriture non implémentée."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Impossible de mettre à jour un objet sans identifiant (fid)."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Erreur au chargement du fichier GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Votre navigateur ne supporte pas le rendu vectoriel. Les renderers actuellement supportés sont : \n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : le composant devrait être de type ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent a été appelé sur un calque sans renderer. Cela signifie généralement que vous avez détruit cette couche, mais que vous avez conservé un handler qui lui était associé."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"La propriété minZoomLevel doit seulement être utilisée pour des couches FixedZoomLevels-descendent. Le fait que cette couche WFS vérifie la présence de minZoomLevel est une relique du passé. Nous ne pouvons toutefois la supprimer sans casser des applications qui pourraient en dépendre. C\'est pourquoi nous la déprécions -- la vérification du minZoomLevel sera supprimée en version 3.0. A la place, merci d\'utiliser les paramètres de résolutions min/max tel que décrit sur : http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transaction WFS : SUCCES ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transaction WFS : ECHEC ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"La couche Google n\'a pas été en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sélecteur de couche en haut à droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causé par la non-inclusion de la librairie Google Maps, ou alors parce que la clé de l\'API ne correspond pas à votre site.\x3cbr\x3e\x3cbr\x3eDéveloppeurs : pour savoir comment corriger ceci, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3ecliquez ici\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"La couche ${layerType} n\'est pas en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sélecteur de couche en haut à droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causé par la non-inclusion de la librairie ${layerLib}.\x3cbr\x3e\x3cbr\x3eDéveloppeurs : pour savoir comment corriger ceci, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3ecliquez ici\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Echelle ~ 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"E"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Vous avez essayé d\'ajouter à la carte le calque : ${layerName}, mais il est déjà présent"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Vous utilisez l\'option \'reproject\' sur la couche ${layerName}. Cette option est dépréciée : Son usage permettait d\'afficher des données au dessus de couches raster commerciales.Cette fonctionalité est maintenant supportée en utilisant le support de la projection Mercator Sphérique. Plus d\'information est disponible sur http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Cette méthode est dépréciée, et sera supprimée à la version 3.0. Merci d\'utiliser ${newMethod} à la place."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Vous devez passer les deux valeurs x et y à la fonction add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Vous devez passer les deux valeurs lon et lat à la fonction add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Vous devez passer les deux valeurs x et y à la fonction add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Type de géométrie non supporté : ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition a échoué: l\'élément d\'id ${elemId} pourrait être mal positionné."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"évaluer n\'a pas encore été implémenté pour ce type de filtre."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"fur"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Leam Permanent"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Livei parsore"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Livel di base"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Il to sgarfadôr nol supuarte la renderizazion vetoriâl. Al moment a son supuartâts:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Scjale = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"E"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"gl"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Solicitude non xerada; a resposta foi: ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Ligazón permanente"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Capas superpostas"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Capa base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"A vista xeral do mapa só funciona cando está na mesma proxección có mapa principal"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lectura non implementada."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Escritura non implementada."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Non se pode actualizar a funcionalidade para a que non hai FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Erro ao cargar o ficheiro GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"O seu navegador non soporta a renderización de vectores. Os renderizadores soportados actualmente son:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: o compoñente debera ser de tipo ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent ten sido chamado a unha capa sen renderizador. Isto normalmente significa que destruíu unha capa, mais non o executador que está asociado con ela."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"A propiedade minZoomLevel é só para uso conxuntamente coas capas FixedZoomLevels-descendent. O feito de que esa capa wfs verifique o minZoomLevel é unha reliquia do pasado. Non podemos, con todo, eliminala sen a posibilidade de non romper as aplicacións baseadas en OL que poidan depender dela. Por iso a estamos deixando obsoleta (a comprobación minZoomLevel de embaixo será eliminada na versión 3.0). Por favor, no canto diso use o axuste de resolución mín/máx tal e como está descrito aquí: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transacción WFS: ÉXITO ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transacción WFS: FALLIDA ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"A capa do Google non puido cargarse correctamente.\x3cbr\x3e\x3cbr\x3ePara evitar esta mensaxe, escolla unha nova capa base no seleccionador de capas na marxe superior dereita.\x3cbr\x3e\x3cbr\x3eProbablemente, isto acontece porque a escritura da libraría do Google Maps ou ben non foi incluída ou ben non contén a clave API correcta para o seu sitio.\x3cbr\x3e\x3cbr\x3eDesenvolvedores: para axudar a facer funcionar isto correctamente, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3epremede aquí\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"A capa ${layerType} foi incapaz de cargarse correctamente.\x3cbr\x3e\x3cbr\x3ePara evitar esta mensaxe, escolla unha nova capa base no seleccionador de capas na marxe superior dereita.\x3cbr\x3e\x3cbr\x3eProbablemente, isto acontece porque a escritura da libraría ${layerLib} non foi ben incluída.\x3cbr\x3e\x3cbr\x3eDesenvolvedores: para axudar a facer funcionar isto correctamente, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3epremede aquí\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Escala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"L"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Intentou engadir a capa: ${layerName} ao mapa, pero xa fora engadida"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Está usando a opción \"reproject\" na capa ${layerName}. Esta opción está obsoleta: o seu uso foi deseñado para a visualización de datos sobre mapas base comerciais, pero esta funcionalidade debera agora ser obtida utilizando a proxección Spherical Mercator. Hai dispoñible máis información en http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Este método está obsoleto e será eliminado na versión 3.0. Por favor, no canto deste use ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Debe achegar os valores x e y á función add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Debe achegar tanto o valor lon coma o lat á función add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Debe achegar os valores x e y á función add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Tipo xeométrico non soportado: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition fallou: o elemento con id ${elemId} pode non estar na súa posición."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"avaliar non está implementado para este tipo de filtro."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"gsw"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Nit behandleti Aafrogsruckmäldig ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Iberlagerige"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Grundcharte"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"D Ibersichts-Charte funktioniert nume, wänn si di glych Projäktion brucht wie d Hauptcharte"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Läse nit implementiert."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Schrybe nit implementiert."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"E Feature, wu s kei FID derfir git, cha nit aktualisiert wäre."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fähler bim Lade vu dr GML-Datei ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Dyy Browser unterstitzt kei Vektordarstellig. Aktuäll unterstitzti Renderer:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : Komponänt sott dr Typ ${geomType} syy"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent isch uf eme Layer ohni Renderer ufgruefe wore. Des heisst normalerwys, ass Du e Layer kaputt gmacht hesch, aber nit dr Handler, wu derzue ghert."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"D minZoomLevel-Eigeschaft isch nume dänk fir d Layer, wu vu dr FixedZoomLevels abstamme. Ass dää wfs-Layer minZoomLevel prieft, scih e Relikt us dr Vergangeheit. Mir chenne s aber nit ändere ohni OL_basierti Aawändige villicht kaputt gehn, wu dervu abhänge.  Us däm Grund het die Funktion d Eigeschaft \'deprecated\' iberchuu. D minZoomLevel-Priefig unte wird in dr Version 3.0 usegnuu. Bitte verwänd statt däm e min/max-Uflesig wie s do bschriben isch: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transaktion: ERFOLGRYCH ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transaktion: FÄHLGSCHLAA ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Dr Google-Layer het nit korräkt chenne glade wäre.\x3cbr\x3e\x3cbr\x3eGo die Mäldig nimi z kriege, wehl e andere Hintergrundlayer us em LayerSwitcher im rächte obere Ecke.\x3cbr\x3e\x3cbr\x3eDää Fähler git s seli hyfig, wel s Skript vu dr Google-Maps-Bibliothek nit yybunde woren isch oder wel s kei giltige API-Schlissel fir Dyy URL din het.\x3cbr\x3e\x3cbr\x3eEntwickler: Fir Hilf zum korräkte Yybinde vum Google-Layer \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3edoo drucke\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Dr ${layerType}-Layer het nit korräkt chenne glade wäre.\x3cbr\x3e\x3cbr\x3eGo die Mäldig nimi z kriege, wehl e andere Hintergrundlayer us em LayerSwitcher im rächte obere Ecke.\x3cbr\x3e\x3cbr\x3eDää Fähler git s seli hyfig, wel s Skript vu dr \'${layerLib}\'-Bibliothek nit yybunde woren isch oder wel s kei giltige API-Schlissel fir Dyy URL din het.\x3cbr\x3e\x3cbr\x3eEntwickler: Fir Hilf zum korräkte Yybinde vu Layer \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3edoo drucke\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Maßstab = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Du hesch versuecht dää Layer in d Charte yyzfiege: ${layerName}, aber är isch schoi yygfiegt"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Du bruchsch d \'reproject\'-Option bim ${layerName}-Layer. Die Option isch nimi giltig: si isch aagleit wore go   Date iber kommerziälli Grundcharte lege, aber des sott mer jetz mache mit dr Unterstitzig vu Spherical Mercator. Meh Informatione git s uf http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Die Methode isch veraltet un wird us dr Version 3.0 usegnuu. Bitte verwäbnd statt däm ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Du muesch e x-Wärt un e y-Wärt yygee bi dr Zuefieg-Funktion"</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Du meusch e Lengi- un e Breiti-Grad yygee bi dr Zuefieg-Funktion."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Du muesch x- un y-Wärt aagee bi dr Zuefieg-Funktion."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nit unterstitze Geometrii-Typ: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition fählgschlaa: Elemänt mit ID ${elemId} isch villicht falsch gsetzt."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluiere isch nit implemäntiert in däm Filtertyp."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"hr"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Nepodržani zahtjev ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Osnovna karta"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Pregledna karta radi jedino kao je u istoj projekciji kao i glava karta"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Čitanje nije implementirano."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Pisanje nije implementirano."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Ne mogu ažurirati značajku za koju ne postoji FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Greška u učitavanju GML datoteke ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Vaš preglednik ne podržava vektorsko renderiranje. Trenutno podržani rendereri su: ${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : komponenta bi trebala biti ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent je pozvao Layer bez renderera. Ovo obično znači da ste uništiili Layer, a ne neki Handler koji je povezan s njim."</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS Transakcija: USPJEŠNA ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS Transakcija: NEUSPJEŠNA ${response}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Mjerilo = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Pokušali ste dodati layer:  ${layerName} na kartu, ali je već dodan"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Ova metoda nije odobrena i biti će maknuta u 3.0. Koristite ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Morate dati obje vrijednosti ,  x i y  da bi dodali funkciju."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Morate dati obje vrijednosti , (lon i lat) da bi dodali funkciju."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Morate dati obje vrijednosti ,  x i y  da bi dodali funkciju."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nepodržani tip geometrije: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition nije uspjelo: element sa id ${elemId} može biti krivo smješten."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"hsb"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Wotmołwa njewobdźěłaneho naprašowanja ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Trajny wotkaz"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Naworštowanja"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Zakładna runina"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Přehladowa karta jenož funguje, hdyž je w samsnej projekciji kaž hłowna karta"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Čitanje njeimplementowane."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Pisanje njeimplementowane."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Funkcija, za kotruž FID njeje, njeda so aktualizować."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Zmylk při začitowanju dataje ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Twój wobhladowak wektorowe rysowanje njepodpěruje. Tuchwilu podpěrowane rysowaki su:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: komponenta měła ${geomType} być"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent bu na woršće bjez rysowak zawołany. To zwjetša woznamjenja, zo sy worštu zničił, ale nic wobdźěłak, kotryž je z njej zwjazany."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Kajkosć minZoomLevel je jenož za wužiwanje z worštami myslena, kotrež wot FixedZoomLevels pochadźeja. Zo tuta woršta wfs za minZoomLevel přepruwuje, je relikt zańdźenosće. Njemóžemy wšak ju wotstronić, bjeztoho zo aplikacije, kotrež na OpenLayers bazěruja a snano tutu kajkosć wužiwaja, hižo njefunguja. Tohodla smy ju jako zestarjenu woznamjenili -- přepruwowanje za minZoomLevel budu so we wersiji 3.0 wotstronjeć. Prošu wužij město toho nastajenje min/max, kaž je tu wopisane: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transakcija: WUSPĚŠNA ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transakcija: NJEPORADŹENA ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Woršta Google njemóžeše so korektnje začitać.\x3cbr\x3e\x3cbr\x3eZo by tutu zdźělenku wotbył, wubjer nowy BaseLayer z wuběra worštow horjeka naprawo.\x3cbr\x3e\x3cbr\x3eNajskerje so to stawa, dokelž skript biblioteki Google Maps pak njebu zapřijaty pak njewobsahuje korektny kluč API za twoje sydło.\x3cbr\x3e\x3cbr\x3eWuwiwarjo: Za pomoc ke korektnemu fungowanju worštow\n\x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3etu kliknyć\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Woršta ${layerType} njemóžeše so korektnje začitać.\x3cbr\x3e\x3cbr\x3eZo by tutu zdźělenku wotbył, wubjer nowy BaseLayer z wuběra worštow horjeka naprawo.\x3cbr\x3e\x3cbr\x3eNajskerje so to stawa, dokelž skript biblioteki ${layerLib} njebu korektnje zapřijaty.\x3cbr\x3e\x3cbr\x3eWuwiwarjo: Za pomoc ke korektnemu fungowanju worštow\n\x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3etu kliknyć\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Měritko = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"Z"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"J"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Sy spytał runinu ${layerName} karće dodać, ale je so hižo dodała"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Wužiwaš opciju \"reproject\" wořšty ${layerName}. Tuta opcija je zestarjena: jeje wužiwanje bě myslene, zo by zwobraznjenje datow nad komercielnymi bazowymi kartami podpěrało, ale funkcionalnosć měła so nětko z pomocu Sperical Mercator docpěć. Dalše informacije steja na http://trac.openlayers.org/wiki/SphericalMercator k dispoziciji."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Tuta metoda je so njeschwaliła a budźe so w 3.0 wotstronjeć. Prošu wužij ${newMethod} město toho."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Dyrbiš hódnotu x kaž tež y funkciji \"add\" přepodać."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Dyrbiš hódnotu lon kaž tež lat funkciji \"add\" přepodać."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Dyrbiš hódnotu x kaž tež y funkciji \"add\" přepodać."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Njepodpěrowany geometrijowy typ: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition je so njeporadźił: element z id ${elemId} bu snano wopak zaměstnjeny."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"wuhódnoćenje njeje za tutón filtrowy typ implementowany."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"hu"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Nem kezelt kérés visszatérése ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Rávetítések"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Alapréteg"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Az áttekintő térkép csak abban az esetben működik, ha ugyanazon a vetületen van, mint a fő térkép."</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Olvasás nincs végrehajtva."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Írás nincs végrehajtva."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Nem frissíthető olyan jellemző, amely nem rendelkezik FID-del."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Hiba GML-fájl betöltésekor ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"A böngészője nem támogatja a vektoros renderelést. A jelenleg támogatott renderelők:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : az összetevőnek ilyen típusúnak kell lennie: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent réteget hívott meg renderelő nélkül. Ez rendszerint azt jelenti, hogy megsemmisített egy fóliát, de néhány ahhoz társított kezelőt nem."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"A minZoomLevel tulajdonságot csak a következővel való használatra szánták: FixedZoomLevels-leszármazott fóliák. Ez azt jelenti, hogy a minZoomLevel wfs fólia jelölőnégyzetei már a múlté. Mi azonban nem távolíthatjuk el annak a veszélye nélkül, hogy az esetlegesen ettől függő OL alapú alkalmazásokat tönkretennénk. Ezért ezt érvénytelenítjük -- a minZoomLevel az alul levő jelölőnégyzet a 3.0-s verzióból el lesz távolítva. Kérjük, helyette használja a  min/max felbontás beállítást, amelyről az alábbi helyen talál leírást: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS tranzakció: SIKERES ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS tranzakció: SIKERTELEN ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"A Google fólia betöltése sikertelen.\x3cbr\x3e\x3cbr\x3eAhhoz, hogy ez az üzenet eltűnjön, válasszon egy új BaseLayer fóliát a jobb felső sarokban található fóliakapcsoló segítségével.\x3cbr\x3e\x3cbr\x3eNagy valószínűséggel ez azért van, mert a Google Maps könyvtár parancsfájlja nem található, vagy nem tartalmazza az Ön oldalához tartozó megfelelő API-kulcsot.\x3cbr\x3e\x3cbr\x3eFejlesztőknek: A helyes működtetésre vonatkozó segítség az alábbi helyen érhető el, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3ekattintson ide\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"A(z) ${layerType} fólia nem töltődött be helyesen.\x3cbr\x3e\x3cbr\x3eAhhoz, hogy ez az üzenet eltűnjön, válasszon egy új BaseLayer fóliát a jobb felső sarokban található fóliakapcsoló segítségével.\x3cbr\x3e\x3cbr\x3eNagy valószínűséggel ez azért van, mert a(z) ${layerLib} könyvtár parancsfájlja helytelen.\x3cbr\x3e\x3cbr\x3eFejlesztőknek: A helyes működtetésre vonatkozó segítség az alábbi helyen érhető el, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3ekattintson ide\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Lépték = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"Ny"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"K"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"É"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"D"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Megpróbálta hozzáadni a(z) ${layerName} fóliát a térképhez, de az már hozzá van adva"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Ön a \'reproject\' beállítást használja a(z) ${layerName} fólián. Ez a beállítás érvénytelen: használata az üzleti alaptérképek fölötti adatok megjelenítésének támogatására szolgált, de ezt a funkció ezentúl a Gömbi Mercator használatával érhető el. További információ az alábbi helyen érhető el: http://trac.openlayers.org/wiki/SphericalMercator"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Ez a módszer érvénytelenítve lett és a 3.0-s verzióból el lesz távolítva. Használja a(z) ${newMethod} módszert helyette."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Az x és y értékeknek egyaránt meg kell felelnie, hogy a funkciót hozzáadhassa."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"A hossz. és szél. értékeknek egyaránt meg kell felelnie, hogy a funkciót hozzáadhassa."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Az x és y értékeknek egyaránt meg kell felelnie, hogy a funkciót hozzáadhassa."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nem támogatott geometriatípus: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition sikertelen: lehetséges, hogy a(z) ${elemId} azonosítójú elem téves helyre került."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"ennél a szűrőtípusnál kiértékelés nem hajtódik végre."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"ia"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Le responsa a un requesta non esseva maneate: ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permaligamine"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Superpositiones"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Strato de base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Le mini-carta functiona solmente si illo es in le mesme projection que le carta principal"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lectura non implementate."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Scriptura non implementate."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Non pote actualisar un elemento sin FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Error al cargamento del file GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Tu navigator non supporta le rendition de vectores. Le renditores actualmente supportate es:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: le componente debe esser del typo ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent ha essite appellate in un strato sin renditor. Isto significa generalmente que tu ha destruite un strato, ma lassava un gestor associate con illo."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Le proprietate minZoomLevel es solmente pro uso con le stratos descendente de FixedZoomLevels. Le facto que iste strato WFS verifica minZoomLevel es un reliquia del passato. Nonobstante, si nos lo remove immediatemente, nos pote rumper applicationes a base de OL que depende de illo. Ergo nos lo declara obsolete; le verification de minZoomLevel in basso essera removite in version 3.0. Per favor usa in su loco le configuration de resolutiones min/max como describite a: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transaction WFS: SUCCESSO ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transaction WFS: FALLEVA ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Le strato Google non poteva esser cargate correctemente.\x3cbr\x3e\x3cbr\x3ePro disfacer te de iste message, selige un nove BaseLayer in le selector de strato in alto a dextra.\x3cbr\x3e\x3cbr\x3eMulto probabilemente, isto es proque le script del libreria de Google Maps non esseva includite o non contine le clave API correcte pro tu sito.\x3cbr\x3e\x3cbr\x3eDisveloppatores: Pro adjuta de corriger isto, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eclicca hic\x3c/a"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Le strato ${layerType} non poteva esser cargate correctemente.\x3cbr\x3e\x3cbr\x3ePro disfacer te de iste message, selige un nove BaseLayer in le selector de strato in alto a dextra.\x3cbr\x3e\x3cbr\x3eMulto probabilemente, isto es proque le script del libreria de ${layerLib} non esseva correctemente includite.\x3cbr\x3e\x3cbr\x3eDisveloppatores: Pro adjuta de corriger isto, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eclicca hic\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Scala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"E"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Tu tentava adder le strato: ${layerName} al carta, ma illo es ja presente"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Tu usa le option \'reproject\' in le strato ${layerName} layer. Iste option es obsolescente: illo esseva pro poter monstrar datos super cartas de base commercial, ma iste functionalitate pote ora esser attingite con le uso de Spherical Mercator. Ulterior information es disponibile a http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Iste methodo ha essite declarate obsolescente e essera removite in version 3.0. Per favor usa ${newMethod} in su loco."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Tu debe passar le duo valores x e y al function add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Tu debe passar le duo valores lon e lat al function add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Tu debe passar le duo valores x e y al function add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Typo de geometria non supportate: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition falleva: le elemento con id ${elemId} pote esser mal placiate."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"\"evaluate\" non es implementate pro iste typo de filtro."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"is"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Varanlegur tengill"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Þekjur"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Grunnlag"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Yfirlitskortið virkar aðeins ef það er í sömu vörpun og aðalkortið"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Skrifun er óútfærð."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lestur er óútfærður."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Villa kom upp við að hlaða inn GML skránni ${url}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Skali = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Þú reyndir að bæta laginu ${layerName} á kortið en það er þegar búið að bæta því við"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Þetta fall hefur verið úrelt og verður fjarlægt í 3.0. Notaðu ${newMethod} í staðin."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang.it</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Codice di ritorno della richiesta ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Livello base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"La mini mappa funziona solamente se ha la stessa proiezione della mappa principale"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lettura non implementata."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Scrittura non implementata."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Impossibile aggiornare un elemento grafico che non abbia il FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Errore nel caricamento del file GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Il tuo browser non supporta il rendering vettoriale. I renderizzatore attualemnte supportati sono:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : il componente dovrebbe essere di tipo ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent chiamata su di un livello senza renderizzatore. Ciò significa che "</span><span class="PUNC">+</span><span class="STRN">"il livello è stato cancellato, ma non i gestori associati ad esso."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"La proprietà minZoomLevel è da utilizzare solamente "</span><span class="PUNC">+</span><span class="STRN">"con livelli che abbiano FixedZoomLevels. Il fatto che "</span><span class="PUNC">+</span><span class="STRN">"questo livello wfs controlli la proprietà minZoomLevel è "</span><span class="PUNC">+</span><span class="STRN">"un retaggio del passato. Non possiamo comunque rimuoverla "</span><span class="PUNC">+</span><span class="STRN">"senza rompere le vecchie applicazioni che dipendono su di essa."</span><span class="PUNC">+</span><span class="STRN">"Quindi siamo costretti a deprecarla -- minZoomLevel "</span><span class="PUNC">+</span><span class="STRN">"e sarà rimossa dalla vesione 3.0. Si prega di utilizzare i "</span><span class="PUNC">+</span><span class="STRN">"settaggi di risoluzione min/max come descritto qui: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transazione WFS: SUCCESS ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transazione WFS: FAILED ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Il livello Google non è riuscito a caricare correttamente.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Per evitare questo messaggio, seleziona un nuovo BaseLayer "</span><span class="PUNC">+</span><span class="STRN">"nel selettore di livelli nell'angolo in alto a destra.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Più precisamente, ciò accade perchè la libreria Google Maps "</span><span class="PUNC">+</span><span class="STRN">"non è stata inclusa nella pagina, oppure non contiene la "</span><span class="PUNC">+</span><span class="STRN">"corretta API key per il tuo sito.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Sviluppatori: Per aiuto su come farlo funzionare correttamente, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>clicca qui&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Il livello ${layerType} non è riuscito a caricare correttamente.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Per evitare questo messaggio, seleziona un nuovo BaseLayer "</span><span class="PUNC">+</span><span class="STRN">"nel selettore di livelli nell'angolo in alto a destra.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Più precisamente, ciò accade perchè la libreria ${layerLib} "</span><span class="PUNC">+</span><span class="STRN">"non è stata inclusa nella pagina.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Sviluppatori: Per aiuto su come farlo funzionare correttamente, "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>clicca qui&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Scala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Stai cercando di aggiungere il livello: ${layerName} alla mappa, ma tale livello è già stato aggiunto."</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Stai utilizzando l'opzione 'reproject' sul livello ${layerName}. "</span><span class="PUNC">+</span><span class="STRN">"Questa opzione è deprecata: il suo utilizzo è stato introdotto per"</span><span class="PUNC">+</span><span class="STRN">"supportare il disegno dei dati sopra mappe commerciali, ma tale "</span><span class="PUNC">+</span><span class="STRN">"funzionalità dovrebbe essere ottenuta tramite l'utilizzo della proiezione "</span><span class="PUNC">+</span><span class="STRN">"Spherical Mercator. Per maggiori informazioni consultare qui "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Questo metodo è stato deprecato e sarà rimosso dalla versione 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Si prega di utilizzare il metodo ${newMethod} in alternativa."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Devi specificare i valori di x e y alla funzione add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Devi specificare i valori di lon e lat alla funzione add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Devi specificare i valori di x e y alla funzione add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Tipo di geometria non supportata: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition fallita: l'elemento con id ${elemId} è posizionato in modo errato."</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"ja"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"未処理の要求は ${statusText} を返します"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"パーマリンク"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"オーバーレイ"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"基底レイヤー"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"概観地図はメインの地図と同じ投影法をとる場合のみ機能します"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"読み込みは実装されていません。"</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"書き込みは実装されていません。"</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"FID のない地物は更新できません。"</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"GML ファイル ${url} の読み込みエラー"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"あなたのブラウザはベクターグラフィックスの描写に対応していません。現時点で対応しているソフトウェアは以下のものです。\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: 要素は ${geomType} であるべきです"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent がレンダラーのないレイヤーから呼ばれました。通常、これはあなたがレイヤーを、それに関連づけられたいくつかのハンドラを除いて、破壊してしまったことを意味します。"</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"minZoomLevel プロパティは FixedZoomLevels を継承するレイヤーでの使用のみを想定しています。この minZoomLevel に対する WFS レイヤーの検査は歴史的なものです。しかしながら、この検査を除去するとそれに依存する OpenLayers ベースのアプリケーションを破壊してしまう可能性があります。よって廃止が予定されており、この minZoomLevel 検査はバージョン3.0で除去されます。代わりに、http://trac.openlayers.org/wiki/SettingZoomLevels で解説されている、最小および最大解像度設定を使用してください。"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS トランザクション: 成功 ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS トランザクション: 失敗 ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Google レイヤーが正しく読み込みを行えませんでした。\x3cbr\x3e\x3cbr\x3eこのメッセージを消すには、右上の隅にあるレイヤー切り替え部分で新しい基底レイヤーを選んでください。\x3cbr\x3e\x3cbr\x3eおそらく、これは Google マップ用ライブラリのスクリプトが組み込まれていないか、あなたのサイトに対応する正しい API キーが設定されていないためです。\x3cbr\x3e\x3cbr\x3e開発者の方へ: 正しい動作をさせるために\x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eこちらのウィキ\x3c/a\x3eを参照してください。"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"${layerType} レイヤーが正しく読み込みを行えませんでした。\x3cbr\x3e\x3cbr\x3eこのメッセージを消すには、右上の隅にあるレイヤー切り替え部分で新しい基底レイヤーを選んでください。\x3cbr\x3e\x3cbr\x3eおそらく、これは ${layerLib} ライブラリのスクリプトが正しく組み込まれていないためです。\x3cbr\x3e\x3cbr\x3e開発者の方へ: 正しい動作をさせるために\x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eこちらのウィキ\x3c/a\x3eを参照してください。"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"縮尺 = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"西"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"東"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"北"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"南"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"あなたは「${layerName}」を地図に追加しようと試みましたが、そのレイヤーは既に追加されています"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"あなたは「${layerName}」レイヤーで reproject オプションを使っています。このオプションは商用の基底地図上に情報を表示する目的で設計されましたが、現在ではその機能は Spherical Mercator サポートを利用して実現されており、このオプションの使用は非推奨です。追加の情報は http://trac.openlayers.org/wiki/SphericalMercator で入手できます。"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"このメソッドは廃止が予定されており、バージョン3.0で除去されます。代わりに ${newMethod} を使用してください。"</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"x と y 両方の値を add 関数に渡さなければなりません。"</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"lon と lat 両方の値を add 関数に渡さなければなりません。"</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"x と y の値両方を add 関数に渡さなければなりません。"</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"未対応の形状型: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition が失敗しました: id ${elemId} をもつ要素が誤った位置にある可能性があります。"</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"このフィルター型について evaluate は実装されていません。"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"km"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"តំណភ្ជាប់អចិន្ត្រៃយ៍"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"ស្រទាប់បាត​"</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"កំហុសកំឡុងពេលផ្ទុកឯកសារ GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"មាត្រដ្ឋាន = ១ ៖ ${scaleDenom}"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"ksh"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Met dä Antwoot op en Aanfrooch ham_mer nix aanjefange: ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Lengk op Duuer"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Drövver jelaat"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Jrund-Nivoh"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"De Övverseeschs_Kaat deiht et bloß, wann se de sälve Projäxjuhn bruche deiht, wi de Houp_Kaat"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"„\x3ccode lang=\"en\"\x3eread\x3c/code\x3e“ is em Projramm nit fürjesinn."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"„\x3ccode lang=\"en\"\x3ewrite\x3c/code\x3e“ is em Projramm nit fürjesinn."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"En Saach, woh kein \x3ci lang=\"en\"\x3eFID\x3c/i\x3e för doh es, löht sesch nit ändere."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fähler beim \x3ci lang=\"en\"\x3eGML\x3c/i\x3e-Datei-Laade vun \x3ccode\x3e${url}\x3c/code\x3e"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Dinge Brauser kann kein Väktore ußjävve. De Zoote Ußjaabe, di em Momang jon, sen:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"\x3ccode lang=\"en\"\x3eaddFeatures\x3c/code\x3e: dä Aandeil sullt vun dä Zoot „\x3ccode lang=\"en\"\x3e${geomType}\x3c/code\x3e“ sin."</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"\x3ccode lang=\"en\"\x3egetFeatureFromEvent\x3c/code\x3e es vun enem Nivoh opjeroofe woode, woh et kei Projramm zom Ußjävve jit. Dat bedügg för jewöhnlesch, dat De e Nivoh kapott jemaat häs, ävver nit e Projramm för domet ömzejonn, wat domet verbonge es."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"De Eijeschaff „\x3ccode lang=\"en\"\x3eminZoomLevel\x3c/code\x3e“ es bloß doför jedaach, dat mer se met dä Nivvohß bruch, di vun \x3ccode lang=\"en\"\x3eFixedZoomLevels\x3c/code\x3e affhange don. Dat dat \x3ci lang=\"en\"\x3eWFS\x3c/i\x3e-Nivvoh övverhoup de Eijeschaff „\x3ccode lang=\"en\"\x3eminZoomLevel\x3c/code\x3e“ pröhfe deiht, es noch övveresch vun fröhjer. Mer künne dat ävver jez nit fott lohße, oohne dat mer Jevaa loufe, dat Aanwendunge vun OpenLayers nit mieh loufe, di sesch doh velleijsch noch drop am verlohße sin. Dröm sare mer, dat mer et nit mieh han welle, un de „\x3ccode lang=\"en\"\x3eminZoomLevel\x3c/code\x3e“-Eijeschaff weed hee vun de Version 3.0 af nit mieh jeprööf wäde. Nemm doför de Enstellung för de hühßte un de kleinßte Oplöhsung, esu wi et en http://trac.openlayers.org/wiki/SettingZoomLevels opjeschrevve es."</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Dä \x3ci lang=\"en\"\x3eWFS\x3c/i\x3e-Vörjang es joot jeloufe: ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Dä \x3ci lang=\"en\"\x3eWFS\x3c/i\x3e-Vörjang es scheif jejange: ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Dat Nivvoh \x3ccode lang=\"en\"\x3eGoogle\x3c/code\x3e kunnt nit reschtesch jelaade wääde.\x3cbr /\x3e\x3cbr /\x3eÖm hee di Nohreesch loß ze krijje, donn en ander Jrund-Nivvoh ußsöhke, rähß bovve en de Äk.\x3cbr /\x3e\x3cbr /\x3eWascheinlesch es dat wiel dat \x3ci lang=\"en\"\x3eGoogle-Maps\x3c/i\x3e-Skrepp entweeder nit reschtesch enjebonge wood, udder nit dä reschtejje \x3ci lang=\"en\"\x3eAPI\x3c/i\x3e-Schlößel för Ding Web-ßait scheke deiht.\x3cbr /\x3e\x3cbr /\x3eFör Projrammierer jidd_et Hölp do_drövver, \x3ca href=\"http://trac.openlayers.org/wiki/Google\" target=\"_blank\"\x3ewi mer dat aan et Loufe brengk\x3c/a\x3e."</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Dat Nivvoh \x3ccode\x3e${layerType}\x3c/code\x3e kunnt nit reschtesch jelaade wääde.\x3cbr /\x3e\x3cbr /\x3eÖm hee di Nohreesch loß ze krijje, donn en ander Jrund-Nivvoh ußsöhkre, rähß bovve en de Äk.\x3cbr /\x3e\x3cbr /\x3eWascheinlesch es dat, wiel dat Skrepp \x3ccode\x3e${layerLib}\x3c/code\x3e nit reschtesch enjebonge wood.\x3cbr /\x3e\x3cbr /\x3eFör Projrammierer jidd_Et Hölp do_drövver, \x3ca href=\"http://trac.openlayers.org/wiki/${layerLib}\" target=\"_blank\"\x3ewi mer dat aan et Loufe brengk\x3c/a\x3e."</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Mohßshtaab = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Do häß versöhk, dat Nivvoh \x3ccode\x3e${layerName}\x3c/code\x3e en di Kaat eren ze bränge, et wohr ävver ald do dren."</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Do bruchs de Ußwahl \x3ccode\x3ereproject\x3c/code\x3e op däm Nivvoh \x3ccode\x3e${layerName}\x3c/code\x3e. Di Ußwahl es nit mieh jähn jesinn. Se wohr doför jedaach, öm Date op jeschääfsmäßesch eruß jejovve Kaate bovve drop ze moole, wat ävver enzwesche besser met dä Öngershtözung för de ßfääresche Mäkaator Beldscher jeiht. Doh kanns De mieh drövver fenge op dä Sigg: http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Hee di Metood es nim_mih aktoäll un et weed se en dä Version 3.0 nit mieh jävve. Nemm \x3ccode\x3e${newMethod}\x3c/code\x3e doföör."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Do moß beeds vun de \x3ccode\x3ex\x3c/code\x3e un \x3ccode\x3ey\x3c/code\x3e Wääte aan de Fungkßjohn \x3ccode\x3eadd\x3c/code\x3e jävve."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Do moß beeds \x3ccode\x3elon\x3c/code\x3e un \x3ccode\x3elat\x3c/code\x3e aan de Fungkßjohn \x3ccode\x3eadd\x3c/code\x3e jävve."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Do moß beeds \x3ccode\x3ex\x3c/code\x3e un \x3ccode\x3ey\x3c/code\x3e aan de Fungkßjohn \x3ccode\x3eadd\x3c/code\x3e jävve."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"De Zoot Jommetrii dom_mer nit ongershtöze: \x3ccode\x3e${geomType}\x3c/code\x3e"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"\x3ccode lang=\"en\"\x3eOpenLayers.Util.pagePosition\x3c/code\x3e es donevve jejange: dat Denge met dä Kännong \x3ccode\x3e${elemId}\x3c/code\x3e künnt am verkeehte Plaz sin."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"„\x3ccode lang=\"en\"\x3eevaluate\x3c/code\x3e“ es för di Zoot Fellter nit enjereschdt."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"nb"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Ubehandlet forespørsel returnerte ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Kobling til denne siden"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Kartlag"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Bakgrunnskart"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Oversiktskartet fungerer bare når det har samme projeksjon som hovedkartet"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lesing er ikke implementert."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Skriving er ikke implementert."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Kan ikke oppdatere et feature (et objekt) som ikke har FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Feil under lasting av GML-fil ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Din nettleser støtter ikke vektortegning. Tegnemetodene som støttes er:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : komponenten må være en ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent har blitt kjørt mot et lag uten noen tegnemetode. Dette betyr som regel at du "</span><span class="PUNC">+</span><span class="STRN">"fjernet et lag uten å fjerne alle håndterere tilknyttet laget."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Egenskapen minZoomLevel er kun ment til bruk på lag "</span><span class="PUNC">+</span><span class="STRN">"basert på FixedZoomLevels. At dette wfs-laget sjekker "</span><span class="PUNC">+</span><span class="STRN">"minZoomLevel er en etterlevning fra tidligere versjoner. Det kan dog ikke "</span><span class="PUNC">+</span><span class="STRN">"tas bort uten å risikere at OL-baserte applikasjoner "</span><span class="PUNC">+</span><span class="STRN">"slutter å virke, så det er merket som foreldet: "</span><span class="PUNC">+</span><span class="STRN">"minZoomLevel i sjekken nedenfor vil fjernes i 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Vennligst bruk innstillingene for min/maks oppløsning "</span><span class="PUNC">+</span><span class="STRN">"som er beskrevet her: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-transaksjon: LYKTES ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-transaksjon: MISLYKTES ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Google-laget kunne ikke lastes.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Bytt til et annet bakgrunnslag i lagvelgeren i "</span><span class="PUNC">+</span><span class="STRN">"øvre høyre hjørne for å slippe denne meldingen.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Sannsynligvis forårsakes feilen av at Google Maps-biblioteket "</span><span class="PUNC">+</span><span class="STRN">"ikke er riktig inkludert på nettsiden, eller at det ikke er "</span><span class="PUNC">+</span><span class="STRN">"angitt riktig API-nøkkel for nettstedet.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Utviklere: For hjelp til å få dette til å virke se "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>her&lt;/a>."</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"${layerType}-laget kunne ikke lastes.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Bytt til et annet bakgrunnslag i lagvelgeren i "</span><span class="PUNC">+</span><span class="STRN">"øvre høyre hjørne for å slippe denne meldingen.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Sannsynligvis forårsakes feilen av at "</span><span class="PUNC">+</span><span class="STRN">"${layerLib}-biblioteket ikke var riktig inkludert "</span><span class="PUNC">+</span><span class="STRN">"på nettsiden.&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"Utviklere: For hjelp til å få dette til å virke se "</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>her&lt;/a>."</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"&lt;strong>Skala&lt;/strong> 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Du forsøkte å legge til laget ${layerName} på kartet, men det er allerede lagt til"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Du bruker innstillingen 'reproject' på laget ${layerName}. "</span><span class="PUNC">+</span><span class="STRN">"Denne innstillingen er foreldet, den var ment for å støtte "</span><span class="PUNC">+</span><span class="STRN">"visning av kartdata over kommersielle bakgrunnskart, men det "</span><span class="PUNC">+</span><span class="STRN">"bør nå gjøres med støtten for Spherical Mercator. Mer informasjon "</span><span class="PUNC">+</span><span class="STRN">"finnes på http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Denne metoden er markert som foreldet og vil bli fjernet i 3.0. "</span><span class="PUNC">+</span><span class="STRN">"Vennligst bruk ${newMethod} i stedet."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Du må gi både x- og y-verdier til funksjonen add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Du må gi både lon- og lat-verdier til funksjonen add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Du må gi både x- og y-verdier til funksjonen add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Geometritypen ${geomType} er ikke støttet"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition feilet: elementet med id ${elemId} kan være feilplassert."</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"no"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"nb"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"nds"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Unbehannelt Trüchmellels för de Anfraag ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalink"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Achtergrundkoort"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"De Översichtskoort geiht blot, wenn de sülve Projekschoon as bi de Hööftkoort bruukt warrt"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lesen is nich inricht."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Schrieven is nich inricht."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"En Feature, dat keen FID hett, kann nich aktuell maakt warrn."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fehler bi’t Laden vun de GML-Datei ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Dien Browser ünnerstütt keen Vektorbiller. Ünnerstütt Renderers:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : Kumponent schull man den Typ ${geomType} hebben"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent is von en Laag ahn Render opropen worrn. Dat bedüüdt normalerwies, dat en Laag wegmaakt worrn is, aver nich de Handler, de dor op verwiest."</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transakschoon: hett klappt ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-Transakschoon: hett nich klappt ${response}"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Skaal = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Du versöchst de Laag „${layerName}“ to de Koort totofögen, man de is al toföögt"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Disse Methood is oold un schall dat in 3.0 nich mehr geven. Bruuk dor man beter ${newMethod} för."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"De Weert x un y, de mööt all beid an de add-Funkschoon övergeven warrn."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"De Weert lon un lat, de mööt all beid an de add-Funkschoon övergeven warrn."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"De Weert x un y, de mööt all beid an de add-Funkschoon övergeven warrn."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nich ünnerstütt Geometrie-Typ: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition güng nich: Element mit de Id ${elemId} is villicht an’n verkehrten Platz."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"nl"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permanente verwijzing"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Achtergrondkaart"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"De overzichtskaart werkt alleen als de projectie gelijk is aan de projectie van de hoofdkaart"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Lezen is niet geïmplementeerd."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Schrijven is niet geïmplementeerd."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Een optie die geen FID heeft kan niet bijgewerkt worden."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Er is een fout opgetreden bij het laden van het GML bestand van ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : component moet van het type ${geomType} zijn"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent is aangeroepen op een laag zonder rederer.\nDit betekent meestal dat u een laag hebt verwijderd, maar niet een handler die ermee geassocieerd was."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap \'deprecated\' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-transactie: succesvol ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-transactie: mislukt ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen."</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen."</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Schaal = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"Z"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"U hebt geprobeerd om de laag  ${layerName} aan de kaart toe te voegen, maar deze is al toegevoegd"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"U gebruikt de optie \'reproject\' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commerciële basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"U moet zowel de lengte- als de breedtewaarde doorgeven aan de toevoegfunctie."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Dit geometrietype wordt niet ondersteund: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition is mislukt: het element met id ${elemId} is wellicht onjuist geplaatst."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evalueren is niet geïmplementeerd voor dit filtertype."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"nn"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Skala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Du freista å leggja til laget «${layerName}» på kartet, men det har alt vorte lagt til."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Du er nøydd til å gje både ein x- og ein y-verdi til «add»-funksjonen."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Du er nøydd til å gje både lon- og lat-verdiar til «add»-funksjonen."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Du er nøydd til å gje både ein x- og ein y-verdi til «add»-funksjonen."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"pt-br"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"A requisição retornou um erro não tratado: ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Link para essa página"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Camadas de Sobreposição"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Camada Base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"O mapa de referência só funciona quando ele está na mesma projeção do mapa principal"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Leitura não implementada."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Escrita não implementada."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Não é possível atualizar uma feição que não tenha um FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Erro ao carregar o arquivo GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Seu navegador não suporta renderização de vetores. Os renderizadores suportados atualmente são:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: o componente deve ser do tipo ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent foi executado mas nenhum renderizador foi encontrado. Isso pode indicar que você destruiu uma camana, mas não o handler associado a ela."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"A propriedade minZoomLevel é de uso restrito das camadas descendentes de FixedZoomLevels. A verificação dessa propriedade pelas camadas wfs é um resíduo do passado. Não podemos, entretanto não é possível removê-la sem possívelmente quebrar o funcionamento de aplicações OL que possuem depência com ela. Portanto estamos tornando seu uso obsoleto -- a verificação desse atributo será removida na versão 3.0. Ao invés, use as opções de resolução min/max como descrito em: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transação WFS : SUCESSO ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transação WFS : ERRO ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Não foi possível carregar a camada Google corretamente.\x3cbr\x3e\x3cbr\x3ePara se livrar dessa mensagem, selecione uma nova Camada Base, na ferramenta de alternação de camadas localização do canto superior direito.\x3cbr\x3e\x3cbr\x3eMuito provavelmente, isso foi causado porque o script da biblioteca do Google Maps não foi incluído, ou porque ele não contém a chave correta da API para o seu site.\x3cbr\x3e\x3cbr\x3eDesenvolvedores: Para obter ajuda em solucionar esse problema \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3ecliquem aqui\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Não foi possível carregar a camada ${layerType} corretamente.\x3cbr\x3e\x3cbr\x3ePara se livrar dessa mensagem, selecione uma nova Camada Base, na ferramenta de alternação de camadas localização do canto superior direito.\x3cbr\x3e\x3cbr\x3eMuito provavelmente, isso foi causado porque o script da biblioteca ${layerLib} não foi incluído corretamente.\x3cbr\x3e\x3cbr\x3eDesenvolvedores: Para obter ajuda em solucionar esse problema \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3ecliquem aqui\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Escala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"L"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Você tentou adicionar a camada: ${layerName} ao mapa, mas ela já foi adicionada"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Você está usando a opção \'reproject\' na camada ${layerName}. Essa opção está obsoleta: seu uso foi projetado para suportar a visualização de dados sobre bases de mapas comerciais, entretanto essa funcionalidade deve agora ser alcançada usando o suporte à projeção Mercator. Mais informação está disponível em: http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Esse método está obsoleto e será removido na versão 3.0. Ao invés, por favor use ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Você deve informar ambos os valores x e y para a função add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Você deve informar ambos os valores lon e lat para a função add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Você deve informar ambos os valores x e y para a função add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Tipo geométrico não suportado: ${geomType}."</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition falhou: o elemento de id ${elemId} deve estar fora do lugar."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluete não está implementado para este tipo de filtro."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"pt"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Servidor devolveu erro não contemplado ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Ligação permanente"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Sobreposições"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Camada Base"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"O mapa panorâmico só funciona quando está na mesma projeção que o mapa principal"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Leitura não implementada."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Escrita não implementada."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Não é possível atualizar um elemento para a qual não há FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Erro ao carregar ficheiro GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"O seu navegador não suporta renderização vetorial. Actualmente os renderizadores suportados são:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: componente deve ser um(a) ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent foi chamado numa camada sem renderizador. Isto normalmente significa que destruiu uma camada, mas não um manipulador \'\'(handler)\'\' que lhe está associado."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"A propriedade minZoomLevel só deve ser usada com as camadas descendentes da FixedZoomLevels. A verificação da propriedade por esta camada wfs é uma relíquia do passado. No entanto, não podemos removê-la sem correr o risco de afectar aplicações OL que dependam dela. Portanto, estamos a torná-la obsoleta -- a verificação minZoomLevel será removida na versão 3.0. Em vez dela, por favor, use as opções de resolução min/max descritas aqui: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transacção WFS: SUCESSO ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transacção WFS: FALHOU ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"A Camada Google não foi correctamente carregada.\x3cbr\x3e\x3cbr\x3ePara deixar de receber esta mensagem, seleccione uma nova Camada-Base no \'\'switcher\'\' de camadas no canto superior direito.\x3cbr\x3e\x3cbr\x3eProvavelmente, isto acontece porque o \'\'script\'\' da biblioteca do Google Maps não foi incluído ou não contém a chave API correcta para o seu sítio.\x3cbr\x3e\x3cbr\x3eProgramadores: Para ajuda sobre como solucionar o problema \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eclique aqui\x3c/a\x3e ."</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"A camada ${layerType} não foi correctamente carregada.\x3cbr\x3e\x3cbr\x3ePara desactivar esta mensagem, seleccione uma nova Camada-Base no \'\'switcher\'\' de camadas no canto superior direito.\x3cbr\x3e\x3cbr\x3eProvavelmente, isto acontece porque o \'\'script\'\' da biblioteca ${layerLib} não foi incluído correctamente.\x3cbr\x3e\x3cbr\x3eProgramadores: Para ajuda sobre como solucionar o problema \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eclique aqui\x3c/a\x3e ."</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Escala = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"E"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Você tentou adicionar a camada: ${layerName} ao mapa, mas ela já tinha sido adicionada antes"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Está usando a opção \'reproject\' na camada ${layerName}. Esta opção é obsoleta: foi concebida para permitir a apresentação de dados sobre mapas-base comerciais, mas esta funcionalidade é agora suportada pelo Mercator Esférico. Mais informação está disponível em http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Este método foi declarado obsoleto e será removido na versão 3.0. Por favor, use ${newMethod} em vez disso."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Você deve passar tanto o valor x como o y à função de adição."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Você deve passar tanto o valor lon como o lat à função de adição."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Você deve passar tanto o valor x como o y à função de adição."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Tipo de geometria não suportado: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition falhou: o elemento com o id ${elemId} poderá estar mal-posicionado."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"avaliar não está implementado para este tipo de filtro."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"ru"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Необработанный запрос вернул ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Постоянная ссылка"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Слои"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Основной слой"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Обзорная карта работает только тогда, когда имеет ту же проекцию, что и основная"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Чтение не реализовано."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Запись не реализована."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Невозможно обновить объект, для которого нет FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Ошибка при загрузке файла GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Ваш браузер не поддерживает векторную графику. На данный момент поддерживаются:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: компонент должен быть ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent вызван для слоя без рендерера. Обычно это говорит о том, что вы уничтожили слой, но оставили связанный с ним обработчик."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Свойство minZoomLevel предназначено только для использования со слоями, являющимися потомками FixedZoomLevels. То, что этот WFS-слой проверяется на minZoomLevel — реликт прошлого. Однако мы не можем удалить эту функцию, так как, возможно, от неё зависят некоторые основанные на OpenLayers приложения. Функция объявлена устаревшей — проверка minZoomLevel будет удалена в 3.0. Пожалуйста, используйте вместо неё настройку мин/макс разрешения, описанную здесь: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Транзакция WFS: УСПЕШНО ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Транзакция WFS: ОШИБКА ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Слой Google не удалось нормально загрузить.\x3cbr\x3e\x3cbr\x3eЧтобы избавиться от этого сообщения, выбите другой основной слой в переключателе в правом верхнем углу.\x3cbr\x3e\x3cbr\x3eСкорее всего, причина в том, что библиотека Google Maps не была включена или не содержит корректного API-ключа для вашего сайта.\x3cbr\x3e\x3cbr\x3eРазработчикам: чтобы узнать, как сделать, чтобы всё заработало, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eщёлкните тут\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Слой ${layerType} не удалось нормально загрузить. \x3cbr\x3e\x3cbr\x3eЧтобы избавиться от этого сообщения, выбите другой основной слой в переключателе в правом верхнем углу.\x3cbr\x3e\x3cbr\x3eСкорее всего, причина в том, что библиотека ${layerLib} не была включена или была включена некорректно.\x3cbr\x3e\x3cbr\x3eРазработчикам: чтобы узнать, как сделать, чтобы всё заработало, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eщёлкните тут\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Масштаб = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"З"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"В"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"С"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"Ю"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Вы попытались добавить слой «${layerName}» на карту, но он уже был добавлен"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Вы используете опцию \'reproject\' для слоя ${layerName}. Эта опция является устаревшей: ее использование предполагалось для поддержки показа данных поверх коммерческих базовых карт, но теперь этот функционал несёт встроенная поддержка сферической проекции Меркатора. Больше сведений доступно на http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Этот метод считается устаревшим и будет удалён в версии 3.0. Пожалуйста, пользуйтесь ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Функции add надо передавать оба значения, x и y."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Функции add надо передавать оба значения, lon и lat."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Функции add надо передавать оба значения, x и y."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Неподдерживаемый тип геометрии: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition failed: элемент с id ${elemId} может находиться не в нужном месте."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluate не реализовано для фильтра данного типа."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"sk"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Neobslúžené požiadavky vracajú ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Trvalý odkaz"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Prekrytia"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Základná vrstva"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Prehľadová mapka funguje iba vtedy, keď je v rovnakej projekcii ako hlavná mapa"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Čítanie nie je implementované."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Zápis nie je implementovaný."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Nie je možné aktualizovať vlastnosť, pre ktorú neexistuje FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Chyba pri načítaní súboru GML ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Váš prehliadač nepodporuje vykresľovanie vektorov. Momentálne podporované vykresľovače sú:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: komponent by mal byť ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent bola zavolaná na vrstve bez vykresľovača. To zvyčajne znamená, že ste odstránili vrstvu, ale nie niektorú z obslúh, ktorá je s ňou asociovaná."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Vlastnosť minZoomLevel je určený iba na použitie s vrstvami odvodenými od FixedZoomLevels. To, že táto wfs vrstva kontroluje minZoomLevel je pozostatok z minulosti. Nemôžeme ho však odstrániť, aby sme sa vyhli možnému porušeniu aplikácií založených na Open Layers, ktoré na tomto môže závisieť. Preto ho označujeme ako zavrhovaný - dolu uvedená kontrola minZoomLevel bude odstránená vo verzii 3.0. Použite prosím namiesto toho kontrolu min./max. rozlíšenia podľa tu uvedeného popisu: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Transakcia WFS: ÚSPEŠNÁ ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Transakcia WFS: ZLYHALA ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Vrstvu Google nebolo možné správne načítať.\x3cbr\x3e\x3cbr\x3eAby ste sa tejto správy zbavili vyberte novú BaseLayer v prepínači vrstiev v pravom hornom rohu.\x3cbr\x3e\x3cbr\x3eToto sa stalo pravdepodobne preto, že skript knižnice Google Maps buď nebol načítaný alebo neobsahuje správny kľúč API pre vašu lokalitu.\x3cbr\x3e\x3cbr\x3eVývojári: Tu môžete získať \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3epomoc so sfunkčnením\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Vrstvu ${layerType} nebolo možné správne načítať.\x3cbr\x3e\x3cbr\x3eAby ste sa tejto správy zbavili vyberte novú BaseLayer v prepínači vrstiev v pravom hornom rohu.\x3cbr\x3e\x3cbr\x3eToto sa stalo pravdepodobne preto, že skript knižnice ${layerType} buď nebol načítaný alebo neobsahuje správny kľúč API pre vašu lokalitu.\x3cbr\x3e\x3cbr\x3eVývojári: Tu môžete získať \x3ca href=\'http://trac.openlayers.org/wiki/${layerType}\' target=\'_blank\'\x3epomoc so sfunkčnením\x3c/a\x3e"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Mierka = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Pokúsili ste sa do mapy pridať vrstvu ${layerName}, ale tá už bola pridaná"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Používate voľby „reproject“ vrstvy ${layerType}. Táto voľba je zzavrhovaná: jej použitie bolo navrhnuté na podporu zobrazovania údajov nad komerčnými základovými mapami, ale túto funkcionalitu je teraz možné dosiahnuť pomocou Spherical Mercator. Ďalšie informácie získate na stránke http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Táto metóda je zavrhovaná a bude odstránená vo verzii 3.0. Použite prosím namiesto nej metódu ${newMethod}."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Sčítacej funkcii musíte dať hodnoty x aj y."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Sčítacej funkcii musíte dať hodnoty lon (zem. dĺžka) aj lat (zem. šírka)."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Sčítacej funkcii musíte dať hodnoty x aj y."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Nepodporovaný typ geometrie: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition zlyhalo: prvok s id ${elemId} môže byť zle umiestnený."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluate nie je implementovaný pre tento typ filtra"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"sv"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Ej hanterad fråga retur ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Permalänk"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Kartlager"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Bakgrundskarta"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Översiktskartan fungerar endast när den har samma projektion som huvudkartan"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Läsning ej implementerad."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Skrivning ej implementerad."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Kan ej uppdatera feature (objekt) för vilket FID saknas."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Fel i laddning av GML-fil ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Din webbläsare stöder inte vektorvisning. För närvarande stöds följande visning:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : komponenten skall vara en ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent anropad för lager utan utritning. Detta betyder oftast att man raderat ett lager, men inte en hanterare som är knuten till lagret."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Egenskapen minZoomLevel är endast avsedd att användas med lager med FixedZoomLevels. Att detta WFS-lager kontrollerar minZoomLevel är en relik från äldre versioner. Vi kan dock inte ta bort det utan att riskera att OL-baserade tillämpningar som använder detta slutar fungera. Därför är det satt som deprecated, minZoomLevel kommer att tas bort i version 3.0. Använd i stället inställning av min/max resolution som beskrivs här: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS-transaktion: LYCKADES ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS-transaktion: MISSLYCKADES ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Google-lagret kunde inte laddas korrekt.\x3cbr\x3e\x3cbr\x3eFör att slippa detta meddelande, välj en annan bakgrundskarta i lagerväljaren i övre högra hörnet.\x3cbr\x3e\x3cbr\x3eSannolikt beror felet på att Google Maps-biblioteket inte är inkluderat på webbsidan eller på att sidan inte anger korrekt API-nyckel för webbplatsen.\x3cbr\x3e\x3cbr\x3eUtvecklare: hjälp för att åtgärda detta, \x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eklicka här\x3c/a\x3e."</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"${layerType}-lagret kunde inte laddas korrekt.\x3cbr\x3e\x3cbr\x3eFör att slippa detta meddelande, välj en annan bakgrundskarta i lagerväljaren i övre högra hörnet.\x3cbr\x3e\x3cbr\x3eSannolikt beror felet på att ${layerLib}-biblioteket inte är inkluderat på webbsidan.\x3cbr\x3e\x3cbr\x3eUtvecklare: hjälp för att åtgärda detta, \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eklicka här\x3c/a\x3e."</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"\x3cstrong\x3eSkala\x3c/strong\x3e 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Du försökte lägga till lagret: ${layerName} på kartan, men det har lagts till tidigare"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Du använder inställningen \'reproject\' på lagret ${layerName}. Denna inställning markerad som deprecated: den var avsedd att användas för att stödja visning av kartdata på kommersiella bakgrundskartor, men nu bör man i stället använda Spherical Mercator-stöd för den funktionaliteten. Mer information finns på http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Denna metod är markerad som deprecated och kommer att tas bort i 3.0. Använd ${newMethod} i stället."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Du måste skicka både x- och y-värde till funktionen add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Du måste skicka både lon- och lat-värde till funktionen add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Du måste skicka både x- och y-värde till funktionen add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Stöd saknas för geometritypen: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition misslyckades: elementet med id ${elemId} kan placeras fel."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"evaluering har ej implementerats för denna typ av filter."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"te"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"స్థిరలింకు"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"ప"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"తూ"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"ఉ"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"ద"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"vi"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"Không xử lý được phản hồi ${statusText} cho yêu cầu"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"Liên kết thường trực"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"Lấp bản đồ"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"Lớp nền"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"Bản đồ toàn cảnh chỉ hoạt động khi cùng phép chiếu với bản đồ chính"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Chưa hỗ trợ chức năng đọc."</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"Chưa hỗ trợ chức năng viết."</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"Không thể cập nhật tính năng thiếu FID."</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"Lỗi tải tập tin GML tại ${url}"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"Trình duyệt của bạn không hỗ trợ chức năng vẽ bằng vectơ. Hiện hỗ trợ các bộ kết xuất:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures: bộ phận cần phải là ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent được gọi từ lớp không có bộ kết xuất. Thường thì có lẽ lớp bị xóa nhưng một phần xử lý của nó vẫn còn."</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"Chỉ nên sử dụng thuộc tính minZoomLevel với các lớp FixedZoomLevels-descendent. Việc lớp wfs này tìm cho minZoomLevel là di tích còn lại từ xưa. Tuy nhiên, nếu chúng tôi dời nó thì sẽ vỡ các chương trình OpenLayers mà dựa trên nó. Bởi vậy chúng tôi phản đối sử dụng nó\x26nbsp;– bước tìm cho minZoomLevel sẽ được dời vào phiên bản 3.0. Xin sử dụng thiết lập độ phân tích tối thiểu / tối đa thay thế, theo hướng dẫn này: http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"Giao dịch WFS: THÀNH CÔNG ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"Giao dịch WFS: THẤT BẠI ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Không thể tải lớp Google đúng đắn.\x3cbr\x3e\x3cbr\x3eĐể tránh thông báo này lần sau, hãy chọn BaseLayer mới dùng điều khiển chọn lớp ở góc trên phải.\x3cbr\x3e\x3cbr\x3eChắc script thư viện Google Maps hoặc không được bao gồm hoặc không chứa khóa API hợp với website của bạn.\x3cbr\x3e\x3cbr\x3e\x3ca href=\'http://trac.openlayers.org/wiki/Google\' target=\'_blank\'\x3eTrợ giúp về tính năng này\x3c/a\x3e cho người phát triển."</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"Không thể tải lớp ${layerType} đúng đắn.\x3cbr\x3e\x3cbr\x3eĐể tránh thông báo này lần sau, hãy chọn BaseLayer mới dùng điều khiển chọn lớp ở góc trên phải.\x3cbr\x3e\x3cbr\x3eChắc script thư viện ${layerLib} không được bao gồm đúng kiểu.\x3cbr\x3e\x3cbr\x3e\x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eTrợ giúp về tính năng này\x3c/a\x3e cho người phát triển."</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Tỷ lệ = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="STRN">"T"</span><span class="PUNC">,</span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="STRN">"Đ"</span><span class="PUNC">,</span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="STRN">"B"</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"Bạn muốn thêm lớp ${layerName} vào bản đồ, nhưng lớp này đã được thêm"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Bạn đang áp dụng chế độ “reproject” vào lớp ${layerName}. Chế độ này đã bị phản đối: nó có mục đích hỗ trợ lấp dữ liệu trên các nền bản đồ thương mại; nên thực hiện hiệu ứng đó dùng tính năng Mercator Hình cầu. Có sẵn thêm chi tiết tại http://trac.openlayers.org/wiki/SphericalMercator ."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"Phương thức này đã bị phản đối và sẽ bị dời vào phiên bản 3.0. Xin hãy sử dụng ${newMethod} thay thế."</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"Cần phải cho cả giá trị x và y vào hàm add."</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"Cần phải cho cả giá trị lon và lat vào hàm add."</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"Cần phải cho cả giá trị x và y vào hàm add."</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"Không hỗ trợ kiểu địa lý: ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition bị thất bại: nguyên tố với ID ${elemId} có thể ở chỗ sai."</span><span class="PUNC">,</span><span class="STRN">'filterEvaluateNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"chưa hỗ trợ evaluate cho loại bộ lọc này."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"zh-CN"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"未处理的请求，返回值为 ${statusText}"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"永久链接"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"叠加层"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"基础图层"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"鹰眼地图只有在和主地图使用相同的投影的时候才能正常共工作"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"读取功能没有实现。"</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"写入功能没有实现。"</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"无法更新feature，缺少FID。"</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"加载GML文件 ${url} 出现错误。"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"你使用的浏览器不支持矢量渲染。当前支持的渲染方式包括：\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : 组件类型应该是 ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent方法在一个没有渲染器的图层上被调用。 这通常意味着您"</span><span class="PUNC">+</span><span class="STRN">"销毁了一个图层，但并未销毁其关联的handler。"</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"minZoomLevel属性仅适合用于"</span><span class="PUNC">+</span><span class="STRN">"使用了固定缩放级别的图层。这个 "</span><span class="PUNC">+</span><span class="STRN">"wfs 图层检查 minZoomLevel 是过去遗留下来的。"</span><span class="PUNC">+</span><span class="STRN">"然而，我们不能移除它，"</span><span class="PUNC">+</span><span class="STRN">"而破坏依赖于它的基于OL的应用程序。"</span><span class="PUNC">+</span><span class="STRN">"因此，我们废除了它 -- minZoomLevel "</span><span class="PUNC">+</span><span class="STRN">"将会在3.0中被移除。请改用 "</span><span class="PUNC">+</span><span class="STRN">"min/max resolution 设置，参考："</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: 成功。 ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: 失败。 ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"Google图层不能正确加载。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"要消除这个信息，请在右上角的"</span><span class="PUNC">+</span><span class="STRN">"图层控制面板中选择其他的基础图层。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"这种情况很可能是没有正确的包含Google地图脚本库，"</span><span class="PUNC">+</span><span class="STRN">"或者是没有包含在你的站点上"</span><span class="PUNC">+</span><span class="STRN">"使用的正确的Google Maps API密匙。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"开发者：获取使其正确工作的帮助信息，"</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>点击这里&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"${layerType} 图层不能正确加载。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"要消除这个信息，请在右上角的"</span><span class="PUNC">+</span><span class="STRN">"图层控制面板中选择其他的基础图层。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"这种情况很可能是没有正确的包含"</span><span class="PUNC">+</span><span class="STRN">"${layerLib} 脚本库。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"开发者：获取使其正确工作的帮助信息，"</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>点击这里&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"比例尺 = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"你尝试添加图层： ${layerName} 到地图中，但是它之前就已经被添加。"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"你正在使用 ${layerName} 图层上的'reproject'选项。"</span><span class="PUNC">+</span><span class="STRN">"这个选项已经不再使用："</span><span class="PUNC">+</span><span class="STRN">"它是被设计用来支持显示商业的地图数据，"</span><span class="PUNC">+</span><span class="STRN">"不过现在该功能可以通过使用Spherical Mercator来实现。"</span><span class="PUNC">+</span><span class="STRN">"更多信息可以参阅"</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"该方法已经不再被支持，并且将在3.0中被移除。"</span><span class="PUNC">+</span><span class="STRN">"请使用 ${newMethod} 方法来替代。"</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"您必须传递 x 和 y 两个参数值到 add 方法。"</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"您必须传递 lon 和 lat 两个参数值到 add 方法。"</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"您必须传递 x and y 两个参数值到 add 方法。"</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"不支持的几何体类型： ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition 失败：id 为 ${elemId} 的元素可能被错置。"</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"zh-TW"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="STRN">"未處理的請求，傳回值為 ${statusText}。"</span><span class="PUNC">,</span><span class="STRN">'permalink'</span><span class="PUNC">:</span><span class="STRN">"永久連結"</span><span class="PUNC">,</span><span class="STRN">'overlays'</span><span class="PUNC">:</span><span class="STRN">"額外圖層"</span><span class="PUNC">,</span><span class="STRN">'baseLayer'</span><span class="PUNC">:</span><span class="STRN">"基礎圖層"</span><span class="PUNC">,</span><span class="STRN">'sameProjection'</span><span class="PUNC">:</span><span class="STRN">"地圖縮覽(OverviewMap)只能在跟主地圖相同投影時起作用。"</span><span class="PUNC">,</span><span class="STRN">'readNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"沒有實作讀取的功能。"</span><span class="PUNC">,</span><span class="STRN">'writeNotImplemented'</span><span class="PUNC">:</span><span class="STRN">"沒有實作寫入的功能。"</span><span class="PUNC">,</span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="STRN">"因為沒有 FID 所以無法更新 feature。"</span><span class="PUNC">,</span><span class="STRN">'errorLoadingGML'</span><span class="PUNC">:</span><span class="STRN">"讀取GML檔案 ${url} 錯誤。"</span><span class="PUNC">,</span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="STRN">"您的瀏覽器未支援向量渲染. 目前支援的渲染方式是:\n${renderers}"</span><span class="PUNC">,</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">:</span><span class="STRN">"addFeatures : 元件應該為 ${geomType}"</span><span class="PUNC">,</span><span class="STRN">'getFeatureError'</span><span class="PUNC">:</span><span class="STRN">"getFeatureFromEvent 在一個沒有被渲染的圖層裡被呼叫。這通常意味著您 "</span><span class="PUNC">+</span><span class="STRN">"摧毀了一個圖層，但並未摧毀相關的handler。"</span><span class="PUNC">,</span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="STRN">"minZoomLevel 屬性僅適合用在 "</span><span class="PUNC">+</span><span class="STRN">"FixedZoomLevels-descendent 類型的圖層. 這個"</span><span class="PUNC">+</span><span class="STRN">"wfs layer 的 minZoomLevel 是過去所遺留下來的，"</span><span class="PUNC">+</span><span class="STRN">"然而我們不能移除它而不讓它將"</span><span class="PUNC">+</span><span class="STRN">"過去的程式相容性給破壞掉。"</span><span class="PUNC">+</span><span class="STRN">"因此我們將會迴避使用它 -- minZoomLevel "</span><span class="PUNC">+</span><span class="STRN">"會在3.0被移除，請改"</span><span class="PUNC">+</span><span class="STRN">"用在這邊描述的 min/max resolution 設定: "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: 成功 ${response}"</span><span class="PUNC">,</span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="STRN">"WFS Transaction: 失敗 ${response}"</span><span class="PUNC">,</span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="STRN">"The Google Layer 圖層無法被正確的載入。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"要迴避這個訊息, 請在右上角的圖層改變器裡，"</span><span class="PUNC">+</span><span class="STRN">"選一個新的基礎圖層。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"很有可能是因為 Google Maps 的函式庫"</span><span class="PUNC">+</span><span class="STRN">"腳本沒有被正確的置入，或沒有包含 "</span><span class="PUNC">+</span><span class="STRN">"您網站上正確的 API key &lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"開發者: 要幫助這個行為正確完成，"</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/Google' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>請按這裡&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="STRN">"${layerType} 圖層無法被正確的載入。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"要迴避這個訊息, 請在右上角的圖層改變器裡，"</span><span class="PUNC">+</span><span class="STRN">"選一個新的基礎圖層。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"很有可能是因為 ${layerLib} 的函式庫"</span><span class="PUNC">+</span><span class="STRN">"腳本沒有被正確的置入。&lt;br>&lt;br>"</span><span class="PUNC">+</span><span class="STRN">"開發者: 要幫助這個行為正確完成，"</span><span class="PUNC">+</span><span class="STRN">"&lt;a href='http://trac.openlayers.org/wiki/${layerLib}' "</span><span class="PUNC">+</span><span class="STRN">"target='_blank'>請按這裡&lt;/a>"</span><span class="PUNC">,</span><span class="STRN">'scale'</span><span class="PUNC">:</span><span class="STRN">"Scale = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">:</span><span class="STRN">"你試著新增圖層: ${layerName} 到地圖上，但圖層之前就已經被新增了。"</span><span class="PUNC">,</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="STRN">"你正使用 'reproject' 這個選項 "</span><span class="PUNC">+</span><span class="STRN">"在 ${layerName} 層。這個選項已經不再使用:"</span><span class="PUNC">+</span><span class="STRN">"它的使用原本是設計用來支援在商業地圖上秀出資料，"</span><span class="PUNC">+</span><span class="STRN">"但這個功能已經被"</span><span class="PUNC">+</span><span class="STRN">"Spherical Mercator所取代。更多的資訊可以在 "</span><span class="PUNC">+</span><span class="STRN">"http://trac.openlayers.org/wiki/SphericalMercator 找到。"</span><span class="PUNC">,</span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="STRN">"這個方法已經不再使用且在3.0將會被移除，"</span><span class="PUNC">+</span><span class="STRN">"請使用 ${newMethod} 來代替。"</span><span class="PUNC">,</span><span class="STRN">'boundsAddError'</span><span class="PUNC">:</span><span class="STRN">"您必須傳入 x 跟 y 兩者的值進 add 函數。"</span><span class="PUNC">,</span><span class="STRN">'lonlatAddError'</span><span class="PUNC">:</span><span class="STRN">"您必須傳入 lon 跟 lat 兩者的值進 add 函數。"</span><span class="PUNC">,</span><span class="STRN">'pixelAddError'</span><span class="PUNC">:</span><span class="STRN">"您必須傳入 x 跟 y 兩者的值進 add 函數。"</span><span class="PUNC">,</span><span class="STRN">'unsupportedGeometryType'</span><span class="PUNC">:</span><span class="STRN">"未支援的幾何型別: ${geomType}。"</span><span class="PUNC">,</span><span class="STRN">'pagePositionFailed'</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Util.pagePosition 失敗: id ${elemId} 的 element 可能被錯置。"</span><span class="PUNC">,</span><span class="STRN">'end'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.AnchoredBubble</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Popup.Anchored</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">rounded</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">,</span><span class="NAME">closeBoxCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.padding</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Popup.AnchoredBubble.CORNER_SIZE</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Popup.AnchoredBubble.CORNER_SIZE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setContentHTML</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setBackgroundColor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setOpacity</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateRelativePosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setRicoCorners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contentSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.setSize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setRicoCorners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBackgroundColor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backgroundColor</span><span class="PUNC">=</span><span class="NAME">color</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>467</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.contentDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.background</span><span class="PUNC">=</span><span class="STRN">"transparent"</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Rico.Corner.changeColor</span><span class="PUNC">(</span><span class="NAME">this.groupDiv</span><span class="PUNC">,</span><span class="NAME">this.backgroundColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.setOpacity.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.groupDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Rico.Corner.changeOpacity</span><span class="PUNC">(</span><span class="NAME">this.groupDiv</span><span class="PUNC">,</span><span class="NAME">this.opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBorder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.border</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setRicoCorners</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">corners</span><span class="PUNC">=</span><span class="NAME">this.getCornersToRound</span><span class="PUNC">(</span><span class="NAME">this.relativePosition</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">corners</span><span class="PUNC">:</span><span class="NAME">corners</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">:</span><span class="NAME">this.backgroundColor</span><span class="PUNC">,</span><span class="NAME">bgColor</span><span class="PUNC">:</span><span class="STRN">"transparent"</span><span class="PUNC">,</span><span class="NAME">blend</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.rounded</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Rico.Corner.round</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rounded</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Rico.Corner.reRound</span><span class="PUNC">(</span><span class="NAME">this.groupDiv</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setBackgroundColor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setOpacity</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCornersToRound</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">corners</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'tl'</span><span class="PUNC">,</span><span class="STRN">'tr'</span><span class="PUNC">,</span><span class="STRN">'bl'</span><span class="PUNC">,</span><span class="STRN">'br'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">corner</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Bounds.oppositeQuadrant</span><span class="PUNC">(</span><span class="NAME">this.relativePosition</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">corners</span><span class="PUNC">,</span><span class="NAME">corner</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">corners.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Popup.AnchoredBubble"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.AnchoredBubble.CORNER_SIZE</span><span class="PUNC">=</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.Framed</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Popup.Anchored</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">imageSrc</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imageSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">isAlphaImage</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">positionBlocks</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">blocks</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fixedRelativePosition</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">,</span><span class="NAME">closeBoxCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.fixedRelativePosition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.updateRelativePosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.calculateRelativePosition</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.relativePosition</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>468</span> </span><span class="NAME">this.contentDiv.style.position</span><span class="PUNC">=</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="NAME">this.contentDiv.style.zIndex</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">closeBox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.closeDiv.style.zIndex</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>469</span> </span><span class="NAME">this.groupDiv.style.position</span><span class="PUNC">=</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.style.top</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.style.left</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.style.height</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.style.width</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imageSrc</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.imageSize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.isAlphaImage</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.fixedRelativePosition</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.positionBlocks</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.blocks.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">block</span><span class="PUNC">=</span><span class="NAME">this.blocks</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">block.image</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">block.div.removeChild</span><span class="PUNC">(</span><span class="NAME">block.image</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>470</span> </span><span class="NAME">block.image</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">block.div</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.groupDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">block.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>471</span> </span><span class="NAME">block.div</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>472</span> </span><span class="NAME">this.blocks</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBackgroundColor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBorder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">contentSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.setSize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.updateBlocks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateRelativePosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.padding</span><span class="PUNC">=</span><span class="NAME">this.positionBlocks</span><span class="PUNC">[</span><span class="NAME">this.relativePosition</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">padding</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.closeDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contentDivPadding</span><span class="PUNC">=</span><span class="NAME">this.getContentDivPadding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.closeDiv.style.right</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.right</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>473</span> </span><span class="NAME">this.padding.right</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.closeDiv.style.top</span><span class="PUNC">=</span><span class="NAME">contentDivPadding.top</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>474</span> </span><span class="NAME">this.padding.top</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>475</span> </span><span class="NAME">this.updateBlocks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateNewPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">newPx.offset</span><span class="PUNC">(</span><span class="NAME">this.positionBlocks</span><span class="PUNC">[</span><span class="NAME">this.relativePosition</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createBlocks</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.blocks</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">firstPosition</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.positionBlocks</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">firstPosition</span><span class="PUNC">=</span><span class="NAME">key</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>476</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">=</span><span class="NAME">this.positionBlocks</span><span class="PUNC">[</span><span class="NAME">firstPosition</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">position.blocks.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">block</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.blocks.push</span><span class="PUNC">(</span><span class="NAME">block</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">divId</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">'_FrameDecorationDiv_'</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">;</span><span class="NAME">block.div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">divId</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"hidden"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgId</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">'_FrameDecorationImg_'</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imageCreator</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.isAlphaImage</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Util.createImage</span><span class="PUNC">;</span><span class="NAME">block.image</span><span class="PUNC">=</span><span class="NAME">imageCreator</span><span class="PUNC">(</span><span class="NAME">imgId</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.imageSize</span><span class="PUNC">,</span><span class="NAME">this.imageSrc</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">block.div.appendChild</span><span class="PUNC">(</span><span class="NAME">block.image</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.groupDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">block.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateBlocks</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.blocks</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.createBlocks</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>477</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">&&</span><span class="NAME">this.relativePosition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">=</span><span class="NAME">this.positionBlocks</span><span class="PUNC">[</span><span class="NAME">this.relativePosition</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">position.blocks.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">positionBlock</span><span class="PUNC">=</span><span class="NAME">position.blocks</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">block</span><span class="PUNC">=</span><span class="NAME">this.blocks</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">positionBlock.anchor.left</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">positionBlock.anchor.bottom</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">positionBlock.anchor.right</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">positionBlock.anchor.top</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">positionBlock.size.w</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.size.w</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">+</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">positionBlock.size.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">positionBlock.size.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.size.h</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">positionBlock.size.h</span><span class="PUNC">;</span><span class="NAME">block.div.style.width</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">;</span><span class="NAME">block.div.style.height</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">;</span><span class="NAME">block.div.style.left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">l</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">block.div.style.bottom</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">block.div.style.right</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">r</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">block.div.style.top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">t</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">block.image.style.left</span><span class="PUNC">=</span><span class="NAME">positionBlock.position.x</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">;</span><span class="NAME">block.image.style.top</span><span class="PUNC">=</span><span class="NAME">positionBlock.position.y</span><span class="PUNC">+</span><span class="STRN">'px'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>478</span> </span><span class="NAME">this.contentDiv.style.left</span><span class="PUNC">=</span><span class="NAME">this.padding.left</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.contentDiv.style.top</span><span class="PUNC">=</span><span class="NAME">this.padding.top</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Popup.Framed"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">proj</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">projCode</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projCode</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.projCode</span><span class="PUNC">=</span><span class="NAME">projCode</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.Proj4js</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.proj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Proj4js.Proj</span><span class="PUNC">(</span><span class="NAME">projCode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.proj</span><span class="PUNC">?</span><span class="NAME">this.proj.srsCode</span><span class="PUNC">:</span><span class="NAME">this.projCode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getUnits</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.proj</span><span class="PUNC">?</span><span class="NAME">this.proj.units</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">&&</span><span class="NAME">projection.getCode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">projection.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.proj</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.projCode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Projection"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Projection.addTransform</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">from</span><span class="PUNC">,</span><span class="NAME">to</span><span class="PUNC">,</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">[</span><span class="NAME">from</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">[</span><span class="NAME">from</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>479</span> </span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">[</span><span class="NAME">from</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">to</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">method</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source.proj</span><span class="PUNC">&&</span><span class="NAME">dest.proj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">Proj4js.transform</span><span class="PUNC">(</span><span class="NAME">source.proj</span><span class="PUNC">,</span><span class="NAME">dest.proj</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">&&</span><span class="NAME">dest</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">[</span><span class="NAME">source.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">[</span><span class="NAME">source.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dest.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Projection.transforms</span><span class="PUNC">[</span><span class="NAME">source.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dest.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>480</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.SVG</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Renderer.Elements</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">xmlns</span><span class="PUNC">:</span><span class="STRN">"http://www.w3.org/2000/svg"</span><span class="PUNC">,</span><span class="NAME">xlinkns</span><span class="PUNC">:</span><span class="STRN">"http://www.w3.org/1999/xlink"</span><span class="PUNC">,</span><span class="NAME">MAX_PIXEL</span><span class="PUNC">:</span><span class="NUMB">15000</span><span class="PUNC">,</span><span class="NAME">translationParameters</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">symbolMetrics</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">isGecko</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">supportUse</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">containerID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.supported</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>481</span> </span><span class="NAME">OpenLayers.Renderer.Elements.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.translationParameters</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.supportUse</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"applewebkit/5"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.isGecko</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"gecko/"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.symbolMetrics</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.Elements.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">supported</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">svgFeature</span><span class="PUNC">=</span><span class="STRN">"http://www.w3.org/TR/SVG11/feature#"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">document.implementation</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">(</span><span class="STRN">"org.w3c.svg"</span><span class="PUNC">,</span><span class="STRN">"1.0"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">(</span><span class="NAME">svgFeature</span><span class="PUNC">+</span><span class="STRN">"SVG"</span><span class="PUNC">,</span><span class="STRN">"1.1"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">(</span><span class="NAME">svgFeature</span><span class="PUNC">+</span><span class="STRN">"BasicStructure"</span><span class="PUNC">,</span><span class="STRN">"1.1"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">inValidRange</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">xyOnly</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">xyOnly</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">this.translationParameters.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">xyOnly</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">this.translationParameters.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">>=</span><span class="PUNC">-</span><span class="NAME">this.MAX_PIXEL</span><span class="PUNC">&&</span><span class="NAME">left</span><span class="PUNC">&lt;=</span><span class="NAME">this.MAX_PIXEL</span><span class="PUNC">&&</span><span class="NAME">top</span><span class="PUNC">>=</span><span class="PUNC">-</span><span class="NAME">this.MAX_PIXEL</span><span class="PUNC">&&</span><span class="NAME">top</span><span class="PUNC">&lt;=</span><span class="NAME">this.MAX_PIXEL</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">resolutionChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.Elements.prototype.setExtent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">extent.left</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">extent.top</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">resolutionChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.left</span><span class="PUNC">=</span><span class="NAME">left</span><span class="PUNC">;</span><span class="NAME">this.top</span><span class="PUNC">=</span><span class="NAME">top</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extentString</span><span class="PUNC">=</span><span class="STRN">"0 0 "</span><span class="PUNC">+</span><span class="NAME">this.size.w</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">this.size.h</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"viewBox"</span><span class="PUNC">,</span><span class="NAME">extentString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.translate</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inRange</span><span class="PUNC">=</span><span class="NAME">this.translate</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">-</span><span class="NAME">this.left</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">-</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">inRange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setExtent</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>482</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">inRange</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">translate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.inValidRange</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">transformString</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">||</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">transformString</span><span class="PUNC">=</span><span class="STRN">"translate("</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>483</span> </span><span class="NAME">this.root.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"transform"</span><span class="PUNC">,</span><span class="NAME">transformString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.translationParameters</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.prototype.setSize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="NAME">this.size.w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="NAME">this.size.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNodeType</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"image"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isComplexSymbol</span><span class="PUNC">(</span><span class="NAME">style.graphicName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="NAME">this.supportUse</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">?</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="STRN">"use"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"circle"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>484</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Rectangle"</span><span class="PUNC">:</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"rect"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">:</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"polyline"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">:</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"polygon"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Curve"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Surface"</span><span class="PUNC">:</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"path"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>485</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">node._style</span><span class="PUNC">;</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">||</span><span class="NAME">node._options</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">node.getAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"r"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">widthFactor</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node._geometryClass</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">&&</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.style.visibility</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphic</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pos</span><span class="PUNC">=</span><span class="NAME">this.getPosition</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphicTitle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"title"</span><span class="PUNC">,</span><span class="NAME">style.graphicTitle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>486</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphicWidth</span><span class="PUNC">&&</span><span class="NAME">style.graphicHeight</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"preserveAspectRatio"</span><span class="PUNC">,</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>487</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">style.graphicWidth</span><span class="PUNC">||</span><span class="NAME">style.graphicHeight</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">style.graphicHeight</span><span class="PUNC">||</span><span class="NAME">style.graphicWidth</span><span class="PUNC">;</span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">?</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">?</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">style.graphicXOffset</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">style.graphicXOffset</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">style.graphicYOffset</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">style.graphicYOffset</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">opacity</span><span class="PUNC">=</span><span class="NAME">style.graphicOpacity</span><span class="PUNC">||</span><span class="NAME">style.fillOpacity</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">pos.x</span><span class="PUNC">+</span><span class="NAME">xOffset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toFixed</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">pos.y</span><span class="PUNC">+</span><span class="NAME">yOffset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toFixed</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="NAME">this.xlinkns</span><span class="PUNC">,</span><span class="STRN">"href"</span><span class="PUNC">,</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"style"</span><span class="PUNC">,</span><span class="STRN">"opacity: "</span><span class="PUNC">+</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isComplexSymbol</span><span class="PUNC">(</span><span class="NAME">style.graphicName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">=</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">offset</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.importSymbol</span><span class="PUNC">(</span><span class="NAME">style.graphicName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pos</span><span class="PUNC">=</span><span class="NAME">this.getPosition</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">widthFactor</span><span class="PUNC">=</span><span class="NAME">this.symbolMetrics</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">/</span><span class="NAME">size</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">=</span><span class="NAME">node.parentNode</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextSibling</span><span class="PUNC">=</span><span class="NAME">node.nextSibling</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parent.removeChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>488</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.supportUse</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.firstChild</span><span class="PUNC">&&</span><span class="NAME">node.removeChild</span><span class="PUNC">(</span><span class="NAME">node.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.appendChild</span><span class="PUNC">(</span><span class="NAME">src.firstChild.cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"viewBox"</span><span class="PUNC">,</span><span class="NAME">src.getAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"viewBox"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="NAME">this.xlinkns</span><span class="PUNC">,</span><span class="STRN">"href"</span><span class="PUNC">,</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>489</span> </span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="NAME">pos.x</span><span class="PUNC">-</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="NAME">pos.y</span><span class="PUNC">-</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nextSibling</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parent.insertBefore</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">nextSibling</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parent.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"r"</span><span class="PUNC">,</span><span class="NAME">style.pointRadius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>490</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotation</span><span class="PUNC">=</span><span class="NAME">style.rotation</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">rotation</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">||</span><span class="NAME">node._rotation</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">pos</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node._rotation</span><span class="PUNC">=</span><span class="NAME">rotation</span><span class="PUNC">;</span><span class="NAME">rotation</span><span class="PUNC">|</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.nodeName</span><span class="PUNC">!==</span><span class="STRN">"svg"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"transform"</span><span class="PUNC">,</span><span class="STRN">"rotate("</span><span class="PUNC">+</span><span class="NAME">rotation</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">pos.x</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>491</span> </span><span class="NAME">pos.y</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">metrics</span><span class="PUNC">=</span><span class="NAME">this.symbolMetrics</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">node.firstChild.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"transform"</span><span class="PUNC">,</span><span class="STRN">"rotate("</span><span class="PUNC">+</span><span class="NAME">style.rotation</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">metrics</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">metrics</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>492</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.isFilled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="NAME">style.fillColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"fill-opacity"</span><span class="PUNC">,</span><span class="NAME">style.fillOpacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>493</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.isStroked</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="NAME">style.strokeColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke-opacity"</span><span class="PUNC">,</span><span class="NAME">style.strokeOpacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="NAME">style.strokeWidth</span><span class="PUNC">*</span><span class="NAME">widthFactor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke-linecap"</span><span class="PUNC">,</span><span class="NAME">style.strokeLinecap</span><span class="PUNC">||</span><span class="STRN">"round"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke-linejoin"</span><span class="PUNC">,</span><span class="STRN">"round"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">style.strokeDashstyle</span><span class="PUNC">&&</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">,</span><span class="NAME">this.dashStyle</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">widthFactor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>494</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.pointerEvents</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"pointer-events"</span><span class="PUNC">,</span><span class="NAME">style.pointerEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>495</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.cursor</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"cursor"</span><span class="PUNC">,</span><span class="NAME">style.cursor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>496</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dashStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">widthFactor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">style.strokeWidth</span><span class="PUNC">*</span><span class="NAME">widthFactor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">style.strokeDashstyle</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">'solid'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="STRN">'none'</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">'dot'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">'dash'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">'dashdot'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">'longdash'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">'longdashdot'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/g</span><span class="PUNC">,</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.xmlns</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>497</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">nodeTypeCompare</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="NAME">node.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createRenderRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="STRN">"_svgRoot"</span><span class="PUNC">,</span><span class="STRN">"svg"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">suffix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="NAME">suffix</span><span class="PUNC">,</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createDefs</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defs</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="STRN">"_defs"</span><span class="PUNC">,</span><span class="STRN">"defs"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rendererRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">defs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">defs</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.drawCircle</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawCircle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">radius</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">geometry.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">geometry.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.inValidRange</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"cx"</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"cy"</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"r"</span><span class="PUNC">,</span><span class="NAME">radius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLineString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">componentsResult</span><span class="PUNC">=</span><span class="NAME">this.getComponentsString</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">componentsResult.path</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"points"</span><span class="PUNC">,</span><span class="NAME">componentsResult.path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">componentsResult.complete</span><span class="PUNC">?</span><span class="NAME">node</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLinearRing</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">componentsResult</span><span class="PUNC">=</span><span class="NAME">this.getComponentsString</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">componentsResult.path</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"points"</span><span class="PUNC">,</span><span class="NAME">componentsResult.path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">componentsResult.complete</span><span class="PUNC">?</span><span class="NAME">node</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPolygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draw</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">complete</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">linearRingResult</span><span class="PUNC">,</span><span class="NAME">path</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" M"</span><span class="PUNC">;</span><span class="NAME">linearRingResult</span><span class="PUNC">=</span><span class="NAME">this.getComponentsString</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">components</span><span class="PUNC">,</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">path</span><span class="PUNC">=</span><span class="NAME">linearRingResult.path</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">path</span><span class="PUNC">;</span><span class="NAME">complete</span><span class="PUNC">=</span><span class="NAME">linearRingResult.complete</span><span class="PUNC">&&</span><span class="NAME">complete</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">draw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>498</span> </span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" z"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">draw</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"fill-rule"</span><span class="PUNC">,</span><span class="STRN">"evenodd"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">complete</span><span class="PUNC">?</span><span class="NAME">node</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawRectangle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">geometry.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">geometry.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.inValidRange</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="NAME">geometry.width</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="NAME">geometry.height</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawSurface</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draw</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">%</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">this.getShortString</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">draw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>499</span> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">"M "</span><span class="PUNC">+</span><span class="NAME">component</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">%</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">this.getShortString</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">draw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>500</span> </span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" C "</span><span class="PUNC">+</span><span class="NAME">component</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">this.getShortString</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">draw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>501</span> </span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">component</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>502</span> </span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">" Z"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">draw</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">location.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">location.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">+</span><span class="NAME">this.LABEL_ID_SUFFIX</span><span class="PUNC">,</span><span class="STRN">"text"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tspan</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">+</span><span class="NAME">this.LABEL_ID_SUFFIX</span><span class="PUNC">+</span><span class="STRN">"_tspan"</span><span class="PUNC">,</span><span class="STRN">"tspan"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="NAME">style.fontColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>503</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontOpacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="NAME">style.fontOpacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>504</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontFamily</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"font-family"</span><span class="PUNC">,</span><span class="NAME">style.fontFamily</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>505</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"font-size"</span><span class="PUNC">,</span><span class="NAME">style.fontSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>506</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontWeight</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"font-weight"</span><span class="PUNC">,</span><span class="NAME">style.fontWeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>507</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.labelSelect</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"pointer-events"</span><span class="PUNC">,</span><span class="STRN">"visible"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">label._featureId</span><span class="PUNC">=</span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="NAME">tspan._featureId</span><span class="PUNC">=</span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="NAME">tspan._geometry</span><span class="PUNC">=</span><span class="NAME">location</span><span class="PUNC">;</span><span class="NAME">tspan._geometryClass</span><span class="PUNC">=</span><span class="NAME">location.CLASS_NAME</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"pointer-events"</span><span class="PUNC">,</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>508</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">align</span><span class="PUNC">=</span><span class="NAME">style.labelAlign</span><span class="PUNC">||</span><span class="STRN">"cm"</span><span class="PUNC">;</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"text-anchor"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Renderer.SVG.LABEL_ALIGN</span><span class="PUNC">[</span><span class="NAME">align</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="STRN">"middle"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isGecko</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"dominant-baseline"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Renderer.SVG.LABEL_ALIGN</span><span class="PUNC">[</span><span class="NAME">align</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="STRN">"central"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">tspan.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"baseline-shift"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Renderer.SVG.LABEL_VSHIFT</span><span class="PUNC">[</span><span class="NAME">align</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="STRN">"-35%"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>509</span> </span><span class="NAME">tspan.textContent</span><span class="PUNC">=</span><span class="NAME">style.label</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">label.parentNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.appendChild</span><span class="PUNC">(</span><span class="NAME">tspan</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.textRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getComponentsString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">,</span><span class="NAME">separator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderCmp</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">complete</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">components.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">,</span><span class="NAME">component</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">renderCmp.push</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">this.getShortString</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strings.push</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.getShortString</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strings.push</span><span class="PUNC">(</span><span class="NAME">this.clipLine</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>510</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.getShortString</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strings.push</span><span class="PUNC">(</span><span class="NAME">this.clipLine</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>511</span> </span><span class="NAME">complete</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>512</span> </span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">path</span><span class="PUNC">:</span><span class="NAME">strings.join</span><span class="PUNC">(</span><span class="NAME">separator</span><span class="PUNC">||</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">complete</span><span class="PUNC">:</span><span class="NAME">complete</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clipLine</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">badComponent</span><span class="PUNC">,</span><span class="NAME">goodComponent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">goodComponent.equals</span><span class="PUNC">(</span><span class="NAME">badComponent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>513</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="PUNC">=</span><span class="NAME">this.MAX_PIXEL</span><span class="PUNC">-</span><span class="NAME">this.translationParameters.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="PUNC">=</span><span class="NAME">this.MAX_PIXEL</span><span class="PUNC">-</span><span class="NAME">this.translationParameters.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">=</span><span class="NAME">goodComponent.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">=</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">goodComponent.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">badComponent.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">badComponent.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x2</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">maxX</span><span class="PUNC">||</span><span class="NAME">x2</span><span class="PUNC">></span><span class="NAME">maxX</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">k</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">x2</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NAME">maxX</span><span class="PUNC">:</span><span class="NAME">maxX</span><span class="PUNC">;</span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">k</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>514</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">maxY</span><span class="PUNC">||</span><span class="NAME">y2</span><span class="PUNC">></span><span class="NAME">maxY</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">k</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">y2</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NAME">maxY</span><span class="PUNC">:</span><span class="NAME">maxY</span><span class="PUNC">;</span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">k</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>515</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getShortString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">+</span><span class="NAME">this.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.top</span><span class="PUNC">-</span><span class="NAME">point.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.inValidRange</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getPosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">node.getAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"cx"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">node.getAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"cy"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">importSymbol</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">graphicName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.defs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.defs</span><span class="PUNC">=</span><span class="NAME">this.createDefs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>516</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">graphicName</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>517</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbol</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Renderer.symbol</span><span class="PUNC">[</span><span class="NAME">graphicName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">symbol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="NAME">graphicName</span><span class="PUNC">+</span><span class="STRN">' is not a valid symbol name'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>518</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbolNode</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="STRN">"symbol"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"polygon"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolNode.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbolExtent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">,</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">symbol.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">symbol</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">symbol</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">symbolExtent.left</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">symbolExtent.left</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolExtent.right</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">symbolExtent.right</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolExtent.top</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">symbolExtent.top</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="STRN">","</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>519</span> </span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"points"</span><span class="PUNC">,</span><span class="NAME">points.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">symbolExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">symbolExtent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewBox</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">symbolExtent.left</span><span class="PUNC">-</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">-</span><span class="NAME">height</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">symbolNode.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"viewBox"</span><span class="PUNC">,</span><span class="NAME">viewBox.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.symbolMetrics</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">symbolExtent.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">lon</span><span class="PUNC">,</span><span class="NAME">symbolExtent.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">lat</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.defs.appendChild</span><span class="PUNC">(</span><span class="NAME">symbolNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">symbolNode.id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureIdFromEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureId</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.supportUse</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">=</span><span class="NAME">evt.target</span><span class="PUNC">;</span><span class="NAME">featureId</span><span class="PUNC">=</span><span class="NAME">target.parentNode</span><span class="PUNC">&&</span><span class="NAME">target</span><span class="PUNC">!=</span><span class="NAME">this.rendererRoot</span><span class="PUNC">&&</span><span class="NAME">target.parentNode._featureId</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>520</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Renderer.SVG"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.SVG.LABEL_ALIGN</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"l"</span><span class="PUNC">:</span><span class="STRN">"start"</span><span class="PUNC">,</span><span class="STRN">"r"</span><span class="PUNC">:</span><span class="STRN">"end"</span><span class="PUNC">,</span><span class="STRN">"b"</span><span class="PUNC">:</span><span class="STRN">"bottom"</span><span class="PUNC">,</span><span class="STRN">"t"</span><span class="PUNC">:</span><span class="STRN">"hanging"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.SVG.LABEL_VSHIFT</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"t"</span><span class="PUNC">:</span><span class="STRN">"-70%"</span><span class="PUNC">,</span><span class="STRN">"b"</span><span class="PUNC">:</span><span class="STRN">"0"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.VML</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Renderer.Elements</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">xmlns</span><span class="PUNC">:</span><span class="STRN">"urn:schemas-microsoft-com:vml"</span><span class="PUNC">,</span><span class="NAME">symbolCache</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">containerID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.supported</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>521</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.namespaces.olv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.namespaces.add</span><span class="PUNC">(</span><span class="STRN">"olv"</span><span class="PUNC">,</span><span class="NAME">this.xmlns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">document.createStyleSheet</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">shapes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'shape'</span><span class="PUNC">,</span><span class="STRN">'rect'</span><span class="PUNC">,</span><span class="STRN">'oval'</span><span class="PUNC">,</span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="STRN">'imagedata'</span><span class="PUNC">,</span><span class="STRN">'group'</span><span class="PUNC">,</span><span class="STRN">'textbox'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">shapes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style.addRule</span><span class="PUNC">(</span><span class="STRN">'olv\\:'</span><span class="PUNC">+</span><span class="NAME">shapes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"behavior: url(#default#VML); "</span><span class="PUNC">+</span><span class="STRN">"position: absolute; display: inline-block;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>522</span> </span><span class="NAME">OpenLayers.Renderer.Elements.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.Elements.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">supported</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">document.namespaces</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">resolutionChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.Elements.prototype.setExtent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">extent.left</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">extent.top</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.size.h</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">resolutionChanged</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.offset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.offset</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">top</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">left</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">top</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">left</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">;</span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">top</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>523</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">org</span><span class="PUNC">=</span><span class="NAME">left</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">top</span><span class="PUNC">;</span><span class="NAME">this.root.coordorigin</span><span class="PUNC">=</span><span class="NAME">org</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">roots</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this.root</span><span class="PUNC">,</span><span class="NAME">this.vectorRoot</span><span class="PUNC">,</span><span class="NAME">this.textRoot</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">roots.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root</span><span class="PUNC">=</span><span class="NAME">roots</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.size.w</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">this.size.h</span><span class="PUNC">;</span><span class="NAME">root.coordsize</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>524</span> </span><span class="NAME">this.root.style.flip</span><span class="PUNC">=</span><span class="STRN">"y"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Renderer.prototype.setSize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">roots</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this.rendererRoot</span><span class="PUNC">,</span><span class="NAME">this.root</span><span class="PUNC">,</span><span class="NAME">this.vectorRoot</span><span class="PUNC">,</span><span class="NAME">this.textRoot</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">this.size.w</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.size.h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">roots.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root</span><span class="PUNC">=</span><span class="NAME">roots</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">root.style.width</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="NAME">root.style.height</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNodeType</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"olv:rect"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isComplexSymbol</span><span class="PUNC">(</span><span class="NAME">style.graphicName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"olv:shape"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"olv:oval"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>525</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Rectangle"</span><span class="PUNC">:</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"olv:rect"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Curve"</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">"OpenLayers.Geometry.Surface"</span><span class="PUNC">:</span><span class="NAME">nodeType</span><span class="PUNC">=</span><span class="STRN">"olv:shape"</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>526</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">node._style</span><span class="PUNC">;</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">||</span><span class="NAME">node._options</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fillColor</span><span class="PUNC">=</span><span class="NAME">style.fillColor</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node._geometryClass</span><span class="PUNC">===</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphicTitle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.title</span><span class="PUNC">=</span><span class="NAME">style.graphicTitle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>527</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">style.graphicWidth</span><span class="PUNC">||</span><span class="NAME">style.graphicHeight</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">style.graphicHeight</span><span class="PUNC">||</span><span class="NAME">style.graphicWidth</span><span class="PUNC">;</span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">?</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">?</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">style.graphicXOffset</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">style.graphicXOffset</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yOffset</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">style.graphicYOffset</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">style.graphicYOffset</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">xOffset</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">yOffset</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.width</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.height</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.flip</span><span class="PUNC">=</span><span class="STRN">"y"</span><span class="PUNC">;</span><span class="NAME">fillColor</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">options.isStroked</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isComplexSymbol</span><span class="PUNC">(</span><span class="NAME">style.graphicName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">=</span><span class="NAME">this.importSymbol</span><span class="PUNC">(</span><span class="NAME">style.graphicName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.path</span><span class="PUNC">=</span><span class="NAME">cache.path</span><span class="PUNC">;</span><span class="NAME">node.coordorigin</span><span class="PUNC">=</span><span class="NAME">cache.left</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">cache.bottom</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">cache.size</span><span class="PUNC">;</span><span class="NAME">node.coordsize</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">size</span><span class="PUNC">;</span><span class="NAME">this.drawCircle</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style.pointRadius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.flip</span><span class="PUNC">=</span><span class="STRN">"y"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.drawCircle</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">style.pointRadius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>528</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.isFilled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.fillcolor</span><span class="PUNC">=</span><span class="NAME">fillColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node.filled</span><span class="PUNC">=</span><span class="STRN">"false"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>529</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fills</span><span class="PUNC">=</span><span class="NAME">node.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fill</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">fills.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="KEYW">null</span><span class="PUNC">:</span><span class="NAME">fills</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options.isFilled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fill</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.removeChild</span><span class="PUNC">(</span><span class="NAME">fill</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">fill</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fill</span><span class="PUNC">=</span><span class="NAME">this.createNode</span><span class="PUNC">(</span><span class="STRN">'olv:fill'</span><span class="PUNC">,</span><span class="NAME">node.id</span><span class="PUNC">+</span><span class="STRN">"_fill"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>530</span> </span><span class="NAME">fill.opacity</span><span class="PUNC">=</span><span class="NAME">style.fillOpacity</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node._geometryClass</span><span class="PUNC">===</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">&&</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.graphicOpacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fill.opacity</span><span class="PUNC">=</span><span class="NAME">style.graphicOpacity</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>531</span> </span><span class="NAME">fill.src</span><span class="PUNC">=</span><span class="NAME">style.externalGraphic</span><span class="PUNC">;</span><span class="NAME">fill.type</span><span class="PUNC">=</span><span class="STRN">"frame"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">style.graphicWidth</span><span class="PUNC">&&</span><span class="NAME">style.graphicHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fill.aspect</span><span class="PUNC">=</span><span class="STRN">"atmost"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>532</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fill.parentNode</span><span class="PUNC">!=</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.appendChild</span><span class="PUNC">(</span><span class="NAME">fill</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>533</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotation</span><span class="PUNC">=</span><span class="NAME">style.rotation</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">rotation</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">||</span><span class="NAME">node._rotation</span><span class="PUNC">!==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node._rotation</span><span class="PUNC">=</span><span class="NAME">rotation</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.externalGraphic</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.graphicRotate</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">xOffset</span><span class="PUNC">,</span><span class="NAME">yOffset</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">fill.opacity</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node._geometryClass</span><span class="PUNC">===</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.style.rotation</span><span class="PUNC">=</span><span class="NAME">rotation</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>534</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strokes</span><span class="PUNC">=</span><span class="NAME">node.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stroke</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">strokes.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="KEYW">null</span><span class="PUNC">:</span><span class="NAME">strokes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options.isStroked</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.stroked</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">stroke</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stroke.on</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">stroke</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stroke</span><span class="PUNC">=</span><span class="NAME">this.createNode</span><span class="PUNC">(</span><span class="STRN">'olv:stroke'</span><span class="PUNC">,</span><span class="NAME">node.id</span><span class="PUNC">+</span><span class="STRN">"_stroke"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.appendChild</span><span class="PUNC">(</span><span class="NAME">stroke</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>535</span> </span><span class="NAME">stroke.on</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">stroke.color</span><span class="PUNC">=</span><span class="NAME">style.strokeColor</span><span class="PUNC">;</span><span class="NAME">stroke.weight</span><span class="PUNC">=</span><span class="NAME">style.strokeWidth</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">stroke.opacity</span><span class="PUNC">=</span><span class="NAME">style.strokeOpacity</span><span class="PUNC">;</span><span class="NAME">stroke.endcap</span><span class="PUNC">=</span><span class="NAME">style.strokeLinecap</span><span class="PUNC">==</span><span class="STRN">'butt'</span><span class="PUNC">?</span><span class="STRN">'flat'</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">style.strokeLinecap</span><span class="PUNC">||</span><span class="STRN">'round'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.strokeDashstyle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">stroke.dashstyle</span><span class="PUNC">=</span><span class="NAME">this.dashStyle</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>536</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.cursor</span><span class="PUNC">!=</span><span class="STRN">"inherit"</span><span class="PUNC">&&</span><span class="NAME">style.cursor</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.style.cursor</span><span class="PUNC">=</span><span class="NAME">style.cursor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>537</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">graphicRotate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">xOffset</span><span class="PUNC">,</span><span class="NAME">yOffset</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">node._style</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotation</span><span class="PUNC">=</span><span class="NAME">style.rotation</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aspectRatio</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">style.graphicWidth</span><span class="PUNC">&&</span><span class="NAME">style.graphicHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Image</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">img.onreadystatechange</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">img.readyState</span><span class="PUNC">==</span><span class="STRN">"complete"</span><span class="PUNC">||</span><span class="NAME">img.readyState</span><span class="PUNC">==</span><span class="STRN">"interactive"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">aspectRatio</span><span class="PUNC">=</span><span class="NAME">img.width</span><span class="PUNC">/</span><span class="NAME">img.height</span><span class="PUNC">;</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">style.pointRadius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">style.graphicWidth</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">style.graphicHeight</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">xOffset</span><span class="PUNC">=</span><span class="NAME">xOffset</span><span class="PUNC">*</span><span class="NAME">aspectRatio</span><span class="PUNC">;</span><span class="NAME">style.graphicWidth</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">*</span><span class="NAME">aspectRatio</span><span class="PUNC">;</span><span class="NAME">style.graphicHeight</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">;</span><span class="NAME">this.graphicRotate</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">xOffset</span><span class="PUNC">,</span><span class="NAME">yOffset</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">img.src</span><span class="PUNC">=</span><span class="NAME">style.externalGraphic</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">style.graphicWidth</span><span class="PUNC">,</span><span class="NAME">style.graphicHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">aspectRatio</span><span class="PUNC">=</span><span class="NAME">style.graphicWidth</span><span class="PUNC">/</span><span class="NAME">style.graphicHeight</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>538</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">style.graphicWidth</span><span class="PUNC">||</span><span class="NAME">size</span><span class="PUNC">*</span><span class="NAME">aspectRatio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">style.graphicHeight</span><span class="PUNC">||</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.width</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.height</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">image</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">node.id</span><span class="PUNC">+</span><span class="STRN">"_image"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">image</span><span class="PUNC">=</span><span class="NAME">this.createNode</span><span class="PUNC">(</span><span class="STRN">"olv:imagedata"</span><span class="PUNC">,</span><span class="NAME">node.id</span><span class="PUNC">+</span><span class="STRN">"_image"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.appendChild</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>539</span> </span><span class="NAME">image.style.width</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">image.style.height</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">image.src</span><span class="PUNC">=</span><span class="NAME">style.externalGraphic</span><span class="PUNC">;</span><span class="NAME">image.style.filter</span><span class="PUNC">=</span><span class="STRN">"progid:DXImageTransform.Microsoft.AlphaImageLoader("</span><span class="PUNC">+</span><span class="STRN">"src='', sizingMethod='scale')"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rot</span><span class="PUNC">=</span><span class="NAME">rotation</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sintheta</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rot</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">costheta</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rot</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filter</span><span class="PUNC">=</span><span class="STRN">"progid:DXImageTransform.Microsoft.Matrix(M11="</span><span class="PUNC">+</span><span class="NAME">costheta</span><span class="PUNC">+</span><span class="STRN">",M12="</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">sintheta</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">",M21="</span><span class="PUNC">+</span><span class="NAME">sintheta</span><span class="PUNC">+</span><span class="STRN">",M22="</span><span class="PUNC">+</span><span class="NAME">costheta</span><span class="PUNC">+</span><span class="STRN">",SizingMethod='auto expand')\n"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">opacity</span><span class="PUNC">=</span><span class="NAME">style.graphicOpacity</span><span class="PUNC">||</span><span class="NAME">style.fillOpacity</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">&&</span><span class="NAME">opacity</span><span class="PUNC">!=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">filter</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"progid:DXImageTransform.Microsoft.BasicImage(opacity="</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>540</span> </span><span class="NAME">opacity</span><span class="PUNC">+</span><span class="STRN">")\n"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>541</span> </span><span class="NAME">node.style.filter</span><span class="PUNC">=</span><span class="NAME">filter</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centerPoint</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">xOffset</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">yOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgBox</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">imgBox.rotate</span><span class="PUNC">(</span><span class="NAME">style.rotation</span><span class="PUNC">,</span><span class="NAME">centerPoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgBounds</span><span class="PUNC">=</span><span class="NAME">imgBox.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.left</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">node.style.left</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">imgBounds.left</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.top</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">node.style.top</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">imgBounds.bottom</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">postDraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.style.visibility</span><span class="PUNC">=</span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fillColor</span><span class="PUNC">=</span><span class="NAME">node._style.fillColor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strokeColor</span><span class="PUNC">=</span><span class="NAME">node._style.strokeColor</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fillColor</span><span class="PUNC">==</span><span class="STRN">"none"</span><span class="PUNC">&&</span><span class="NAME">node.fillcolor</span><span class="PUNC">!=</span><span class="NAME">fillColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.fillcolor</span><span class="PUNC">=</span><span class="NAME">fillColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>542</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">strokeColor</span><span class="PUNC">==</span><span class="STRN">"none"</span><span class="PUNC">&&</span><span class="NAME">node.strokecolor</span><span class="PUNC">!=</span><span class="NAME">strokeColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.strokecolor</span><span class="PUNC">=</span><span class="NAME">strokeColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setNodeDimension</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bbox</span><span class="PUNC">=</span><span class="NAME">geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bbox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scaledBox</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bbox.left</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">bbox.bottom</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">bbox.right</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">bbox.top</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.left</span><span class="PUNC">=</span><span class="NAME">scaledBox.left</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.top</span><span class="PUNC">=</span><span class="NAME">scaledBox.top</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.width</span><span class="PUNC">=</span><span class="NAME">scaledBox.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.height</span><span class="PUNC">=</span><span class="NAME">scaledBox.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.coordorigin</span><span class="PUNC">=</span><span class="NAME">scaledBox.left</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">scaledBox.top</span><span class="PUNC">;</span><span class="NAME">node.coordsize</span><span class="PUNC">=</span><span class="NAME">scaledBox.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">scaledBox.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dashStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dash</span><span class="PUNC">=</span><span class="NAME">style.strokeDashstyle</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">dash</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">'solid'</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">'dot'</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">'dash'</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">'dashdot'</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">'longdash'</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="STRN">'longdashdot'</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dash</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="NAME">dash.split</span><span class="PUNC">(</span><span class="REGX">/[ ,]/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parts.length</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">>=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"longdash"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>543</span> </span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">||</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"dot"</span><span class="PUNC">:</span><span class="STRN">"dash"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parts.length</span><span class="PUNC">==</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">>=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"longdashdot"</span><span class="PUNC">:</span><span class="STRN">"dashdot"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>544</span> </span><span class="KEYW">return</span><span class="STRN">"solid"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.id</span><span class="PUNC">=</span><span class="NAME">id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>545</span> </span><span class="NAME">node.unselectable</span><span class="PUNC">=</span><span class="STRN">'on'</span><span class="PUNC">;</span><span class="NAME">node.onselectstart</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.False</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">nodeTypeCompare</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">subType</span><span class="PUNC">=</span><span class="NAME">type</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">splitIndex</span><span class="PUNC">=</span><span class="NAME">subType.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splitIndex</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">subType</span><span class="PUNC">=</span><span class="NAME">subType.substr</span><span class="PUNC">(</span><span class="NAME">splitIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>546</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeName</span><span class="PUNC">=</span><span class="NAME">node.nodeName</span><span class="PUNC">;</span><span class="NAME">splitIndex</span><span class="PUNC">=</span><span class="NAME">nodeName.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splitIndex</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeName</span><span class="PUNC">=</span><span class="NAME">nodeName.substr</span><span class="PUNC">(</span><span class="NAME">splitIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>547</span> </span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">subType</span><span class="PUNC">==</span><span class="NAME">nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createRenderRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="STRN">"_vmlRoot"</span><span class="PUNC">,</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">suffix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="NAME">suffix</span><span class="PUNC">,</span><span class="STRN">"olv:group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.drawCircle</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawCircle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">radius</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">geometry.x</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">geometry.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">diameter</span><span class="PUNC">=</span><span class="NAME">radius</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">node.style.width</span><span class="PUNC">=</span><span class="NAME">diameter</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.height</span><span class="PUNC">=</span><span class="NAME">diameter</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>548</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLineString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.drawLine</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLinearRing</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.drawLine</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawLine</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">closeLine</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setNodeDimension</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numComponents</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">numComponents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">comp</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numComponents</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">comp</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">comp.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">comp.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">+</span><span class="STRN">" l "</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>549</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">closeLine</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">" x e"</span><span class="PUNC">:</span><span class="STRN">" e"</span><span class="PUNC">;</span><span class="NAME">node.path</span><span class="PUNC">=</span><span class="STRN">"m"</span><span class="PUNC">+</span><span class="NAME">parts.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">end</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawPolygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setNodeDimension</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">linearRing</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">,</span><span class="NAME">ilen</span><span class="PUNC">,</span><span class="NAME">comp</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">linearRing</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">"m"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">ilen</span><span class="PUNC">=</span><span class="NAME">linearRing.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">ilen</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">comp</span><span class="PUNC">=</span><span class="NAME">linearRing.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">comp.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">comp.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">" l"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>550</span> </span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">" x "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>551</span> </span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">"e"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.path</span><span class="PUNC">=</span><span class="NAME">path.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawRectangle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.style.left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.width</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.width</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">node.style.height</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">geometry.height</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">+</span><span class="NAME">this.LABEL_ID_SUFFIX</span><span class="PUNC">,</span><span class="STRN">"olv:rect"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">textbox</span><span class="PUNC">=</span><span class="NAME">this.nodeFactory</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">+</span><span class="NAME">this.LABEL_ID_SUFFIX</span><span class="PUNC">+</span><span class="STRN">"_textbox"</span><span class="PUNC">,</span><span class="STRN">"olv:textbox"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">label.style.left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">location.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">label.style.top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">location.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">label.style.flip</span><span class="PUNC">=</span><span class="STRN">"y"</span><span class="PUNC">;</span><span class="NAME">textbox.innerText</span><span class="PUNC">=</span><span class="NAME">style.label</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontColor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">textbox.style.color</span><span class="PUNC">=</span><span class="NAME">style.fontColor</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>552</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontOpacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">textbox.style.filter</span><span class="PUNC">=</span><span class="STRN">'alpha(opacity='</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">style.fontOpacity</span><span class="PUNC">*</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>553</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontFamily</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">textbox.style.fontFamily</span><span class="PUNC">=</span><span class="NAME">style.fontFamily</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>554</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontSize</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">textbox.style.fontSize</span><span class="PUNC">=</span><span class="NAME">style.fontSize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>555</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.fontWeight</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">textbox.style.fontWeight</span><span class="PUNC">=</span><span class="NAME">style.fontWeight</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>556</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style.labelSelect</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label._featureId</span><span class="PUNC">=</span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="NAME">textbox._featureId</span><span class="PUNC">=</span><span class="NAME">featureId</span><span class="PUNC">;</span><span class="NAME">textbox._geometry</span><span class="PUNC">=</span><span class="NAME">location</span><span class="PUNC">;</span><span class="NAME">textbox._geometryClass</span><span class="PUNC">=</span><span class="NAME">location.CLASS_NAME</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>557</span> </span><span class="NAME">textbox.style.whiteSpace</span><span class="PUNC">=</span><span class="STRN">"nowrap"</span><span class="PUNC">;</span><span class="NAME">textbox.inset</span><span class="PUNC">=</span><span class="STRN">"1px,0px,0px,0px"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">label.parentNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">label.appendChild</span><span class="PUNC">(</span><span class="NAME">textbox</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.textRoot.appendChild</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>558</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">align</span><span class="PUNC">=</span><span class="NAME">style.labelAlign</span><span class="PUNC">||</span><span class="STRN">"cm"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">align.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">align</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"m"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>559</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xshift</span><span class="PUNC">=</span><span class="NAME">textbox.clientWidth</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Renderer.VML.LABEL_SHIFT</span><span class="PUNC">[</span><span class="NAME">align.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yshift</span><span class="PUNC">=</span><span class="NAME">textbox.clientHeight</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Renderer.VML.LABEL_SHIFT</span><span class="PUNC">[</span><span class="NAME">align.substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">label.style.left</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">label.style.left</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">xshift</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">label.style.top</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">label.style.top</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">yshift</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawSurface</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setNodeDimension</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">comp</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">comp</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">comp.x</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.x</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">comp.y</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">-</span><span class="NAME">this.offset.y</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">%</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">"m"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">%</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">" c"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>560</span> </span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>561</span> </span><span class="NAME">path.push</span><span class="PUNC">(</span><span class="STRN">" x e"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.path</span><span class="PUNC">=</span><span class="NAME">path.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveRoot</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">renderer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.getLayer</span><span class="PUNC">(</span><span class="NAME">renderer.container.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector.RootContainer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.getLayer</span><span class="PUNC">(</span><span class="NAME">this.container.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>562</span> </span><span class="NAME">layer</span><span class="PUNC">&&</span><span class="NAME">layer.renderer.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.Elements.prototype.moveRoot.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layer</span><span class="PUNC">&&</span><span class="NAME">layer.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">importSymbol</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">graphicName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.container.id</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">graphicName</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">=</span><span class="NAME">this.symbolCache</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cache</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>563</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbol</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Renderer.symbol</span><span class="PUNC">[</span><span class="NAME">graphicName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">symbol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="NAME">graphicName</span><span class="PUNC">+</span><span class="STRN">' is not a valid symbol name'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>564</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbolExtent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">,</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pathitems</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"m"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">symbol.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">symbol</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">symbol</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">symbolExtent.left</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">symbolExtent.left</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolExtent.right</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">symbolExtent.right</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">symbolExtent.top</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">symbolExtent.top</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pathitems.push</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pathitems.push</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pathitems.push</span><span class="PUNC">(</span><span class="STRN">"l"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>565</span> </span><span class="NAME">pathitems.push</span><span class="PUNC">(</span><span class="STRN">"x e"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">=</span><span class="NAME">pathitems.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">symbolExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">symbolExtent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">diff</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">=</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">-</span><span class="NAME">diff</span><span class="PUNC">;</span><span class="NAME">symbolExtent.top</span><span class="PUNC">=</span><span class="NAME">symbolExtent.top</span><span class="PUNC">+</span><span class="NAME">diff</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">symbolExtent.left</span><span class="PUNC">=</span><span class="NAME">symbolExtent.left</span><span class="PUNC">+</span><span class="NAME">diff</span><span class="PUNC">;</span><span class="NAME">symbolExtent.right</span><span class="PUNC">=</span><span class="NAME">symbolExtent.right</span><span class="PUNC">-</span><span class="NAME">diff</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>566</span> </span><span class="NAME">cache</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">path</span><span class="PUNC">:</span><span class="NAME">path</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">:</span><span class="NAME">symbolExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">symbolExtent.left</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="NAME">symbolExtent.bottom</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.symbolCache</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cache</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Renderer.VML"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Renderer.VML.LABEL_SHIFT</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"l"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"c"</span><span class="PUNC">:</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="STRN">"r"</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="STRN">"t"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"m"</span><span class="PUNC">:</span><span class="PUNC">.</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="STRN">"b"</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Tile</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"loadstart"</span><span class="PUNC">,</span><span class="STRN">"loadend"</span><span class="PUNC">,</span><span class="STRN">"reload"</span><span class="PUNC">,</span><span class="STRN">"unload"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">isLoading</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="NAME">layer</span><span class="PUNC">;</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="NAME">position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="NAME">bounds.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">size.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="STRN">"Tile_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unload</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isLoading</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.isLoading</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"unload"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.events.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Tile</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">,</span><span class="NAME">this.position</span><span class="PUNC">,</span><span class="NAME">this.bounds</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>567</span> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.layer.maxExtent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">withinMaxExtent</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">&&</span><span class="NAME">this.bounds.intersectsBounds</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.shouldDraw</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">withinMaxExtent</span><span class="PUNC">||</span><span class="NAME">this.layer.displayOutsideMaxExtent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.shouldDraw</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">redraw</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">redraw</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">redraw</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>568</span> </span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="NAME">bounds.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.position</span><span class="PUNC">=</span><span class="NAME">position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">redraw</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getBoundsFromBaseLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'layerName'</span><span class="PUNC">:</span><span class="NAME">this.layer.name</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topLeft</span><span class="PUNC">=</span><span class="NAME">this.layer.map.getLonLatFromLayerPx</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomRightPx</span><span class="PUNC">=</span><span class="NAME">position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bottomRightPx.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.size.w</span><span class="PUNC">;</span><span class="NAME">bottomRightPx.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.size.h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomRight</span><span class="PUNC">=</span><span class="NAME">this.layer.map.getLonLatFromLayerPx</span><span class="PUNC">(</span><span class="NAME">bottomRightPx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">topLeft.lon</span><span class="PUNC">></span><span class="NAME">bottomRight.lon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">topLeft.lon</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">topLeft.lon</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">180</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">topLeft.lon</span><span class="PUNC">+</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">bottomRight.lon</span><span class="PUNC">=</span><span class="NUMB">180</span><span class="PUNC">+</span><span class="NAME">bottomRight.lon</span><span class="PUNC">+</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>569</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">topLeft.lon</span><span class="PUNC">,</span><span class="NAME">bottomRight.lat</span><span class="PUNC">,</span><span class="NAME">bottomRight.lon</span><span class="PUNC">,</span><span class="NAME">topLeft.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">showTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.shouldDraw</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">show</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hide</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Tile"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.PanZoomBar</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control.PanZoom</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">zoomStopWidth</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="NAME">zoomStopHeight</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="NAME">slider</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">sliderEvents</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoombarDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">divEvents</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoomWorldIcon</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">forceFixedZoomLevel</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">mouseDragStart</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoomStart</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.PanZoom.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._removeZoomBar</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"changebaselayer"</span><span class="PUNC">:</span><span class="NAME">this.redraw</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.PanZoom.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.mouseDragStart</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.zoomStart</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.PanZoom.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"changebaselayer"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.redraw</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.removeButtons</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._removeZoomBar</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>570</span> </span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Control.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.buttons</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centered</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">+</span><span class="NAME">sz.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wposition</span><span class="PUNC">=</span><span class="NAME">sz.w</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.zoomWorldIcon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">centered</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">+</span><span class="NAME">sz.w</span><span class="PUNC">,</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>571</span> </span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"panup"</span><span class="PUNC">,</span><span class="STRN">"north-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px.y</span><span class="PUNC">=</span><span class="NAME">centered.y</span><span class="PUNC">+</span><span class="NAME">sz.h</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"panleft"</span><span class="PUNC">,</span><span class="STRN">"west-mini.png"</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.zoomWorldIcon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"zoomworld"</span><span class="PUNC">,</span><span class="STRN">"zoom-world-mini.png"</span><span class="PUNC">,</span><span class="NAME">px.add</span><span class="PUNC">(</span><span class="NAME">sz.w</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">wposition</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>572</span> </span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"panright"</span><span class="PUNC">,</span><span class="STRN">"east-mini.png"</span><span class="PUNC">,</span><span class="NAME">px.add</span><span class="PUNC">(</span><span class="NAME">wposition</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"pandown"</span><span class="PUNC">,</span><span class="STRN">"south-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"zoomin"</span><span class="PUNC">,</span><span class="STRN">"zoom-plus-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">centered</span><span class="PUNC">=</span><span class="NAME">this._addZoomBar</span><span class="PUNC">(</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sz.h</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._addButton</span><span class="PUNC">(</span><span class="STRN">"zoomout"</span><span class="PUNC">,</span><span class="STRN">"zoom-minus-mini.png"</span><span class="PUNC">,</span><span class="NAME">centered</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_addZoomBar</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">centered</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgLocation</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">this.map.id</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoomsToEnd</span><span class="PUNC">=</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">slider</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">zoomsToEnd</span><span class="PUNC">*</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">imgLocation</span><span class="PUNC">+</span><span class="STRN">"slider.png"</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.slider</span><span class="PUNC">=</span><span class="NAME">slider</span><span class="PUNC">;</span><span class="NAME">this.sliderEvents</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">slider</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">includeXY</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.sliderEvents.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mousedown"</span><span class="PUNC">:</span><span class="NAME">this.zoomBarDown</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.zoomBarDrag</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">:</span><span class="NAME">this.zoomBarUp</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sz.h</span><span class="PUNC">=</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">*</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sz.w</span><span class="PUNC">=</span><span class="NAME">this.zoomStopWidth</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.alphaHack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">this.map.id</span><span class="PUNC">;</span><span class="NAME">div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">centered</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">sz.w</span><span class="PUNC">,</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">imgLocation</span><span class="PUNC">+</span><span class="STRN">"zoombar.png"</span><span class="PUNC">,</span><span class="STRN">"absolute"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"crop"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">div.style.height</span><span class="PUNC">=</span><span class="NAME">sz.h</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="STRN">'OpenLayers_Control_PanZoomBar_Zoombar'</span><span class="PUNC">+</span><span class="NAME">this.map.id</span><span class="PUNC">,</span><span class="NAME">centered</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">,</span><span class="NAME">imgLocation</span><span class="PUNC">+</span><span class="STRN">"zoombar.png"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>573</span> </span><span class="NAME">this.zoombarDiv</span><span class="PUNC">=</span><span class="NAME">div</span><span class="PUNC">;</span><span class="NAME">this.divEvents</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">includeXY</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.divEvents.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mousedown"</span><span class="PUNC">:</span><span class="NAME">this.divClick</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.passEventToSlider</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.startTop</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">div.style.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">slider</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"zoomend"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.moveZoomBar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">centered</span><span class="PUNC">=</span><span class="NAME">centered.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">*</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">centered</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">_removeZoomBar</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.sliderEvents.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mousedown"</span><span class="PUNC">:</span><span class="NAME">this.zoomBarDown</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.zoomBarDrag</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">:</span><span class="NAME">this.zoomBarUp</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.sliderEvents.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.divEvents.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mousedown"</span><span class="PUNC">:</span><span class="NAME">this.divClick</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.passEventToSlider</span><span class="PUNC">,</span><span class="STRN">"dblclick"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">,</span><span class="STRN">"click"</span><span class="PUNC">:</span><span class="NAME">this.doubleClick</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.divEvents.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.removeChild</span><span class="PUNC">(</span><span class="NAME">this.zoombarDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoombarDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.div.removeChild</span><span class="PUNC">(</span><span class="NAME">this.slider</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.slider</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.map.events.unregister</span><span class="PUNC">(</span><span class="STRN">"zoomend"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.moveZoomBar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">passEventToSlider</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.sliderEvents.handleBrowserEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">divClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Event.isLeftClick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>574</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">evt.xy.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.pagePosition</span><span class="PUNC">(</span><span class="NAME">evt.object</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">levels</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.forceFixedZoomLevel</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.map.fractionalZoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">levels</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">levels</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>575</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">levels</span><span class="PUNC">;</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.zoomTo</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomBarDown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Event.isLeftClick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>576</span> </span><span class="NAME">this.map.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.passEventToSlider</span><span class="PUNC">,</span><span class="STRN">"mouseup"</span><span class="PUNC">:</span><span class="NAME">this.passEventToSlider</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.mouseDragStart</span><span class="PUNC">=</span><span class="NAME">evt.xy.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomStart</span><span class="PUNC">=</span><span class="NAME">evt.xy.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.style.cursor</span><span class="PUNC">=</span><span class="STRN">"move"</span><span class="PUNC">;</span><span class="NAME">this.zoombarDiv.offsets</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomBarDrag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.mouseDragStart</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaY</span><span class="PUNC">=</span><span class="NAME">this.mouseDragStart.y</span><span class="PUNC">-</span><span class="NAME">evt.xy.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.pagePosition</span><span class="PUNC">(</span><span class="NAME">this.zoombarDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">evt.clientY</span><span class="PUNC">-</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">evt.clientY</span><span class="PUNC">-</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.zoombarDiv.style.height</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newTop</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.slider.style.top</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">deltaY</span><span class="PUNC">;</span><span class="NAME">this.slider.style.top</span><span class="PUNC">=</span><span class="NAME">newTop</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.mouseDragStart</span><span class="PUNC">=</span><span class="NAME">evt.xy.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>577</span> </span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomBarUp</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Event.isLeftClick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>578</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.mouseDragStart</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.cursor</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.map.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"mouseup"</span><span class="PUNC">:</span><span class="NAME">this.passEventToSlider</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">:</span><span class="NAME">this.passEventToSlider</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaY</span><span class="PUNC">=</span><span class="NAME">this.zoomStart.y</span><span class="PUNC">-</span><span class="NAME">evt.xy.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoomLevel</span><span class="PUNC">=</span><span class="NAME">this.map.zoom</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.forceFixedZoomLevel</span><span class="PUNC">&&</span><span class="NAME">this.map.fractionalZoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoomLevel</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">deltaY</span><span class="PUNC">/</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">;</span><span class="NAME">zoomLevel</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">zoomLevel</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">zoomLevel</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">deltaY</span><span class="PUNC">/</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>579</span> </span><span class="NAME">this.map.zoomTo</span><span class="PUNC">(</span><span class="NAME">zoomLevel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.mouseDragStart</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.zoomStart</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveZoomBar</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newTop</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.zoomStopHeight</span><span class="PUNC">+</span><span class="NAME">this.startTop</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.slider.style.top</span><span class="PUNC">=</span><span class="NAME">newTop</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.PanZoomBar"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.XML</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Format</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">namespaces</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">namespaceAlias</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">defaultPrefix</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">readers</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">writers</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">xmldom</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.ActiveXObject</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.xmldom</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">"Microsoft.XMLDOM"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>580</span> </span><span class="NAME">OpenLayers.Format.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.namespaces</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.namespaces</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.namespaceAlias</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alias</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.namespaces</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.namespaceAlias</span><span class="PUNC">[</span><span class="NAME">this.namespaces</span><span class="PUNC">[</span><span class="NAME">alias</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">alias</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.xmldom</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setNamespace</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">alias</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.namespaces</span><span class="PUNC">[</span><span class="NAME">alias</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">uri</span><span class="PUNC">;</span><span class="NAME">this.namespaceAlias</span><span class="PUNC">[</span><span class="NAME">uri</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">alias</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">read</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">text.indexOf</span><span class="PUNC">(</span><span class="STRN">'&lt;'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">text</span><span class="PUNC">=</span><span class="NAME">text.substring</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>581</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.Try</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmldom</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.ActiveXObject</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.xmldom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">xmldom</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">"Microsoft.XMLDOM"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">xmldom</span><span class="PUNC">=</span><span class="NAME">this.xmldom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>582</span> </span><span class="NAME">xmldom.loadXML</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">xmldom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parseFromString</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="STRN">'text/xml'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">req</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">req.open</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="STRN">"data:"</span><span class="PUNC">+</span><span class="STRN">"text/xml"</span><span class="PUNC">+</span><span class="STRN">";charset=utf-8,"</span><span class="PUNC">+</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">req.overrideMimeType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">req.overrideMimeType</span><span class="PUNC">(</span><span class="STRN">"text/xml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>583</span> </span><span class="NAME">req.send</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">req.responseXML</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.keepData</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.data</span><span class="PUNC">=</span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>584</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">write</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xmldom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">node.xml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">serializer</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLSerializer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.nodeType</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doc</span><span class="PUNC">=</span><span class="NAME">document.implementation.createDocument</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">doc.importNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">doc.importNode</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>585</span> </span><span class="NAME">doc.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">serializer.serializeToString</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">serializer.serializeToString</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>586</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createElementNS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xmldom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">uri</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">this.xmldom.createNode</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">this.xmldom.createNode</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>587</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createTextNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">!==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">text</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>588</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xmldom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.xmldom.createTextNode</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>589</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getElementsByTagNameNS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.getElementsByTagNameNS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">elements</span><span class="PUNC">=</span><span class="NAME">node.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allNodes</span><span class="PUNC">=</span><span class="NAME">node.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">potentialNode</span><span class="PUNC">,</span><span class="NAME">fullName</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">allNodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">potentialNode</span><span class="PUNC">=</span><span class="NAME">allNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">fullName</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">potentialNode.prefix</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">potentialNode.prefix</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">name</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">fullName</span><span class="PUNC">==</span><span class="NAME">potentialNode.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">==</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">==</span><span class="NAME">potentialNode.namespaceURI</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">elements.push</span><span class="PUNC">(</span><span class="NAME">potentialNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>590</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getAttributeNodeNS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributeNode</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.getAttributeNodeNS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attributeNode</span><span class="PUNC">=</span><span class="NAME">node.getAttributeNodeNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">=</span><span class="NAME">node.attributes</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">potentialNode</span><span class="PUNC">,</span><span class="NAME">fullName</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">attributes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">potentialNode</span><span class="PUNC">=</span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">potentialNode.namespaceURI</span><span class="PUNC">==</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fullName</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">potentialNode.prefix</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">potentialNode.prefix</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">name</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fullName</span><span class="PUNC">==</span><span class="NAME">potentialNode.nodeName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attributeNode</span><span class="PUNC">=</span><span class="NAME">potentialNode</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>591</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attributeNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getAttributeNS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributeValue</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.getAttributeNS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attributeValue</span><span class="PUNC">=</span><span class="NAME">node.getAttributeNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">""</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributeNode</span><span class="PUNC">=</span><span class="NAME">this.getAttributeNodeNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">attributeNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attributeValue</span><span class="PUNC">=</span><span class="NAME">attributeNode.nodeValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>592</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attributeValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getChildValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">def</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">def</span><span class="PUNC">||</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">node.firstChild</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">child.nextSibling</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">child.nodeType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">child.nodeValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>593</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">concatChildValues</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">def</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">node.firstChild</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">childValue</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">childValue</span><span class="PUNC">=</span><span class="NAME">child.nodeValue</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">childValue</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">childValue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>594</span> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">child.nextSibling</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>595</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">&&</span><span class="NAME">def</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">def</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>596</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isSimpleContent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">simple</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">node.firstChild</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">child.nextSibling</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">child.nodeType</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">simple</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>597</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">simple</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">contentType</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">simple</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">complex</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Format.XML.CONTENT_TYPE.EMPTY</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">node.firstChild</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">;</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">child.nextSibling</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">child.nodeType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">complex</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="NAME">simple</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>598</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">complex</span><span class="PUNC">&&</span><span class="NAME">simple</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>599</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">complex</span><span class="PUNC">&&</span><span class="NAME">simple</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Format.XML.CONTENT_TYPE.MIXED</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">complex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">simple</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>600</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hasAttributeNS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.hasAttributeNS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">found</span><span class="PUNC">=</span><span class="NAME">node.hasAttributeNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">found</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">this.getAttributeNodeNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>601</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setAttributeNS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttributeNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xmldom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attribute</span><span class="PUNC">=</span><span class="NAME">node.ownerDocument.createNode</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">attribute.nodeValue</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="NAME">node.setAttributeNode</span><span class="PUNC">(</span><span class="NAME">attribute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="STRN">"setAttributeNS not implemented"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createElementNSPlus</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">options.uri</span><span class="PUNC">||</span><span class="NAME">this.namespaces</span><span class="PUNC">[</span><span class="NAME">options.prefix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">=</span><span class="NAME">name.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.namespaces</span><span class="PUNC">[</span><span class="NAME">name.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">loc</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>602</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.namespaces</span><span class="PUNC">[</span><span class="NAME">this.defaultPrefix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>603</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.attributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setAttributes</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">options.attributes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>604</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">options.value</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.appendChild</span><span class="PUNC">(</span><span class="NAME">this.createTextNode</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>605</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setAttributes</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.namespaces</span><span class="PUNC">[</span><span class="NAME">name.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">name.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.setAttributeNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">readNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>606</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">=</span><span class="NAME">this.readers</span><span class="PUNC">[</span><span class="NAME">node.namespaceURI</span><span class="PUNC">?</span><span class="NAME">this.namespaceAlias</span><span class="PUNC">[</span><span class="NAME">node.namespaceURI</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">this.defaultPrefix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">group</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">local</span><span class="PUNC">=</span><span class="NAME">node.localName</span><span class="PUNC">||</span><span class="NAME">node.nodeName.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">reader</span><span class="PUNC">=</span><span class="NAME">group</span><span class="PUNC">[</span><span class="NAME">local</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">group</span><span class="PUNC">[</span><span class="STRN">"*"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">reader</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">reader.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>607</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">readChildNodes</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>608</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">=</span><span class="NAME">node.childNodes</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">child.nodeType</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.readNode</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>609</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">writeNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">,</span><span class="NAME">local</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">split</span><span class="PUNC">=</span><span class="NAME">name.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">split</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">prefix</span><span class="PUNC">=</span><span class="NAME">name.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">split</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">local</span><span class="PUNC">=</span><span class="NAME">name.substring</span><span class="PUNC">(</span><span class="NAME">split</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">prefix</span><span class="PUNC">=</span><span class="NAME">this.namespaceAlias</span><span class="PUNC">[</span><span class="NAME">parent.namespaceURI</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">prefix</span><span class="PUNC">=</span><span class="NAME">this.defaultPrefix</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>610</span> </span><span class="NAME">local</span><span class="PUNC">=</span><span class="NAME">name</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>611</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">this.writers</span><span class="PUNC">[</span><span class="NAME">prefix</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">local</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parent.appendChild</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>612</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getChildEl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">&&</span><span class="NAME">this.getThisOrNextEl</span><span class="PUNC">(</span><span class="NAME">node.firstChild</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNextEl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">&&</span><span class="NAME">this.getThisOrNextEl</span><span class="PUNC">(</span><span class="NAME">node.nextSibling</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getThisOrNextEl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">uri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">outer</span><span class="PUNC">:</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sibling</span><span class="PUNC">=</span><span class="NAME">node</span><span class="PUNC">;</span><span class="NAME">sibling</span><span class="PUNC">;</span><span class="NAME">sibling</span><span class="PUNC">=</span><span class="NAME">sibling.nextSibling</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">sibling.nodeType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">name</span><span class="PUNC">||</span><span class="NAME">name</span><span class="PUNC">===</span><span class="PUNC">(</span><span class="NAME">sibling.localName</span><span class="PUNC">||</span><span class="NAME">sibling.nodeName.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uri</span><span class="PUNC">||</span><span class="NAME">uri</span><span class="PUNC">===</span><span class="NAME">sibling.namespaceURI</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>613</span> </span><span class="NAME">sibling</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="REGX">/^\s*$/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">sibling.nodeValue</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>614</span> </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">:</span><span class="NAME">sibling</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>615</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sibling</span><span class="PUNC">||</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">lookupNamespaceURI</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uri</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.lookupNamespaceURI</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">node.lookupNamespaceURI</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">outer</span><span class="PUNC">:</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">node.nodeType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.namespaceURI</span><span class="PUNC">!==</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">node.prefix</span><span class="PUNC">===</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">node.namespaceURI</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>616</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">node.attributes.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attr</span><span class="PUNC">=</span><span class="NAME">node.attributes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">attr.prefix</span><span class="PUNC">===</span><span class="STRN">"xmlns"</span><span class="PUNC">&&</span><span class="NAME">attr.name</span><span class="PUNC">===</span><span class="STRN">"xmlns:"</span><span class="PUNC">+</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">attr.value</span><span class="PUNC">||</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">attr.name</span><span class="PUNC">===</span><span class="STRN">"xmlns"</span><span class="PUNC">&&</span><span class="NAME">prefix</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">attr.value</span><span class="PUNC">||</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>617</span> </span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.lookupNamespaceURI</span><span class="PUNC">(</span><span class="NAME">node.parentNode</span><span class="PUNC">,</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.lookupNamespaceURI</span><span class="PUNC">(</span><span class="NAME">node.ownerElement</span><span class="PUNC">,</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">:</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.lookupNamespaceURI</span><span class="PUNC">(</span><span class="NAME">node.documentElement</span><span class="PUNC">,</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="NAME">uri</span><span class="PUNC">=</span><span class="NAME">this.lookupNamespaceURI</span><span class="PUNC">(</span><span class="NAME">node.parentNode</span><span class="PUNC">,</span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>618</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uri</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Format.XML"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.XML.CONTENT_TYPE</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">EMPTY</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">SIMPLE</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">COMPLEX</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">MIXED</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.XML.lookupNamespaceURI</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Format.XML.prototype.lookupNamespaceURI</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Format.XML.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">control</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">keyMask</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">active</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.control</span><span class="PUNC">=</span><span class="NAME">control</span><span class="PUNC">;</span><span class="NAME">this.callbacks</span><span class="PUNC">=</span><span class="NAME">callbacks</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">=</span><span class="NAME">this.map</span><span class="PUNC">||</span><span class="NAME">control.map</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setMap</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>619</span> </span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">checkModifiers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.keyMask</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>620</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keyModifiers</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">evt.shiftKey</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Handler.MOD_SHIFT</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="PUNC">(</span><span class="NAME">evt.ctrlKey</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Handler.MOD_CTRL</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">|</span><span class="PUNC">(</span><span class="NAME">evt.altKey</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Handler.MOD_ALT</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">keyModifiers</span><span class="PUNC">==</span><span class="NAME">this.keyMask</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>621</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Events.prototype.BROWSER_EVENTS</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.register</span><span class="PUNC">(</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>622</span> </span><span class="NAME">this.active</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>623</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Events.prototype.BROWSER_EVENTS</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unregister</span><span class="PUNC">(</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>624</span> </span><span class="NAME">this.active</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">&&</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">this.control</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">register</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.registerPriority</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.registerPriority</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.setEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unregister</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.unregister</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.unregister</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.setEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.evt</span><span class="PUNC">=</span><span class="NAME">evt</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.control</span><span class="PUNC">=</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.MOD_NONE</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.MOD_SHIFT</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.MOD_CTRL</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.MOD_ALT</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Map</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">Z_INDEX_BASE</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">BaseLayer</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NAME">Overlay</span><span class="PUNC">:</span><span class="NUMB">325</span><span class="PUNC">,</span><span class="NAME">Feature</span><span class="PUNC">:</span><span class="NUMB">725</span><span class="PUNC">,</span><span class="NAME">Popup</span><span class="PUNC">:</span><span class="NUMB">750</span><span class="PUNC">,</span><span class="NAME">Control</span><span class="PUNC">:</span><span class="NUMB">1000</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"preaddlayer"</span><span class="PUNC">,</span><span class="STRN">"addlayer"</span><span class="PUNC">,</span><span class="STRN">"removelayer"</span><span class="PUNC">,</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="STRN">"movestart"</span><span class="PUNC">,</span><span class="STRN">"move"</span><span class="PUNC">,</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="STRN">"zoomend"</span><span class="PUNC">,</span><span class="STRN">"popupopen"</span><span class="PUNC">,</span><span class="STRN">"popupclose"</span><span class="PUNC">,</span><span class="STRN">"addmarker"</span><span class="PUNC">,</span><span class="STRN">"removemarker"</span><span class="PUNC">,</span><span class="STRN">"clearmarkers"</span><span class="PUNC">,</span><span class="STRN">"mouseover"</span><span class="PUNC">,</span><span class="STRN">"mouseout"</span><span class="PUNC">,</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="STRN">"dragstart"</span><span class="PUNC">,</span><span class="STRN">"drag"</span><span class="PUNC">,</span><span class="STRN">"dragend"</span><span class="PUNC">,</span><span class="STRN">"changebaselayer"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fractionalZoom</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">allOverlays</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">viewPortDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layerContainerOrigin</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layerContainerDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">controls</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">popups</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">baseLayer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">center</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">resolution</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">panRatio</span><span class="PUNC">:</span><span class="NUMB">1.5</span><span class="PUNC">,</span><span class="NAME">viewRequestID</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tileSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">projection</span><span class="PUNC">:</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">,</span><span class="NAME">units</span><span class="PUNC">:</span><span class="STRN">'degrees'</span><span class="PUNC">,</span><span class="NAME">resolutions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxResolution</span><span class="PUNC">:</span><span class="NUMB">1.40625</span><span class="PUNC">,</span><span class="NAME">minResolution</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxScale</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minScale</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxExtent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minExtent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">restrictedExtent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">numZoomLevels</span><span class="PUNC">:</span><span class="NUMB">16</span><span class="PUNC">,</span><span class="NAME">theme</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">displayProjection</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fallThrough</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">panTween</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">eventListeners</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">panMethod</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Easing.Expo.easeOut</span><span class="PUNC">,</span><span class="NAME">panDuration</span><span class="PUNC">:</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NAME">paddingForPopups</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">===</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">div</span><span class="PUNC">;</span><span class="NAME">div</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.div</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>625</span> </span><span class="NAME">this.tileSize</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Map.TILE_WIDTH</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Map.TILE_HEIGHT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.maxExtent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">180</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">90</span><span class="PUNC">,</span><span class="NUMB">180</span><span class="PUNC">,</span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.paddingForPopups</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="NUMB">15</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.theme</span><span class="PUNC">=</span><span class="NAME">OpenLayers._getScriptLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'theme/default/style.css'</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layers</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="STRN">"OpenLayers.Map_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.style.height</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="NAME">this.div.style.width</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>626</span> </span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="STRN">'olMap'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_OpenLayers_ViewPort"</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"relative"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv.style.width</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv.style.height</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv.className</span><span class="PUNC">=</span><span class="STRN">"olMapViewport"</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_OpenLayers_Container"</span><span class="PUNC">;</span><span class="NAME">this.layerContainerDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layerContainerDiv.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="STRN">'Popup'</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.layerContainerDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">,</span><span class="NAME">this.fallThrough</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">includeXY</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.updateSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.on</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>627</span> </span><span class="NAME">this.events.register</span><span class="PUNC">(</span><span class="STRN">"movestart"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.updateSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.String.contains</span><span class="PUNC">(</span><span class="NAME">navigator.appName</span><span class="PUNC">,</span><span class="STRN">"Microsoft"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.register</span><span class="PUNC">(</span><span class="STRN">"resize"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.updateSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.updateSizeDestroy</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.updateSize</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">'resize'</span><span class="PUNC">,</span><span class="NAME">this.updateSizeDestroy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>628</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.theme</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addNode</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">'link'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.isEquivalentUrl</span><span class="PUNC">(</span><span class="NAME">nodes.item</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">href</span><span class="PUNC">,</span><span class="NAME">this.theme</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">addNode</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>629</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">addNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cssNode</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'link'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">cssNode.setAttribute</span><span class="PUNC">(</span><span class="STRN">'rel'</span><span class="PUNC">,</span><span class="STRN">'stylesheet'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">cssNode.setAttribute</span><span class="PUNC">(</span><span class="STRN">'type'</span><span class="PUNC">,</span><span class="STRN">'text/css'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">cssNode.setAttribute</span><span class="PUNC">(</span><span class="STRN">'href'</span><span class="PUNC">,</span><span class="NAME">this.theme</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">'head'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">cssNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>630</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.controls</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.controls</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Navigation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.PanZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.ArgParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Attribution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.controls</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>631</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.controls.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addControlToMap</span><span class="PUNC">(</span><span class="NAME">this.controls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>632</span> </span><span class="NAME">this.popups</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.unloadDestroy</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.destroy</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">'unload'</span><span class="PUNC">,</span><span class="NAME">this.unloadDestroy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addLayers</span><span class="PUNC">(</span><span class="NAME">options.layers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.center</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="NAME">options.center</span><span class="PUNC">,</span><span class="NAME">options.zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">render</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="STRN">'olMap'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.attachToElement</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.updateSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unloadDestroy</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">updateSizeDestroy</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.unloadDestroy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>633</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.panTween</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panTween.stop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.panTween</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>634</span> </span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">'unload'</span><span class="PUNC">,</span><span class="NAME">this.unloadDestroy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.unloadDestroy</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.updateSizeDestroy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">'resize'</span><span class="PUNC">,</span><span class="NAME">this.updateSizeDestroy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.events.unregister</span><span class="PUNC">(</span><span class="STRN">"resize"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.updateSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>635</span> </span><span class="NAME">this.paddingForPopups</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.controls</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.controls.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">--</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.controls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>636</span> </span><span class="NAME">this.controls</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>637</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">--</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>638</span> </span><span class="NAME">this.layers</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>639</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.removeChild</span><span class="PUNC">(</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>640</span> </span><span class="NAME">this.viewPortDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.un</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.eventListeners</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>641</span> </span><span class="NAME">this.events.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOptions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getTileSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.tileSize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getBy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">array</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">test</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">match.test</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Array.filter</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">array</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">match</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">test</span><span class="PUNC">&&</span><span class="NAME">match.test</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayersBy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getBy</span><span class="PUNC">(</span><span class="STRN">"layers"</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayersByName</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getLayersBy</span><span class="PUNC">(</span><span class="STRN">"name"</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayersByClass</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getLayersBy</span><span class="PUNC">(</span><span class="STRN">"CLASS_NAME"</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getControlsBy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getBy</span><span class="PUNC">(</span><span class="STRN">"controls"</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getControlsByClass</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getControlsBy</span><span class="PUNC">(</span><span class="STRN">"CLASS_NAME"</span><span class="PUNC">,</span><span class="NAME">match</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">foundLayer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.id</span><span class="PUNC">==</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">foundLayer</span><span class="PUNC">=</span><span class="NAME">layer</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>642</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">foundLayer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setLayerZIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">zIdx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.setZIndex</span><span class="PUNC">(</span><span class="NAME">this.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="NAME">layer.isBaseLayer</span><span class="PUNC">?</span><span class="STRN">'BaseLayer'</span><span class="PUNC">:</span><span class="STRN">'Overlay'</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>643</span> </span><span class="PUNC">+</span><span class="NAME">zIdx</span><span class="PUNC">*</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resetLayersZIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.setLayerZIndex</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">'layerAlreadyAdded'</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'layerName'</span><span class="PUNC">:</span><span class="NAME">layer.name</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>644</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.allOverlays</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.isBaseLayer</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>645</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"preaddlayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>646</span> </span><span class="NAME">layer.div.className</span><span class="PUNC">=</span><span class="STRN">"olLayerDiv"</span><span class="PUNC">;</span><span class="NAME">layer.div.style.overflow</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.setLayerZIndex</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">this.layers.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.isFixed</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.viewPortDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">layer.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.layerContainerDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">layer.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>647</span> </span><span class="NAME">this.layers.push</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layer.setMap</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.isBaseLayer</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.allOverlays</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.baseLayer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">layer.setVisibility</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">layer.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>648</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"addlayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layer.afterAdd</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addLayers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addLayer</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>649</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.isFixed</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.viewPortDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">layer.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.layerContainerDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">layer.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>650</span> </span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layer.removeMap</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layer.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">==</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.baseLayer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iLayer</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iLayer.isBaseLayer</span><span class="PUNC">||</span><span class="NAME">this.allOverlays</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">iLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>651</span> </span><span class="NAME">this.resetLayersZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"removelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNumLayers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayerIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setLayerIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">=</span><span class="NAME">this.getLayerIndex</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">></span><span class="NAME">this.layers.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>652</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">!=</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layers.splice</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layers.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setLayerZIndex</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>653</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="STRN">"order"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.allOverlays</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!==</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">raiseLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">delta</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NAME">this.getLayerIndex</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">delta</span><span class="PUNC">;</span><span class="NAME">this.setLayerIndex</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBaseLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newBaseLayer</span><span class="PUNC">!=</span><span class="NAME">this.baseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">,</span><span class="NAME">newBaseLayer</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newResolution</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">this.getScale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">newBaseLayer.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.allOverlays</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.baseLayer.setVisibility</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>654</span> </span><span class="NAME">this.baseLayer</span><span class="PUNC">=</span><span class="NAME">newBaseLayer</span><span class="PUNC">;</span><span class="NAME">this.viewRequestID</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.allOverlays</span><span class="PUNC">||</span><span class="NAME">this.baseLayer.visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.baseLayer.setVisibility</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>655</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newZoom</span><span class="PUNC">=</span><span class="NAME">this.getZoomForResolution</span><span class="PUNC">(</span><span class="NAME">newResolution</span><span class="PUNC">||</span><span class="NAME">this.resolution</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="NAME">newZoom</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>656</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changebaselayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="NAME">this.baseLayer</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addControl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.controls.push</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.addControlToMap</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addControls</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">controls</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pxs</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">pixels</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">controls.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctrl</span><span class="PUNC">=</span><span class="NAME">controls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">pxs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">pxs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.addControl</span><span class="PUNC">(</span><span class="NAME">ctrl</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addControlToMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">control.outsideViewport</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">control.div</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.displayProjection</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">control.displayProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">control.displayProjection</span><span class="PUNC">=</span><span class="NAME">this.displayProjection</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>657</span> </span><span class="NAME">control.setMap</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">=</span><span class="NAME">control.draw</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">control.outsideViewport</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">div.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="STRN">'Control'</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>658</span> </span><span class="NAME">this.controls.length</span><span class="PUNC">;</span><span class="NAME">this.viewPortDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>659</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">control.autoActivate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">control.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getControl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnControl</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.controls.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">control</span><span class="PUNC">=</span><span class="NAME">this.controls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">control.id</span><span class="PUNC">==</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">returnControl</span><span class="PUNC">=</span><span class="NAME">control</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>660</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnControl</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeControl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">==</span><span class="NAME">this.getControl</span><span class="PUNC">(</span><span class="NAME">control.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">control.div</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">control.div.parentNode</span><span class="PUNC">==</span><span class="NAME">this.viewPortDiv</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.viewPortDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">control.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>661</span> </span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.controls</span><span class="PUNC">,</span><span class="NAME">control</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addPopup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">popup</span><span class="PUNC">,</span><span class="NAME">exclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">exclusive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.popups.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">--</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.removePopup</span><span class="PUNC">(</span><span class="NAME">this.popups</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>662</span> </span><span class="NAME">popup.map</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">this.popups.push</span><span class="PUNC">(</span><span class="NAME">popup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">popupDiv</span><span class="PUNC">=</span><span class="NAME">popup.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">popupDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">popupDiv.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="STRN">'Popup'</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>663</span> </span><span class="NAME">this.popups.length</span><span class="PUNC">;</span><span class="NAME">this.layerContainerDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">popupDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removePopup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">popup</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.popups</span><span class="PUNC">,</span><span class="NAME">popup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">popup.div</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">this.layerContainerDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">popup.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>664</span> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>665</span> </span><span class="NAME">popup.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.size</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.size.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>666</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">updateSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newSize</span><span class="PUNC">=</span><span class="NAME">this.getCurrentSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newSize</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">newSize.h</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">newSize.w</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.clearMouseCache</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldSize</span><span class="PUNC">=</span><span class="NAME">this.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oldSize</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">oldSize</span><span class="PUNC">=</span><span class="NAME">newSize</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>667</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">newSize.equals</span><span class="PUNC">(</span><span class="NAME">oldSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.size</span><span class="PUNC">=</span><span class="NAME">newSize</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">onMapResize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>668</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">center</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">this.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoom</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCurrentSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">this.div.clientWidth</span><span class="PUNC">,</span><span class="NAME">this.div.clientHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">size.h</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">size.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size.w</span><span class="PUNC">=</span><span class="NAME">this.div.offsetWidth</span><span class="PUNC">;</span><span class="NAME">size.h</span><span class="PUNC">=</span><span class="NAME">this.div.offsetHeight</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>669</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">size.h</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">size.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size.w</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.div.style.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">size.h</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.div.style.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>670</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>671</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>672</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w_deg</span><span class="PUNC">=</span><span class="NAME">size.w</span><span class="PUNC">*</span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h_deg</span><span class="PUNC">=</span><span class="NAME">size.h</span><span class="PUNC">*</span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="NAME">extent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">center.lon</span><span class="PUNC">-</span><span class="NAME">w_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">-</span><span class="NAME">h_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">center.lon</span><span class="PUNC">+</span><span class="NAME">w_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">+</span><span class="NAME">h_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>673</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCenter</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.center</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.center.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>674</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZoom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.zoom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">pan</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">animate</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centerPx</span><span class="PUNC">=</span><span class="NAME">this.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newCenterPx</span><span class="PUNC">=</span><span class="NAME">centerPx.add</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options.dragging</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">newCenterPx.equals</span><span class="PUNC">(</span><span class="NAME">centerPx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newCenterLonLat</span><span class="PUNC">=</span><span class="NAME">this.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">newCenterPx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options.animate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panTo</span><span class="PUNC">(</span><span class="NAME">newCenterLonLat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="NAME">newCenterLonLat</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">options.dragging</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">panTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.panMethod</span><span class="PUNC">&&</span><span class="NAME">this.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">scale</span><span class="PUNC">(</span><span class="NAME">this.panRatio</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">containsLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.panTween</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panTween</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Tween</span><span class="PUNC">(</span><span class="NAME">this.panMethod</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>675</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">==</span><span class="NAME">center.lon</span><span class="PUNC">&&</span><span class="NAME">lonlat.lat</span><span class="PUNC">==</span><span class="NAME">center.lat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>676</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">from</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">lon</span><span class="PUNC">:</span><span class="NAME">center.lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">:</span><span class="NAME">center.lat</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">lon</span><span class="PUNC">:</span><span class="NAME">lonlat.lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">:</span><span class="NAME">lonlat.lat</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.panTween.start</span><span class="PUNC">(</span><span class="NAME">from</span><span class="PUNC">,</span><span class="NAME">to</span><span class="PUNC">,</span><span class="NAME">this.panDuration</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">callbacks</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">start</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"movestart"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">eachStep</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">,</span><span class="NAME">lonlat.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">this.zoom</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'dragging'</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">'noEvent'</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">done</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">,</span><span class="NAME">lonlat.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">this.zoom</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'noEvent'</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setCenter</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">,</span><span class="NAME">forceZoomChange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'dragging'</span><span class="PUNC">:</span><span class="NAME">dragging</span><span class="PUNC">,</span><span class="STRN">'forceZoomChange'</span><span class="PUNC">:</span><span class="NAME">forceZoomChange</span><span class="PUNC">,</span><span class="STRN">'caller'</span><span class="PUNC">:</span><span class="STRN">'setCenter'</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>677</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fractionalZoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>678</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragging</span><span class="PUNC">=</span><span class="NAME">options.dragging</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">forceZoomChange</span><span class="PUNC">=</span><span class="NAME">options.forceZoomChange</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">noEvent</span><span class="PUNC">=</span><span class="NAME">options.noEvent</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.panTween</span><span class="PUNC">&&</span><span class="NAME">options.caller</span><span class="PUNC">==</span><span class="STRN">"setCenter"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panTween.stop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>679</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.center</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.isValidLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">this.maxExtent.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>680</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.restrictedExtent</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>681</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">this.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>682</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolutionForZoom</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.calculateBounds</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.restrictedExtent.containsBounds</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxCenter</span><span class="PUNC">=</span><span class="NAME">this.restrictedExtent.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">this.restrictedExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">maxCenter.lon</span><span class="PUNC">,</span><span class="NAME">lonlat.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent.left</span><span class="PUNC">&lt;</span><span class="NAME">this.restrictedExtent.left</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NAME">this.restrictedExtent.left</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>683</span> </span><span class="NAME">extent.left</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent.right</span><span class="PUNC">></span><span class="NAME">this.restrictedExtent.right</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NAME">this.restrictedExtent.right</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>684</span> </span><span class="NAME">extent.right</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>685</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">this.restrictedExtent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">,</span><span class="NAME">maxCenter.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent.bottom</span><span class="PUNC">&lt;</span><span class="NAME">this.restrictedExtent.bottom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.restrictedExtent.bottom</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>686</span> </span><span class="NAME">extent.bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>687</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent.top</span><span class="PUNC">></span><span class="NAME">this.restrictedExtent.top</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.restrictedExtent.top</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>688</span> </span><span class="NAME">extent.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>689</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoomChanged</span><span class="PUNC">=</span><span class="NAME">forceZoomChange</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.isValidZoomLevel</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">!=</span><span class="NAME">this.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centerChanged</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.isValidLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">lonlat.equals</span><span class="PUNC">(</span><span class="NAME">this.center</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoomChanged</span><span class="PUNC">||</span><span class="NAME">centerChanged</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.dragging</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">noEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"movestart"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>690</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">centerChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">zoomChanged</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.center</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.centerLayerContainer</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>691</span> </span><span class="NAME">this.center</span><span class="PUNC">=</span><span class="NAME">lonlat.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>692</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">zoomChanged</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.layerContainerOrigin</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layerContainerOrigin</span><span class="PUNC">=</span><span class="NAME">this.center.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layerContainerDiv.style.left</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="NAME">this.layerContainerDiv.style.top</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>693</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoomChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoom</span><span class="PUNC">=</span><span class="NAME">zoom</span><span class="PUNC">;</span><span class="NAME">this.resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolutionForZoom</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.viewRequestID</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>694</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">this.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer.visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.baseLayer.moveTo</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.baseLayer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"move"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.baseLayer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"zoomChanged"</span><span class="PUNC">:</span><span class="NAME">zoomChanged</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>695</span> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">!==</span><span class="NAME">this.baseLayer</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">layer.isBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inRange</span><span class="PUNC">=</span><span class="NAME">layer.calculateInRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layer.inRange</span><span class="PUNC">!=</span><span class="NAME">inRange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.inRange</span><span class="PUNC">=</span><span class="NAME">inRange</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">inRange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.display</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>696</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="STRN">"visibility"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>697</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">inRange</span><span class="PUNC">&&</span><span class="NAME">layer.visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.moveTo</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"move"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"zoomChanged"</span><span class="PUNC">:</span><span class="NAME">zoomChanged</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>698</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoomChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.popups.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.popups</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">updatePosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>699</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"move"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoomChanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"zoomend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>700</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dragging</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">noEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>701</span> </span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">dragging</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">centerLayerContainer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originPx</span><span class="PUNC">=</span><span class="NAME">this.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.layerContainerOrigin</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPx</span><span class="PUNC">=</span><span class="NAME">this.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">originPx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">newPx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layerContainerDiv.style.left</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">originPx.x</span><span class="PUNC">-</span><span class="NAME">newPx.x</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.layerContainerDiv.style.top</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">originPx.y</span><span class="PUNC">-</span><span class="NAME">newPx.y</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isValidZoomLevel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">zoomLevel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">zoomLevel</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">zoomLevel</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">zoomLevel</span><span class="PUNC">&lt;</span><span class="NAME">this.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isValidLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valid</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.getMaxExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">valid</span><span class="PUNC">=</span><span class="NAME">maxExtent.containsLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>702</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">valid</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getProjection</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">projection</span><span class="PUNC">=</span><span class="NAME">this.getProjectionObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">projection</span><span class="PUNC">?</span><span class="NAME">projection.getCode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getProjectionObject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">projection</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">projection</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.projection</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>703</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">projection</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getMaxResolution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.maxResolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>704</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getMaxExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.restricted</span><span class="PUNC">&&</span><span class="NAME">this.restrictedExtent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.restrictedExtent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.maxExtent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>705</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNumZoomLevels</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numZoomLevels</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">numZoomLevels</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.numZoomLevels</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>706</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">numZoomLevels</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>707</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getResolution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.allOverlays</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">&&</span><span class="NAME">this.layers.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>708</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getUnits</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">units</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">units</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.units</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>709</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">units</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getScale</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">units</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.units</span><span class="PUNC">;</span><span class="NAME">scale</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getScaleFromResolution</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">,</span><span class="NAME">units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>710</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZoomForExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getZoomForExtent</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>711</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getResolutionForZoom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getResolutionForZoom</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>712</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZoomForResolution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getZoomForResolution</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>713</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isValidZoomLevel</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomIn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomTo</span><span class="PUNC">(</span><span class="NAME">this.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomTo</span><span class="PUNC">(</span><span class="NAME">this.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomToExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">bounds.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer.wrapDateLine</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.getMaxExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">bounds.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">bounds.right</span><span class="PUNC">&lt;</span><span class="NAME">bounds.left</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">bounds.right</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">maxExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>714</span> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">bounds.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">wrapDateLine</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>715</span> </span><span class="NAME">this.setCenter</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="NAME">this.getZoomForExtent</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomToMaxExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">restricted</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">options.restricted</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.getMaxExtent</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'restricted'</span><span class="PUNC">:</span><span class="NAME">restricted</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomToExtent</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomToScale</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">this.baseLayer.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w_deg</span><span class="PUNC">=</span><span class="NAME">size.w</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h_deg</span><span class="PUNC">=</span><span class="NAME">size.h</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">center.lon</span><span class="PUNC">-</span><span class="NAME">w_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">-</span><span class="NAME">h_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">center.lon</span><span class="PUNC">+</span><span class="NAME">w_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">+</span><span class="NAME">h_deg</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomToExtent</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLonLatFromViewPortPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>716</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getViewPortPxFromLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.baseLayer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.baseLayer.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>717</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLonLatFromPixel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getPixelFromLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px.x</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">px.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px.y</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">px.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeodesicPixelSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">px</span><span class="PUNC">?</span><span class="NAME">this.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">res</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">res</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">lonlat.add</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">res</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dest</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">=</span><span class="NAME">this.getProjectionObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">dest</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">source.equals</span><span class="PUNC">(</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">left.transform</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">right.transform</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bottom.transform</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">top.transform</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>718</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.distVincenty</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Util.distVincenty</span><span class="PUNC">(</span><span class="NAME">bottom</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getViewPortPxFromLayerPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layerPx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewPortPx</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layerPx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dX</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.layerContainerDiv.style.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dY</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.layerContainerDiv.style.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">viewPortPx</span><span class="PUNC">=</span><span class="NAME">layerPx.add</span><span class="PUNC">(</span><span class="NAME">dX</span><span class="PUNC">,</span><span class="NAME">dY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>719</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">viewPortPx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayerPxFromViewPortPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerPx</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dX</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.layerContainerDiv.style.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dY</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.layerContainerDiv.style.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layerPx</span><span class="PUNC">=</span><span class="NAME">viewPortPx.add</span><span class="PUNC">(</span><span class="NAME">dX</span><span class="PUNC">,</span><span class="NAME">dY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">layerPx.x</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">layerPx.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layerPx</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>720</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">layerPx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLonLatFromLayerPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.getViewPortPxFromLayerPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLayerPxFromLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.getPixelFromLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getLayerPxFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Map"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Map.TILE_WIDTH</span><span class="PUNC">=</span><span class="NUMB">256</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Map.TILE_HEIGHT</span><span class="PUNC">=</span><span class="NUMB">256</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Marker</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">icon</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newIcon</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">icon</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Marker.defaultIcon</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.icon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon</span><span class="PUNC">=</span><span class="NAME">newIcon</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.icon.url</span><span class="PUNC">=</span><span class="NAME">newIcon.url</span><span class="PUNC">;</span><span class="NAME">this.icon.size</span><span class="PUNC">=</span><span class="NAME">newIcon.size</span><span class="PUNC">;</span><span class="NAME">this.icon.offset</span><span class="PUNC">=</span><span class="NAME">newIcon.offset</span><span class="PUNC">;</span><span class="NAME">this.icon.calculateOffset</span><span class="PUNC">=</span><span class="NAME">newIcon.calculateOffset</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>721</span> </span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.icon.imageDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.erase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.events.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.icon</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.icon</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.icon.draw</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">erase</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.icon</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon.erase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.icon</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon.moveTo</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>722</span> </span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromLayerPx</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isDrawn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isDrawn</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.icon</span><span class="PUNC">&&</span><span class="NAME">this.icon.isDrawn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">isDrawn</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onScreen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenBounds</span><span class="PUNC">=</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="NAME">screenBounds.containsLonLat</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>723</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">onScreen</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">inflate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inflate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.icon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newSize</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">this.icon.size.w</span><span class="PUNC">*</span><span class="NAME">inflate</span><span class="PUNC">,</span><span class="NAME">this.icon.size.h</span><span class="PUNC">*</span><span class="NAME">inflate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.icon.setSize</span><span class="PUNC">(</span><span class="NAME">newSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon.setOpacity</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setUrl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon.setUrl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">display</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.icon.display</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Marker"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Marker.defaultIcon</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"marker.png"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">21</span><span class="PUNC">,</span><span class="NUMB">25</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">calculateOffset</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">size.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Icon</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">calculateOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.FramedCloud</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Popup.Framed</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">contentDisplayClass</span><span class="PUNC">:</span><span class="STRN">"olFramedCloudPopupContent"</span><span class="PUNC">,</span><span class="NAME">autoSize</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">panMapIfOutOfView</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">imageSize</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">1276</span><span class="PUNC">,</span><span class="NUMB">736</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">isAlphaImage</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">fixedRelativePosition</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">positionBlocks</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"tl"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'offset'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">44</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'padding'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">40</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'blocks'</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">51</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="NUMB">19</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">631</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">632</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">81</span><span class="PUNC">,</span><span class="NUMB">35</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">688</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">"tr"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'offset'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">45</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'padding'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">40</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'blocks'</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">51</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="NUMB">19</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">631</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">19</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">631</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">81</span><span class="PUNC">,</span><span class="NUMB">35</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">215</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">687</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">"bl"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'offset'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">45</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'padding'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">40</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'blocks'</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">629</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">629</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">81</span><span class="PUNC">,</span><span class="NUMB">33</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">101</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">674</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">"br"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'offset'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">44</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'padding'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">40</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'blocks'</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="STRN">'auto'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="STRN">'auto'</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">629</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NUMB">21</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1238</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">629</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">81</span><span class="PUNC">,</span><span class="NUMB">33</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">311</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">674</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">minSize</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">105</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">maxSize</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">1200</span><span class="PUNC">,</span><span class="NUMB">660</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">contentSize</span><span class="PUNC">,</span><span class="NAME">contentHTML</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">,</span><span class="NAME">closeBoxCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imageSrc</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'cloud-popup-relative.png'</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Popup.Framed.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.contentDiv.className</span><span class="PUNC">=</span><span class="NAME">this.contentDisplayClass</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Popup.Framed.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Popup.FramedCloud"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Request</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">DEFAULT_CONFIG</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">:</span><span class="NAME">window.location.href</span><span class="PUNC">,</span><span class="NAME">async</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">user</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="NAME">password</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="NAME">params</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">proxy</span><span class="PUNC">:</span><span class="NAME">OpenLayers.ProxyHost</span><span class="PUNC">,</span><span class="NAME">headers</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">success</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">failure</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="STRN">"complete"</span><span class="PUNC">,</span><span class="STRN">"success"</span><span class="PUNC">,</span><span class="STRN">"failure"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">issue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultConfig</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">this.DEFAULT_CONFIG</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">proxy</span><span class="PUNC">:</span><span class="NAME">OpenLayers.ProxyHost</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="NAME">defaultConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">request</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">config.url</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">config.params</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">paramString</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getParameterString</span><span class="PUNC">(</span><span class="NAME">config.params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">paramString.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">separator</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">'&'</span><span class="PUNC">:</span><span class="STRN">'?'</span><span class="PUNC">;</span><span class="NAME">url</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">separator</span><span class="PUNC">+</span><span class="NAME">paramString</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>724</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">config.proxy</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">"http"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">config.proxy</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">config.proxy</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">config.proxy</span><span class="PUNC">+</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>725</span> </span><span class="NAME">request.open</span><span class="PUNC">(</span><span class="NAME">config.method</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">config.async</span><span class="PUNC">,</span><span class="NAME">config.user</span><span class="PUNC">,</span><span class="NAME">config.password</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">header</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">config.headers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">request.setRequestHeader</span><span class="PUNC">(</span><span class="NAME">header</span><span class="PUNC">,</span><span class="NAME">config.headers</span><span class="PUNC">[</span><span class="NAME">header</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>726</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">=</span><span class="NAME">this.events</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">request.onreadystatechange</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">request.readyState</span><span class="PUNC">==</span><span class="NAME">OpenLayers.Request.XMLHttpRequest.DONE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">proceed</span><span class="PUNC">=</span><span class="NAME">events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"complete"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">request</span><span class="PUNC">:</span><span class="NAME">request</span><span class="PUNC">,</span><span class="NAME">config</span><span class="PUNC">:</span><span class="NAME">config</span><span class="PUNC">,</span><span class="NAME">requestUrl</span><span class="PUNC">:</span><span class="NAME">url</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">proceed</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">self.runCallbacks</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">request</span><span class="PUNC">:</span><span class="NAME">request</span><span class="PUNC">,</span><span class="NAME">config</span><span class="PUNC">:</span><span class="NAME">config</span><span class="PUNC">,</span><span class="NAME">requestUrl</span><span class="PUNC">:</span><span class="NAME">url</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">config.async</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">request.send</span><span class="PUNC">(</span><span class="NAME">config.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">window.setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">request._aborted</span><span class="PUNC">!==</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">request.send</span><span class="PUNC">(</span><span class="NAME">config.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>727</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">request</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">runCallbacks</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">request</span><span class="PUNC">=</span><span class="NAME">options.request</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">options.config</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">complete</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">config.scope</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">config.callback</span><span class="PUNC">,</span><span class="NAME">config.scope</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">config.callback</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">success</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">config.success</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">success</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">config.scope</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">config.success</span><span class="PUNC">,</span><span class="NAME">config.scope</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">config.success</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>728</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">failure</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">config.failure</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">failure</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">config.scope</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">config.failure</span><span class="PUNC">,</span><span class="NAME">config.scope</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">config.failure</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>729</span> </span><span class="NAME">complete</span><span class="PUNC">(</span><span class="NAME">request</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">request.status</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">request.status</span><span class="PUNC">>=</span><span class="NUMB">200</span><span class="PUNC">&&</span><span class="NAME">request.status</span><span class="PUNC">&lt;</span><span class="NUMB">300</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"success"</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">success</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">success</span><span class="PUNC">(</span><span class="NAME">request</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>730</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">request.status</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">request.status</span><span class="PUNC">&lt;</span><span class="NUMB">200</span><span class="PUNC">||</span><span class="NAME">request.status</span><span class="PUNC">>=</span><span class="NUMB">300</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"failure"</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">failure</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">failure</span><span class="PUNC">(</span><span class="NAME">request</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">GET</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"GET"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.issue</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">POST</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"POST"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">config.headers</span><span class="PUNC">=</span><span class="NAME">config.headers</span><span class="PUNC">?</span><span class="NAME">config.headers</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="STRN">"CONTENT-TYPE"</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.upperCaseObject</span><span class="PUNC">(</span><span class="NAME">config.headers</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config.headers</span><span class="PUNC">[</span><span class="STRN">"Content-Type"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">"application/xml"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>731</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.issue</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">PUT</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"PUT"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">config.headers</span><span class="PUNC">=</span><span class="NAME">config.headers</span><span class="PUNC">?</span><span class="NAME">config.headers</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="STRN">"CONTENT-TYPE"</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.upperCaseObject</span><span class="PUNC">(</span><span class="NAME">config.headers</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config.headers</span><span class="PUNC">[</span><span class="STRN">"Content-Type"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="STRN">"application/xml"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>732</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.issue</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">DELETE</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"DELETE"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.issue</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">HEAD</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"HEAD"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.issue</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">OPTIONS</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">config</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">method</span><span class="PUNC">:</span><span class="STRN">"OPTIONS"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Request.issue</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Tile.Image</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Tile</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imgDiv</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">frame</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layerAlphaHack</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">isBackBuffer</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">isFirstDraw</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">backBufferTile</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Tile.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="NAME">this.frame</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.frame.style.overflow</span><span class="PUNC">=</span><span class="STRN">'hidden'</span><span class="PUNC">;</span><span class="NAME">this.frame.style.position</span><span class="PUNC">=</span><span class="STRN">'absolute'</span><span class="PUNC">;</span><span class="NAME">this.layerAlphaHack</span><span class="PUNC">=</span><span class="NAME">this.layer.alpha</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.alphaHack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layerAlphaHack</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.imgDiv.childNodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>733</span> </span><span class="NAME">OpenLayers.Event.stopObservingElement</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imgDiv.parentNode</span><span class="PUNC">==</span><span class="NAME">this.frame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.frame.removeChild</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.imgDiv.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> </span><span class="NAME">this.imgDiv.urls</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.imgDiv.src</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"blank.gif"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>735</span> </span><span class="NAME">this.imgDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.frame</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.frame.parentNode</span><span class="PUNC">==</span><span class="NAME">this.layer.div</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.div.removeChild</span><span class="PUNC">(</span><span class="NAME">this.frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>736</span> </span><span class="NAME">this.frame</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backBufferTile.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>737</span> </span><span class="NAME">this.layer.events.unregister</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.resetBackBuffer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Tile.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Tile.Image</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">,</span><span class="NAME">this.position</span><span class="PUNC">,</span><span class="NAME">this.bounds</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>738</span> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Tile.prototype.clone.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">obj.imgDiv</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">!=</span><span class="NAME">this.layer.map.baseLayer</span><span class="PUNC">&&</span><span class="NAME">this.layer.reproject</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="NAME">this.getBoundsFromBaseLayer</span><span class="PUNC">(</span><span class="NAME">this.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>739</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">drawTile</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Tile.prototype.draw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.layer.SUPPORTED_TRANSITIONS</span><span class="PUNC">,</span><span class="NAME">this.layer.transitionEffect</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">this.layer.singleTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drawTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.backBufferTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backBufferTile</span><span class="PUNC">=</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.isBackBuffer</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.events.register</span><span class="PUNC">(</span><span class="STRN">'loadend'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.resetBackBuffer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.events.register</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.resetBackBuffer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>740</span> </span><span class="NAME">this.startTransition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backBufferTile.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">drawTile</span><span class="PUNC">&&</span><span class="NAME">this.isFirstDraw</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.register</span><span class="PUNC">(</span><span class="STRN">'loadend'</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.showTile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.isFirstDraw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>741</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">drawTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>742</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isLoading</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"reload"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.isLoading</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadstart"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>743</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.renderTile</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resetBackBuffer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.showTile</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.isFirstDraw</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.layer.numLoadingTiles</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.isFirstDraw</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.layer.maxExtent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">withinMaxExtent</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">&&</span><span class="NAME">this.bounds.intersectsBounds</span><span class="PUNC">(</span><span class="NAME">maxExtent</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">withinMaxExtent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backBufferTile.position</span><span class="PUNC">=</span><span class="NAME">this.position</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.bounds</span><span class="PUNC">=</span><span class="NAME">this.bounds</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.size</span><span class="PUNC">=</span><span class="NAME">this.size</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.imageSize</span><span class="PUNC">=</span><span class="NAME">this.layer.getImageSize</span><span class="PUNC">(</span><span class="NAME">this.bounds</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">this.size</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.imageOffset</span><span class="PUNC">=</span><span class="NAME">this.layer.imageOffset</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.resolution</span><span class="PUNC">=</span><span class="NAME">this.layer.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.renderTile</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>744</span> </span><span class="NAME">this.backBufferTile.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">renderTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.initImgDiv</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>745</span> </span><span class="NAME">this.imgDiv.viewRequestID</span><span class="PUNC">=</span><span class="NAME">this.layer.map.viewRequestID</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.async</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.getURLasync</span><span class="PUNC">(</span><span class="NAME">this.bounds</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="STRN">"url"</span><span class="PUNC">,</span><span class="NAME">this.positionImage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.url</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imgDiv.urls</span><span class="PUNC">=</span><span class="NAME">this.layer.url.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>746</span> </span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">this.layer.getURL</span><span class="PUNC">(</span><span class="NAME">this.bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.positionImage</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>747</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">positionImage</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>748</span> </span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">this.frame</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.position</span><span class="PUNC">,</span><span class="NAME">this.size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imageSize</span><span class="PUNC">=</span><span class="NAME">this.layer.getImageSize</span><span class="PUNC">(</span><span class="NAME">this.bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layerAlphaHack</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyAlphaImageDiv</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imageSize</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imageSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.imgDiv.src</span><span class="PUNC">=</span><span class="NAME">this.url</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Tile.Image.useBlankTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imgDiv.src</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getImagesLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"blank.gif"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initImgDiv</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">=</span><span class="NAME">this.layer.imageOffset</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.layer.getImageSize</span><span class="PUNC">(</span><span class="NAME">this.bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layerAlphaHack</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imgDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createAlphaImageDiv</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"relative"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.imgDiv</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createImage</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">offset</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"relative"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>749</span> </span><span class="NAME">this.imgDiv.className</span><span class="PUNC">=</span><span class="STRN">'olTileImage'</span><span class="PUNC">;</span><span class="NAME">this.frame.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.isBackBuffer</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.frame.appendChild</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.div.appendChild</span><span class="PUNC">(</span><span class="NAME">this.frame</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.opacity</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.layer.opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>750</span> </span><span class="NAME">this.imgDiv.map</span><span class="PUNC">=</span><span class="NAME">this.layer.map</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onload</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isLoading</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.isLoading</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layerAlphaHack</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.imgDiv.childNodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">'load'</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">onload</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">,</span><span class="STRN">'load'</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">onload</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>751</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onerror</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.imgDiv._attempts</span><span class="PUNC">></span><span class="NAME">OpenLayers.IMAGE_RELOAD_ATTEMPTS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">onload.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">this.imgDiv</span><span class="PUNC">,</span><span class="STRN">"error"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">onerror</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">checkImgURL</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loaded</span><span class="PUNC">=</span><span class="NAME">this.layerAlphaHack</span><span class="PUNC">?</span><span class="NAME">this.imgDiv.firstChild.src</span><span class="PUNC">:</span><span class="NAME">this.imgDiv.src</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Util.isEquivalentUrl</span><span class="PUNC">(</span><span class="NAME">loaded</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">startTransition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.backBufferTile</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.backBufferTile.imgDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>752</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ratio</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile.resolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ratio</span><span class="PUNC">=</span><span class="NAME">this.backBufferTile.resolution</span><span class="PUNC">/</span><span class="NAME">this.layer.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>753</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ratio</span><span class="PUNC">!=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.transitionEffect</span><span class="PUNC">==</span><span class="STRN">'resize'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">upperLeft</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile.bounds.left</span><span class="PUNC">,</span><span class="NAME">this.backBufferTile.bounds.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile.size.w</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">,</span><span class="NAME">this.backBufferTile.size.h</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.layer.map.getLayerPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">upperLeft</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile.frame</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imageSize</span><span class="PUNC">=</span><span class="NAME">this.backBufferTile.imageSize</span><span class="PUNC">;</span><span class="NAME">imageSize</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">imageSize.w</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">,</span><span class="NAME">imageSize.h</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imageOffset</span><span class="PUNC">=</span><span class="NAME">this.backBufferTile.imageOffset</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">imageOffset</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">imageOffset</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">imageOffset.x</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">,</span><span class="NAME">imageOffset.y</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>754</span> </span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">this.backBufferTile.imgDiv</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imageOffset</span><span class="PUNC">,</span><span class="NAME">imageSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.backBufferTile.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.singleTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.backBufferTile.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.backBufferTile.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">show</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.frame.style.display</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.layer.SUPPORTED_TRANSITIONS</span><span class="PUNC">,</span><span class="NAME">this.layer.transitionEffect</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"gecko"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.frame.scrollLeft</span><span class="PUNC">=</span><span class="NAME">this.frame.scrollLeft</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">hide</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.frame.style.display</span><span class="PUNC">=</span><span class="STRN">'none'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Tile.Image"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Tile.Image.useBlankTile</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"safari"</span><span class="PUNC">||</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"opera"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Feature</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">marker</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">popupClass</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Popup.AnchoredBubble</span><span class="PUNC">,</span><span class="NAME">popup</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="NAME">layer</span><span class="PUNC">;</span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat</span><span class="PUNC">;</span><span class="NAME">this.data</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">data</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.layer.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.popup</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.map.removePopup</span><span class="PUNC">(</span><span class="NAME">this.popup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>755</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.marker</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.removeMarker</span><span class="PUNC">(</span><span class="NAME">this.marker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>756</span> </span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.data</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.marker</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.destroyMarker</span><span class="PUNC">(</span><span class="NAME">this.marker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.marker</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>757</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.popup</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.destroyPopup</span><span class="PUNC">(</span><span class="NAME">this.popup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.popup</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onScreen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.layer.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenBounds</span><span class="PUNC">=</span><span class="NAME">this.layer.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="NAME">screenBounds.containsLonLat</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>758</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">onScreen</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.marker</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Marker</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">,</span><span class="NAME">this.data.icon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>759</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.marker</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.marker.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createPopup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">closeBox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lonlat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_popup"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.marker</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.marker.icon</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.popup</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.popup</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">this.popupClass</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">this.lonlat</span><span class="PUNC">,</span><span class="NAME">this.data.popupSize</span><span class="PUNC">,</span><span class="NAME">this.data.popupContentHTML</span><span class="PUNC">,</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="NAME">closeBox</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>760</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.data.overflow</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.popup.contentDiv.style.overflow</span><span class="PUNC">=</span><span class="NAME">this.data.overflow</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>761</span> </span><span class="NAME">this.popup.feature</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>762</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.popup</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyPopup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.popup</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.popup.feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.popup.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.popup</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Feature"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.Click</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">delay</span><span class="PUNC">:</span><span class="NUMB">300</span><span class="PUNC">,</span><span class="NAME">single</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">'double'</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">pixelTolerance</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">stopSingle</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">stopDouble</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">timerId</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">down</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">rightclickTimerId</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.pixelTolerance</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.mousedown</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.down</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousedown</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">mouseup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.checkModifiers</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.control.handleRightClicks</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Event.isRightClick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">propagate</span><span class="PUNC">=</span><span class="NAME">this.rightclick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>763</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rightclick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.passesTolerance</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rightclickTimerId</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearTimer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">'dblrightclick'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.stopDouble</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clickEvent</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">'double'</span><span class="PUNC">]</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">'rightclick'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delayedRightCall</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.delayedRightCall</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">clickEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rightclickTimerId</span><span class="PUNC">=</span><span class="NAME">window.setTimeout</span><span class="PUNC">(</span><span class="NAME">delayedRightCall</span><span class="PUNC">,</span><span class="NAME">this.delay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>764</span> </span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.stopSingle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">delayedRightCall</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.rightclickTimerId</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">'rightclick'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>765</span> </span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.stopSingle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dblclick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.passesTolerance</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"double"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">'dblclick'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>766</span> </span><span class="NAME">this.clearTimer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>767</span> </span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.stopDouble</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">click</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.passesTolerance</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.timerId</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearTimer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clickEvent</span><span class="PUNC">=</span><span class="NAME">this.single</span><span class="PUNC">?</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.timerId</span><span class="PUNC">=</span><span class="NAME">window.setTimeout</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.delayedCall</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">clickEvent</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.delay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>768</span> </span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.stopSingle</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">passesTolerance</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">passes</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.pixelTolerance</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.down</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dpx</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.down.x</span><span class="PUNC">-</span><span class="NAME">evt.xy.x</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>769</span> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.down.y</span><span class="PUNC">-</span><span class="NAME">evt.xy.y</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dpx</span><span class="PUNC">></span><span class="NAME">this.pixelTolerance</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">passes</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>770</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">passes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clearTimer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.timerId</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.timerId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.timerId</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>771</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rightclickTimerId</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.rightclickTimerId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rightclickTimerId</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">delayedCall</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.timerId</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearTimer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.down</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>772</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.Click"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.Drag</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">started</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">stopDown</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">last</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">start</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">oldOnselectstart</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">interval</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">timeoutId</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">documentDrag</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">documentEvents</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">down</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">move</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">up</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">out</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousedown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.checkModifiers</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Event.isLeftClick</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.started</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.start</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="STRN">"olDragDown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.down</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"down"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt.xy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.oldOnselectstart</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.oldOnselectstart</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">document.onselectstart</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">document.onselectstart</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Function.True</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>773</span> </span><span class="NAME">document.onselectstart</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.False</span><span class="PUNC">;</span><span class="NAME">propagate</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">this.stopDown</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.started</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.start</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>774</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">propagate</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousemove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.started</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.timeoutId</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">evt.xy.x</span><span class="PUNC">!=</span><span class="NAME">this.last.x</span><span class="PUNC">||</span><span class="NAME">evt.xy.y</span><span class="PUNC">!=</span><span class="NAME">this.last.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.documentDrag</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">&&</span><span class="NAME">this.documentEvents</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">evt.element</span><span class="PUNC">===</span><span class="NAME">document</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.adjustXY</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.destroyDocumentEvents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>775</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.interval</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.timeoutId</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="NAME">this.removeTimeout</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.interval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>776</span> </span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.move</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"move"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt.xy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.oldOnselectstart</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.oldOnselectstart</span><span class="PUNC">=</span><span class="NAME">document.onselectstart</span><span class="PUNC">;</span><span class="NAME">document.onselectstart</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.False</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>777</span> </span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">this.evt.xy</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>778</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeTimeout</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.timeoutId</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mouseup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.started</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.documentDrag</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">&&</span><span class="NAME">this.documentEvents</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.adjustXY</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.destroyDocumentEvents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>779</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragged</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.start</span><span class="PUNC">!=</span><span class="NAME">this.last</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.started</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="STRN">"olDragDown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.up</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"up"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt.xy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dragged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"done"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt.xy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>780</span> </span><span class="NAME">document.onselectstart</span><span class="PUNC">=</span><span class="NAME">this.oldOnselectstart</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>781</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mouseout</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.started</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.mouseLeft</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">this.map.div</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.documentDrag</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.documentEvents</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">document</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">includeXY</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.documentEvents.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">mousemove</span><span class="PUNC">:</span><span class="NAME">this.mousemove</span><span class="PUNC">,</span><span class="NAME">mouseup</span><span class="PUNC">:</span><span class="NAME">this.mouseup</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">document.body</span><span class="PUNC">,</span><span class="STRN">"olDragDown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragged</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.start</span><span class="PUNC">!=</span><span class="NAME">this.last</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.started</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="STRN">"olDragDown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.out</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"out"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dragged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"done"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt.xy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>782</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.onselectstart</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.onselectstart</span><span class="PUNC">=</span><span class="NAME">this.oldOnselectstart</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>783</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">click</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.start</span><span class="PUNC">==</span><span class="NAME">this.last</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">activated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>784</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">activated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.started</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.dragging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.start</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="STRN">"olDragDown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>785</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">adjustXY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.pagePosition</span><span class="PUNC">(</span><span class="NAME">this.map.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.xy.x</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">evt.xy.y</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">pos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyDocumentEvents</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">document.body</span><span class="PUNC">,</span><span class="STRN">"olDragDown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.documentEvents.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.documentEvents</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.Drag"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.Feature</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">EVENTMAP</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'click'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'in'</span><span class="PUNC">:</span><span class="STRN">'click'</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">:</span><span class="STRN">'clickout'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'mousemove'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'in'</span><span class="PUNC">:</span><span class="STRN">'over'</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">:</span><span class="STRN">'out'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'dblclick'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'in'</span><span class="PUNC">:</span><span class="STRN">'dblclick'</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'mousedown'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'in'</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'mouseup'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'in'</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">lastFeature</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">down</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">up</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">clickTolerance</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NAME">geometryTypes</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">stopClick</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">stopDown</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">stopUp</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="NAME">layer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousedown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.down</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.handle</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NAME">this.stopDown</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mouseup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.up</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.handle</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NAME">this.stopUp</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">click</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.handle</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NAME">this.stopClick</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousemove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="STRN">'over'</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="STRN">'out'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>786</span> </span><span class="NAME">this.handle</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dblclick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">this.handle</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">geometryTypeMatches</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.geometryTypes</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.geometryTypes</span><span class="PUNC">,</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">handle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.feature.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>787</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">evt.type</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">handled</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">previouslyIn</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">click</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"click"</span><span class="PUNC">||</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"dblclick"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="NAME">this.layer.getFeatureFromEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.feature.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>788</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastFeature</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.lastFeature.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.lastFeature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>789</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inNew</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">!=</span><span class="NAME">this.lastFeature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.geometryTypeMatches</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">previouslyIn</span><span class="PUNC">&&</span><span class="NAME">inNew</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastFeature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.triggerCallback</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.lastFeature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>790</span> </span><span class="NAME">this.triggerCallback</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'in'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.feature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">previouslyIn</span><span class="PUNC">||</span><span class="NAME">click</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.triggerCallback</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'in'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.feature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>791</span> </span><span class="NAME">this.lastFeature</span><span class="PUNC">=</span><span class="NAME">this.feature</span><span class="PUNC">;</span><span class="NAME">handled</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastFeature</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">previouslyIn</span><span class="PUNC">&&</span><span class="NAME">inNew</span><span class="PUNC">||</span><span class="NAME">click</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.triggerCallback</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.lastFeature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>792</span> </span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastFeature</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">previouslyIn</span><span class="PUNC">||</span><span class="NAME">click</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.triggerCallback</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'out'</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.lastFeature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>793</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">handled</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">triggerCallback</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">mode</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="NAME">this.EVENTMAP</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">mode</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">'click'</span><span class="PUNC">&&</span><span class="NAME">this.up</span><span class="PUNC">&&</span><span class="NAME">this.down</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dpx</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.up.x</span><span class="PUNC">-</span><span class="NAME">this.down.x</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>794</span> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.up.y</span><span class="PUNC">-</span><span class="NAME">this.down.y</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dpx</span><span class="PUNC">&lt;=</span><span class="NAME">this.clickTolerance</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.moveLayerToTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"removelayer"</span><span class="PUNC">:</span><span class="NAME">this.handleMapEvents</span><span class="PUNC">,</span><span class="STRN">"changelayer"</span><span class="PUNC">:</span><span class="NAME">this.handleMapEvents</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">activated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>795</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">activated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.moveLayerBack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.lastFeature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.down</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.up</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.map.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"removelayer"</span><span class="PUNC">:</span><span class="NAME">this.handleMapEvents</span><span class="PUNC">,</span><span class="STRN">"changelayer"</span><span class="PUNC">:</span><span class="NAME">this.handleMapEvents</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>796</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">handleMapEvents</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">evt.property</span><span class="PUNC">||</span><span class="NAME">evt.property</span><span class="PUNC">==</span><span class="STRN">"order"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.moveLayerToTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveLayerToTop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.map.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="STRN">'Feature'</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">this.layer.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.layer.setZIndex</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveLayerBack</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">this.layer.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">>=</span><span class="NAME">this.map.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="STRN">'Feature'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.setZIndex</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.map.setLayerZIndex</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">,</span><span class="NAME">this.map.getLayerIndex</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.Feature"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.MouseWheel</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">wheelListener</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">mousePosition</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">interval</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">delta</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">cumulative</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.wheelListener</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.bindAsEventListener</span><span class="PUNC">(</span><span class="NAME">this.onWheelEvent</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.wheelListener</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onWheelEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.map</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.checkModifiers</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>797</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overScrollableDiv</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overLayerDiv</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overMapDiv</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Event.element</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">overMapDiv</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">overScrollableDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">overScrollableDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elem.currentStyle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">overflow</span><span class="PUNC">=</span><span class="NAME">elem.currentStyle</span><span class="PUNC">[</span><span class="STRN">"overflow"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">document.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">overflow</span><span class="PUNC">=</span><span class="NAME">style.getPropertyValue</span><span class="PUNC">(</span><span class="STRN">"overflow"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>798</span> </span><span class="NAME">overScrollableDiv</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">overflow</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">overflow</span><span class="PUNC">==</span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">overflow</span><span class="PUNC">==</span><span class="STRN">"scroll"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>799</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">overLayerDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.map.layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">==</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">div</span><span class="PUNC">||</span><span class="NAME">elem</span><span class="PUNC">==</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pane</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">overLayerDiv</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>800</span> </span><span class="NAME">overMapDiv</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">==</span><span class="NAME">this.map.div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">elem</span><span class="PUNC">=</span><span class="NAME">elem.parentNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>801</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">overScrollableDiv</span><span class="PUNC">&&</span><span class="NAME">overMapDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">overLayerDiv</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">window.event</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>802</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e.wheelDelta</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">delta</span><span class="PUNC">=</span><span class="NAME">e.wheelDelta</span><span class="PUNC">/</span><span class="NUMB">120</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.opera</span><span class="PUNC">&&</span><span class="NAME">window.opera.version</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">9.2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">delta</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">delta</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e.detail</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">delta</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">e.detail</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>803</span> </span><span class="NAME">this.delta</span><span class="PUNC">=</span><span class="NAME">this.delta</span><span class="PUNC">+</span><span class="NAME">delta</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.interval</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.clearTimeout</span><span class="PUNC">(</span><span class="NAME">this._timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._timeoutId</span><span class="PUNC">=</span><span class="NAME">window.setTimeout</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Function.bind</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.wheelZoom</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.interval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.wheelZoom</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>804</span> </span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wheelZoom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="PUNC">=</span><span class="NAME">this.delta</span><span class="PUNC">;</span><span class="NAME">this.delta</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">delta</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.mousePosition</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e.xy</span><span class="PUNC">=</span><span class="NAME">this.mousePosition</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>805</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">e.xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e.xy</span><span class="PUNC">=</span><span class="NAME">this.map.getPixelFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.map.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>806</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">delta</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"down"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">this.cumulative</span><span class="PUNC">?</span><span class="NAME">delta</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"up"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">this.cumulative</span><span class="PUNC">?</span><span class="NAME">delta</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousemove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.mousePosition</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wheelListener</span><span class="PUNC">=</span><span class="NAME">this.wheelListener</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">"DOMMouseScroll"</span><span class="PUNC">,</span><span class="NAME">wheelListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">"mousewheel"</span><span class="PUNC">,</span><span class="NAME">wheelListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.observe</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"mousewheel"</span><span class="PUNC">,</span><span class="NAME">wheelListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wheelListener</span><span class="PUNC">=</span><span class="NAME">this.wheelListener</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">"DOMMouseScroll"</span><span class="PUNC">,</span><span class="NAME">wheelListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">,</span><span class="STRN">"mousewheel"</span><span class="PUNC">,</span><span class="NAME">wheelListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Event.stopObserving</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="STRN">"mousewheel"</span><span class="PUNC">,</span><span class="NAME">wheelListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.MouseWheel"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">div</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">alwaysInRange</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"loadstart"</span><span class="PUNC">,</span><span class="STRN">"loadend"</span><span class="PUNC">,</span><span class="STRN">"loadcancel"</span><span class="PUNC">,</span><span class="STRN">"visibilitychanged"</span><span class="PUNC">,</span><span class="STRN">"move"</span><span class="PUNC">,</span><span class="STRN">"moveend"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">RESOLUTION_PROPERTIES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">'scales'</span><span class="PUNC">,</span><span class="STRN">'resolutions'</span><span class="PUNC">,</span><span class="STRN">'maxScale'</span><span class="PUNC">,</span><span class="STRN">'minScale'</span><span class="PUNC">,</span><span class="STRN">'maxResolution'</span><span class="PUNC">,</span><span class="STRN">'minResolution'</span><span class="PUNC">,</span><span class="STRN">'numZoomLevels'</span><span class="PUNC">,</span><span class="STRN">'maxZoomLevel'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">displayInLayerSwitcher</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">inRange</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">imageSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">imageOffset</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">eventListeners</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">gutter</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">projection</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">units</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">scales</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">resolutions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxExtent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minExtent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxResolution</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minResolution</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">numZoomLevels</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minScale</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxScale</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">displayOutsideMaxExtent</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">wrapDateLine</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">transitionEffect</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">SUPPORTED_TRANSITIONS</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">'resize'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">metadata</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">name</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.style.width</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="NAME">this.div.style.height</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="NAME">this.div.dir</span><span class="PUNC">=</span><span class="STRN">"ltr"</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Events</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.on</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>807</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.wrapDateLine</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.displayOutsideMaxExtent</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>808</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.removeLayer</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">setNewBaseLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>809</span> </span><span class="NAME">this.projection</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.div</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.options</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.events</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.un</span><span class="PUNC">(</span><span class="NAME">this.eventListeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>810</span> </span><span class="NAME">this.events.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>811</span> </span><span class="NAME">this.eventListeners</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.events</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">this.getOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>812</span> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">obj.map</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getOptions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">o</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">o</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>813</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setName</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newName</span><span class="PUNC">!=</span><span class="NAME">this.name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.name</span><span class="PUNC">=</span><span class="NAME">newName</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="STRN">"name"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addOptions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>814</span> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">this.options</span><span class="PUNC">,</span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.projection</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.projection</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="NAME">this.projection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>815</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.projection</span><span class="PUNC">&&</span><span class="NAME">this.projection.getUnits</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.units</span><span class="PUNC">=</span><span class="NAME">this.projection.getUnits</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>816</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">=</span><span class="NAME">this.RESOLUTION_PROPERTIES.concat</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"projection"</span><span class="PUNC">,</span><span class="STRN">"units"</span><span class="PUNC">,</span><span class="STRN">"minExtent"</span><span class="PUNC">,</span><span class="STRN">"maxExtent"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newOptions.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">properties</span><span class="PUNC">,</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.initResolutions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onMapResize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">redrawn</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.inRange</span><span class="PUNC">=</span><span class="NAME">this.calculateInRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">&&</span><span class="NAME">this.inRange</span><span class="PUNC">&&</span><span class="NAME">this.visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoomChanged</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.moveTo</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"zoomChanged"</span><span class="PUNC">:</span><span class="NAME">zoomChanged</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">redrawn</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>817</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">redrawn</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">display</span><span class="PUNC">=</span><span class="NAME">this.visibility</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">display</span><span class="PUNC">=</span><span class="NAME">display</span><span class="PUNC">&&</span><span class="NAME">this.inRange</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>818</span> </span><span class="NAME">this.display</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">;</span><span class="NAME">this.maxExtent</span><span class="PUNC">=</span><span class="NAME">this.maxExtent</span><span class="PUNC">||</span><span class="NAME">this.map.maxExtent</span><span class="PUNC">;</span><span class="NAME">this.minExtent</span><span class="PUNC">=</span><span class="NAME">this.minExtent</span><span class="PUNC">||</span><span class="NAME">this.map.minExtent</span><span class="PUNC">;</span><span class="NAME">this.projection</span><span class="PUNC">=</span><span class="NAME">this.projection</span><span class="PUNC">||</span><span class="NAME">this.map.projection</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.projection</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.projection</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="NAME">this.projection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>819</span> </span><span class="NAME">this.units</span><span class="PUNC">=</span><span class="NAME">this.projection.getUnits</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">this.units</span><span class="PUNC">||</span><span class="NAME">this.map.units</span><span class="PUNC">;</span><span class="NAME">this.initResolutions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.inRange</span><span class="PUNC">=</span><span class="NAME">this.calculateInRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">show</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.visibility</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.inRange</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.style.display</span><span class="PUNC">=</span><span class="NAME">show</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>820</span> </span><span class="NAME">this.setTileSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">afterAdd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getImageSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.imageSize</span><span class="PUNC">||</span><span class="NAME">this.tileSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setTileSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileSize</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">size</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.tileSize</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.tileSize</span><span class="PUNC">:</span><span class="NAME">this.map.getTileSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.tileSize</span><span class="PUNC">=</span><span class="NAME">tileSize</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.gutter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.imageOffset</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">this.gutter</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">this.gutter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.imageSize</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NAME">tileSize.w</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">this.gutter</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">tileSize.h</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">this.gutter</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVisibility</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.visibility</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setVisibility</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">visibility</span><span class="PUNC">!=</span><span class="NAME">this.visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.visibility</span><span class="PUNC">=</span><span class="NAME">visibility</span><span class="PUNC">;</span><span class="NAME">this.display</span><span class="PUNC">(</span><span class="NAME">visibility</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="STRN">"visibility"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>821</span> </span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"visibilitychanged"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">display</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">!=</span><span class="PUNC">(</span><span class="NAME">this.div.style.display</span><span class="PUNC">!=</span><span class="STRN">"none"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.display</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">&&</span><span class="NAME">this.calculateInRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"block"</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateInRange</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inRange</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.alwaysInRange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inRange</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">inRange</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">>=</span><span class="NAME">this.minResolution</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">&lt;=</span><span class="NAME">this.maxResolution</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>822</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">inRange</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setIsBaseLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">isBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isBaseLayer</span><span class="PUNC">!=</span><span class="NAME">this.isBaseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.isBaseLayer</span><span class="PUNC">=</span><span class="NAME">isBaseLayer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changebaselayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initResolutions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">alwaysInRange</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.RESOLUTION_PROPERTIES.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">this.RESOLUTION_PROPERTIES</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this.options</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">alwaysInRange</span><span class="PUNC">&&</span><span class="NAME">this.options</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">alwaysInRange</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>823</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.alwaysInRange</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.alwaysInRange</span><span class="PUNC">=</span><span class="NAME">alwaysInRange</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>824</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.resolutions</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">props.resolutions</span><span class="PUNC">=</span><span class="NAME">this.resolutionsFromScales</span><span class="PUNC">(</span><span class="NAME">props.scales</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>825</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.resolutions</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">props.resolutions</span><span class="PUNC">=</span><span class="NAME">this.calculateResolutions</span><span class="PUNC">(</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>826</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.resolutions</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.RESOLUTION_PROPERTIES.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">this.RESOLUTION_PROPERTIES</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this.options</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">this.options</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">this.map</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>827</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.resolutions</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">props.resolutions</span><span class="PUNC">=</span><span class="NAME">this.resolutionsFromScales</span><span class="PUNC">(</span><span class="NAME">props.scales</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>828</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.resolutions</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">props.resolutions</span><span class="PUNC">=</span><span class="NAME">this.calculateResolutions</span><span class="PUNC">(</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>829</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.maxResolution</span><span class="PUNC">&&</span><span class="NAME">this.options.maxResolution</span><span class="PUNC">!==</span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">this.options.maxResolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>830</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.minScale</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">this.options.minScale</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>831</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minResolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.minResolution</span><span class="PUNC">&&</span><span class="NAME">this.options.minResolution</span><span class="PUNC">!==</span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">minResolution</span><span class="PUNC">=</span><span class="NAME">this.options.minResolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>832</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.maxScale</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">minResolution</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">this.options.maxScale</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>833</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.resolutions</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">props.resolutions.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">maxResolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">props.resolutions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>834</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">minResolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastIdx</span><span class="PUNC">=</span><span class="NAME">props.resolutions.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">minResolution</span><span class="PUNC">=</span><span class="NAME">props.resolutions</span><span class="PUNC">[</span><span class="NAME">lastIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>835</span> </span><span class="NAME">this.resolutions</span><span class="PUNC">=</span><span class="NAME">props.resolutions</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.resolutions</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.resolutions.length</span><span class="PUNC">;</span><span class="NAME">this.scales</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.scales</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getScaleFromResolution</span><span class="PUNC">(</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>836</span> </span><span class="NAME">this.numZoomLevels</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>837</span> </span><span class="NAME">this.minResolution</span><span class="PUNC">=</span><span class="NAME">minResolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">minResolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.maxScale</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getScaleFromResolution</span><span class="PUNC">(</span><span class="NAME">minResolution</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>838</span> </span><span class="NAME">this.maxResolution</span><span class="PUNC">=</span><span class="NAME">maxResolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">maxResolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.minScale</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getScaleFromResolution</span><span class="PUNC">(</span><span class="NAME">maxResolution</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resolutionsFromScales</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scales</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">scales</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>839</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolutions</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">scales.length</span><span class="PUNC">;</span><span class="NAME">resolutions</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolutions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">scales</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>840</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resolutions</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateResolutions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">props.maxResolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.minScale</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">props.minScale</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">maxResolution</span><span class="PUNC">==</span><span class="STRN">"auto"</span><span class="PUNC">&&</span><span class="NAME">this.maxExtent</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewSize</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wRes</span><span class="PUNC">=</span><span class="NAME">this.maxExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">viewSize.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hRes</span><span class="PUNC">=</span><span class="NAME">this.maxExtent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">viewSize.h</span><span class="PUNC">;</span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">wRes</span><span class="PUNC">,</span><span class="NAME">hRes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>841</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minResolution</span><span class="PUNC">=</span><span class="NAME">props.minResolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.maxScale</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">minResolution</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getResolutionFromScale</span><span class="PUNC">(</span><span class="NAME">props.maxScale</span><span class="PUNC">,</span><span class="NAME">this.units</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">props.minResolution</span><span class="PUNC">==</span><span class="STRN">"auto"</span><span class="PUNC">&&</span><span class="NAME">this.minExtent</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewSize</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wRes</span><span class="PUNC">=</span><span class="NAME">this.minExtent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">viewSize.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hRes</span><span class="PUNC">=</span><span class="NAME">this.minExtent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">viewSize.h</span><span class="PUNC">;</span><span class="NAME">minResolution</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">wRes</span><span class="PUNC">,</span><span class="NAME">hRes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>842</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxZoomLevel</span><span class="PUNC">=</span><span class="NAME">props.maxZoomLevel</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numZoomLevels</span><span class="PUNC">=</span><span class="NAME">props.numZoomLevels</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">minResolution</span><span class="PUNC">===</span><span class="STRN">"number"</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">===</span><span class="STRN">"number"</span><span class="PUNC">&&</span><span class="NAME">numZoomLevels</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ratio</span><span class="PUNC">=</span><span class="NAME">maxResolution</span><span class="PUNC">/</span><span class="NAME">minResolution</span><span class="PUNC">;</span><span class="NAME">numZoomLevels</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">Math.log</span><span class="PUNC">(</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">Math.log</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">numZoomLevels</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">&&</span><span class="NAME">maxZoomLevel</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">numZoomLevels</span><span class="PUNC">=</span><span class="NAME">maxZoomLevel</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>843</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">numZoomLevels</span><span class="PUNC">!==</span><span class="STRN">"number"</span><span class="PUNC">||</span><span class="NAME">numZoomLevels</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">!==</span><span class="STRN">"number"</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">minResolution</span><span class="PUNC">!==</span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>844</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolutions</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">numZoomLevels</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">minResolution</span><span class="PUNC">==</span><span class="STRN">"number"</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">==</span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">base</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">maxResolution</span><span class="PUNC">/</span><span class="NAME">minResolution</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">numZoomLevels</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>845</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">===</span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numZoomLevels</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolutions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">maxResolution</span><span class="PUNC">/</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numZoomLevels</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">resolutions</span><span class="PUNC">[</span><span class="NAME">numZoomLevels</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">minResolution</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>846</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resolutions</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getResolution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getResolutionForZoom</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.map.calculateBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZoomForExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewSize</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idealResolution</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">extent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">viewSize.w</span><span class="PUNC">,</span><span class="NAME">extent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">viewSize.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getZoomForResolution</span><span class="PUNC">(</span><span class="NAME">idealResolution</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getDataExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getResolutionForZoom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">,</span><span class="NAME">this.resolutions.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map.fractionalZoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">high</span><span class="PUNC">=</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">low</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>847</span> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">-</span><span class="NAME">low</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">low</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">high</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>848</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZoomForResolution</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">resolution</span><span class="PUNC">,</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map.fractionalZoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lowZoom</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">highZoom</span><span class="PUNC">=</span><span class="NAME">this.resolutions.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">highRes</span><span class="PUNC">=</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">lowZoom</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lowRes</span><span class="PUNC">=</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">highZoom</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.resolutions.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">>=</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">highRes</span><span class="PUNC">=</span><span class="NAME">res</span><span class="PUNC">;</span><span class="NAME">lowZoom</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>849</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">&lt;=</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lowRes</span><span class="PUNC">=</span><span class="NAME">res</span><span class="PUNC">;</span><span class="NAME">highZoom</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>850</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dRes</span><span class="PUNC">=</span><span class="NAME">highRes</span><span class="PUNC">-</span><span class="NAME">lowRes</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dRes</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">lowZoom</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">highRes</span><span class="PUNC">-</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">dRes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">lowZoom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minDiff</span><span class="PUNC">=</span><span class="NAME">Number.POSITIVE_INFINITY</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.resolutions.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">diff</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">diff</span><span class="PUNC">></span><span class="NAME">minDiff</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>851</span> </span><span class="NAME">minDiff</span><span class="PUNC">=</span><span class="NAME">diff</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.resolutions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>852</span> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>853</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLonLatFromViewPortPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.map.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta_x</span><span class="PUNC">=</span><span class="NAME">viewPortPx.x</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta_y</span><span class="PUNC">=</span><span class="NAME">viewPortPx.y</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">size.h</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">center.lon</span><span class="PUNC">+</span><span class="NAME">delta_x</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">-</span><span class="NAME">delta_y</span><span class="PUNC">*</span><span class="NAME">res</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.wrapDateLine</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">lonlat.wrapDateLine</span><span class="PUNC">(</span><span class="NAME">this.maxExtent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>854</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getViewPortPxFromLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">px</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">-</span><span class="NAME">extent.left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">extent.top</span><span class="PUNC">-</span><span class="NAME">lonlat.lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>855</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">!=</span><span class="NAME">this.opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.opacity</span><span class="PUNC">=</span><span class="NAME">opacity</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.div.childNodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">=</span><span class="NAME">this.div.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.modifyDOMElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>856</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="STRN">"opacity"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getZIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.div.style.zIndex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setZIndex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">zIndex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.style.zIndex</span><span class="PUNC">=</span><span class="NAME">zIndex</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">adjustBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.gutter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mapGutter</span><span class="PUNC">=</span><span class="NAME">this.gutter</span><span class="PUNC">*</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">-</span><span class="NAME">mapGutter</span><span class="PUNC">,</span><span class="NAME">bounds.bottom</span><span class="PUNC">-</span><span class="NAME">mapGutter</span><span class="PUNC">,</span><span class="NAME">bounds.right</span><span class="PUNC">+</span><span class="NAME">mapGutter</span><span class="PUNC">,</span><span class="NAME">bounds.top</span><span class="PUNC">+</span><span class="NAME">mapGutter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>857</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.wrapDateLine</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wrappingOptions</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'rightTolerance'</span><span class="PUNC">:</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">bounds.wrapDateLine</span><span class="PUNC">(</span><span class="NAME">this.maxExtent</span><span class="PUNC">,</span><span class="NAME">wrappingOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>858</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oXMLHttpRequest</span><span class="PUNC">=</span><span class="NAME">window.XMLHttpRequest</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bGecko</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">window.controllers</span><span class="PUNC">,</span><span class="NAME">bIE</span><span class="PUNC">=</span><span class="NAME">window.document.all</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">window.opera</span><span class="PUNC">,</span><span class="NAME">bIE7</span><span class="PUNC">=</span><span class="NAME">bIE</span><span class="PUNC">&&</span><span class="NAME">window.navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/MSIE ([\.0-9]+)/</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">RegExp.$1</span><span class="PUNC">==</span><span class="NUMB">7</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">cXMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._object</span><span class="PUNC">=</span><span class="NAME">oXMLHttpRequest</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">bIE7</span><span class="PUNC">?</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">oXMLHttpRequest</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window.ActiveXObject</span><span class="PUNC">(</span><span class="STRN">"Microsoft.XMLHTTP"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._listeners</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bGecko</span><span class="PUNC">&&</span><span class="NAME">oXMLHttpRequest.wrapped</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>859</span> </span><span class="NAME">cXMLHttpRequest.wrapped</span><span class="PUNC">=</span><span class="NAME">oXMLHttpRequest.wrapped</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.UNSENT</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.OPENED</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.HEADERS_RECEIVED</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.LOADING</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.DONE</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.readyState</span><span class="PUNC">=</span><span class="NAME">cXMLHttpRequest.UNSENT</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.responseText</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.responseXML</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.status</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.statusText</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.onreadystatechange</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.onreadystatechange</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.onopen</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.onsend</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.onabort</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.open</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sMethod</span><span class="PUNC">,</span><span class="NAME">sUrl</span><span class="PUNC">,</span><span class="NAME">bAsync</span><span class="PUNC">,</span><span class="NAME">sUser</span><span class="PUNC">,</span><span class="NAME">sPassword</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._headers</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>860</span> </span><span class="NAME">bAsync</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this._async</span><span class="PUNC">=</span><span class="NAME">bAsync</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oRequest</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">nState</span><span class="PUNC">=</span><span class="NAME">this.readyState</span><span class="PUNC">,</span><span class="NAME">fOnUnload</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bIE</span><span class="PUNC">&&</span><span class="NAME">bAsync</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fOnUnload</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nState</span><span class="PUNC">!=</span><span class="NAME">cXMLHttpRequest.DONE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fCleanTransport</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">oRequest.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.attachEvent</span><span class="PUNC">(</span><span class="STRN">"onunload"</span><span class="PUNC">,</span><span class="NAME">fOnUnload</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>861</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cXMLHttpRequest.onopen</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>862</span> </span><span class="NAME">cXMLHttpRequest.onopen.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>863</span> </span><span class="NAME">this._object.open</span><span class="PUNC">(</span><span class="NAME">sMethod</span><span class="PUNC">,</span><span class="NAME">sUrl</span><span class="PUNC">,</span><span class="NAME">bAsync</span><span class="PUNC">,</span><span class="NAME">sUser</span><span class="PUNC">,</span><span class="NAME">sPassword</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>864</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>865</span> </span><span class="NAME">this._object.open</span><span class="PUNC">(</span><span class="NAME">sMethod</span><span class="PUNC">,</span><span class="NAME">sUrl</span><span class="PUNC">,</span><span class="NAME">bAsync</span><span class="PUNC">,</span><span class="NAME">sUser</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>866</span> </span><span class="NAME">this._object.open</span><span class="PUNC">(</span><span class="NAME">sMethod</span><span class="PUNC">,</span><span class="NAME">sUrl</span><span class="PUNC">,</span><span class="NAME">bAsync</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bGecko</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">bIE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.readyState</span><span class="PUNC">=</span><span class="NAME">cXMLHttpRequest.OPENED</span><span class="PUNC">;</span><span class="NAME">fReadyStateChange</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>867</span> </span><span class="NAME">this._object.onreadystatechange</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bGecko</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">bAsync</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>868</span> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">oRequest.readyState</span><span class="PUNC">=</span><span class="NAME">oRequest._object.readyState</span><span class="PUNC">;</span><span class="NAME">fSynchronizeValues</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oRequest._aborted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">oRequest.readyState</span><span class="PUNC">=</span><span class="NAME">cXMLHttpRequest.UNSENT</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>869</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oRequest.readyState</span><span class="PUNC">==</span><span class="NAME">cXMLHttpRequest.DONE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fCleanTransport</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bIE</span><span class="PUNC">&&</span><span class="NAME">bAsync</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>870</span> </span><span class="NAME">window.detachEvent</span><span class="PUNC">(</span><span class="STRN">"onunload"</span><span class="PUNC">,</span><span class="NAME">fOnUnload</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>871</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nState</span><span class="PUNC">!=</span><span class="NAME">oRequest.readyState</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>872</span> </span><span class="NAME">fReadyStateChange</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">nState</span><span class="PUNC">=</span><span class="NAME">oRequest.readyState</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.send</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vData</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cXMLHttpRequest.onsend</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>873</span> </span><span class="NAME">cXMLHttpRequest.onsend.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">vData</span><span class="PUNC">&&</span><span class="NAME">vData.nodeType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vData</span><span class="PUNC">=</span><span class="NAME">window.XMLSerializer</span><span class="PUNC">?</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window.XMLSerializer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">serializeToString</span><span class="PUNC">(</span><span class="NAME">vData</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">vData.xml</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._headers</span><span class="PUNC">[</span><span class="STRN">"Content-Type"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>874</span> </span><span class="NAME">this._object.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">"Content-Type"</span><span class="PUNC">,</span><span class="STRN">"application/xml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>875</span> </span><span class="NAME">this._object.send</span><span class="PUNC">(</span><span class="NAME">vData</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bGecko</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this._async</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.readyState</span><span class="PUNC">=</span><span class="NAME">cXMLHttpRequest.OPENED</span><span class="PUNC">;</span><span class="NAME">fSynchronizeValues</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">this.readyState</span><span class="PUNC">&lt;</span><span class="NAME">cXMLHttpRequest.DONE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.readyState</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="NAME">fReadyStateChange</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._aborted</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>876</span> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.abort</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cXMLHttpRequest.onabort</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>877</span> </span><span class="NAME">cXMLHttpRequest.onabort.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.readyState</span><span class="PUNC">></span><span class="NAME">cXMLHttpRequest.UNSENT</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>878</span> </span><span class="NAME">this._aborted</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this._object.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">fCleanTransport</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.getAllResponseHeaders</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._object.getAllResponseHeaders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.getResponseHeader</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._object.getResponseHeader</span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.setRequestHeader</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">,</span><span class="NAME">sValue</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._headers</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>879</span> </span><span class="NAME">this._headers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this._headers</span><span class="PUNC">[</span><span class="NAME">sName</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">sValue</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._object.setRequestHeader</span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">,</span><span class="NAME">sValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.addEventListener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">,</span><span class="NAME">fHandler</span><span class="PUNC">,</span><span class="NAME">bUseCapture</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">oListener</span><span class="PUNC">;</span><span class="NAME">oListener</span><span class="PUNC">=</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">nIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">nIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>880</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">sName</span><span class="PUNC">&&</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">fHandler</span><span class="PUNC">&&</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">bUseCapture</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>881</span> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="NAME">this._listeners.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">sName</span><span class="PUNC">,</span><span class="NAME">fHandler</span><span class="PUNC">,</span><span class="NAME">bUseCapture</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.removeEventListener</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">,</span><span class="NAME">fHandler</span><span class="PUNC">,</span><span class="NAME">bUseCapture</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">oListener</span><span class="PUNC">;</span><span class="NAME">oListener</span><span class="PUNC">=</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">nIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">nIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>882</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">sName</span><span class="PUNC">&&</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">fHandler</span><span class="PUNC">&&</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">bUseCapture</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>883</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oListener</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>884</span> </span><span class="NAME">this._listeners.splice</span><span class="PUNC">(</span><span class="NAME">nIndex</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.dispatchEvent</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oEventPseudo</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'type'</span><span class="PUNC">:</span><span class="NAME">oEvent.type</span><span class="PUNC">,</span><span class="STRN">'target'</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="STRN">'currentTarget'</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="STRN">'eventPhase'</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">'bubbles'</span><span class="PUNC">:</span><span class="NAME">oEvent.bubbles</span><span class="PUNC">,</span><span class="STRN">'cancelable'</span><span class="PUNC">:</span><span class="NAME">oEvent.cancelable</span><span class="PUNC">,</span><span class="STRN">'timeStamp'</span><span class="PUNC">:</span><span class="NAME">oEvent.timeStamp</span><span class="PUNC">,</span><span class="STRN">'stopPropagation'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'preventDefault'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'initEvent'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oEventPseudo.type</span><span class="PUNC">==</span><span class="STRN">"readystatechange"</span><span class="PUNC">&&</span><span class="NAME">this.onreadystatechange</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>885</span> </span><span class="PUNC">(</span><span class="NAME">this.onreadystatechange.handleEvent</span><span class="PUNC">||</span><span class="NAME">this.onreadystatechange</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">oEventPseudo</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nIndex</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">oListener</span><span class="PUNC">;</span><span class="NAME">oListener</span><span class="PUNC">=</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">nIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">nIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>886</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">oEventPseudo.type</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>887</span> </span><span class="PUNC">(</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">handleEvent</span><span class="PUNC">||</span><span class="NAME">oListener</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">oEventPseudo</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.prototype.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">'['</span><span class="PUNC">+</span><span class="STRN">"object"</span><span class="PUNC">+</span><span class="STRN">' '</span><span class="PUNC">+</span><span class="STRN">"XMLHttpRequest"</span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">cXMLHttpRequest.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">'['</span><span class="PUNC">+</span><span class="STRN">"XMLHttpRequest"</span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">fReadyStateChange</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cXMLHttpRequest.onreadystatechange</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>888</span> </span><span class="NAME">cXMLHttpRequest.onreadystatechange.apply</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">oRequest.dispatchEvent</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'type'</span><span class="PUNC">:</span><span class="STRN">"readystatechange"</span><span class="PUNC">,</span><span class="STRN">'bubbles'</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="STRN">'cancelable'</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="STRN">'timeStamp'</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">fGetDocument</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDocument</span><span class="PUNC">=</span><span class="NAME">oRequest.responseXML</span><span class="PUNC">,</span><span class="NAME">sResponse</span><span class="PUNC">=</span><span class="NAME">oRequest.responseText</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bIE</span><span class="PUNC">&&</span><span class="NAME">sResponse</span><span class="PUNC">&&</span><span class="NAME">oDocument</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">oDocument.documentElement</span><span class="PUNC">&&</span><span class="NAME">oRequest.getResponseHeader</span><span class="PUNC">(</span><span class="STRN">"Content-Type"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/[^\/]+\/[^\+]+\+xml/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">oDocument</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window.ActiveXObject</span><span class="PUNC">(</span><span class="STRN">"Microsoft.XMLDOM"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">oDocument.async</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">oDocument.validateOnParse</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">oDocument.loadXML</span><span class="PUNC">(</span><span class="NAME">sResponse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>889</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDocument</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>890</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bIE</span><span class="PUNC">&&</span><span class="NAME">oDocument.parseError</span><span class="PUNC">!=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">oDocument.documentElement</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">oDocument.documentElement</span><span class="PUNC">&&</span><span class="NAME">oDocument.documentElement.tagName</span><span class="PUNC">==</span><span class="STRN">"parsererror"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>891</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oDocument</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">fSynchronizeValues</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">oRequest.responseText</span><span class="PUNC">=</span><span class="NAME">oRequest._object.responseText</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>892</span> </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">oRequest.responseXML</span><span class="PUNC">=</span><span class="NAME">fGetDocument</span><span class="PUNC">(</span><span class="NAME">oRequest._object</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>893</span> </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">oRequest.status</span><span class="PUNC">=</span><span class="NAME">oRequest._object.status</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>894</span> </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">oRequest.statusText</span><span class="PUNC">=</span><span class="NAME">oRequest._object.statusText</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">fCleanTransport</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">oRequest._object.onreadystatechange</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window.Function</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.Function.prototype.apply</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.Function.prototype.apply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oRequest</span><span class="PUNC">,</span><span class="NAME">oArguments</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oArguments</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>895</span> </span><span class="NAME">oArguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">oRequest.__func</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">oRequest.__func</span><span class="PUNC">(</span><span class="NAME">oArguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">oArguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">oArguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">oArguments</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">oArguments</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">oRequest.__func</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Request.XMLHttpRequest</span><span class="PUNC">=</span><span class="NAME">cXMLHttpRequest</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.DragPan</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Control.TYPE_TOOL</span><span class="PUNC">,</span><span class="NAME">panned</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">interval</span><span class="PUNC">:</span><span class="NUMB">25</span><span class="PUNC">,</span><span class="NAME">documentDrag</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handler</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Drag</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"move"</span><span class="PUNC">:</span><span class="NAME">this.panMap</span><span class="PUNC">,</span><span class="STRN">"done"</span><span class="PUNC">:</span><span class="NAME">this.panMapDone</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">interval</span><span class="PUNC">:</span><span class="NAME">this.interval</span><span class="PUNC">,</span><span class="NAME">documentDrag</span><span class="PUNC">:</span><span class="NAME">this.documentDrag</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">panMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panned</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.map.pan</span><span class="PUNC">(</span><span class="NAME">this.handler.last.x</span><span class="PUNC">-</span><span class="NAME">xy.x</span><span class="PUNC">,</span><span class="NAME">this.handler.last.y</span><span class="PUNC">-</span><span class="NAME">xy.y</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dragging</span><span class="PUNC">:</span><span class="NAME">this.handler.dragging</span><span class="PUNC">,</span><span class="NAME">animate</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">panMapDone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.panned</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.panMap</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.panned</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.DragPan"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.State</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">UNKNOWN</span><span class="PUNC">:</span><span class="STRN">'Unknown'</span><span class="PUNC">,</span><span class="NAME">INSERT</span><span class="PUNC">:</span><span class="STRN">'Insert'</span><span class="PUNC">,</span><span class="NAME">UPDATE</span><span class="PUNC">:</span><span class="STRN">'Update'</span><span class="PUNC">,</span><span class="NAME">DELETE</span><span class="PUNC">:</span><span class="STRN">'Delete'</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">fid</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">attributes</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">state</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">renderIntent</span><span class="PUNC">:</span><span class="STRN">"default"</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">attributes</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Feature.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">attributes</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.lonlat</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.geometry</span><span class="PUNC">=</span><span class="NAME">geometry</span><span class="PUNC">?</span><span class="NAME">geometry</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.state</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.attributes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.attributes</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">,</span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>896</span> </span><span class="NAME">this.style</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">?</span><span class="NAME">style</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.removeFeatures</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>897</span> </span><span class="NAME">this.geometry</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Feature.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="NAME">this.geometry</span><span class="PUNC">?</span><span class="NAME">this.geometry.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.attributes</span><span class="PUNC">,</span><span class="NAME">this.style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onScreen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">boundsOnly</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">&&</span><span class="NAME">this.layer.map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenBounds</span><span class="PUNC">=</span><span class="NAME">this.layer.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">boundsOnly</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureBounds</span><span class="PUNC">=</span><span class="NAME">this.geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="NAME">screenBounds.intersectsBounds</span><span class="PUNC">(</span><span class="NAME">featureBounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenPoly</span><span class="PUNC">=</span><span class="NAME">screenBounds.toGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">onScreen</span><span class="PUNC">=</span><span class="NAME">screenPoly.intersects</span><span class="PUNC">(</span><span class="NAME">this.geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>898</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">onScreen</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVisibility</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.style</span><span class="PUNC">&&</span><span class="NAME">this.style.display</span><span class="PUNC">==</span><span class="STRN">'none'</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.layer</span><span class="PUNC">||</span><span class="NAME">this.layer</span><span class="PUNC">&&</span><span class="NAME">this.layer.styleMap</span><span class="PUNC">&&</span><span class="NAME">this.layer.styleMap.createSymbolizer</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.renderIntent</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">display</span><span class="PUNC">==</span><span class="STRN">'none'</span><span class="PUNC">||</span><span class="NAME">this.layer</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.layer.getVisibility</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createPopup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">atPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">toleranceLon</span><span class="PUNC">,</span><span class="NAME">toleranceLat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">atPoint</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">atPoint</span><span class="PUNC">=</span><span class="NAME">this.geometry.atPoint</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">toleranceLon</span><span class="PUNC">,</span><span class="NAME">toleranceLat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>899</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">atPoint</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyPopup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">move</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.layer</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.geometry.move</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>900</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">location.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.LonLat"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">this.layer.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">location</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>901</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastPixel</span><span class="PUNC">=</span><span class="NAME">this.layer.getViewPortPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">this.geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.layer.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.geometry.move</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">pixel.x</span><span class="PUNC">-</span><span class="NAME">lastPixel.x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">res</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">lastPixel.y</span><span class="PUNC">-</span><span class="NAME">pixel.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.drawFeature</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastPixel</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toState</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">==</span><span class="NAME">OpenLayers.State.UPDATE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.UNKNOWN</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.DELETE</span><span class="PUNC">:</span><span class="NAME">this.state</span><span class="PUNC">=</span><span class="NAME">state</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.UPDATE</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.INSERT</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">==</span><span class="NAME">OpenLayers.State.INSERT</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.UNKNOWN</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="NAME">this.state</span><span class="PUNC">=</span><span class="NAME">state</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">==</span><span class="NAME">OpenLayers.State.DELETE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this.state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.INSERT</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.DELETE</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.UNKNOWN</span><span class="PUNC">:</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.UPDATE</span><span class="PUNC">:</span><span class="NAME">this.state</span><span class="PUNC">=</span><span class="NAME">state</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">==</span><span class="NAME">OpenLayers.State.UNKNOWN</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.state</span><span class="PUNC">=</span><span class="NAME">state</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Feature.Vector"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'default'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="STRN">"#ee9900"</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NAME">hoverFillColor</span><span class="PUNC">:</span><span class="STRN">"white"</span><span class="PUNC">,</span><span class="NAME">hoverFillOpacity</span><span class="PUNC">:</span><span class="NUMB">0.8</span><span class="PUNC">,</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="STRN">"#ee9900"</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="STRN">"round"</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="STRN">"solid"</span><span class="PUNC">,</span><span class="NAME">hoverStrokeColor</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NAME">hoverStrokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">hoverStrokeWidth</span><span class="PUNC">:</span><span class="NUMB">0.2</span><span class="PUNC">,</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NAME">hoverPointRadius</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">hoverPointUnit</span><span class="PUNC">:</span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="NAME">pointerEvents</span><span class="PUNC">:</span><span class="STRN">"visiblePainted"</span><span class="PUNC">,</span><span class="NAME">cursor</span><span class="PUNC">:</span><span class="STRN">"inherit"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'select'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NAME">hoverFillColor</span><span class="PUNC">:</span><span class="STRN">"white"</span><span class="PUNC">,</span><span class="NAME">hoverFillOpacity</span><span class="PUNC">:</span><span class="NUMB">0.8</span><span class="PUNC">,</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="STRN">"round"</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="STRN">"solid"</span><span class="PUNC">,</span><span class="NAME">hoverStrokeColor</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NAME">hoverStrokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">hoverStrokeWidth</span><span class="PUNC">:</span><span class="NUMB">0.2</span><span class="PUNC">,</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NAME">hoverPointRadius</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">hoverPointUnit</span><span class="PUNC">:</span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="NAME">pointerEvents</span><span class="PUNC">:</span><span class="STRN">"visiblePainted"</span><span class="PUNC">,</span><span class="NAME">cursor</span><span class="PUNC">:</span><span class="STRN">"pointer"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'temporary'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="STRN">"#66cccc"</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="NUMB">0.2</span><span class="PUNC">,</span><span class="NAME">hoverFillColor</span><span class="PUNC">:</span><span class="STRN">"white"</span><span class="PUNC">,</span><span class="NAME">hoverFillOpacity</span><span class="PUNC">:</span><span class="NUMB">0.8</span><span class="PUNC">,</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="STRN">"#66cccc"</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="STRN">"round"</span><span class="PUNC">,</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="STRN">"solid"</span><span class="PUNC">,</span><span class="NAME">hoverStrokeColor</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NAME">hoverStrokeOpacity</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">hoverStrokeWidth</span><span class="PUNC">:</span><span class="NUMB">0.2</span><span class="PUNC">,</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NAME">hoverPointRadius</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">hoverPointUnit</span><span class="PUNC">:</span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="NAME">pointerEvents</span><span class="PUNC">:</span><span class="STRN">"visiblePainted"</span><span class="PUNC">,</span><span class="NAME">cursor</span><span class="PUNC">:</span><span class="STRN">"inherit"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'delete'</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">display</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.Box</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dragHandler</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">boxDivClassName</span><span class="PUNC">:</span><span class="STRN">'olHandlerBoxZoomBox'</span><span class="PUNC">,</span><span class="NAME">boxCharacteristics</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callbacks</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"down"</span><span class="PUNC">:</span><span class="NAME">this.startBox</span><span class="PUNC">,</span><span class="STRN">"move"</span><span class="PUNC">:</span><span class="NAME">this.moveBox</span><span class="PUNC">,</span><span class="STRN">"out"</span><span class="PUNC">:</span><span class="NAME">this.removeBox</span><span class="PUNC">,</span><span class="STRN">"up"</span><span class="PUNC">:</span><span class="NAME">this.endBox</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.dragHandler</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Drag</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">keyMask</span><span class="PUNC">:</span><span class="NAME">this.keyMask</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.dragHandler</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragHandler.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dragHandler</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>902</span> </span><span class="NAME">OpenLayers.Handler.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Handler.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.dragHandler</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragHandler.setMap</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">startBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createDiv</span><span class="PUNC">(</span><span class="STRN">'zoomBox'</span><span class="PUNC">,</span><span class="NAME">this.dragHandler.start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.className</span><span class="PUNC">=</span><span class="NAME">this.boxDivClassName</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.style.zIndex</span><span class="PUNC">=</span><span class="NAME">this.map.Z_INDEX_BASE</span><span class="PUNC">[</span><span class="STRN">"Popup"</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.map.viewPortDiv.appendChild</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.addClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="STRN">"olDrawBox"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startX</span><span class="PUNC">=</span><span class="NAME">this.dragHandler.start.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startY</span><span class="PUNC">=</span><span class="NAME">this.dragHandler.start.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaX</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">startX</span><span class="PUNC">-</span><span class="NAME">xy.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaY</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">startY</span><span class="PUNC">-</span><span class="NAME">xy.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.style.width</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">deltaX</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.style.height</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">deltaY</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.style.left</span><span class="PUNC">=</span><span class="NAME">xy.x</span><span class="PUNC">&lt;</span><span class="NAME">startX</span><span class="PUNC">?</span><span class="NAME">xy.x</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">:</span><span class="NAME">startX</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.style.top</span><span class="PUNC">=</span><span class="NAME">xy.y</span><span class="PUNC">&lt;</span><span class="NAME">startY</span><span class="PUNC">?</span><span class="NAME">xy.y</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">:</span><span class="NAME">startY</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">box</span><span class="PUNC">=</span><span class="NAME">this.getBoxCharacteristics</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">box.newBoxModel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xy.x</span><span class="PUNC">></span><span class="NAME">startX</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox.style.width</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">deltaX</span><span class="PUNC">-</span><span class="NAME">box.xOffset</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>903</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xy.y</span><span class="PUNC">></span><span class="NAME">startY</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox.style.height</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">deltaY</span><span class="PUNC">-</span><span class="NAME">box.yOffset</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">endBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.dragHandler.start.x</span><span class="PUNC">-</span><span class="NAME">end.x</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">5</span><span class="PUNC">||</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.dragHandler.start.y</span><span class="PUNC">-</span><span class="NAME">end.y</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">=</span><span class="NAME">this.dragHandler.start</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">start.y</span><span class="PUNC">,</span><span class="NAME">end.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">start.y</span><span class="PUNC">,</span><span class="NAME">end.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">start.x</span><span class="PUNC">,</span><span class="NAME">end.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">start.x</span><span class="PUNC">,</span><span class="NAME">end.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">this.dragHandler.start.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>904</span> </span><span class="NAME">this.removeBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"done"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">result</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.viewPortDiv.removeChild</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomBox</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.boxCharacteristics</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Element.removeClass</span><span class="PUNC">(</span><span class="NAME">this.map.viewPortDiv</span><span class="PUNC">,</span><span class="STRN">"olDrawBox"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragHandler.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragHandler.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getBoxCharacteristics</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.boxCharacteristics</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xOffset</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">,</span><span class="STRN">"border-left-width"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">,</span><span class="STRN">"border-right-width"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yOffset</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">,</span><span class="STRN">"border-top-width"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Element.getStyle</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">,</span><span class="STRN">"border-bottom-width"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newBoxModel</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getBrowserName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"msie"</span><span class="PUNC">?</span><span class="NAME">document.compatMode</span><span class="PUNC">!=</span><span class="STRN">"BackCompat"</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.boxCharacteristics</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">xOffset</span><span class="PUNC">:</span><span class="NAME">xOffset</span><span class="PUNC">,</span><span class="NAME">yOffset</span><span class="PUNC">:</span><span class="NAME">yOffset</span><span class="PUNC">,</span><span class="NAME">newBoxModel</span><span class="PUNC">:</span><span class="NAME">newBoxModel</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>905</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.boxCharacteristics</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.Box"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.RegularPolygon</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.Drag</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">sides</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NAME">radius</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">snapAngle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">snapToggle</span><span class="PUNC">:</span><span class="STRN">'shiftKey'</span><span class="PUNC">,</span><span class="NAME">layerOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">persist</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">irregular</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">angle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">fixedRadius</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.layerOptions</span><span class="PUNC">&&</span><span class="NAME">options.layerOptions.styleMap</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.style</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>906</span> </span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.options</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">options</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOptions</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">this.options</span><span class="PUNC">,</span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">displayInLayerSwitcher</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">calculateInRange</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Function.True</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.layerOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.addLayer</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">activated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>907</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">activated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler.Drag.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.cancel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>908</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.destroy</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.feature.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>909</span> </span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">deactivated</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>910</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">deactivated</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">down</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.fixedRadius</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.radius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maploc</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">maploc.lon</span><span class="PUNC">,</span><span class="NAME">maploc.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fixedRadius</span><span class="PUNC">||</span><span class="NAME">this.irregular</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.radius</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>911</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.persist</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>912</span> </span><span class="NAME">this.feature</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.createGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"create"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.origin</span><span class="PUNC">,</span><span class="NAME">this.feature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.addFeatures</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.feature</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">silent</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.drawFeature</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">,</span><span class="NAME">this.style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">move</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maploc</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">maploc.lon</span><span class="PUNC">,</span><span class="NAME">maploc.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.irregular</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ry</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">point.y</span><span class="PUNC">-</span><span class="NAME">this.origin.y</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">this.radius</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">ry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.fixedRadius</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="NAME">point</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.calculateAngle</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.radius</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">point.distanceTo</span><span class="PUNC">(</span><span class="NAME">this.origin</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>913</span> </span><span class="NAME">this.modifyGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.irregular</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">=</span><span class="NAME">point.x</span><span class="PUNC">-</span><span class="NAME">this.origin.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">point.y</span><span class="PUNC">-</span><span class="NAME">this.origin.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ratio</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dy</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ratio</span><span class="PUNC">=</span><span class="NAME">dx</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">this.radius</span><span class="PUNC">*</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">ratio</span><span class="PUNC">=</span><span class="NAME">dx</span><span class="PUNC">/</span><span class="NAME">dy</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>914</span> </span><span class="NAME">this.feature.geometry.resize</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">this.origin</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.feature.geometry.move</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>915</span> </span><span class="NAME">this.layer.drawFeature</span><span class="PUNC">(</span><span class="NAME">this.feature</span><span class="PUNC">,</span><span class="NAME">this.style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">up</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.finalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.start</span><span class="PUNC">==</span><span class="NAME">this.last</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"done"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">evt.xy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">out</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.finalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.angle</span><span class="PUNC">=</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">this.sides</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.snapAngle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.angle</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.snapAngle</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>916</span> </span><span class="NAME">this.feature.geometry</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.Polygon.createRegularPolygon</span><span class="PUNC">(</span><span class="NAME">this.origin</span><span class="PUNC">,</span><span class="NAME">this.radius</span><span class="PUNC">,</span><span class="NAME">this.sides</span><span class="PUNC">,</span><span class="NAME">this.snapAngle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">modifyGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">=</span><span class="NAME">this.feature.geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ring.components.length</span><span class="PUNC">!=</span><span class="PUNC">(</span><span class="NAME">this.sides</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.createGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">ring</span><span class="PUNC">=</span><span class="NAME">this.feature.geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>917</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.sides</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">ring.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">this.angle</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NAME">this.sides</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point.x</span><span class="PUNC">=</span><span class="NAME">this.origin.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this.radius</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point.y</span><span class="PUNC">=</span><span class="NAME">this.origin.y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this.radius</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateAngle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alpha</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">point.y</span><span class="PUNC">-</span><span class="NAME">this.origin.y</span><span class="PUNC">,</span><span class="NAME">point.x</span><span class="PUNC">-</span><span class="NAME">this.origin.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.snapAngle</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.snapToggle</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">evt</span><span class="PUNC">[</span><span class="NAME">this.snapToggle</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">snapAngleRad</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.snapAngle</span><span class="PUNC">;</span><span class="NAME">this.angle</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">alpha</span><span class="PUNC">/</span><span class="NAME">snapAngleRad</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">snapAngleRad</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.angle</span><span class="PUNC">=</span><span class="NAME">alpha</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">cancel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"cancel"</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.finalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">finalize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.radius</span><span class="PUNC">=</span><span class="NAME">this.options.radius</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.renderer.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.destroyFeatures</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.callbacks</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">this.control</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.feature.geometry.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>918</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.persist</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">"done"</span><span class="PUNC">||</span><span class="NAME">name</span><span class="PUNC">==</span><span class="STRN">"cancel"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.RegularPolygon"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.HTTPRequest</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">URL_HASH_FACTOR</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">params</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">reproject</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">params</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newArguments</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">;</span><span class="NAME">newArguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newArguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="NAME">this.params</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.params</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.HTTPRequest</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.params</span><span class="PUNC">,</span><span class="NAME">this.getOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>919</span> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.prototype.clone.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setUrl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newUrl</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">newUrl</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mergeNewParams</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newParams</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.params</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">this.params</span><span class="PUNC">,</span><span class="NAME">newParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="STRN">"params"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>920</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">redraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">force</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">force</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.mergeNewParams</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"_olSalt"</span><span class="PUNC">:</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.prototype.redraw.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">selectUrl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">paramString</span><span class="PUNC">,</span><span class="NAME">urls</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">product</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">paramString.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">product</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">paramString.charCodeAt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.URL_HASH_FACTOR</span><span class="PUNC">;</span><span class="NAME">product</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">product</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>921</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">urls</span><span class="PUNC">[</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">product</span><span class="PUNC">*</span><span class="NAME">urls.length</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFullRequestString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newParams</span><span class="PUNC">,</span><span class="NAME">altUrl</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">altUrl</span><span class="PUNC">||</span><span class="NAME">this.url</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allParams</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">allParams</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">allParams</span><span class="PUNC">,</span><span class="NAME">newParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">paramsString</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getParameterString</span><span class="PUNC">(</span><span class="NAME">allParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">url</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">this.selectUrl</span><span class="PUNC">(</span><span class="NAME">paramsString</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>922</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">urlParams</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.upperCaseObject</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">allParams</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">key.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">urlParams</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">allParams</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>923</span> </span><span class="NAME">paramsString</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.getParameterString</span><span class="PUNC">(</span><span class="NAME">allParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.urlAppend</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">paramsString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.HTTPRequest"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Markers</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">markers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">drawn</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.markers</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearMarkers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.markers</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setOpacity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">!=</span><span class="NAME">this.opacity</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.opacity</span><span class="PUNC">=</span><span class="NAME">opacity</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.markers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.markers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setOpacity</span><span class="PUNC">(</span><span class="NAME">this.opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.prototype.moveTo.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zoomChanged</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.drawn</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.markers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawMarker</span><span class="PUNC">(</span><span class="NAME">this.markers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>924</span> </span><span class="NAME">this.drawn</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">marker</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.markers.push</span><span class="PUNC">(</span><span class="NAME">marker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.opacity</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">marker.setOpacity</span><span class="PUNC">(</span><span class="NAME">this.opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>925</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">&&</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">marker.map</span><span class="PUNC">=</span><span class="NAME">this.map</span><span class="PUNC">;</span><span class="NAME">this.drawMarker</span><span class="PUNC">(</span><span class="NAME">marker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">marker</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.markers</span><span class="PUNC">&&</span><span class="NAME">this.markers.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.markers</span><span class="PUNC">,</span><span class="NAME">marker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">marker.erase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clearMarkers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.markers</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">this.markers.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.removeMarker</span><span class="PUNC">(</span><span class="NAME">this.markers</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawMarker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">marker</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.map.getLayerPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">marker.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">marker.display</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">marker.isDrawn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">markerImg</span><span class="PUNC">=</span><span class="NAME">marker.draw</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.div.appendChild</span><span class="PUNC">(</span><span class="NAME">markerImg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">marker.icon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">marker.icon.moveTo</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getDataExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.markers</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.markers.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.markers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">marker</span><span class="PUNC">=</span><span class="NAME">this.markers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">maxExtent.extend</span><span class="PUNC">(</span><span class="NAME">marker.lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>926</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.Markers"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.SphericalMercator</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">getExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.sphericalMercator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.map.calculateBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>927</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLonLatFromViewPortPx</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getViewPortPxFromLonLat</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initMercatorParameters</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.RESOLUTIONS</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxResolution</span><span class="PUNC">=</span><span class="NUMB">156543.0339</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">zoom</span><span class="PUNC">&lt;=</span><span class="NAME">this.MAX_ZOOM_LEVEL</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.RESOLUTIONS</span><span class="PUNC">[</span><span class="NAME">zoom</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">maxResolution</span><span class="PUNC">/</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>928</span> </span><span class="NAME">this.units</span><span class="PUNC">=</span><span class="STRN">"m"</span><span class="PUNC">;</span><span class="NAME">this.projection</span><span class="PUNC">=</span><span class="NAME">this.projection</span><span class="PUNC">||</span><span class="STRN">"EPSG:900913"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">forwardMercator</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">lon</span><span class="PUNC">*</span><span class="NUMB">20037508.34</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">Math.log</span><span class="PUNC">(</span><span class="NAME">Math.tan</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">90</span><span class="PUNC">+</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">360</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NUMB">20037508.34</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">inverseMercator</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lon</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">/</span><span class="NUMB">20037508.34</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lat</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">/</span><span class="NUMB">20037508.34</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="NAME">lat</span><span class="PUNC">=</span><span class="NUMB">180</span><span class="PUNC">/</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">Math.exp</span><span class="PUNC">(</span><span class="NAME">lat</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">projectForward</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.SphericalMercator.forwardMercator</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">,</span><span class="NAME">point.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point.x</span><span class="PUNC">=</span><span class="NAME">lonlat.lon</span><span class="PUNC">;</span><span class="NAME">point.y</span><span class="PUNC">=</span><span class="NAME">lonlat.lat</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">projectInverse</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.SphericalMercator.inverseMercator</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">,</span><span class="NAME">point.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point.x</span><span class="PUNC">=</span><span class="NAME">lonlat.lon</span><span class="PUNC">;</span><span class="NAME">point.y</span><span class="PUNC">=</span><span class="NAME">lonlat.lat</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Projection.addTransform</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">,</span><span class="STRN">"EPSG:900913"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Layer.SphericalMercator.projectForward</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Projection.addTransform</span><span class="PUNC">(</span><span class="STRN">"EPSG:900913"</span><span class="PUNC">,</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">,</span><span class="NAME">OpenLayers.Layer.SphericalMercator.projectInverse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"featureadded"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">multi</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">featureAdded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">handlerOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">handler</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control.prototype.EVENT_TYPES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callbacks</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">done</span><span class="PUNC">:</span><span class="NAME">this.drawFeature</span><span class="PUNC">,</span><span class="NAME">modify</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"sketchmodified"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">vertex</span><span class="PUNC">:</span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">create</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"sketchstarted"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">vertex</span><span class="PUNC">:</span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.callbacks</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="NAME">layer</span><span class="PUNC">;</span><span class="NAME">this.handlerOptions</span><span class="PUNC">=</span><span class="NAME">this.handlerOptions</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="STRN">"multi"</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.handlerOptions</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlerOptions.multi</span><span class="PUNC">=</span><span class="NAME">this.multi</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>929</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sketchStyle</span><span class="PUNC">=</span><span class="NAME">this.layer.styleMap</span><span class="PUNC">&&</span><span class="NAME">this.layer.styleMap.styles.temporary</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sketchStyle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlerOptions.layerOptions</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">this.handlerOptions.layerOptions</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">styleMap</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.StyleMap</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"default"</span><span class="PUNC">:</span><span class="NAME">sketchStyle</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>930</span> </span><span class="NAME">this.handler</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.callbacks</span><span class="PUNC">,</span><span class="NAME">this.handlerOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">proceed</span><span class="PUNC">=</span><span class="NAME">this.layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"sketchcomplete"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">proceed</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature.state</span><span class="PUNC">=</span><span class="NAME">OpenLayers.State.INSERT</span><span class="PUNC">;</span><span class="NAME">this.layer.addFeatures</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">feature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.featureAdded</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureadded"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.DrawFeature"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.ZoomBox</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Control.TYPE_TOOL</span><span class="PUNC">,</span><span class="NAME">out</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">alwaysZoom</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handler</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Box</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">done</span><span class="PUNC">:</span><span class="NAME">this.zoomBox</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">keyMask</span><span class="PUNC">:</span><span class="NAME">this.keyMask</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">zoomBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">position</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minXY</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="PUNC">,</span><span class="NAME">position.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxXY</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">position.right</span><span class="PUNC">,</span><span class="NAME">position.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">minXY.lon</span><span class="PUNC">,</span><span class="NAME">minXY.lat</span><span class="PUNC">,</span><span class="NAME">maxXY.lon</span><span class="PUNC">,</span><span class="NAME">maxXY.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixWidth</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">position.right</span><span class="PUNC">-</span><span class="NAME">position.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixHeight</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">position.top</span><span class="PUNC">-</span><span class="NAME">position.bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoomFactor</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.map.size.h</span><span class="PUNC">/</span><span class="NAME">pixHeight</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.map.size.w</span><span class="PUNC">/</span><span class="NAME">pixWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">position.getCenterPixel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmin</span><span class="PUNC">=</span><span class="NAME">center.lon</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">extent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">zoomFactor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmax</span><span class="PUNC">=</span><span class="NAME">center.lon</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">extent.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">zoomFactor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ymin</span><span class="PUNC">=</span><span class="NAME">center.lat</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">extent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">zoomFactor</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ymax</span><span class="PUNC">=</span><span class="NAME">center.lat</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">extent.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">zoomFactor</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">xmin</span><span class="PUNC">,</span><span class="NAME">ymin</span><span class="PUNC">,</span><span class="NAME">xmax</span><span class="PUNC">,</span><span class="NAME">ymax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>931</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastZoom</span><span class="PUNC">=</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.zoomToExtent</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lastZoom</span><span class="PUNC">==</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.alwaysZoom</span><span class="PUNC">==</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.zoomTo</span><span class="PUNC">(</span><span class="NAME">lastZoom</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this.out</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.setCenter</span><span class="PUNC">(</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.map.setCenter</span><span class="PUNC">(</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.ZoomBox"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.WKT</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Format</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.regExes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'typeStr'</span><span class="PUNC">:</span><span class="REGX">/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/</span><span class="PUNC">,</span><span class="STRN">'spaces'</span><span class="PUNC">:</span><span class="REGX">/\s+/</span><span class="PUNC">,</span><span class="STRN">'parenComma'</span><span class="PUNC">:</span><span class="REGX">/\)\s*,\s*\(/</span><span class="PUNC">,</span><span class="STRN">'doubleParenComma'</span><span class="PUNC">:</span><span class="REGX">/\)\s*\)\s*,\s*\(\s*\(/</span><span class="PUNC">,</span><span class="STRN">'trimParens'</span><span class="PUNC">:</span><span class="REGX">/^\s*\(?(.*?)\)?\s*$/</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">read</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">str</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matches</span><span class="PUNC">=</span><span class="NAME">this.regExes.typeStr.exec</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">matches</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">matches</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">matches</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.parse</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">this.parse</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">str</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>932</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">&&</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">&&</span><span class="NAME">features.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Feature.Vector"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features.geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.externalProjection</span><span class="PUNC">,</span><span class="NAME">this.internalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">&&</span><span class="NAME">type</span><span class="PUNC">!=</span><span class="STRN">"geometrycollection"</span><span class="PUNC">&&</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">component.geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.externalProjection</span><span class="PUNC">,</span><span class="NAME">this.internalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>933</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">write</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">collection</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">isCollection</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features.constructor</span><span class="PUNC">==</span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">collection</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">;</span><span class="NAME">isCollection</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">collection</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">isCollection</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>934</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pieces</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isCollection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pieces.push</span><span class="PUNC">(</span><span class="STRN">'GEOMETRYCOLLECTION('</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>935</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">collection.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isCollection</span><span class="PUNC">&&</span><span class="NAME">i</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pieces.push</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>936</span> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">collection</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">;</span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">geometry.CLASS_NAME.split</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.extract</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>937</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">&&</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">geometry.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">,</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>938</span> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">this.extract</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pieces.push</span><span class="PUNC">(</span><span class="NAME">type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'('</span><span class="PUNC">+</span><span class="NAME">data</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>939</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isCollection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pieces.push</span><span class="PUNC">(</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>940</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pieces.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">extract</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'point'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">point.x</span><span class="PUNC">+</span><span class="STRN">' '</span><span class="PUNC">+</span><span class="NAME">point.y</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'multipoint'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">multipoint</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">multipoint.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">array.push</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>941</span> </span><span class="NAME">this.extract.point.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">multipoint.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>942</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'linestring'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">linestring</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">linestring.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">array.push</span><span class="PUNC">(</span><span class="NAME">this.extract.point.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">linestring.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>943</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'multilinestring'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">multilinestring</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">multilinestring.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">array.push</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>944</span> </span><span class="NAME">this.extract.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">multilinestring.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>945</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'polygon'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">polygon.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">array.push</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>946</span> </span><span class="NAME">this.extract.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">polygon.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>947</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'multipolygon'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">multipolygon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">multipolygon.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">array.push</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>948</span> </span><span class="NAME">this.extract.polygon.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">multipolygon.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>949</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">array.join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">parse</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'point'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">this.regExes.spaces</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'multipoint'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">this.regExes.parenComma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimParens</span><span class="PUNC">,</span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">this.parse.point.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">point</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>950</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiPoint</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'linestring'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">this.parse.point.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>951</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'multilinestring'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lines</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">this.regExes.parenComma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">lines.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">line</span><span class="PUNC">=</span><span class="NAME">lines</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimParens</span><span class="PUNC">,</span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">this.parse.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">line</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>952</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'polygon'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">,</span><span class="NAME">linestring</span><span class="PUNC">,</span><span class="NAME">linearring</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">this.regExes.parenComma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">rings.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ring</span><span class="PUNC">=</span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimParens</span><span class="PUNC">,</span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">linestring</span><span class="PUNC">=</span><span class="NAME">this.parse.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">ring</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">;</span><span class="NAME">linearring</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">(</span><span class="NAME">linestring.components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">linearring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>953</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'multipolygon'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">polygons</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">this.regExes.doubleParenComma</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">polygons.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">polygon</span><span class="PUNC">=</span><span class="NAME">polygons</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimParens</span><span class="PUNC">,</span><span class="STRN">'$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">this.parse.polygon.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">polygon</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>954</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiPolygon</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="STRN">'geometrycollection'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/,\s*([A-Za-z])/g</span><span class="PUNC">,</span><span class="STRN">'|$1'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wktArray</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'|'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">wktArray.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Format.WKT.prototype.read.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">wktArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>955</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Format.WKT"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Grid</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer.HTTPRequest</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileSize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">grid</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">singleTile</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">:</span><span class="NUMB">1.5</span><span class="PUNC">,</span><span class="NAME">buffer</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">numLoadingTiles</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">params</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.HTTPRequest.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.addEventType</span><span class="PUNC">(</span><span class="STRN">"tileloaded"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.grid</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearGrid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.grid</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.tileSize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.HTTPRequest.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clearGrid</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.grid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iRow</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.grid.length</span><span class="PUNC">;</span><span class="NAME">iRow</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">iRow</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">iRow</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iCol</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">clen</span><span class="PUNC">=</span><span class="NAME">row.length</span><span class="PUNC">;</span><span class="NAME">iCol</span><span class="PUNC">&lt;</span><span class="NAME">clen</span><span class="PUNC">;</span><span class="NAME">iCol</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">row</span><span class="PUNC">[</span><span class="NAME">iCol</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.removeTileMonitoringHooks</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>956</span> </span><span class="NAME">this.grid</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Grid</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.params</span><span class="PUNC">,</span><span class="NAME">this.getOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>957</span> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.HTTPRequest.prototype.clone.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.tileSize</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj.tileSize</span><span class="PUNC">=</span><span class="NAME">this.tileSize.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>958</span> </span><span class="NAME">obj.grid</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">bounds</span><span class="PUNC">||</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">forceReTile</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">this.grid.length</span><span class="PUNC">||</span><span class="NAME">zoomChanged</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilesBounds</span><span class="PUNC">=</span><span class="NAME">this.getTilesBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.singleTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">forceReTile</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dragging</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">tilesBounds.containsBounds</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.initSingleTile</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">forceReTile</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">tilesBounds.containsBounds</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.initGriddedTiles</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.moveGriddedTiles</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setTileSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.singleTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">size.h</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">size.h</span><span class="PUNC">*</span><span class="NAME">this.ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">size.w</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">size.w</span><span class="PUNC">*</span><span class="NAME">this.ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>959</span> </span><span class="NAME">OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">size</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGridBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">=</span><span class="STRN">"The getGridBounds() function is deprecated. It will be "</span><span class="PUNC">+</span><span class="STRN">"removed in 3.0. Please use getTilesBounds() instead."</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Console.warn</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getTilesBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getTilesBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.grid.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">=</span><span class="NAME">this.grid.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottomLeftTile</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">bottom</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">topRightTile</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">right</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">bottomLeftTile.bounds.left</span><span class="PUNC">,</span><span class="NAME">bottomLeftTile.bounds.bottom</span><span class="PUNC">,</span><span class="NAME">topRightTile.bounds.right</span><span class="PUNC">,</span><span class="NAME">topRightTile.bounds.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>960</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initSingleTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">=</span><span class="NAME">bounds.getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileWidth</span><span class="PUNC">=</span><span class="NAME">bounds.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.ratio</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileHeight</span><span class="PUNC">=</span><span class="NAME">bounds.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.ratio</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileBounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">center.lon</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">tileWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">tileHeight</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">center.lon</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">tileWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">center.lat</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">tileHeight</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ul</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">tileBounds.left</span><span class="PUNC">,</span><span class="NAME">tileBounds.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">this.map.getLayerPxFromLonLat</span><span class="PUNC">(</span><span class="NAME">ul</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.grid.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>961</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">this.addTile</span><span class="PUNC">(</span><span class="NAME">tileBounds</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.addTileMonitoringHooks</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tile</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">tile.moveTo</span><span class="PUNC">(</span><span class="NAME">tileBounds</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>962</span> </span><span class="NAME">this.removeExcessTiles</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateGridLayout</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilelon</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NAME">this.tileSize.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilelat</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NAME">this.tileSize.h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsetlon</span><span class="PUNC">=</span><span class="NAME">bounds.left</span><span class="PUNC">-</span><span class="NAME">extent.left</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilecol</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">offsetlon</span><span class="PUNC">/</span><span class="NAME">tilelon</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.buffer</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilecolremain</span><span class="PUNC">=</span><span class="NAME">offsetlon</span><span class="PUNC">/</span><span class="NAME">tilelon</span><span class="PUNC">-</span><span class="NAME">tilecol</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsetx</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">tilecolremain</span><span class="PUNC">*</span><span class="NAME">this.tileSize.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsetlon</span><span class="PUNC">=</span><span class="NAME">extent.left</span><span class="PUNC">+</span><span class="NAME">tilecol</span><span class="PUNC">*</span><span class="NAME">tilelon</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsetlat</span><span class="PUNC">=</span><span class="NAME">bounds.top</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">extent.bottom</span><span class="PUNC">+</span><span class="NAME">tilelat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilerow</span><span class="PUNC">=</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">offsetlat</span><span class="PUNC">/</span><span class="NAME">tilelat</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.buffer</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilerowremain</span><span class="PUNC">=</span><span class="NAME">tilerow</span><span class="PUNC">-</span><span class="NAME">offsetlat</span><span class="PUNC">/</span><span class="NAME">tilelat</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsety</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">tilerowremain</span><span class="PUNC">*</span><span class="NAME">this.tileSize.h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsetlat</span><span class="PUNC">=</span><span class="NAME">extent.bottom</span><span class="PUNC">+</span><span class="NAME">tilerow</span><span class="PUNC">*</span><span class="NAME">tilelat</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">tilelon</span><span class="PUNC">:</span><span class="NAME">tilelon</span><span class="PUNC">,</span><span class="NAME">tilelat</span><span class="PUNC">:</span><span class="NAME">tilelat</span><span class="PUNC">,</span><span class="NAME">tileoffsetlon</span><span class="PUNC">:</span><span class="NAME">tileoffsetlon</span><span class="PUNC">,</span><span class="NAME">tileoffsetlat</span><span class="PUNC">:</span><span class="NAME">tileoffsetlat</span><span class="PUNC">,</span><span class="NAME">tileoffsetx</span><span class="PUNC">:</span><span class="NAME">tileoffsetx</span><span class="PUNC">,</span><span class="NAME">tileoffsety</span><span class="PUNC">:</span><span class="NAME">tileoffsety</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initGriddedTiles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewSize</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minRows</span><span class="PUNC">=</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">viewSize.h</span><span class="PUNC">/</span><span class="NAME">this.tileSize.h</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>963</span> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">this.buffer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minCols</span><span class="PUNC">=</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">viewSize.w</span><span class="PUNC">/</span><span class="NAME">this.tileSize.w</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>964</span> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">this.buffer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.getMaxExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileLayout</span><span class="PUNC">=</span><span class="NAME">this.calculateGridLayout</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">resolution</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsetx</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">tileLayout.tileoffsetx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsety</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">tileLayout.tileoffsety</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsetlon</span><span class="PUNC">=</span><span class="NAME">tileLayout.tileoffsetlon</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileoffsetlat</span><span class="PUNC">=</span><span class="NAME">tileLayout.tileoffsetlat</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilelon</span><span class="PUNC">=</span><span class="NAME">tileLayout.tilelon</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tilelat</span><span class="PUNC">=</span><span class="NAME">tileLayout.tilelat</span><span class="PUNC">;</span><span class="NAME">this.origin</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">tileoffsetx</span><span class="PUNC">,</span><span class="NAME">tileoffsety</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startX</span><span class="PUNC">=</span><span class="NAME">tileoffsetx</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startLon</span><span class="PUNC">=</span><span class="NAME">tileoffsetlon</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowidx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerContainerDivLeft</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.map.layerContainerDiv.style.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerContainerDivTop</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.map.layerContainerDiv.style.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">do</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">rowidx</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">row</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.grid.push</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>965</span> </span><span class="NAME">tileoffsetlon</span><span class="PUNC">=</span><span class="NAME">startLon</span><span class="PUNC">;</span><span class="NAME">tileoffsetx</span><span class="PUNC">=</span><span class="NAME">startX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colidx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">do</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileBounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">tileoffsetlon</span><span class="PUNC">,</span><span class="NAME">tileoffsetlat</span><span class="PUNC">,</span><span class="NAME">tileoffsetlon</span><span class="PUNC">+</span><span class="NAME">tilelon</span><span class="PUNC">,</span><span class="NAME">tileoffsetlat</span><span class="PUNC">+</span><span class="NAME">tilelat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">tileoffsetx</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">layerContainerDivLeft</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">tileoffsety</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">layerContainerDivTop</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">row</span><span class="PUNC">[</span><span class="NAME">colidx</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">this.addTile</span><span class="PUNC">(</span><span class="NAME">tileBounds</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.addTileMonitoringHooks</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">row.push</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">tile.moveTo</span><span class="PUNC">(</span><span class="NAME">tileBounds</span><span class="PUNC">,</span><span class="NAME">px</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>966</span> </span><span class="NAME">tileoffsetlon</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">tilelon</span><span class="PUNC">;</span><span class="NAME">tileoffsetx</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.tileSize.w</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tileoffsetlon</span><span class="PUNC">&lt;=</span><span class="NAME">bounds.right</span><span class="PUNC">+</span><span class="NAME">tilelon</span><span class="PUNC">*</span><span class="NAME">this.buffer</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">colidx</span><span class="PUNC">&lt;</span><span class="NAME">minCols</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tileoffsetlat</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">tilelat</span><span class="PUNC">;</span><span class="NAME">tileoffsety</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.tileSize.h</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tileoffsetlat</span><span class="PUNC">>=</span><span class="NAME">bounds.bottom</span><span class="PUNC">-</span><span class="NAME">tilelat</span><span class="PUNC">*</span><span class="NAME">this.buffer</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">rowidx</span><span class="PUNC">&lt;</span><span class="NAME">minRows</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.removeExcessTiles</span><span class="PUNC">(</span><span class="NAME">rowidx</span><span class="PUNC">,</span><span class="NAME">colidx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.spiralTileLoad</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getMaxExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.maxExtent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">spiralTileLoad</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileQueue</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">directions</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="STRN">"down"</span><span class="PUNC">,</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="STRN">"up"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iRow</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iCell</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">directions</span><span class="PUNC">,</span><span class="STRN">"right"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">directionsTried</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">directionsTried</span><span class="PUNC">&lt;</span><span class="NAME">directions.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">testRow</span><span class="PUNC">=</span><span class="NAME">iRow</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">testCell</span><span class="PUNC">=</span><span class="NAME">iCell</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">directions</span><span class="PUNC">[</span><span class="NAME">direction</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="STRN">"right"</span><span class="PUNC">:</span><span class="NAME">testCell</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"down"</span><span class="PUNC">:</span><span class="NAME">testRow</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="NAME">testCell</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="STRN">"up"</span><span class="PUNC">:</span><span class="NAME">testRow</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>967</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">testRow</span><span class="PUNC">&lt;</span><span class="NAME">this.grid.length</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">testRow</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">testCell</span><span class="PUNC">&lt;</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">testCell</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">testRow</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">testCell</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>968</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tile.queued</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tileQueue.unshift</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.queued</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">directionsTried</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">iRow</span><span class="PUNC">=</span><span class="NAME">testRow</span><span class="PUNC">;</span><span class="NAME">iCell</span><span class="PUNC">=</span><span class="NAME">testCell</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">direction</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">directionsTried</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>969</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">tileQueue.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">tileQueue</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">tile.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.queued</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addTileMonitoringHooks</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tile.onLoadStart</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.numLoadingTiles</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadstart"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>970</span> </span><span class="NAME">this.numLoadingTiles</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">tile.events.register</span><span class="PUNC">(</span><span class="STRN">"loadstart"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">tile.onLoadStart</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.onLoadEnd</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.numLoadingTiles</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"tileloaded"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.numLoadingTiles</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">tile.events.register</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">tile.onLoadEnd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.events.register</span><span class="PUNC">(</span><span class="STRN">"unload"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">tile.onLoadEnd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeTileMonitoringHooks</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tile.unload</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"loadstart"</span><span class="PUNC">:</span><span class="NAME">tile.onLoadStart</span><span class="PUNC">,</span><span class="STRN">"loadend"</span><span class="PUNC">:</span><span class="NAME">tile.onLoadEnd</span><span class="PUNC">,</span><span class="STRN">"unload"</span><span class="PUNC">:</span><span class="NAME">tile.onLoadEnd</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveGriddedTiles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">buffer</span><span class="PUNC">=</span><span class="NAME">this.buffer</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tlLayer</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tlViewPort</span><span class="PUNC">=</span><span class="NAME">this.map.getViewPortPxFromLayerPx</span><span class="PUNC">(</span><span class="NAME">tlLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tlViewPort.x</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NAME">this.tileSize.w</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">buffer</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.shiftColumn</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tlViewPort.x</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">this.tileSize.w</span><span class="PUNC">*</span><span class="NAME">buffer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.shiftColumn</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tlViewPort.y</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NAME">this.tileSize.h</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">buffer</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.shiftRow</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tlViewPort.y</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">this.tileSize.h</span><span class="PUNC">*</span><span class="NAME">buffer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.shiftRow</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">shiftRow</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modelRowIndex</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.grid.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">grid</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modelRow</span><span class="PUNC">=</span><span class="NAME">grid</span><span class="PUNC">[</span><span class="NAME">modelRowIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaY</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NAME">this.tileSize.h</span><span class="PUNC">:</span><span class="NAME">this.tileSize.h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaLat</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">deltaY</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">grid.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">grid.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">modelRow.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modelTile</span><span class="PUNC">=</span><span class="NAME">modelRow</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">modelTile.bounds.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">=</span><span class="NAME">modelTile.position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bounds.bottom</span><span class="PUNC">=</span><span class="NAME">bounds.bottom</span><span class="PUNC">+</span><span class="NAME">deltaLat</span><span class="PUNC">;</span><span class="NAME">bounds.top</span><span class="PUNC">=</span><span class="NAME">bounds.top</span><span class="PUNC">+</span><span class="NAME">deltaLat</span><span class="PUNC">;</span><span class="NAME">position.y</span><span class="PUNC">=</span><span class="NAME">position.y</span><span class="PUNC">+</span><span class="NAME">deltaY</span><span class="PUNC">;</span><span class="NAME">row</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveTo</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>971</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">grid.unshift</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">grid.push</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">shiftColumn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaX</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NAME">this.tileSize.w</span><span class="PUNC">:</span><span class="NAME">this.tileSize.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaLon</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NAME">deltaX</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.grid.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modelTileIndex</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">row.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modelTile</span><span class="PUNC">=</span><span class="NAME">row</span><span class="PUNC">[</span><span class="NAME">modelTileIndex</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">modelTile.bounds.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">position</span><span class="PUNC">=</span><span class="NAME">modelTile.position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bounds.left</span><span class="PUNC">=</span><span class="NAME">bounds.left</span><span class="PUNC">+</span><span class="NAME">deltaLon</span><span class="PUNC">;</span><span class="NAME">bounds.right</span><span class="PUNC">=</span><span class="NAME">bounds.right</span><span class="PUNC">+</span><span class="NAME">deltaLon</span><span class="PUNC">;</span><span class="NAME">position.x</span><span class="PUNC">=</span><span class="NAME">position.x</span><span class="PUNC">+</span><span class="NAME">deltaX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">prepend</span><span class="PUNC">?</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.moveTo</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prepend</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">row.unshift</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">row.push</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeExcessTiles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rows</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">this.grid.length</span><span class="PUNC">></span><span class="NAME">rows</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NAME">this.grid.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">row.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">row</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.removeTileMonitoringHooks</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>972</span> </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">></span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">this.grid.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NAME">this.grid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">row.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.removeTileMonitoringHooks</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tile.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onMapResize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.singleTile</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.clearGrid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setTileSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getTileBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="NAME">this.maxExtent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resolution</span><span class="PUNC">=</span><span class="NAME">this.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileMapWidth</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NAME">this.tileSize.w</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileMapHeight</span><span class="PUNC">=</span><span class="NAME">resolution</span><span class="PUNC">*</span><span class="NAME">this.tileSize.h</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mapPoint</span><span class="PUNC">=</span><span class="NAME">this.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">viewPortPx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileLeft</span><span class="PUNC">=</span><span class="NAME">maxExtent.left</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">tileMapWidth</span><span class="PUNC">*</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mapPoint.lon</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>973</span> </span><span class="NAME">maxExtent.left</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">tileMapWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tileBottom</span><span class="PUNC">=</span><span class="NAME">maxExtent.bottom</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">tileMapHeight</span><span class="PUNC">*</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mapPoint.lat</span><span class="PUNC">-</span><span class="WHIT">
<span class='line'>974</span> </span><span class="NAME">maxExtent.bottom</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">tileMapHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">tileLeft</span><span class="PUNC">,</span><span class="NAME">tileBottom</span><span class="PUNC">,</span><span class="NAME">tileLeft</span><span class="PUNC">+</span><span class="NAME">tileMapWidth</span><span class="PUNC">,</span><span class="NAME">tileBottom</span><span class="PUNC">+</span><span class="NAME">tileMapHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.Grid"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Style</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">title</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">description</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layerName</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">isDefault</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">rules</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">defaultStyle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">defaultsPerSymbolizer</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">propertyStyles</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rules</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.rules</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addRules</span><span class="PUNC">(</span><span class="NAME">options.rules</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>975</span> </span><span class="NAME">this.setDefaultStyle</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">"default"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.rules.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>976</span> </span><span class="NAME">this.rules</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.defaultStyle</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createSymbolizer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.defaultsPerSymbolizer</span><span class="PUNC">?</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">:</span><span class="NAME">this.createLiterals</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.defaultStyle</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rules</span><span class="PUNC">=</span><span class="NAME">this.rules</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rule</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elseRules</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">appliedRules</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">rules.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rule</span><span class="PUNC">=</span><span class="NAME">rules</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">applies</span><span class="PUNC">=</span><span class="NAME">rule.evaluate</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">applies</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">rule</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Rule</span><span class="PUNC">&&</span><span class="NAME">rule.elseFilter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">elseRules.push</span><span class="PUNC">(</span><span class="NAME">rule</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">appliedRules</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.applySymbolizer</span><span class="PUNC">(</span><span class="NAME">rule</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>977</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">appliedRules</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">&&</span><span class="NAME">elseRules.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">appliedRules</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">elseRules.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.applySymbolizer</span><span class="PUNC">(</span><span class="NAME">elseRules</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>978</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">rules.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">appliedRules</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>979</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">applySymbolizer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rule</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbolizerPrefix</span><span class="PUNC">=</span><span class="NAME">feature.geometry</span><span class="PUNC">?</span><span class="NAME">this.getSymbolizerPrefix</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Style.SYMBOLIZER_PREFIXES</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbolizer</span><span class="PUNC">=</span><span class="NAME">rule.symbolizer</span><span class="PUNC">[</span><span class="NAME">symbolizerPrefix</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">rule.symbolizer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.defaultsPerSymbolizer</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="PUNC">=</span><span class="NAME">this.defaultStyle</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="NAME">defaults.pointRadius</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">symbolizer.stroke</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">||</span><span class="NAME">symbolizer.graphic</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="NAME">defaults.strokeWidth</span><span class="PUNC">,</span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="NAME">defaults.strokeColor</span><span class="PUNC">,</span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="NAME">defaults.strokeOpacity</span><span class="PUNC">,</span><span class="NAME">strokeDashstyle</span><span class="PUNC">:</span><span class="NAME">defaults.strokeDashstyle</span><span class="PUNC">,</span><span class="NAME">strokeLinecap</span><span class="PUNC">:</span><span class="NAME">defaults.strokeLinecap</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>980</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">symbolizer.fill</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">||</span><span class="NAME">symbolizer.graphic</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="NAME">defaults.fillColor</span><span class="PUNC">,</span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="NAME">defaults.fillOpacity</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>981</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">symbolizer.graphic</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">symbolizer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.pointRadius</span><span class="PUNC">,</span><span class="NAME">externalGraphic</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.externalGraphic</span><span class="PUNC">,</span><span class="NAME">graphicName</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.graphicName</span><span class="PUNC">,</span><span class="NAME">graphicOpacity</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.graphicOpacity</span><span class="PUNC">,</span><span class="NAME">graphicWidth</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.graphicWidth</span><span class="PUNC">,</span><span class="NAME">graphicHeight</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.graphicHeight</span><span class="PUNC">,</span><span class="NAME">graphicXOffset</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.graphicXOffset</span><span class="PUNC">,</span><span class="NAME">graphicYOffset</span><span class="PUNC">:</span><span class="NAME">this.defaultStyle.graphicYOffset</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>982</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.createLiterals</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createLiterals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">feature.attributes</span><span class="PUNC">||</span><span class="NAME">feature.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">this.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.propertyStyles</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Style.createLiteral</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>983</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">findPropertyStyles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyStyles</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.defaultStyle</span><span class="PUNC">;</span><span class="NAME">this.addPropertyStyles</span><span class="PUNC">(</span><span class="NAME">propertyStyles</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rules</span><span class="PUNC">=</span><span class="NAME">this.rules</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">symbolizer</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">rules.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">symbolizer</span><span class="PUNC">=</span><span class="NAME">rules</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">symbolizer</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">symbolizer</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addPropertyStyles</span><span class="PUNC">(</span><span class="NAME">propertyStyles</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.addPropertyStyles</span><span class="PUNC">(</span><span class="NAME">propertyStyles</span><span class="PUNC">,</span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>984</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">propertyStyles</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addPropertyStyles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">propertyStyles</span><span class="PUNC">,</span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">symbolizer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">property</span><span class="PUNC">=</span><span class="NAME">symbolizer</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">property</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">&&</span><span class="NAME">property.match</span><span class="PUNC">(</span><span class="REGX">/\$\{\w+\}/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">propertyStyles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>985</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">propertyStyles</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addRules</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rules</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Array.prototype.push.apply</span><span class="PUNC">(</span><span class="NAME">this.rules</span><span class="PUNC">,</span><span class="NAME">rules</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.propertyStyles</span><span class="PUNC">=</span><span class="NAME">this.findPropertyStyles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setDefaultStyle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.defaultStyle</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">;</span><span class="NAME">this.propertyStyles</span><span class="PUNC">=</span><span class="NAME">this.findPropertyStyles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getSymbolizerPrefix</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prefixes</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Style.SYMBOLIZER_PREFIXES</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">prefixes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME.indexOf</span><span class="PUNC">(</span><span class="NAME">prefixes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">prefixes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.rules</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.rules</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.rules.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.rules.push</span><span class="PUNC">(</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>986</span> </span><span class="NAME">options.context</span><span class="PUNC">=</span><span class="NAME">this.context</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultStyle</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.defaultStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">defaultStyle</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Style"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Style.createLiteral</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">&&</span><span class="NAME">value.indexOf</span><span class="PUNC">(</span><span class="STRN">"${"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.format</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">value</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>987</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Style.SYMBOLIZER_PREFIXES</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">'Point'</span><span class="PUNC">,</span><span class="STRN">'Line'</span><span class="PUNC">,</span><span class="STRN">'Polygon'</span><span class="PUNC">,</span><span class="STRN">'Text'</span><span class="PUNC">,</span><span class="STRN">'Raster'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.Navigation</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dragPan</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">dragPanOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">documentDrag</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">zoomBox</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">zoomBoxEnabled</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">zoomWheelEnabled</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">mouseWheelOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">handleRightClicks</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">zoomBoxKeyMask</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Handler.MOD_SHIFT</span><span class="PUNC">,</span><span class="NAME">autoActivate</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.dragPan</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragPan.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>988</span> </span><span class="NAME">this.dragPan</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.zoomBox</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>989</span> </span><span class="NAME">this.zoomBox</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.dragPan.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.zoomWheelEnabled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.wheel.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>990</span> </span><span class="NAME">this.handlers.click.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.zoomBoxEnabled</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>991</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dragPan.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handlers.click.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handlers.wheel.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">draw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handleRightClicks</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.viewPortDiv.oncontextmenu</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Function.False</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>992</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clickCallbacks</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'dblclick'</span><span class="PUNC">:</span><span class="NAME">this.defaultDblClick</span><span class="PUNC">,</span><span class="STRN">'dblrightclick'</span><span class="PUNC">:</span><span class="NAME">this.defaultDblRightClick</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clickOptions</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'double'</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">'stopDouble'</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.handlers.click</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Click</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">clickCallbacks</span><span class="PUNC">,</span><span class="NAME">clickOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dragPan</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DragPan</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">map</span><span class="PUNC">:</span><span class="NAME">this.map</span><span class="PUNC">,</span><span class="NAME">documentDrag</span><span class="PUNC">:</span><span class="NAME">this.documentDrag</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.dragPanOptions</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomBox</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.ZoomBox</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">map</span><span class="PUNC">:</span><span class="NAME">this.map</span><span class="PUNC">,</span><span class="NAME">keyMask</span><span class="PUNC">:</span><span class="NAME">this.zoomBoxKeyMask</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dragPan.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handlers.wheel</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.MouseWheel</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"up"</span><span class="PUNC">:</span><span class="NAME">this.wheelUp</span><span class="PUNC">,</span><span class="STRN">"down"</span><span class="PUNC">:</span><span class="NAME">this.wheelDown</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.mouseWheelOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">defaultDblClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newCenter</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.setCenter</span><span class="PUNC">(</span><span class="NAME">newCenter</span><span class="PUNC">,</span><span class="NAME">this.map.zoom</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">defaultDblRightClick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newCenter</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromViewPortPx</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.setCenter</span><span class="PUNC">(</span><span class="NAME">newCenter</span><span class="PUNC">,</span><span class="NAME">this.map.zoom</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wheelChange</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">deltaZ</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentZoom</span><span class="PUNC">=</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newZoom</span><span class="PUNC">=</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">deltaZ</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">newZoom</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">newZoom</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">newZoom</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">newZoom</span><span class="PUNC">,</span><span class="NAME">this.map.getNumZoomLevels</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newZoom</span><span class="PUNC">===</span><span class="NAME">currentZoom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>993</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaX</span><span class="PUNC">=</span><span class="NAME">size.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">-</span><span class="NAME">evt.xy.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">deltaY</span><span class="PUNC">=</span><span class="NAME">evt.xy.y</span><span class="PUNC">-</span><span class="NAME">size.h</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newRes</span><span class="PUNC">=</span><span class="NAME">this.map.baseLayer.getResolutionForZoom</span><span class="PUNC">(</span><span class="NAME">newZoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoomPoint</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newCenter</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">zoomPoint.lon</span><span class="PUNC">+</span><span class="NAME">deltaX</span><span class="PUNC">*</span><span class="NAME">newRes</span><span class="PUNC">,</span><span class="NAME">zoomPoint.lat</span><span class="PUNC">+</span><span class="NAME">deltaY</span><span class="PUNC">*</span><span class="NAME">newRes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.setCenter</span><span class="PUNC">(</span><span class="NAME">newCenter</span><span class="PUNC">,</span><span class="NAME">newZoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wheelUp</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">delta</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.wheelChange</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">delta</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wheelDown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">delta</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.wheelChange</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">delta</span><span class="PUNC">||</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">disableZoomBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBoxEnabled</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.zoomBox.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">enableZoomBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBoxEnabled</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomBox.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">disableZoomWheel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomWheelEnabled</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.handlers.wheel.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">enableZoomWheel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.zoomWheelEnabled</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.wheel.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.Navigation"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="NAME">bounds.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clearBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.parent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.parent.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">extendBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newBounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">this.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setBounds</span><span class="PUNC">(</span><span class="NAME">newBounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.bounds.extend</span><span class="PUNC">(</span><span class="NAME">newBounds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.bounds</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.calculateBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>994</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.bounds</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">distanceTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVertices</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">atPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">,</span><span class="NAME">toleranceLon</span><span class="PUNC">,</span><span class="NAME">toleranceLat</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">atPoint</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">this.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dX</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">toleranceLon</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">toleranceLon</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dY</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">toleranceLat</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">toleranceLat</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toleranceBounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">this.bounds.left</span><span class="PUNC">-</span><span class="NAME">dX</span><span class="PUNC">,</span><span class="NAME">this.bounds.bottom</span><span class="PUNC">-</span><span class="NAME">dY</span><span class="PUNC">,</span><span class="NAME">this.bounds.right</span><span class="PUNC">+</span><span class="NAME">dX</span><span class="PUNC">,</span><span class="NAME">this.bounds.top</span><span class="PUNC">+</span><span class="NAME">dY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">atPoint</span><span class="PUNC">=</span><span class="NAME">toleranceBounds.containsLonLat</span><span class="PUNC">(</span><span class="NAME">lonlat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>995</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">atPoint</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLength</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCentroid</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.WKT.prototype.write</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.fromWKT</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">format</span><span class="PUNC">=</span><span class="NAME">arguments.callee.format</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">format</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">format</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.WKT</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">arguments.callee.format</span><span class="PUNC">=</span><span class="NAME">format</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>996</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geom</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">format.read</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geom</span><span class="PUNC">=</span><span class="NAME">result.geometry</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">result.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>997</span> </span><span class="NAME">geom</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Collection</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>998</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">geom</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.segmentsIntersect</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">seg2</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.point</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tolerance</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.tolerance</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x11_21</span><span class="PUNC">=</span><span class="NAME">seg1.x1</span><span class="PUNC">-</span><span class="NAME">seg2.x1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y11_21</span><span class="PUNC">=</span><span class="NAME">seg1.y1</span><span class="PUNC">-</span><span class="NAME">seg2.y1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x12_11</span><span class="PUNC">=</span><span class="NAME">seg1.x2</span><span class="PUNC">-</span><span class="NAME">seg1.x1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y12_11</span><span class="PUNC">=</span><span class="NAME">seg1.y2</span><span class="PUNC">-</span><span class="NAME">seg1.y1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y22_21</span><span class="PUNC">=</span><span class="NAME">seg2.y2</span><span class="PUNC">-</span><span class="NAME">seg2.y1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x22_21</span><span class="PUNC">=</span><span class="NAME">seg2.x2</span><span class="PUNC">-</span><span class="NAME">seg2.x1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y22_21</span><span class="PUNC">*</span><span class="NAME">x12_11</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">x22_21</span><span class="PUNC">*</span><span class="NAME">y12_11</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n1</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x22_21</span><span class="PUNC">*</span><span class="NAME">y11_21</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">y22_21</span><span class="PUNC">*</span><span class="NAME">x11_21</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n2</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x12_11</span><span class="PUNC">*</span><span class="NAME">y11_21</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">y12_11</span><span class="PUNC">*</span><span class="NAME">x11_21</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n1</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">n2</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">along1</span><span class="PUNC">=</span><span class="NAME">n1</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">along2</span><span class="PUNC">=</span><span class="NAME">n2</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">along1</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">along1</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">along2</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">along2</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">seg1.x1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">along1</span><span class="PUNC">*</span><span class="NAME">x12_11</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">seg1.y1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">along1</span><span class="PUNC">*</span><span class="NAME">y12_11</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>999</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tolerance</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">seg2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">outer</span><span class="PUNC">:</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seg</span><span class="PUNC">=</span><span class="NAME">segs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">seg</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">seg</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">dist</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">intersection.x</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">intersection.y</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dist</span><span class="PUNC">&lt;</span><span class="NAME">tolerance</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersection.x</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">intersection.y</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">seg2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">target</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">result</span><span class="PUNC">;</span><span class="NAME">outer</span><span class="PUNC">:</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">=</span><span class="NAME">segs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">target</span><span class="PUNC">=</span><span class="NAME">segs</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">source</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">source</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.distanceToSegment</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result.distance</span><span class="PUNC">&lt;</span><span class="NAME">tolerance</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">p.x</span><span class="PUNC">,</span><span class="NAME">p.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersection</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.distanceToSegment</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">segment</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x0</span><span class="PUNC">=</span><span class="NAME">point.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y0</span><span class="PUNC">=</span><span class="NAME">point.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">=</span><span class="NAME">segment.x1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">=</span><span class="NAME">segment.y1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">segment.x2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">segment.y2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">=</span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">y2</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">along</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">x0</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">dy</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">y0</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">along</span><span class="PUNC">&lt;=</span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">x1</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">y1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">along</span><span class="PUNC">>=</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">x2</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">y2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">along</span><span class="PUNC">*</span><span class="NAME">dx</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">along</span><span class="PUNC">*</span><span class="NAME">dy</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">y0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.XYZ</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer.Grid</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">sphericalMercator</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">zoomOffset</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.sphericalMercator</span><span class="PUNC">||</span><span class="NAME">this.sphericalMercator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">maxExtent</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">128</span><span class="PUNC">*</span><span class="NUMB">156543.0339</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">128</span><span class="PUNC">*</span><span class="NUMB">156543.0339</span><span class="PUNC">,</span><span class="NUMB">128</span><span class="PUNC">*</span><span class="NUMB">156543.0339</span><span class="PUNC">,</span><span class="NUMB">128</span><span class="PUNC">*</span><span class="NUMB">156543.0339</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">maxResolution</span><span class="PUNC">:</span><span class="NUMB">156543.0339</span><span class="PUNC">,</span><span class="NAME">numZoomLevels</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">,</span><span class="NAME">units</span><span class="PUNC">:</span><span class="STRN">"m"</span><span class="PUNC">,</span><span class="NAME">projection</span><span class="PUNC">:</span><span class="STRN">"EPSG:900913"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">||</span><span class="NAME">this.url</span><span class="PUNC">;</span><span class="NAME">name</span><span class="PUNC">=</span><span class="NAME">name</span><span class="PUNC">||</span><span class="NAME">this.name</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newArguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Grid.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newArguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.XYZ</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.getOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.Grid.prototype.clone.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getURL</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">=</span><span class="NAME">this.map.getResolution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">bounds.left</span><span class="PUNC">-</span><span class="NAME">this.maxExtent.left</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">*</span><span class="NAME">this.tileSize.w</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.maxExtent.top</span><span class="PUNC">-</span><span class="NAME">bounds.top</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">*</span><span class="NAME">this.tileSize.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">z</span><span class="PUNC">=</span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.zoomOffset</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">limit</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.wrapDateLine</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">%</span><span class="NAME">limit</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">limit</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">limit</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">this.url</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">z</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">url</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">=</span><span class="NAME">this.selectUrl</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">=</span><span class="NAME">OpenLayers.String.format</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'x'</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">,</span><span class="STRN">'y'</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">,</span><span class="STRN">'z'</span><span class="PUNC">:</span><span class="NAME">z</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Tile.Image</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.tileSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.Grid.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.tileOrigin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.tileOrigin</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">this.maxExtent.left</span><span class="PUNC">,</span><span class="NAME">this.maxExtent.bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.XYZ"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.OSM</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer.XYZ</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">name</span><span class="PUNC">:</span><span class="STRN">"OpenStreetMap"</span><span class="PUNC">,</span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="STRN">"Data CC-By-SA by &lt;a href='http://openstreetmap.org/'>OpenStreetMap&lt;/a>"</span><span class="PUNC">,</span><span class="NAME">sphericalMercator</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">:</span><span class="STRN">'http://tile.openstreetmap.org/${z}/${x}/${y}.png'</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.OSM</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">this.getOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.XYZ.prototype.clone.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.OSM"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Rule</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">title</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">description</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">filter</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">elseFilter</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">symbolizer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">symbolizers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">minScaleDenominator</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">maxScaleDenominator</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.symbolizer</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.symbolizers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.symbolizer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.createUniqueID</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.symbolizer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.symbolizer</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="NAME">this.symbolizer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.symbolizers</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">evaluate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">this.getContext</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">applies</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.minScaleDenominator</span><span class="PUNC">||</span><span class="NAME">this.maxScaleDenominator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">=</span><span class="NAME">feature.layer.map.getScale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.minScaleDenominator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">applies</span><span class="PUNC">=</span><span class="NAME">scale</span><span class="PUNC">>=</span><span class="NAME">OpenLayers.Style.createLiteral</span><span class="PUNC">(</span><span class="NAME">this.minScaleDenominator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">applies</span><span class="PUNC">&&</span><span class="NAME">this.maxScaleDenominator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">applies</span><span class="PUNC">=</span><span class="NAME">scale</span><span class="PUNC">&lt;</span><span class="NAME">OpenLayers.Style.createLiteral</span><span class="PUNC">(</span><span class="NAME">this.maxScaleDenominator</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">applies</span><span class="PUNC">&&</span><span class="NAME">this.filter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.filter.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Filter.FeatureId"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">applies</span><span class="PUNC">=</span><span class="NAME">this.filter.evaluate</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">applies</span><span class="PUNC">=</span><span class="NAME">this.filter.evaluate</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">applies</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getContext</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">this.context</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">feature.attributes</span><span class="PUNC">||</span><span class="NAME">feature.data</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.context</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">context</span><span class="PUNC">=</span><span class="NAME">this.context</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.symbolizers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.symbolizers.length</span><span class="PUNC">;</span><span class="NAME">options.symbolizers</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.symbolizers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this.symbolizers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">options.symbolizer</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.symbolizer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">this.symbolizer</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">type</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">===</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.symbolizer</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">===</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.symbolizer</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="NAME">options.filter</span><span class="PUNC">=</span><span class="NAME">this.filter</span><span class="PUNC">&&</span><span class="NAME">this.filter.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">options.context</span><span class="PUNC">=</span><span class="NAME">this.context</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Rule</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Rule"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.StyleMap</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">styles</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">extendDefault</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.styles</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">"default"</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">"default"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"select"</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">"select"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"temporary"</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">"temporary"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"delete"</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">"delete"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"default"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">;</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"select"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">;</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"temporary"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">;</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"delete"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"default"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"select"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"temporary"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"delete"</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Style</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="NAME">this.styles</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createSymbolizer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">intent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">intent</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intent</span><span class="PUNC">=</span><span class="STRN">"default"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="NAME">feature.renderIntent</span><span class="PUNC">=</span><span class="NAME">intent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultSymbolizer</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.extendDefault</span><span class="PUNC">&&</span><span class="NAME">intent</span><span class="PUNC">!=</span><span class="STRN">"default"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">defaultSymbolizer</span><span class="PUNC">=</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">"default"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">createSymbolizer</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">defaultSymbolizer</span><span class="PUNC">,</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">intent</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">createSymbolizer</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addUniqueValueRules</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">renderIntent</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">symbolizers</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rules</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">symbolizers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rules.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Rule</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">symbolizer</span><span class="PUNC">:</span><span class="NAME">symbolizers</span><span class="PUNC">[</span><span class="NAME">value</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">:</span><span class="NAME">context</span><span class="PUNC">,</span><span class="NAME">filter</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Filter.Comparison</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Filter.Comparison.EQUAL_TO</span><span class="PUNC">,</span><span class="NAME">property</span><span class="PUNC">:</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">value</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">renderIntent</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addRules</span><span class="PUNC">(</span><span class="NAME">rules</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.StyleMap"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Collection</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">components</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addComponents</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components.length</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.components</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"new "</span><span class="PUNC">+</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">+</span><span class="STRN">"()"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry.addComponent</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getComponentsString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strings.push</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toShortString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">strings.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setBounds</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.extendBounds</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addComponents</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">components</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">components</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addComponent</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addComponent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">added</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.componentTypes</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.componentTypes</span><span class="PUNC">,</span><span class="NAME">component.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">&lt;</span><span class="NAME">this.components.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components1</span><span class="PUNC">=</span><span class="NAME">this.components.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components2</span><span class="PUNC">=</span><span class="NAME">this.components.slice</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NAME">this.components.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components1.push</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.components</span><span class="PUNC">=</span><span class="NAME">components1.concat</span><span class="PUNC">(</span><span class="NAME">components2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.components.push</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="NAME">component.parent</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="NAME">this.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">added</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">added</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeComponents</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">components</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">components</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">--</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.removeComponent</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeComponent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">,</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLength</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">length</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeodesicArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getGeodesicArea</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCentroid</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">weighted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">weighted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.components.length</span><span class="PUNC">&&</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getCentroid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">areas</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centroids</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">areaSum</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minArea</span><span class="PUNC">=</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NAME">component.getArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centroid</span><span class="PUNC">=</span><span class="NAME">component.getCentroid</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">area</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">centroid.x</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">centroid.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="NAME">areas.push</span><span class="PUNC">(</span><span class="NAME">area</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">areaSum</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">area</span><span class="PUNC">;</span><span class="NAME">minArea</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">area</span><span class="PUNC">&lt;</span><span class="NAME">minArea</span><span class="PUNC">&&</span><span class="NAME">area</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">area</span><span class="PUNC">:</span><span class="NAME">minArea</span><span class="PUNC">;</span><span class="NAME">centroids.push</span><span class="PUNC">(</span><span class="NAME">centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">areas.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">areaSum</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">areas</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="NAME">areaSum</span><span class="PUNC">=</span><span class="NAME">areas.length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">areas</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NAME">minArea</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="NAME">areaSum</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NAME">minArea</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xSum</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">ySum</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">centroid</span><span class="PUNC">,</span><span class="NAME">area</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">centroid</span><span class="PUNC">=</span><span class="NAME">centroids</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">area</span><span class="PUNC">=</span><span class="NAME">areas</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">xSum</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">centroid.x</span><span class="PUNC">*</span><span class="NAME">area</span><span class="PUNC">;</span><span class="NAME">ySum</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">centroid.y</span><span class="PUNC">*</span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">xSum</span><span class="PUNC">/</span><span class="NAME">areaSum</span><span class="PUNC">,</span><span class="NAME">ySum</span><span class="PUNC">/</span><span class="NAME">areaSum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeodesicLength</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">length</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getGeodesicLength</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">move</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">move</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rotate</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">resize</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">distanceTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.edge</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">=</span><span class="NAME">edge</span><span class="PUNC">&&</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.details</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">best</span><span class="PUNC">,</span><span class="NAME">distance</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">=</span><span class="NAME">Number.POSITIVE_INFINITY</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">distanceTo</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">distance</span><span class="PUNC">=</span><span class="NAME">details</span><span class="PUNC">?</span><span class="NAME">result.distance</span><span class="PUNC">:</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">distance</span><span class="PUNC">&lt;</span><span class="NAME">min</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">=</span><span class="NAME">distance</span><span class="PUNC">;</span><span class="NAME">best</span><span class="PUNC">=</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">best</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equivalent</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">geometry</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">!=</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equivalent</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">geometry.components.length</span><span class="PUNC">!=</span><span class="NAME">this.components.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equivalent</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">equals</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equivalent</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equivalent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">transform</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">&&</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">component.transform</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">intersects</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.intersects</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVertices</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Array.prototype.push.apply</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">,</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getVertices</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.Collection"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">calculateBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">distanceTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.edge</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">=</span><span class="NAME">edge</span><span class="PUNC">&&</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.details</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">x0</span><span class="PUNC">=</span><span class="NAME">this.x</span><span class="PUNC">;</span><span class="NAME">y0</span><span class="PUNC">=</span><span class="NAME">this.y</span><span class="PUNC">;</span><span class="NAME">x1</span><span class="PUNC">=</span><span class="NAME">geometry.x</span><span class="PUNC">;</span><span class="NAME">y1</span><span class="PUNC">=</span><span class="NAME">geometry.y</span><span class="PUNC">;</span><span class="NAME">distance</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">x0</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">y0</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">details</span><span class="PUNC">?</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">y0</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">distance</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">geometry.distanceTo</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">details</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">result.x1</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">result.y1</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">result.x0</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">result.y0</span><span class="PUNC">,</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">result.distance</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">equals</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geom</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geom</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">equals</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">==</span><span class="NAME">geom.x</span><span class="PUNC">&&</span><span class="NAME">this.y</span><span class="PUNC">==</span><span class="NAME">geom.y</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">geom.x</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">geom.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toShortString</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">move</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">this.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">angle</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">=</span><span class="NAME">this.distanceTo</span><span class="PUNC">(</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">=</span><span class="NAME">angle</span><span class="PUNC">+</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">-</span><span class="NAME">origin.y</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">-</span><span class="NAME">origin.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">origin.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">radius</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">origin.y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">radius</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCentroid</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ratio</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">ratio</span><span class="PUNC">==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">ratio</span><span class="PUNC">;</span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">origin.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">*</span><span class="NAME">ratio</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">-</span><span class="NAME">origin.x</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">origin.y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">-</span><span class="NAME">origin.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">intersects</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">this.equals</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.intersects</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">transform</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">&&</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Projection.transform</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVertices</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"beforefeatureadded"</span><span class="PUNC">,</span><span class="STRN">"beforefeaturesadded"</span><span class="PUNC">,</span><span class="STRN">"featureadded"</span><span class="PUNC">,</span><span class="STRN">"featuresadded"</span><span class="PUNC">,</span><span class="STRN">"beforefeatureremoved"</span><span class="PUNC">,</span><span class="STRN">"beforefeaturesremoved"</span><span class="PUNC">,</span><span class="STRN">"featureremoved"</span><span class="PUNC">,</span><span class="STRN">"featuresremoved"</span><span class="PUNC">,</span><span class="STRN">"beforefeatureselected"</span><span class="PUNC">,</span><span class="STRN">"featureselected"</span><span class="PUNC">,</span><span class="STRN">"featureunselected"</span><span class="PUNC">,</span><span class="STRN">"beforefeaturemodified"</span><span class="PUNC">,</span><span class="STRN">"featuremodified"</span><span class="PUNC">,</span><span class="STRN">"afterfeaturemodified"</span><span class="PUNC">,</span><span class="STRN">"vertexmodified"</span><span class="PUNC">,</span><span class="STRN">"sketchstarted"</span><span class="PUNC">,</span><span class="STRN">"sketchmodified"</span><span class="PUNC">,</span><span class="STRN">"sketchcomplete"</span><span class="PUNC">,</span><span class="STRN">"refresh"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">isFixed</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">isVector</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">features</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">filter</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">selectedFeatures</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">unrenderedFeatures</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">reportError</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">styleMap</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">strategies</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">protocol</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">renderers</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">'SVG'</span><span class="PUNC">,</span><span class="STRN">'VML'</span><span class="PUNC">,</span><span class="STRN">'Canvas'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">renderer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">rendererOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">geometryType</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">drawn</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer.prototype.EVENT_TYPES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.renderer</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.renderer.supported</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.assignRenderer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.renderer</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.renderer.supported</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.displayError</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.styleMap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.styleMap</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.StyleMap</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="NAME">this.features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.selectedFeatures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.strategies</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.strategies.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.strategies</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setLayer</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.strategies</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strategy</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.strategies.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strategy</span><span class="PUNC">=</span><span class="NAME">this.strategies</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">strategy.autoDestroy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strategy.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="NAME">this.strategies</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.protocol</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.protocol.autoDestroy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.protocol.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="NAME">this.protocol</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="NAME">this.destroyFeatures</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.features</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.selectedFeatures</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.renderer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="NAME">this.renderer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.geometryType</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.drawn</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">(</span><span class="NAME">this.name</span><span class="PUNC">,</span><span class="NAME">this.getOptions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1064</span> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Layer.prototype.clone.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clonedFeatures</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">clonedFeatures</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="NAME">obj.features</span><span class="PUNC">=</span><span class="NAME">clonedFeatures</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">refresh</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.calculateInRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.visibility</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"refresh"</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">assignRenderer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.renderers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rendererClass</span><span class="PUNC">=</span><span class="NAME">this.renderers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderer</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">rendererClass</span><span class="PUNC">==</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">rendererClass</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Renderer</span><span class="PUNC">[</span><span class="NAME">rendererClass</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">renderer</span><span class="PUNC">&&</span><span class="NAME">renderer.prototype.supported</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">renderer</span><span class="PUNC">(</span><span class="NAME">this.div</span><span class="PUNC">,</span><span class="NAME">this.rendererOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">displayError</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.reportError</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.userError</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"browserNotSupported"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'renderers'</span><span class="PUNC">:</span><span class="NAME">this.renderers.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.renderer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.removeLayer</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.renderer.map</span><span class="PUNC">=</span><span class="NAME">this.map</span><span class="PUNC">;</span><span class="NAME">this.renderer.setSize</span><span class="PUNC">(</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">afterAdd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.strategies</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strategy</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.strategies.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strategy</span><span class="PUNC">=</span><span class="NAME">this.strategies</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">strategy.autoActivate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strategy.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawn</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.strategies</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strategy</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.strategies.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strategy</span><span class="PUNC">=</span><span class="NAME">this.strategies</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">strategy.autoActivate</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">strategy.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onMapResize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.prototype.onMapResize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.renderer.setSize</span><span class="PUNC">(</span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.prototype.moveTo.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordSysUnchanged</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dragging</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.root.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="NAME">this.div.style.left</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.map.layerContainerDiv.style.left</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="NAME">this.div.style.top</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.map.layerContainerDiv.style.top</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extent</span><span class="PUNC">=</span><span class="NAME">this.map.getExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordSysUnchanged</span><span class="PUNC">=</span><span class="NAME">this.renderer.setExtent</span><span class="PUNC">(</span><span class="NAME">extent</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.renderer.root.style.visibility</span><span class="PUNC">=</span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"gecko"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.div.scrollLeft</span><span class="PUNC">=</span><span class="NAME">this.div.scrollLeft</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">zoomChanged</span><span class="PUNC">&&</span><span class="NAME">coordSysUnchanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.drawFeature</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.drawn</span><span class="PUNC">||</span><span class="NAME">zoomChanged</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">coordSysUnchanged</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.drawn</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.locked</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!==</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.drawFeature</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">display</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">display</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.prototype.display.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentDisplay</span><span class="PUNC">=</span><span class="NAME">this.div.style.display</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentDisplay</span><span class="PUNC">!=</span><span class="NAME">this.renderer.root.style.display</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.root.style.display</span><span class="PUNC">=</span><span class="NAME">currentDisplay</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">features</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">notify</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">options.silent</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">:</span><span class="NAME">features</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeaturesadded"</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">event.features</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featuresAdded</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="PUNC">(</span><span class="NAME">features.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.locked</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.renderer.locked</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.geometryType</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">this.geometryType</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">throwStr</span><span class="PUNC">=</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">'componentShouldBe'</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'geomType'</span><span class="PUNC">:</span><span class="NAME">this.geometryType.prototype.CLASS_NAME</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">throwStr</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="NAME">feature.layer</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">feature.style</span><span class="PUNC">&&</span><span class="NAME">this.style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature.style</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeatureadded"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.preFeatureInsert</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="NAME">featuresAdded.push</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.features.push</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.drawFeature</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureadded"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.onFeatureInsert</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featuresadded"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">:</span><span class="NAME">featuresAdded</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">features</span><span class="PUNC">||</span><span class="NAME">features.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">===</span><span class="NAME">this.features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.removeAllFeatures</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">features</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">===</span><span class="NAME">this.selectedFeatures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">features.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">notify</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">options.silent</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeaturesremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">:</span><span class="NAME">features</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.locked</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.renderer.locked</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">[</span><span class="NAME">feature.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeatureremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="NAME">this.features</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.features</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feature.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.eraseFeatures</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.selectedFeatures</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">this.selectedFeatures</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featuresremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">:</span><span class="NAME">features</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeAllFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">notify</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">options.silent</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeaturesremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">:</span><span class="NAME">features</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeatureremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="NAME">feature.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="NAME">this.renderer.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.selectedFeatures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">notify</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featuresremoved"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">:</span><span class="NAME">features</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">all</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">all</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.removeFeatures</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.drawn</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">!=</span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">style</span><span class="PUNC">&&</span><span class="NAME">feature.state</span><span class="PUNC">===</span><span class="NAME">OpenLayers.State.DELETE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="STRN">"delete"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderIntent</span><span class="PUNC">=</span><span class="NAME">style</span><span class="PUNC">||</span><span class="NAME">feature.renderIntent</span><span class="PUNC">;</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">feature.style</span><span class="PUNC">||</span><span class="NAME">this.style</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.styleMap.createSymbolizer</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">renderIntent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.renderer.drawFeature</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">[</span><span class="NAME">feature.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">feature</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.unrenderedFeatures</span><span class="PUNC">[</span><span class="NAME">feature.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">eraseFeatures</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.eraseFeatures</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureFromEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.renderer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"getFeatureError"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureId</span><span class="PUNC">=</span><span class="NAME">this.renderer.getFeatureIdFromEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getFeatureById</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureBy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureById</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getFeatureBy</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="NAME">featureId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureByFid</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureFid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getFeatureBy</span><span class="PUNC">(</span><span class="STRN">'fid'</span><span class="PUNC">,</span><span class="NAME">featureFid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onFeatureInsert</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">preFeatureInsert</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getDataExtent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">=</span><span class="NAME">this.features</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">features.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxExtent</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">maxExtent.extend</span><span class="PUNC">(</span><span class="NAME">geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">maxExtent</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.Vector"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.MultiPoint</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.Collection</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.addComponent</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removePoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.removeComponent</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.MultiPoint"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Handler.Point</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Handler</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">multi</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">drawing</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">mouseDown</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">lastDown</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">lastUp</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">persist</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">layerOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.layerOptions</span><span class="PUNC">&&</span><span class="NAME">options.layerOptions.styleMap</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.style</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="NAME">OpenLayers.Handler.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Handler.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">displayInLayerSwitcher</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">calculateInRange</span><span class="PUNC">:</span><span class="NAME">OpenLayers.Function.True</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.layerOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">(</span><span class="NAME">this.CLASS_NAME</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.map.addLayer</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pixel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">pixel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.point</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">lonlat.lon</span><span class="PUNC">,</span><span class="NAME">lonlat.lat</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"create"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.point.geometry</span><span class="PUNC">,</span><span class="NAME">this.point</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.point.geometry.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layer.addFeatures</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.point</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">silent</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">OpenLayers.Handler.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.drawing</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.cancel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="NAME">this.destroyFeature</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.destroy</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroyFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.destroyFeatures</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="NAME">this.point</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">finalize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cancel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="NAME">cancel</span><span class="PUNC">?</span><span class="STRN">"cancel"</span><span class="PUNC">:</span><span class="STRN">"done"</span><span class="PUNC">;</span><span class="NAME">this.drawing</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.mouseDown</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.lastDown</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.lastUp</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.geometryClone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cancel</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.persist</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.destroyFeature</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">cancel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.finalize</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">click</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dblclick</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Event.stop</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">modifyFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pixel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lonlat</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="NAME">pixel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.point.geometry.x</span><span class="PUNC">=</span><span class="NAME">lonlat.lon</span><span class="PUNC">;</span><span class="NAME">this.point.geometry.y</span><span class="PUNC">=</span><span class="NAME">lonlat.lat</span><span class="PUNC">;</span><span class="NAME">this.callback</span><span class="PUNC">(</span><span class="STRN">"modify"</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">this.point.geometry</span><span class="PUNC">,</span><span class="NAME">this.point</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.point.geometry.clearBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.drawFeature</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">drawFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.drawFeature</span><span class="PUNC">(</span><span class="NAME">this.point</span><span class="PUNC">,</span><span class="NAME">this.style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeometry</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">this.point</span><span class="PUNC">&&</span><span class="NAME">this.point.geometry</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">&&</span><span class="NAME">this.multi</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiPoint</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">geometryClone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geom</span><span class="PUNC">=</span><span class="NAME">this.getGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">geom</span><span class="PUNC">&&</span><span class="NAME">geom.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousedown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.checkModifiers</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastDown</span><span class="PUNC">&&</span><span class="NAME">this.lastDown.equals</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="NAME">this.drawing</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.lastDown</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.persist</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.destroyFeature</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="NAME">this.createFeature</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.modifyFeature</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="NAME">this.lastDown</span><span class="PUNC">=</span><span class="NAME">evt.xy</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mousemove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.drawing</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.modifyFeature</span><span class="PUNC">(</span><span class="NAME">evt.xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">mouseup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.drawing</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.finalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Handler.Point"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.GML</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">loaded</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">format</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">formatOptions</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newArguments</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">newArguments.push</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Vector.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">newArguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setVisibility</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">visibility</span><span class="PUNC">,</span><span class="NAME">noEvent</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.Vector.prototype.setVisibility.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.visibility</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.loaded</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.loadGML</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">moveTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">,</span><span class="NAME">zoomChanged</span><span class="PUNC">,</span><span class="NAME">minor</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.Vector.prototype.moveTo.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.visibility</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.loaded</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.loadGML</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">loadGML</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.loaded</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadstart"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Request.GET</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">url</span><span class="PUNC">:</span><span class="NAME">this.url</span><span class="PUNC">,</span><span class="NAME">success</span><span class="PUNC">:</span><span class="NAME">this.requestSuccess</span><span class="PUNC">,</span><span class="NAME">failure</span><span class="PUNC">:</span><span class="NAME">this.requestFailure</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.loaded</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setUrl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.url</span><span class="PUNC">=</span><span class="NAME">url</span><span class="PUNC">;</span><span class="NAME">this.destroyFeatures</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.loaded</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">this.loadGML</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">requestSuccess</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">request</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doc</span><span class="PUNC">=</span><span class="NAME">request.responseXML</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doc</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">doc.documentElement</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">doc</span><span class="PUNC">=</span><span class="NAME">request.responseText</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">this.formatOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.projection.equals</span><span class="PUNC">(</span><span class="NAME">this.map.getProjectionObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">options.externalProjection</span><span class="PUNC">=</span><span class="NAME">this.projection</span><span class="PUNC">;</span><span class="NAME">options.internalProjection</span><span class="PUNC">=</span><span class="NAME">this.map.getProjectionObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.format</span><span class="PUNC">?</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">this.format</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.GML</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.addFeatures</span><span class="PUNC">(</span><span class="NAME">gml.read</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">requestFailure</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">request</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.userError</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"errorLoadingGML"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'url'</span><span class="PUNC">:</span><span class="NAME">this.url</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"loadend"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.GML"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Vector.RootContainer</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">displayInLayerSwitcher</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">layers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.Vector.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">display</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getFeatureFromEvent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getFeatureFromEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Layer.Vector.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.collectRoots</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">map.events.register</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.handleChangeLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">map.events.unregister</span><span class="PUNC">(</span><span class="STRN">"changelayer"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.handleChangeLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.resetRoots</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Layer.Vector.prototype.removeMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">collectRoots</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.map.layers.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.renderer.moveRoot</span><span class="PUNC">(</span><span class="NAME">this.renderer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resetRoots</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.layers.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.renderer</span><span class="PUNC">&&</span><span class="NAME">layer.renderer.getRenderLayerId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.renderer.moveRoot</span><span class="PUNC">(</span><span class="NAME">layer.renderer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">handleChangeLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">evt.layer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">evt.property</span><span class="PUNC">==</span><span class="STRN">"order"</span><span class="PUNC">&&</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.resetRoots</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.collectRoots</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Layer.Vector.RootContainer"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.SelectFeature</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">EVENT_TYPES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"beforefeaturehighlighted"</span><span class="PUNC">,</span><span class="STRN">"featurehighlighted"</span><span class="PUNC">,</span><span class="STRN">"featureunhighlighted"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">multipleKey</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">toggleKey</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">multiple</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">clickout</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">toggle</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">hover</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">highlightOnly</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">box</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">onBeforeSelect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onSelect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">onUnselect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">geometryTypes</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layer</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">layers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">callbacks</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">selectStyle</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">renderIntent</span><span class="PUNC">:</span><span class="STRN">"select"</span><span class="PUNC">,</span><span class="NAME">handlers</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.EVENT_TYPES</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Control.prototype.EVENT_TYPES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Control.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.scope</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.scope</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="NAME">this.initLayer</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callbacks</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">click</span><span class="PUNC">:</span><span class="NAME">this.clickFeature</span><span class="PUNC">,</span><span class="NAME">clickout</span><span class="PUNC">:</span><span class="NAME">this.clickoutFeature</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.hover</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">callbacks.over</span><span class="PUNC">=</span><span class="NAME">this.overFeature</span><span class="PUNC">;</span><span class="NAME">callbacks.out</span><span class="PUNC">=</span><span class="NAME">this.outFeature</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="NAME">this.callbacks</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">callbacks</span><span class="PUNC">,</span><span class="NAME">this.callbacks</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handlers</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Feature</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.layer</span><span class="PUNC">,</span><span class="NAME">this.callbacks</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">geometryTypes</span><span class="PUNC">:</span><span class="NAME">this.geometryTypes</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.box</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.box</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Box</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">done</span><span class="PUNC">:</span><span class="NAME">this.selectBox</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">boxDivClassName</span><span class="PUNC">:</span><span class="STRN">"olHandlerBoxSelectFeature"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">initLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layers</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">;</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector.RootContainer</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="STRN">"_container"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">layers</span><span class="PUNC">:</span><span class="NAME">layers</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.layer</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">&&</span><span class="NAME">this.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.removeLayer</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="NAME">OpenLayers.Control.prototype.destroy.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">activate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.addLayer</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="NAME">this.handlers.feature.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.box</span><span class="PUNC">&&</span><span class="NAME">this.handlers.box</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.box.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.prototype.activate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">deactivate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.feature.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.handlers.box</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.box.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.map.removeLayer</span><span class="PUNC">(</span><span class="NAME">this.layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.prototype.deactivate.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unselectAll</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="NAME">this.layer</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">&lt;</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">layer.selectedFeatures.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">--</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">layer.selectedFeatures</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">||</span><span class="NAME">options.except</span><span class="PUNC">!=</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unselect</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clickFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.hover</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">feature.layer.selectedFeatures</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">selected</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.toggleSelect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unselect</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.multipleSelect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unselectAll</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">except</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.multipleSelect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unselectAll</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">except</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multipleSelect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.multiple</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.handlers.feature.evt</span><span class="PUNC">&&</span><span class="NAME">this.handlers.feature.evt</span><span class="PUNC">[</span><span class="NAME">this.multipleKey</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">toggleSelect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.toggle</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.handlers.feature.evt</span><span class="PUNC">&&</span><span class="NAME">this.handlers.feature.evt</span><span class="PUNC">[</span><span class="NAME">this.toggleKey</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">clickoutFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.hover</span><span class="PUNC">&&</span><span class="NAME">this.clickout</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">overFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">feature.layer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.hover</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.highlightOnly</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.highlight</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">layer.selectedFeatures</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">outFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.hover</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.highlightOnly</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature._lastHighlighter</span><span class="PUNC">==</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature._prevHighlighter</span><span class="PUNC">&&</span><span class="NAME">feature._prevHighlighter</span><span class="PUNC">!=</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">feature._lastHighlighter</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">control</span><span class="PUNC">=</span><span class="NAME">this.map.getControl</span><span class="PUNC">(</span><span class="NAME">feature._prevHighlighter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">control</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">control.highlight</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.unhighlight</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.unselect</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">highlight</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">feature.layer</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cont</span><span class="PUNC">=</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeaturehighlighted"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cont</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feature._prevHighlighter</span><span class="PUNC">=</span><span class="NAME">feature._lastHighlighter</span><span class="PUNC">;</span><span class="NAME">feature._lastHighlighter</span><span class="PUNC">=</span><span class="NAME">this.id</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">=</span><span class="NAME">this.selectStyle</span><span class="PUNC">||</span><span class="NAME">this.renderIntent</span><span class="PUNC">;</span><span class="NAME">layer.drawFeature</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featurehighlighted"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unhighlight</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">feature.layer</span><span class="PUNC">;</span><span class="NAME">feature._lastHighlighter</span><span class="PUNC">=</span><span class="NAME">feature._prevHighlighter</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">feature._prevHighlighter</span><span class="PUNC">;</span><span class="NAME">layer.drawFeature</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">feature.style</span><span class="PUNC">||</span><span class="NAME">feature.layer.style</span><span class="PUNC">||</span><span class="STRN">"default"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureunhighlighted"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">select</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cont</span><span class="PUNC">=</span><span class="NAME">this.onBeforeSelect.call</span><span class="PUNC">(</span><span class="NAME">this.scope</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">feature.layer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cont</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">cont</span><span class="PUNC">=</span><span class="NAME">layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"beforefeatureselected"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cont</span><span class="PUNC">!==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer.selectedFeatures.push</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.highlight</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.handlers.feature.lastFeature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.feature.lastFeature</span><span class="PUNC">=</span><span class="NAME">layer.selectedFeatures</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="NAME">layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureselected"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.onSelect.call</span><span class="PUNC">(</span><span class="NAME">this.scope</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">unselect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">feature.layer</span><span class="PUNC">;</span><span class="NAME">this.unhighlight</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Util.removeItem</span><span class="PUNC">(</span><span class="NAME">layer.selectedFeatures</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">layer.events.triggerEvent</span><span class="PUNC">(</span><span class="STRN">"featureunselected"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">feature</span><span class="PUNC">:</span><span class="NAME">feature</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.onUnselect.call</span><span class="PUNC">(</span><span class="NAME">this.scope</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">selectBox</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">position</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minXY</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">position.left</span><span class="PUNC">,</span><span class="NAME">position.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxXY</span><span class="PUNC">=</span><span class="NAME">this.map.getLonLatFromPixel</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Pixel</span><span class="PUNC">(</span><span class="NAME">position.right</span><span class="PUNC">,</span><span class="NAME">position.top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">minXY.lon</span><span class="PUNC">,</span><span class="NAME">minXY.lat</span><span class="PUNC">,</span><span class="NAME">maxXY.lon</span><span class="PUNC">,</span><span class="NAME">maxXY.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.multipleSelect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.unselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevMultiple</span><span class="PUNC">=</span><span class="NAME">this.multiple</span><span class="PUNC">;</span><span class="NAME">this.multiple</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="PUNC">=</span><span class="NAME">this.layers</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="NAME">this.layer</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">&lt;</span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">layer</span><span class="PUNC">=</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">layer.features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">layer.features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">feature.getVisibility</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.geometryTypes</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">this.geometryTypes</span><span class="PUNC">,</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bounds.toGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">intersects</span><span class="PUNC">(</span><span class="NAME">feature.geometry</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.indexOf</span><span class="PUNC">(</span><span class="NAME">layer.selectedFeatures</span><span class="PUNC">,</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.select</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="NAME">this.multiple</span><span class="PUNC">=</span><span class="NAME">prevMultiple</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.feature.setMap</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.box</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.handlers.box.setMap</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="NAME">OpenLayers.Control.prototype.setMap.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setLayer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isActive</span><span class="PUNC">=</span><span class="NAME">this.active</span><span class="PUNC">;</span><span class="NAME">this.unselectAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.layer.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.layers</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="NAME">this.initLayer</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.handlers.feature.layer</span><span class="PUNC">=</span><span class="NAME">this.layer</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isActive</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Control.SelectFeature"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Curve</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.MultiPoint</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.MultiPoint.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getLength</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">length</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">distanceTo</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeodesicLength</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geom</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gg</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gg.equals</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geom</span><span class="PUNC">=</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">transform</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">,</span><span class="NAME">gg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geom.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">geom.components.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geom.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p1</span><span class="PUNC">=</span><span class="NAME">geom.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">p2</span><span class="PUNC">=</span><span class="NAME">geom.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">length</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.distVincenty</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">lon</span><span class="PUNC">:</span><span class="NAME">p1.x</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">:</span><span class="NAME">p1.y</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">lon</span><span class="PUNC">:</span><span class="NAME">p2.x</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">:</span><span class="NAME">p2.y</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1126</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.Curve"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.Curve</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.Curve.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeComponent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.removeComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">intersects</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">||</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">||</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs1</span><span class="PUNC">=</span><span class="NAME">this.getSortedSegments</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">segs2</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">geometry.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">geometry.y</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">:</span><span class="NAME">geometry.x</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">:</span><span class="NAME">geometry.y</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">segs2</span><span class="PUNC">=</span><span class="NAME">geometry.getSortedSegments</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1127</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">seg1x1</span><span class="PUNC">,</span><span class="NAME">seg1x2</span><span class="PUNC">,</span><span class="NAME">seg1y1</span><span class="PUNC">,</span><span class="NAME">seg1y2</span><span class="PUNC">,</span><span class="NAME">seg2</span><span class="PUNC">,</span><span class="NAME">seg2y1</span><span class="PUNC">,</span><span class="NAME">seg2y2</span><span class="PUNC">;</span><span class="NAME">outer</span><span class="PUNC">:</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">segs1.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seg1</span><span class="PUNC">=</span><span class="NAME">segs1</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">seg1x1</span><span class="PUNC">=</span><span class="NAME">seg1.x1</span><span class="PUNC">;</span><span class="NAME">seg1x2</span><span class="PUNC">=</span><span class="NAME">seg1.x2</span><span class="PUNC">;</span><span class="NAME">seg1y1</span><span class="PUNC">=</span><span class="NAME">seg1.y1</span><span class="PUNC">;</span><span class="NAME">seg1y2</span><span class="PUNC">=</span><span class="NAME">seg1.y2</span><span class="PUNC">;</span><span class="NAME">inner</span><span class="PUNC">:</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">jlen</span><span class="PUNC">=</span><span class="NAME">segs2.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">jlen</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seg2</span><span class="PUNC">=</span><span class="NAME">segs2</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">seg2.x1</span><span class="PUNC">></span><span class="NAME">seg1x2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">seg2.x2</span><span class="PUNC">&lt;</span><span class="NAME">seg1x1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="NAME">seg2y1</span><span class="PUNC">=</span><span class="NAME">seg2.y1</span><span class="PUNC">;</span><span class="NAME">seg2y2</span><span class="PUNC">=</span><span class="NAME">seg2.y2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">seg2y1</span><span class="PUNC">,</span><span class="NAME">seg2y2</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">seg1y1</span><span class="PUNC">,</span><span class="NAME">seg1y2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">seg2y1</span><span class="PUNC">,</span><span class="NAME">seg2y2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">seg1y1</span><span class="PUNC">,</span><span class="NAME">seg1y2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.segmentsIntersect</span><span class="PUNC">(</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">seg2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.intersects</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getSortedSegments</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numSeg</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">numSeg</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">point1</span><span class="PUNC">,</span><span class="NAME">point2</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numSeg</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">point1</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">point2</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point1.x</span><span class="PUNC">&lt;</span><span class="NAME">point2.x</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">point1.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">point1.y</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">:</span><span class="NAME">point2.x</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">:</span><span class="NAME">point2.y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">point2.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">point2.y</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">:</span><span class="NAME">point1.x</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">:</span><span class="NAME">point1.y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">byX1</span><span class="PUNC">(</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">seg2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">seg1.x1</span><span class="PUNC">-</span><span class="NAME">seg2.x1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">segments.sort</span><span class="PUNC">(</span><span class="NAME">byX1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">splitWithSegment</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">seg</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.edge</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tolerance</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.tolerance</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lines</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">verts</span><span class="PUNC">=</span><span class="NAME">this.getVertices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersections</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">split</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vert1</span><span class="PUNC">,</span><span class="NAME">vert2</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="NAME">target</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interOptions</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">tolerance</span><span class="PUNC">:</span><span class="NAME">tolerance</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">stop</span><span class="PUNC">=</span><span class="NAME">verts.length</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">stop</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vert1</span><span class="PUNC">=</span><span class="NAME">verts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">vert1.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">vert2</span><span class="PUNC">=</span><span class="NAME">verts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">target</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">vert1.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">vert1.y</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">:</span><span class="NAME">vert2.x</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">:</span><span class="NAME">vert2.y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.segmentsIntersect</span><span class="PUNC">(</span><span class="NAME">seg</span><span class="PUNC">,</span><span class="NAME">target</span><span class="PUNC">,</span><span class="NAME">interOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">===</span><span class="NAME">seg.x1</span><span class="PUNC">&&</span><span class="NAME">point.y</span><span class="PUNC">===</span><span class="NAME">seg.y1</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">===</span><span class="NAME">seg.x2</span><span class="PUNC">&&</span><span class="NAME">point.y</span><span class="PUNC">===</span><span class="NAME">seg.y2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert1</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vertex</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">vertex</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">||</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">intersections</span><span class="PUNC">[</span><span class="NAME">intersections.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersections.push</span><span class="PUNC">(</span><span class="NAME">point.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="NAME">split</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="NAME">lines.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">point.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">split</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">vert2.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">lines.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersections.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xDir</span><span class="PUNC">=</span><span class="NAME">seg.x1</span><span class="PUNC">&lt;</span><span class="NAME">seg.x2</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yDir</span><span class="PUNC">=</span><span class="NAME">seg.y1</span><span class="PUNC">&lt;</span><span class="NAME">seg.y2</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">lines</span><span class="PUNC">:</span><span class="NAME">lines</span><span class="PUNC">,</span><span class="NAME">points</span><span class="PUNC">:</span><span class="NAME">intersections.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">xDir</span><span class="PUNC">*</span><span class="NAME">p1.x</span><span class="PUNC">-</span><span class="NAME">xDir</span><span class="PUNC">*</span><span class="NAME">p2.x</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">yDir</span><span class="PUNC">*</span><span class="NAME">p1.y</span><span class="PUNC">-</span><span class="NAME">yDir</span><span class="PUNC">*</span><span class="NAME">p2.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">split</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mutual</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.mutual</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceSplit</span><span class="PUNC">,</span><span class="NAME">targetSplit</span><span class="PUNC">,</span><span class="NAME">sourceParts</span><span class="PUNC">,</span><span class="NAME">targetParts</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">verts</span><span class="PUNC">=</span><span class="NAME">this.getVertices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vert1</span><span class="PUNC">,</span><span class="NAME">vert2</span><span class="PUNC">,</span><span class="NAME">seg</span><span class="PUNC">,</span><span class="NAME">splits</span><span class="PUNC">,</span><span class="NAME">lines</span><span class="PUNC">,</span><span class="NAME">point</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">stop</span><span class="PUNC">=</span><span class="NAME">verts.length</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">stop</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vert1</span><span class="PUNC">=</span><span class="NAME">verts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">vert2</span><span class="PUNC">=</span><span class="NAME">verts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">seg</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">vert1.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">vert1.y</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">:</span><span class="NAME">vert2.x</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">:</span><span class="NAME">vert2.y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="NAME">targetParts</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="NAME">target</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">vert1.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">targetParts.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">splits</span><span class="PUNC">=</span><span class="NAME">targetParts</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">splitWithSegment</span><span class="PUNC">(</span><span class="NAME">seg</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splits</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lines</span><span class="PUNC">=</span><span class="NAME">splits.lines</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lines.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lines.unshift</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Array.prototype.splice.apply</span><span class="PUNC">(</span><span class="NAME">targetParts</span><span class="PUNC">,</span><span class="NAME">lines</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">lines.length</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">splits.points.length</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">splits.points</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sourceParts.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">vert2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">point.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">&&</span><span class="NAME">sourceParts.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">points.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">vert2.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sourceParts.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="NAME">target.splitWith</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetParts</span><span class="PUNC">&&</span><span class="NAME">targetParts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceParts</span><span class="PUNC">&&</span><span class="NAME">sourceParts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetSplit</span><span class="PUNC">||</span><span class="NAME">sourceSplit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">sourceParts</span><span class="PUNC">,</span><span class="NAME">targetParts</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="NAME">targetParts</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">splitWith</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">geometry.split</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVertices</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vertices</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">this.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">vertices</span><span class="PUNC">=</span><span class="NAME">this.components.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">this.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">vertices</span><span class="PUNC">=</span><span class="NAME">this.components.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">distanceTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.edge</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">=</span><span class="NAME">edge</span><span class="PUNC">&&</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.details</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">,</span><span class="NAME">best</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">=</span><span class="NAME">Number.POSITIVE_INFINITY</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs</span><span class="PUNC">=</span><span class="NAME">this.getSortedSegments</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">geometry.x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">geometry.y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">segs.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seg</span><span class="PUNC">=</span><span class="NAME">segs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.distanceToSegment</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">seg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result.distance</span><span class="PUNC">&lt;</span><span class="NAME">min</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">=</span><span class="NAME">result.distance</span><span class="PUNC">;</span><span class="NAME">best</span><span class="PUNC">=</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">seg.x2</span><span class="PUNC">></span><span class="NAME">x</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">></span><span class="NAME">seg.y1</span><span class="PUNC">&&</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">seg.y2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">seg.y1</span><span class="PUNC">&&</span><span class="NAME">y</span><span class="PUNC">></span><span class="NAME">seg.y2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">details</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">best.distance</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">best.x</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">best.y</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="NAME">best.distance</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs0</span><span class="PUNC">=</span><span class="NAME">this.getSortedSegments</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">segs1</span><span class="PUNC">=</span><span class="NAME">geometry.getSortedSegments</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">seg0</span><span class="PUNC">,</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">intersection</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len1</span><span class="PUNC">=</span><span class="NAME">segs1.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interOptions</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">outer</span><span class="PUNC">:</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">segs0.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seg0</span><span class="PUNC">=</span><span class="NAME">segs0</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">x0</span><span class="PUNC">=</span><span class="NAME">seg0.x1</span><span class="PUNC">;</span><span class="NAME">y0</span><span class="PUNC">=</span><span class="NAME">seg0.y1</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">len1</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">seg1</span><span class="PUNC">=</span><span class="NAME">segs1</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">intersection</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.segmentsIntersect</span><span class="PUNC">(</span><span class="NAME">seg0</span><span class="PUNC">,</span><span class="NAME">seg1</span><span class="PUNC">,</span><span class="NAME">interOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">best</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">intersection.x</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">intersection.y</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">intersection.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">intersection.y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="WHIT"> </span><span class="NAME">outer</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.distanceToSegment</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">y0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">seg1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">result.distance</span><span class="PUNC">&lt;</span><span class="NAME">min</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">=</span><span class="NAME">result.distance</span><span class="PUNC">;</span><span class="NAME">best</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">min</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">x0</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">y0</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">result.x</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">result.y</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">details</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="NAME">best.distance</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">!==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">seg0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">geometry.distanceTo</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">seg0.x2</span><span class="PUNC">,</span><span class="NAME">seg0.y2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">=</span><span class="NAME">details</span><span class="PUNC">?</span><span class="NAME">result.distance</span><span class="PUNC">:</span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dist</span><span class="PUNC">&lt;</span><span class="NAME">min</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">details</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">min</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">result.x1</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">result.y1</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">result.x0</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">result.y0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="NAME">dist</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="NAME">geometry.distanceTo</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">details</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">best</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">best.distance</span><span class="PUNC">,</span><span class="NAME">x0</span><span class="PUNC">:</span><span class="NAME">best.x1</span><span class="PUNC">,</span><span class="NAME">y0</span><span class="PUNC">:</span><span class="NAME">best.y1</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">:</span><span class="NAME">best.x0</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">:</span><span class="NAME">best.y0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">best</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.LineString.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">addComponent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">added</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastPoint</span><span class="PUNC">=</span><span class="NAME">this.components.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">point.equals</span><span class="PUNC">(</span><span class="NAME">lastPoint</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">added</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.addComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">firstPoint</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.addComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">firstPoint</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">added</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">removeComponent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.removeComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">firstPoint</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.addComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">firstPoint</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">move</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">move</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotate</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rotate</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">resize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">resize</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="NAME">origin</span><span class="PUNC">,</span><span class="NAME">ratio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">transform</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">&&</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">component.transform</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="NAME">dest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="NAME">this.bounds</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getCentroid</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sumX</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sumY</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">sumX</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">b.x</span><span class="PUNC">+</span><span class="NAME">c.x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b.x</span><span class="PUNC">*</span><span class="NAME">c.y</span><span class="PUNC">-</span><span class="NAME">c.x</span><span class="PUNC">*</span><span class="NAME">b.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sumY</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">b.y</span><span class="PUNC">+</span><span class="NAME">c.y</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b.x</span><span class="PUNC">*</span><span class="NAME">c.y</span><span class="PUNC">-</span><span class="NAME">c.x</span><span class="PUNC">*</span><span class="NAME">b.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">this.getArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">sumX</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">6</span><span class="PUNC">*</span><span class="NAME">area</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">sumY</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">6</span><span class="PUNC">*</span><span class="NAME">area</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sum</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">sum</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">b.x</span><span class="PUNC">+</span><span class="NAME">c.x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">c.y</span><span class="PUNC">-</span><span class="NAME">b.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">sum</span><span class="PUNC">/</span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeodesicArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gg</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gg.equals</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ring</span><span class="PUNC">=</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">transform</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">,</span><span class="NAME">gg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">ring.components</span><span class="PUNC">&&</span><span class="NAME">ring.components.length</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">></span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p1</span><span class="PUNC">=</span><span class="NAME">ring.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">p2</span><span class="PUNC">=</span><span class="NAME">ring.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">area</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">(</span><span class="NAME">p2.x</span><span class="PUNC">-</span><span class="NAME">p1.x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">(</span><span class="NAME">p1.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Util.rad</span><span class="PUNC">(</span><span class="NAME">p2.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NAME">area</span><span class="PUNC">*</span><span class="NUMB">6378137.0</span><span class="PUNC">*</span><span class="NUMB">6378137.0</span><span class="PUNC">/</span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">containsPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">approx</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Number.limitSigDigs</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">digs</span><span class="PUNC">=</span><span class="NUMB">14</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">point.x</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">point.y</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getX</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">-</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x2</span><span class="PUNC">*</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">*</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">-</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numSeg</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">,</span><span class="NAME">end</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">,</span><span class="NAME">cx</span><span class="PUNC">,</span><span class="NAME">cy</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">crosses</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numSeg</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">start</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">x1</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">start.x</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">y1</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">start.y</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">end</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">x2</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">end.x</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">y2</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">end.y</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">==</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">py</span><span class="PUNC">==</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">&lt;=</span><span class="NAME">x2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">>=</span><span class="NAME">x1</span><span class="PUNC">&&</span><span class="NAME">px</span><span class="PUNC">&lt;=</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">x1</span><span class="PUNC">>=</span><span class="NAME">x2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">&lt;=</span><span class="NAME">x1</span><span class="PUNC">&&</span><span class="NAME">px</span><span class="PUNC">>=</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">crosses</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="NAME">cx</span><span class="PUNC">=</span><span class="NAME">approx</span><span class="PUNC">(</span><span class="NAME">getX</span><span class="PUNC">(</span><span class="NAME">py</span><span class="PUNC">,</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">digs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cx</span><span class="PUNC">==</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">&lt;</span><span class="NAME">y2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">py</span><span class="PUNC">>=</span><span class="NAME">y1</span><span class="PUNC">&&</span><span class="NAME">py</span><span class="PUNC">&lt;=</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">y1</span><span class="PUNC">></span><span class="NAME">y2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">py</span><span class="PUNC">&lt;=</span><span class="NAME">y1</span><span class="PUNC">&&</span><span class="NAME">py</span><span class="PUNC">>=</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">crosses</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">cx</span><span class="PUNC">&lt;=</span><span class="NAME">px</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">!=</span><span class="NAME">x2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">cx</span><span class="PUNC">&lt;</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">cx</span><span class="PUNC">></span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">&lt;</span><span class="NAME">y2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">py</span><span class="PUNC">>=</span><span class="NAME">y1</span><span class="PUNC">&&</span><span class="NAME">py</span><span class="PUNC">&lt;</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">y1</span><span class="PUNC">></span><span class="NAME">y2</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">py</span><span class="PUNC">&lt;</span><span class="NAME">y1</span><span class="PUNC">&&</span><span class="NAME">py</span><span class="PUNC">>=</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">++</span><span class="NAME">crosses</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contained</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">crosses</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">crosses</span><span class="PUNC">&</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contained</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">intersects</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">this.containsPoint</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.intersects</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.LineString.prototype.intersects.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">intersects</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getVertices</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">this.components.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.components.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.Collection</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">split</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mutual</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.mutual</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">splits</span><span class="PUNC">,</span><span class="NAME">sourceLine</span><span class="PUNC">,</span><span class="NAME">sourceLines</span><span class="PUNC">,</span><span class="NAME">sourceSplit</span><span class="PUNC">,</span><span class="NAME">targetSplit</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceLine</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">sourceSplit</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">targetParts.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">splits</span><span class="PUNC">=</span><span class="NAME">sourceLine.split</span><span class="PUNC">(</span><span class="NAME">targetParts</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splits</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceLines</span><span class="PUNC">=</span><span class="NAME">splits</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">klen</span><span class="PUNC">=</span><span class="NAME">sourceLines.length</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NAME">klen</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">sourceParts.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceParts</span><span class="PUNC">[</span><span class="NAME">sourceParts.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addComponent</span><span class="PUNC">(</span><span class="NAME">sourceLines</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">sourceParts.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">sourceLines</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="NAME">sourceSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">splits</span><span class="PUNC">=</span><span class="NAME">splits</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splits.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">splits.unshift</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Array.prototype.splice.apply</span><span class="PUNC">(</span><span class="NAME">targetParts</span><span class="PUNC">,</span><span class="NAME">splits</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sourceSplit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceParts.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceParts</span><span class="PUNC">[</span><span class="NAME">sourceParts.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addComponent</span><span class="PUNC">(</span><span class="NAME">sourceLine.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">(</span><span class="NAME">sourceLine.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceParts</span><span class="PUNC">&&</span><span class="NAME">sourceParts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetParts</span><span class="PUNC">&&</span><span class="NAME">targetParts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceSplit</span><span class="PUNC">||</span><span class="NAME">targetSplit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">sourceParts</span><span class="PUNC">,</span><span class="NAME">targetParts</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="NAME">targetParts</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">splitWith</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mutual</span><span class="PUNC">=</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.mutual</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">splits</span><span class="PUNC">,</span><span class="NAME">targetLine</span><span class="PUNC">,</span><span class="NAME">sourceLines</span><span class="PUNC">,</span><span class="NAME">sourceSplit</span><span class="PUNC">,</span><span class="NAME">targetSplit</span><span class="PUNC">,</span><span class="NAME">sourceParts</span><span class="PUNC">,</span><span class="NAME">targetParts</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetSplit</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">targetLine</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">sourceParts.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">splits</span><span class="PUNC">=</span><span class="NAME">sourceParts</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">targetLine</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splits</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceLines</span><span class="PUNC">=</span><span class="NAME">splits</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceLines.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceLines.unshift</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">Array.prototype.splice.apply</span><span class="PUNC">(</span><span class="NAME">sourceParts</span><span class="PUNC">,</span><span class="NAME">sourceLines</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">sourceLines.length</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="NAME">splits</span><span class="PUNC">=</span><span class="NAME">splits</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splits.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">splits</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">targetLine.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">klen</span><span class="PUNC">=</span><span class="NAME">splits.length</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NAME">klen</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">targetParts.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">[</span><span class="NAME">targetParts.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addComponent</span><span class="PUNC">(</span><span class="NAME">splits</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">targetParts.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">splits</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="NAME">targetSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">targetSplit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetParts.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">[</span><span class="NAME">targetParts.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addComponent</span><span class="PUNC">(</span><span class="NAME">targetLine.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">targetLine.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="NAME">geometry.split</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceParts</span><span class="PUNC">&&</span><span class="NAME">sourceParts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">sourceSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">sourceParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">targetParts</span><span class="PUNC">&&</span><span class="NAME">targetParts.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">targetSplit</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">targetParts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sourceSplit</span><span class="PUNC">||</span><span class="NAME">targetSplit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mutual</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">sourceParts</span><span class="PUNC">,</span><span class="NAME">targetParts</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">results</span><span class="PUNC">=</span><span class="NAME">targetParts</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.MultiLineString"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.Collection</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getGeodesicArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.components.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getGeodesicArea</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getGeodesicArea</span><span class="PUNC">(</span><span class="NAME">projection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">containsPoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numRings</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contained</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">numRings</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">contained</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">containsPoint</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">contained</span><span class="PUNC">!==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">contained</span><span class="PUNC">&&</span><span class="NAME">numRings</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hole</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numRings</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">hole</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">containsPoint</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">hole</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">hole</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">contained</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">contained</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contained</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">intersects</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">this.containsPoint</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.LineString"</span><span class="PUNC">||</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.LinearRing"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">this.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.intersects</span><span class="PUNC">(</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">this.containsPoint</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">this.intersects</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">intersect</span><span class="PUNC">&&</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">==</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">=</span><span class="NAME">this.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">=</span><span class="NAME">ring.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">intersect</span><span class="PUNC">=</span><span class="NAME">geometry.containsPoint</span><span class="PUNC">(</span><span class="NAME">ring.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">intersect</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersect</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">distanceTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">&&</span><span class="NAME">options.edge</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">edge</span><span class="PUNC">&&</span><span class="NAME">this.intersects</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.distanceTo.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.Polygon.createRegularPolygon</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">origin</span><span class="PUNC">,</span><span class="NAME">radius</span><span class="PUNC">,</span><span class="NAME">sides</span><span class="PUNC">,</span><span class="NAME">rotation</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">sides</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">rotation</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">angle</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">rotation</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotatedAngle</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">sides</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">rotatedAngle</span><span class="PUNC">=</span><span class="NAME">angle</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NAME">sides</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">origin.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">radius</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">rotatedAngle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">origin.y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">radius</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">rotatedAngle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">ring</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.OSM</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Format.XML</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">checkTags</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">interestingTagsExclude</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">areaTags</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer_defaults</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'interestingTagsExclude'</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">'source'</span><span class="PUNC">,</span><span class="STRN">'source_ref'</span><span class="PUNC">,</span><span class="STRN">'source:ref'</span><span class="PUNC">,</span><span class="STRN">'history'</span><span class="PUNC">,</span><span class="STRN">'attribution'</span><span class="PUNC">,</span><span class="STRN">'created_by'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">'areaTags'</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">'area'</span><span class="PUNC">,</span><span class="STRN">'building'</span><span class="PUNC">,</span><span class="STRN">'leisure'</span><span class="PUNC">,</span><span class="STRN">'tourism'</span><span class="PUNC">,</span><span class="STRN">'ruins'</span><span class="PUNC">,</span><span class="STRN">'historic'</span><span class="PUNC">,</span><span class="STRN">'landuse'</span><span class="PUNC">,</span><span class="STRN">'military'</span><span class="PUNC">,</span><span class="STRN">'natural'</span><span class="PUNC">,</span><span class="STRN">'sport'</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">layer_defaults</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="NAME">layer_defaults</span><span class="PUNC">,</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interesting</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">layer_defaults.interestingTagsExclude.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">interesting</span><span class="PUNC">[</span><span class="NAME">layer_defaults.interestingTagsExclude</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="NAME">layer_defaults.interestingTagsExclude</span><span class="PUNC">=</span><span class="NAME">interesting</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">area</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">layer_defaults.areaTags.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">area</span><span class="PUNC">[</span><span class="NAME">layer_defaults.areaTags</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="NAME">layer_defaults.areaTags</span><span class="PUNC">=</span><span class="NAME">area</span><span class="PUNC">;</span><span class="NAME">this.externalProjection</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.XML.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">layer_defaults</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">read</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">doc</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">doc</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Format.XML.prototype.read.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">doc</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="NAME">this.getNodes</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ways</span><span class="PUNC">=</span><span class="NAME">this.getWays</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feat_list</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">ways.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">ways.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point_list</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodes.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">poly</span><span class="PUNC">=</span><span class="NAME">this.isWayArea</span><span class="PUNC">(</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">node.lon</span><span class="PUNC">,</span><span class="NAME">node.lat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point.osm_id</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">point_list</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">point</span><span class="PUNC">;</span><span class="NAME">node.used</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">poly</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">(</span><span class="NAME">point_list</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">point_list</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">&&</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.externalProjection</span><span class="PUNC">,</span><span class="NAME">this.internalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tags</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feat.osm_id</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">ways</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feat.fid</span><span class="PUNC">=</span><span class="STRN">"way."</span><span class="PUNC">+</span><span class="NAME">feat.osm_id</span><span class="PUNC">;</span><span class="NAME">feat_list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">feat</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node_id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">node_id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">node.used</span><span class="PUNC">||</span><span class="NAME">this.checkTags</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tags</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.checkTags</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="NAME">this.getTags</span><span class="PUNC">(</span><span class="NAME">node.node</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.used</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="NAME">tags</span><span class="PUNC">=</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">tags</span><span class="PUNC">=</span><span class="NAME">this.getTags</span><span class="PUNC">(</span><span class="NAME">node.node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">[</span><span class="STRN">'lon'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">node</span><span class="PUNC">[</span><span class="STRN">'lat'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">tags</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">&&</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">feat.geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.externalProjection</span><span class="PUNC">,</span><span class="NAME">this.internalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="NAME">feat.osm_id</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">node_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feat.fid</span><span class="PUNC">=</span><span class="STRN">"node."</span><span class="PUNC">+</span><span class="NAME">feat.osm_id</span><span class="PUNC">;</span><span class="NAME">feat_list.push</span><span class="PUNC">(</span><span class="NAME">feat</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="NAME">node.node</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">feat_list</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getNodes</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node_list</span><span class="PUNC">=</span><span class="NAME">doc.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"node"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">node_list.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">node_list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">node.getAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="STRN">'lat'</span><span class="PUNC">:</span><span class="NAME">node.getAttribute</span><span class="PUNC">(</span><span class="STRN">"lat"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'lon'</span><span class="PUNC">:</span><span class="NAME">node.getAttribute</span><span class="PUNC">(</span><span class="STRN">"lon"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'node'</span><span class="PUNC">:</span><span class="NAME">node</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getWays</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">doc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">way_list</span><span class="PUNC">=</span><span class="NAME">doc.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"way"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">return_ways</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">way_list.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">way</span><span class="PUNC">=</span><span class="NAME">way_list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">way_object</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">way.getAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">way_object.tags</span><span class="PUNC">=</span><span class="NAME">this.getTags</span><span class="PUNC">(</span><span class="NAME">way</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node_list</span><span class="PUNC">=</span><span class="NAME">way.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"nd"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">way_object.nodes</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">node_list.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">node_list.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">way_object.nodes</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">node_list</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"ref"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="NAME">return_ways.push</span><span class="PUNC">(</span><span class="NAME">way_object</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">return_ways</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">getTags</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dom_node</span><span class="PUNC">,</span><span class="NAME">interesting_tags</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tag_list</span><span class="PUNC">=</span><span class="NAME">dom_node.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"tag"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tags</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">interesting</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">tag_list.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="NAME">tag_list</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"k"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tags</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tag_list</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"v"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">interesting_tags</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.interestingTagsExclude</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">interesting</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">interesting_tags</span><span class="PUNC">?</span><span class="PUNC">[</span><span class="NAME">tags</span><span class="PUNC">,</span><span class="NAME">interesting</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">tags</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">isWayArea</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">way</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">poly_shaped</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">poly_tags</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">way.nodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">way.nodes</span><span class="PUNC">[</span><span class="NAME">way.nodes.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">poly_shaped</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.checkTags</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">way.tags</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.areaTags</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">poly_tags</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">poly_shaped</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.checkTags</span><span class="PUNC">?</span><span class="NAME">poly_tags</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">write</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">features</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="NAME">this.osm_id</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.created_nodes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">root_node</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"osm"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">root_node.setAttribute</span><span class="PUNC">(</span><span class="STRN">"version"</span><span class="PUNC">,</span><span class="STRN">"0.5"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">root_node.setAttribute</span><span class="PUNC">(</span><span class="STRN">"generator"</span><span class="PUNC">,</span><span class="STRN">"OpenLayers "</span><span class="PUNC">+</span><span class="NAME">OpenLayers.VERSION_NUMBER</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">features.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="NAME">this.createFeatureNodes</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">root_node.appendChild</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.XML.prototype.write.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">root_node</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createFeatureNodes</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">=</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">className.substring</span><span class="PUNC">(</span><span class="NAME">className.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">type.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">=</span><span class="NAME">this.createXML</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">builder</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="NAME">builder.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">feature</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createXML</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">'point'</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">point.geometry</span><span class="PUNC">?</span><span class="NAME">point.geometry</span><span class="PUNC">:</span><span class="NAME">point</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">already_exists</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point.osm_id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">point.osm_id</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.created_nodes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">already_exists</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">this.osm_id</span><span class="PUNC">;</span><span class="NAME">this.osm_id</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">already_exists</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.created_nodes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"node"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="NAME">this.created_nodes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">node</span><span class="PUNC">;</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="STRN">"lon"</span><span class="PUNC">,</span><span class="NAME">geometry.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="STRN">"lat"</span><span class="PUNC">,</span><span class="NAME">geometry.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point.attributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.serializeTags</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="NAME">this.setState</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">already_exists</span><span class="PUNC">?</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">node</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">linestring</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">feature.geometry</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature.osm_id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">feature.osm_id</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">this.osm_id</span><span class="PUNC">;</span><span class="NAME">this.osm_id</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">way</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"way"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">way.setAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">geometry.components.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.createXML</span><span class="PUNC">[</span><span class="STRN">'point'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">node.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">node</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node_ref</span><span class="PUNC">=</span><span class="NAME">node.getAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">nodes.push</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">node_ref</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">osm_id</span><span class="PUNC">;</span><span class="NAME">node</span><span class="PUNC">=</span><span class="NAME">this.created_nodes</span><span class="PUNC">[</span><span class="NAME">node_ref</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="NAME">this.setState</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nd_dom</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"nd"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">nd_dom.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ref"</span><span class="PUNC">,</span><span class="NAME">node_ref</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">way.appendChild</span><span class="PUNC">(</span><span class="NAME">nd_dom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="NAME">this.serializeTags</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">way</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">nodes.push</span><span class="PUNC">(</span><span class="NAME">way</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">polygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'area'</span><span class="PUNC">:</span><span class="STRN">'yes'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">feature.attributes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feat</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="NAME">feature.geometry.components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feat.osm_id</span><span class="PUNC">=</span><span class="NAME">feature.osm_id</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.createXML</span><span class="PUNC">[</span><span class="STRN">'linestring'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">feat</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">serializeTags</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">feature.attributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">"tag"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tag.setAttribute</span><span class="PUNC">(</span><span class="STRN">"k"</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tag.setAttribute</span><span class="PUNC">(</span><span class="STRN">"v"</span><span class="PUNC">,</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">node.appendChild</span><span class="PUNC">(</span><span class="NAME">tag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">setState</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">,</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature.state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">feature.state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.UPDATE</span><span class="PUNC">:</span><span class="NAME">state</span><span class="PUNC">=</span><span class="STRN">"modify"</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">OpenLayers.State.DELETE</span><span class="PUNC">:</span><span class="NAME">state</span><span class="PUNC">=</span><span class="STRN">"delete"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="STRN">"action"</span><span class="PUNC">,</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Format.OSM"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Geometry.MultiPolygon</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Geometry.Collection</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">componentTypes</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"OpenLayers.Geometry.Polygon"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Geometry.Collection.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Geometry.MultiPolygon"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.GML</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Class</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Format.XML</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">featureNS</span><span class="PUNC">:</span><span class="STRN">"http://mapserver.gis.umn.edu/mapserver"</span><span class="PUNC">,</span><span class="NAME">featurePrefix</span><span class="PUNC">:</span><span class="STRN">"feature"</span><span class="PUNC">,</span><span class="NAME">featureName</span><span class="PUNC">:</span><span class="STRN">"featureMember"</span><span class="PUNC">,</span><span class="NAME">layerName</span><span class="PUNC">:</span><span class="STRN">"features"</span><span class="PUNC">,</span><span class="NAME">geometryName</span><span class="PUNC">:</span><span class="STRN">"geometry"</span><span class="PUNC">,</span><span class="NAME">collectionName</span><span class="PUNC">:</span><span class="STRN">"FeatureCollection"</span><span class="PUNC">,</span><span class="NAME">gmlns</span><span class="PUNC">:</span><span class="STRN">"http://www.opengis.net/gml"</span><span class="PUNC">,</span><span class="NAME">extractAttributes</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">xy</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.regExes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">trimSpace</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="REGX">/^\s*|\s*$/g</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">removeSpace</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="REGX">/\s*/g</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">splitSpace</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="REGX">/\s+/</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">trimComma</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="REGX">/\s*,\s*/g</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenLayers.Format.XML.prototype.initialize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">options</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">read</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">OpenLayers.Format.XML.prototype.read.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">data</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureNodes</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">data.documentElement</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="NAME">this.featureName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">featureNodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="NAME">this.parseFeature</span><span class="PUNC">(</span><span class="NAME">featureNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features.push</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">parseFeature</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">order</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"MultiPolygon"</span><span class="PUNC">,</span><span class="STRN">"Polygon"</span><span class="PUNC">,</span><span class="STRN">"MultiLineString"</span><span class="PUNC">,</span><span class="STRN">"LineString"</span><span class="PUNC">,</span><span class="STRN">"MultiPoint"</span><span class="PUNC">,</span><span class="STRN">"Point"</span><span class="PUNC">,</span><span class="STRN">"Envelope"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">nodeList</span><span class="PUNC">,</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">parser</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">order.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parser</span><span class="PUNC">=</span><span class="NAME">this.parseGeometry</span><span class="PUNC">[</span><span class="NAME">type.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parser</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">parser.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">&&</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.externalProjection</span><span class="PUNC">,</span><span class="NAME">this.internalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">OpenLayers.Console.error</span><span class="PUNC">(</span><span class="NAME">OpenLayers.i18n</span><span class="PUNC">(</span><span class="STRN">"unsupportedGeometryType"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">'geomType'</span><span class="PUNC">:</span><span class="NAME">type</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bounds</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">boxNodes</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"Box"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">boxNodes.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">boxNode</span><span class="PUNC">=</span><span class="NAME">boxNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">box</span><span class="PUNC">=</span><span class="NAME">this.parseGeometry</span><span class="PUNC">[</span><span class="STRN">"box"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">boxNode</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentNode</span><span class="PUNC">=</span><span class="NAME">boxNode.parentNode</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentName</span><span class="PUNC">=</span><span class="NAME">parentNode.localName</span><span class="PUNC">||</span><span class="NAME">parentNode.nodeName.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">parentName</span><span class="PUNC">===</span><span class="STRN">"boundedBy"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">bounds</span><span class="PUNC">=</span><span class="NAME">box</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">box.toGeometry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.extractAttributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">attributes</span><span class="PUNC">=</span><span class="NAME">this.parseAttributes</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">,</span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">feature.bounds</span><span class="PUNC">=</span><span class="NAME">bounds</span><span class="PUNC">;</span><span class="NAME">feature.gml</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">featureType</span><span class="PUNC">:</span><span class="NAME">node.firstChild.nodeName.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">featureNS</span><span class="PUNC">:</span><span class="NAME">node.firstChild.namespaceURI</span><span class="PUNC">,</span><span class="NAME">featureNSPrefix</span><span class="PUNC">:</span><span class="NAME">node.firstChild.prefix</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">childNode</span><span class="PUNC">=</span><span class="NAME">node.firstChild</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fid</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">childNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">childNode.nodeType</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">fid</span><span class="PUNC">=</span><span class="NAME">childNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">"fid"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">childNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="NAME">childNode</span><span class="PUNC">=</span><span class="NAME">childNode.nextSibling</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="NAME">feature.fid</span><span class="PUNC">=</span><span class="NAME">fid</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">parseGeometry</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">,</span><span class="NAME">coordString</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"pos"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="NAME">this.regExes.splitSpace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"coordinates"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.removeSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"coord"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"X"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"Y"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">yList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">xList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">,</span><span class="NAME">yList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multipoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"Point"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">nodeList.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">=</span><span class="NAME">this.parseGeometry.point.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiPoint</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">linestring</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">,</span><span class="NAME">coordString</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"posList"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">this.getChildValue</span><span class="PUNC">(</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="NAME">this.regExes.splitSpace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"dimension"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">coords.length</span><span class="PUNC">/</span><span class="NAME">dim</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NAME">dim</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">z</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="KEYW">null</span><span class="PUNC">:</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"coordinates"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">this.getChildValue</span><span class="PUNC">(</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimComma</span><span class="PUNC">,</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointList</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="NAME">this.regExes.splitSpace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pointList.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">pointList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">points.length</span><span class="PUNC">!=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">line</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">line</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LineString</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multilinestring</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"LineString"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">line</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">nodeList.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">line</span><span class="PUNC">=</span><span class="NAME">this.parseGeometry.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiLineString</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">polygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"LinearRing"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">nodeList.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ring</span><span class="PUNC">=</span><span class="NAME">this.parseGeometry.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multipolygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"Polygon"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">nodeList.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">polygon</span><span class="PUNC">=</span><span class="NAME">this.parseGeometry.polygon.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.MultiPolygon</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">envelope</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordString</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">envelope</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lpoint</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"lowerCorner"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lpoint.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lpoint.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">lpoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="NAME">this.regExes.splitSpace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1248</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1249</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lowerPoint</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lowerPoint</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">upoint</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"upperCorner"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">upoint.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">upoint.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">upoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">;</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">coordString.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="NAME">this.regExes.splitSpace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.xy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">upperPoint</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">upperPoint</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">lowerPoint</span><span class="PUNC">&&</span><span class="NAME">upperPoint</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">lowerPoint.x</span><span class="PUNC">,</span><span class="NAME">lowerPoint.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">upperPoint.x</span><span class="PUNC">,</span><span class="NAME">lowerPoint.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">upperPoint.x</span><span class="PUNC">,</span><span class="NAME">upperPoint.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">lowerPoint.x</span><span class="PUNC">,</span><span class="NAME">upperPoint.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Point</span><span class="PUNC">(</span><span class="NAME">lowerPoint.x</span><span class="PUNC">,</span><span class="NAME">lowerPoint.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.LinearRing</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">envelope</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Geometry.Polygon</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">ring</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">envelope</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">box</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeList</span><span class="PUNC">=</span><span class="NAME">this.getElementsByTagNameNS</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"coordinates"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordString</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">,</span><span class="NAME">beginPoint</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">endPoint</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeList.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">coordString</span><span class="PUNC">=</span><span class="NAME">nodeList</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstChild.nodeValue</span><span class="PUNC">;</span><span class="NAME">coords</span><span class="PUNC">=</span><span class="NAME">coordString.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">coords.length</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">beginPoint</span><span class="PUNC">=</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">endPoint</span><span class="PUNC">=</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">beginPoint</span><span class="PUNC">!==</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">endPoint</span><span class="PUNC">!==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">beginPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">beginPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">endPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">endPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">parseAttributes</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">childNode</span><span class="PUNC">=</span><span class="NAME">node.firstChild</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">child</span><span class="PUNC">,</span><span class="NAME">grandchildren</span><span class="PUNC">,</span><span class="NAME">grandchild</span><span class="PUNC">,</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">childNode</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">childNode.nodeType</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">children</span><span class="PUNC">=</span><span class="NAME">childNode.childNodes</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">children.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">child</span><span class="PUNC">=</span><span class="NAME">children</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">child.nodeType</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">grandchildren</span><span class="PUNC">=</span><span class="NAME">child.childNodes</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">grandchildren.length</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">grandchild</span><span class="PUNC">=</span><span class="NAME">grandchildren</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">grandchild.nodeType</span><span class="PUNC">==</span><span class="NUMB">3</span><span class="PUNC">||</span><span class="NAME">grandchild.nodeType</span><span class="PUNC">==</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">name</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">child.prefix</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">child.nodeName.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">child.nodeName</span><span class="PUNC">;</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">grandchild.nodeValue.replace</span><span class="PUNC">(</span><span class="NAME">this.regExes.trimSpace</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">value</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="NAME">child.nodeName.split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="NAME">childNode</span><span class="PUNC">=</span><span class="NAME">childNode.nextSibling</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">write</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">features</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">features</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">features</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="STRN">"http://www.opengis.net/wfs"</span><span class="PUNC">,</span><span class="STRN">"wfs:"</span><span class="PUNC">+</span><span class="NAME">this.collectionName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">features.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">this.createFeatureXML</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.XML.prototype.write.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">gml</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">createFeatureXML</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">feature.geometry</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geometryNode</span><span class="PUNC">=</span><span class="NAME">this.buildGeometryNode</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">geomContainer</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.featureNS</span><span class="PUNC">,</span><span class="NAME">this.featurePrefix</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="NAME">this.geometryName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">geomContainer.appendChild</span><span class="PUNC">(</span><span class="NAME">geometryNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureNode</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:"</span><span class="PUNC">+</span><span class="NAME">this.featureName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">featureContainer</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.featureNS</span><span class="PUNC">,</span><span class="NAME">this.featurePrefix</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="NAME">this.layerName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fid</span><span class="PUNC">=</span><span class="NAME">feature.fid</span><span class="PUNC">||</span><span class="NAME">feature.id</span><span class="PUNC">;</span><span class="NAME">featureContainer.setAttribute</span><span class="PUNC">(</span><span class="STRN">"fid"</span><span class="PUNC">,</span><span class="NAME">fid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">featureContainer.appendChild</span><span class="PUNC">(</span><span class="NAME">geomContainer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">feature.attributes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrText</span><span class="PUNC">=</span><span class="NAME">this.createTextNode</span><span class="PUNC">(</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodename</span><span class="PUNC">=</span><span class="NAME">attr.substring</span><span class="PUNC">(</span><span class="NAME">attr.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attrContainer</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.featureNS</span><span class="PUNC">,</span><span class="NAME">this.featurePrefix</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="NAME">nodename</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">attrContainer.appendChild</span><span class="PUNC">(</span><span class="NAME">attrText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">featureContainer.appendChild</span><span class="PUNC">(</span><span class="NAME">attrContainer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="NAME">featureNode.appendChild</span><span class="PUNC">(</span><span class="NAME">featureContainer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">featureNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">buildGeometryNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.externalProjection</span><span class="PUNC">&&</span><span class="NAME">this.internalProjection</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">geometry</span><span class="PUNC">=</span><span class="NAME">geometry.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">geometry.transform</span><span class="PUNC">(</span><span class="NAME">this.internalProjection</span><span class="PUNC">,</span><span class="NAME">this.externalProjection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">=</span><span class="NAME">geometry.CLASS_NAME</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">=</span><span class="NAME">className.substring</span><span class="PUNC">(</span><span class="NAME">className.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">builder</span><span class="PUNC">=</span><span class="NAME">this.buildGeometry</span><span class="PUNC">[</span><span class="NAME">type.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">builder.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">buildGeometry</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:Point"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">this.buildCoordinatesNode</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multipoint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:MultiPoint"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pointMember</span><span class="PUNC">,</span><span class="NAME">pointGeom</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pointMember</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:pointMember"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pointGeom</span><span class="PUNC">=</span><span class="NAME">this.buildGeometry.point.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">pointMember.appendChild</span><span class="PUNC">(</span><span class="NAME">pointGeom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">pointMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">linestring</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:LineString"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">this.buildCoordinatesNode</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multilinestring</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:MultiLineString"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lines</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lineMember</span><span class="PUNC">,</span><span class="NAME">lineGeom</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">lines.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">lineMember</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:lineStringMember"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">lineGeom</span><span class="PUNC">=</span><span class="NAME">this.buildGeometry.linestring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">lines</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">lineMember.appendChild</span><span class="PUNC">(</span><span class="NAME">lineGeom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">lineMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">linearring</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:LinearRing"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">this.buildCoordinatesNode</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">polygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:Polygon"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ringMember</span><span class="PUNC">,</span><span class="NAME">ringGeom</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">rings.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"outerBoundaryIs"</span><span class="PUNC">:</span><span class="STRN">"innerBoundaryIs"</span><span class="PUNC">;</span><span class="NAME">ringMember</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:"</span><span class="PUNC">+</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">ringGeom</span><span class="PUNC">=</span><span class="NAME">this.buildGeometry.linearring.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">ringMember.appendChild</span><span class="PUNC">(</span><span class="NAME">ringGeom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">ringMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">multipolygon</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:MultiPolygon"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">polys</span><span class="PUNC">=</span><span class="NAME">geometry.components</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">polyMember</span><span class="PUNC">,</span><span class="NAME">polyGeom</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">polys.length</span><span class="PUNC">;</span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">polyMember</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:polygonMember"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">polyGeom</span><span class="PUNC">=</span><span class="NAME">this.buildGeometry.polygon.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">polys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">polyMember.appendChild</span><span class="PUNC">(</span><span class="NAME">polyGeom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">polyMember</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">bounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:Box"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gml.appendChild</span><span class="PUNC">(</span><span class="NAME">this.buildCoordinatesNode</span><span class="PUNC">(</span><span class="NAME">bounds</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gml</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">buildCoordinatesNode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coordinatesNode</span><span class="PUNC">=</span><span class="NAME">this.createElementNS</span><span class="PUNC">(</span><span class="NAME">this.gmlns</span><span class="PUNC">,</span><span class="STRN">"gml:coordinates"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordinatesNode.setAttribute</span><span class="PUNC">(</span><span class="STRN">"decimal"</span><span class="PUNC">,</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordinatesNode.setAttribute</span><span class="PUNC">(</span><span class="STRN">"cs"</span><span class="PUNC">,</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordinatesNode.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ts"</span><span class="PUNC">,</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">geometry</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parts.push</span><span class="PUNC">(</span><span class="NAME">geometry.left</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">geometry.bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">parts.push</span><span class="PUNC">(</span><span class="NAME">geometry.right</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">geometry.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">geometry.components</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">geometry.components</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">geometry</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">parts.push</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">txtNode</span><span class="PUNC">=</span><span class="NAME">this.createTextNode</span><span class="PUNC">(</span><span class="NAME">parts.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">coordinatesNode.appendChild</span><span class="PUNC">(</span><span class="NAME">txtNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">coordinatesNode</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">CLASS_NAME</span><span class="PUNC">:</span><span class="STRN">"OpenLayers.Format.GML"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span></pre></body></html>