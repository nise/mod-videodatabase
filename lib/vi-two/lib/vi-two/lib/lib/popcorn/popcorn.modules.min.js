(function(n,e){var s=n.document,q=n.location,m=/:\/\//,p=q.href.replace(q.href.split("/").slice(-1)[0],""),k=function(b,d,a){b=b||0;d=(d||b||0)+1;a=a||1;d=Math.ceil((d-b)/a)||0;var i=0,c=[];for(c.length=d;i<d;){c[i++]=b;b+=a}return c};e.sequence=function(b,d){return new e.sequence.init(b,d)};e.sequence.init=function(b,d){this.parent=s.getElementById(b);this.seqId=e.guid("__sequenced");this.queue=[];this.playlist=[];this.inOuts={ofVideos:[],ofClips:[]};this.dims={width:0,height:0};this.active=0;this.playing=
this.cycling=false;this.times={last:0};this.events={};var a=this,i=0;e.forEach(d,function(c,f){var h=s.createElement("video");h.preload="auto";h.controls=true;h.style.display=f&&"none"||"";h.id=a.seqId+"-"+f;a.queue.push(h);var g=c["in"],j=c.out;a.inOuts.ofVideos.push({"in":g!==undefined&&g||1,out:j!==undefined&&j||0});a.inOuts.ofVideos[f].out=a.inOuts.ofVideos[f].out||a.inOuts.ofVideos[f]["in"]+2;h.src=!m.test(c.src)?p+c.src:c.src;h.setAttribute("data-sequence-owner",b);h.setAttribute("data-sequence-guid",
a.seqId);h.setAttribute("data-sequence-id",f);h.setAttribute("data-sequence-clip",[a.inOuts.ofVideos[f]["in"],a.inOuts.ofVideos[f].out].join(":"));a.parent.appendChild(h);a.playlist.push(e("#"+h.id))});a.inOuts.ofVideos.forEach(function(c){c={"in":i,out:i+(c.out-c["in"])};a.inOuts.ofClips.push(c);i=c.out+1});e.forEach(this.queue,function(c,f){function h(){if(!f){a.dims.width=c.videoWidth;a.dims.height=c.videoHeight}c.currentTime=a.inOuts.ofVideos[f]["in"]-0.5;c.removeEventListener("canplaythrough",
h,false);return true}c.addEventListener("canplaythrough",h,false);c.addEventListener("play",function(){a.playing=true},false);c.addEventListener("pause",function(){a.playing=false},false);c.addEventListener("timeupdate",function(g){g=g.srcElement||g.target;g=+(g.dataset&&g.dataset.sequenceId||g.getAttribute("data-sequence-id"));var j=Math.floor(c.currentTime);if(a.times.last!==j&&g===a.active){a.times.last=j;j===a.inOuts.ofVideos[g].out&&e.sequence.cycle.call(a,g)}},false)});return this};e.sequence.init.prototype=
e.sequence.prototype;e.sequence.cycle=function(b){this.queue||e.error("Popcorn.sequence.cycle is not a public method");var d=this.queue,a=this.inOuts.ofVideos,i=d[b],c=0,f;if(d[b+1])c=b+1;if(d[b+1]){d=d[c];a=a[c];e.extend(d,{width:this.dims.width,height:this.dims.height});f=this.playlist[c];i.pause();this.active=c;this.times.last=a["in"]-1;f.currentTime(a["in"]);f[c?"play":"pause"]();this.trigger("cycle",{position:{previous:b,current:c}});if(c){i.style.display="none";d.style.display=""}this.cycling=
false}else this.playlist[b].pause();return this};var o=["timeupdate","play","pause"];e.extend(e.sequence.prototype,{eq:function(b){return this.playlist[b]},remove:function(){this.parent.innerHTML=null},clip:function(b){return this.inOuts.ofVideos[b]},duration:function(){for(var b=0,d=this.inOuts.ofClips,a=0;a<d.length;a++)b+=d[a].out-d[a]["in"]+1;return b-1},play:function(){this.playlist[this.active].play();return this},exec:function(b,d){var a=this.active;this.inOuts.ofClips.forEach(function(i,c){if(b>=
i["in"]&&b<=i.out)a=c});b+=this.inOuts.ofVideos[a]["in"]-this.inOuts.ofClips[a]["in"];e.addTrackEvent(this.playlist[a],{start:b-1,end:b,_running:false,_natives:{start:d||e.nop,end:e.nop,type:"exec"}});return this},listen:function(b,d){var a=this,i=this.playlist,c=i.length,f=0;if(!d)d=e.nop;if(e.Events.Natives.indexOf(b)>-1)e.forEach(i,function(h){h.listen(b,function(g){g.active=a;if(o.indexOf(b)>-1)d.call(h,g);else++f===c&&d.call(h,g)})});else{this.events[b]||(this.events[b]={});i=d.name||e.guid("__"+
b);this.events[b][i]=d}return this},unlisten:function(){},trigger:function(b,d){var a=this;if(!(e.Events.Natives.indexOf(b)>-1)){this.events[b]&&e.forEach(this.events[b],function(i){i.call(a,{type:b},d)});return this}}});e.forEach(e.manifest,function(b,d){e.sequence.prototype[d]=function(a){var i={},c=[],f,h,g,j,l;for(f=0;f<this.inOuts.ofClips.length;f++){c=this.inOuts.ofClips[f];h=k(c["in"],c.out);g=h.indexOf(a.start);j=h.indexOf(a.end);if(g>-1)i[f]=e.extend({},c,{start:h[g],clipIdx:g});if(j>-1)i[f]=
e.extend({},c,{end:h[j],clipIdx:j})}f=Object.keys(i).map(function(t){return+t});c=k(f[0],f[1]);for(f=0;f<c.length;f++){g={};j=c[f];var r=i[j];if(r){l=this.inOuts.ofVideos[j];h=r.clipIdx;l=k(l["in"],l.out);if(r.start){g.start=l[h];g.end=l[l.length-1]}if(r.end){g.start=l[0];g.end=l[h]}}else{g.start=this.inOuts.ofVideos[j]["in"];g.end=this.inOuts.ofVideos[j].out}this.playlist[j][d](e.extend({},a,g))}return this}})})(this,Popcorn);(function(n){document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("[data-timeline-sources]");n.forEach(e,function(s,q){var m=e[q],p,k,o;if(!m.id)m.id=n.guid("__popcorn");if(m.nodeType&&m.nodeType===1){o=n("#"+m.id);p=(m.getAttribute("data-timeline-sources")||"").split(",");p[0]&&n.forEach(p,function(b){k=b.split("!");if(k.length===1){k=b.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/)[2].split(".");k[0]="parse"+k[1].toUpperCase();k[1]=b}p[0]&&o[k[0]]&&o[k[0]](k[1])});o.autoplay&&
o.play()}})},false)})(Popcorn);
