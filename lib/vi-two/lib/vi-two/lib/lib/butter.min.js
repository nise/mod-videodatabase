(function(t,r,m){var v=0,i=function(a){var c=[],b=v++,l=m,f=this,a=a||{},d=a.name||"Track"+Date.now();this.getName=function(){return d};this.getId=function(){return b};this.getTrackEvent=function(b){for(var a=0,f=c.length;a<f;++a)if(c[a].getId()===b||c[a].getName()===b)return c[a]};this.getTrackEvents=function(){return c};this.removeTrackEvent=function(b){typeof b==="string"&&(b=f.getTrackEvent(b));var a=c.indexOf(b);if(a>-1)c.splice(a,1),b.track=m,b.setButter(m),l.trigger("trackeventremoved",b)};
this.addTrackEvent=function(b){b instanceof e||(b=new e(b));c.push(b);b.track=f;l&&b.setButter(l);return b};this.setButter=function(b){if(l=b){l.trigger("trackadded",f);for(var b=f.getTrackEvents(),c=0,a=b.length;c<a;++c)b[c].setButter(l)}};this.getButter=function(){return l};this.importJSON=function(b){if(b.name)d=b.name;if(b.trackEvents)for(var b=b.trackEvents,c=0,a=b.length;c<a;++c){var g=new e;g.importJSON(b[c]);f.addTrackEvent(g)}};this.exportJSON=function(){for(var b=[],a=0,f=c.length;a<f;++a)b.push(c[a].exportJSON());
return{name:d,trackEvents:b}}},p=0,e=function(a){var c=p++,b=m,d=this,a=a||{},f=a.name||"Track"+Date.now();this.start=a.start||0;this.end=a.end||0;this.type=a.type;this.popcornOptions=a.popcornOptions;this.popcornEvent=a.popcornEvent;this.track=a.track;this.getName=function(){return f};this.getId=function(){return c};this.setButter=function(c){(b=c)&&b.trigger("trackeventadded",d)};this.getButter=function(){return b};this.importJSON=function(b){this.start=b.start||0;this.end=b.end||0;this.type=b.type;
if(b.name)f=b.name;this.popcornOptions=b.popcornOptions};this.exportJSON=function(){return{start:this.start,end:this.end,type:this.type,popcornOptions:this.popcornOptions,track:this.track?this.track.getName():m,name:f}}},d=0,k=function(a){var c=d++,a=a||{},b=a.name||"Target"+c+Date.now();this.object=a.object;this.getName=function(){return b};this.getId=function(){return c};this.importJSON=function(c){if(c.name)b=c.name;this.object=c.object};this.exportJSON=function(){var c;try{c=JSON.stringify(this.object)}catch(a){c=
this.object.toString()}return{name:b,object:c}}},n=0,a=function(a){var a=a||{},c={},b=[],d=n++,f=a.name||"Media"+d+Date.now(),e,h,o=m,j=0,g=0,s=this;this.getUrl=function(){return e};this.getTarget=function(){return h};this.setUrl=function(b){e=b;o&&o.trigger("mediacontentchanged",s)};this.setTarget=function(b){h=b;o&&o.trigger("mediatargetchanged",s)};this.getName=function(){return f};this.getId=function(){return d};this.getTracks=function(){return b};this.setButter=function(b){if(o=b){o.trigger("mediaadded",
s);for(var b=s.getTracks(),g=0,c=b.length;g<c;++g)b[g].setButter(o)}};this.getButter=function(){return o};this.addTrack=function(g){g instanceof i||(g=new i(g));c[g.getName()]=g;b.push(g);o&&g.setButter(o);return g};this.getTrack=function(g){var a=c[g];if(a)return a;for(var a=0,f=b.length;a<f;++a)if(b[a].getName()===g)return b[a];return m};this.removeTrack=function(g){typeof g==="string"&&(g=s.getTrack(g));var a=b.indexOf(g);if(a>-1){b.splice(a,1);g.setButter(m);delete c[g.getName()];for(var a=g.getTrackEvents(),
f=0,d=a.length;f<d;++f)o.trigger("trackeventremoved",a[f]);o&&o.trigger("trackremoved",g);return g}return m};this.currentTime=function(g){g&&(j=g,o&&o.trigger("mediatimeupdate",s));return j};this.duration=function(b){b&&(g=b,o&&o.trigger("mediadurationchanged",s));return g};this.importJSON=function(g){if(g.name)f=g.name;g.target&&s.setTarget(g.target);g.url&&s.setUrl(g.url);if(g.tracks)for(var g=g.tracks,b=0,a=g.length;b<a;++b){var c=new i;c.importJSON(g[b]);s.addTrack(c)}};this.exportJSON=function(){for(var a=
[],c=0,s=b.length;c<s;++c)a.push(b[c].exportJSON());return{name:f,url:e,target:h,duration:g,tracks:a}};a.url&&this.setUrl(a.url);a.target&&this.setTarget(a.target)},u=0,h=function(){function d(){if(!f)throw Error("No media object is selected");}var c={},b=[],l={},f,q=[],n={},o={},j=this;console.log("medias after instantiation",b,[],l);this.id="Butter"+u++;this.trigger=function(g,b,a){b={type:g,domain:a,data:b};if(c[g])for(var f=0,d=c[g].length;f<d;++f)c[g][f].call(j,b,a);if(a&&(g+=a,c[g])){f=0;for(d=
c[g].length;f<d;++f)c[g][f].call(j,b,a)}};this.listen=function(g,b,a){g+=a||"";c[g]||(c[g]=[]);c[g].push(b)};this.unlisten=function(g,b,a){g+=a||"";if(a=c[g])b?(g=a.indexOf(b),a.splice(g,1)):c[g]=[]};this.addTrackEvent=function(g,b){d();typeof g==="string"&&(g=f.getTrack(g));if(g)return b instanceof e||(b=new e(b)),g.addTrackEvent(b),b;else throw Error("No valid track specified");};this.getTrackEvents=function(){d();for(var g=f.getTracks(),b={},a=0,c=g.length;a<c;++a){var l=g[a];b[l.getName()]=l.getTrackEvents()}return b};
this.getTrackEvent=function(b,a){d();if(b&&a)return typeof b==="string"&&(b=j.getTrack(b)),b.getTrackEvent(a);else{var c=j.getTrackEvents(),f;for(f in c)for(var l=c[f],e=0,h=l.length;e<h;++e)if(l[e].getName()===b)return l[e]}};this.removeTrackEvent=function(b,a){d();if(!a)if(b instanceof e)a=b,b=a.track;else if(typeof b==="string")a=j.getTrackEvent(b),b=a.track;else throw Error("Invalid parameters for removeTrackEvent");typeof b==="string"&&(b=j.getTrack(b));typeof a==="string"&&(a=b.getTrackEvent(a));
b.removeTrackEvent(a);return a};this.addTrack=function(b){d();return f.addTrack(b)};this.getTracks=function(){d();return f.getTracks()};this.getTrack=function(b){d();return f.getTrack(b)};this.removeTrack=function(b){d();return f.removeTrack(b)};this.addTarget=function(b){b instanceof k||(b=new k(b));n[b.getName()]=b;q.push(b);j.trigger("targetadded",b);return b};this.removeTarget=function(b){typeof b==="string"&&(b=j.getTarget(b));var a=q.indexOf(b);if(a>-1)return q.splice(a,1),delete q[b.getName()],
j.trigger("targetremoved",b),b;return m};this.getTargets=function(b){if(b){for(var b=[],a=0,c=q.length;a<c;++a)b.push(q[a].exportJSON());return b}else return q};this.getTarget=function(b){return n[b]};this.importProject=function(b){o=b.project;if(b.targets)for(var c=0,f=b.targets.length;c<f;++c){var d=new k;d.importJSON(b.targets[c]);j.addTarget(d)}if(b.media){c=0;for(f=b.media.length;c<f;++c)d=new a,d.importJSON(b.media[c]),j.addMedia(d)}};this.exportProject=function(){for(var a=[],c=0,f=b.length;c<
f;++c)a.push(b[c].exportJSON());return{project:o,targets:j.getTargets(!0),media:a}};this.setProjectDetails=function(b,a){o[b]=a};this.getProjectDetails=function(b){return b?o[b]:o};this.clearProject=function(){for(var b=j.getTracks(),a=j.getTargets(),c=j.getAllMedia(),f=0,d=b.length;f<d;f++)j.removeTrack(b[f]);f=0;for(d=a.length;f<d;f++)j.removeTarget(a[f]);console.log("All Medias",c,j.getAllMedia());f=0;for(d=c.length;f<d;f++)j.removeMedia(c[f]),console.log(j.getAllMedia())};this.currentTime=function(b){d();
return f.currentTime(b)};this.duration=function(b){d();return f.duration(b)};this.getAllMedia=function(){return b};this.getMedia=function(a){if(l[a])return l[a];for(var c=0,f=b.length;c<f;++c)if(b[c].getName()===a)return b[c];return m};this.getCurrentMedia=function(){return f};this.setMedia=function(a){typeof a==="string"&&(a=j.getMedia(a));if(a&&b.indexOf(a)>-1)return f=a,j.trigger("mediachanged",a),f};this.addMedia=function(c){c instanceof a||(c=new a(c));var d=c.getName();console.log("medias before 1st push!",
b,[]);b.push(c);l[d]=c;c.setButter(j);f||j.setMedia(c);return c};this.removeMedia=function(a){typeof a==="string"&&(a=j.getMedia(a));var c=b.indexOf(a);console.log("idx of",a,":",c);if(c>-1)return console.log("medias before:",b),b.splice(c,1),console.log("medias after:",b),console.log("name: ",a.getName()),console.log("mediaByName",l[a.getName()]),delete l[a.getName()],console.log("mediaByName",l[a.getName()]),a.setButter(m),console.log("media === currentMedia",a===f),a===f&&(f=m),j.trigger("mediaremoved",
a),a;return m};this.extend=function(){h.extend(j,[].slice.call(arguments,1))}};h.getScriptLocation=function(){for(var a=r.querySelectorAll("script"),c=0;c<a.length;++c){var b=a[c].src.lastIndexOf("butter.js");if(b>-1)return a[c].src.substr(0,b)+"/"}};h.registerModule=h.prototype.registerModule=function(a,c){h.prototype[a]=function(b){c.call(this,b);return this};c.extend&&h.extendAPI(c.extend)};h.extendAPI=function(a){for(var c in a)a.hasOwnProperty(c)&&(h[c]=a[c],h.prototype[c]=a[c])};h.extend=function(a){var c=
a;[].slice.call(arguments,1).forEach(function(b){for(var a in b)c[a]=b[a]})};h.Media=a;h.Track=i;h.TrackEvent=e;h.Target=k;t.Butter=h})(window,document,void 0);(function(t,r,m){m.registerModule("comm",{setup:function(){},extend:{CommClient:function(m,i){var p={};t.addEventListener("message",function(e){if(e.source!==t){e=JSON.parse(e.data);if(e.type&&p[e.type])for(var d=p[e.type],k=0;k<d.length;++k)d[k](e.message);i&&i(e)}},!1);this.listen=function(e,d){if(e&&d)return p[e]||(p[e]=[]),p[e].push(d),d;else throw Error("Must provide a type and callback for CommClient listeners");};this.forget=function(e,d){if(d){var k=p[e].indexOf(d);if(k>-1)return d=p[e][k],
p.splice(k,1),d}else delete p[e]};this.send=function(e,d){d?postMessage(JSON.stringify({type:d,message:e}),"*"):postMessage(JSON.stringify(e),"*")}},CommServer:function(){function m(e,d,k){var n={};this.getName=function(){return e};this.listen=function(a,d){if(a&&d)return n[a]||(n[a]=[]),n[a].push(d),d;else throw Error("Must provide a type and callback for CommServer listeners");};this.forget=function(a,d){if(d){var e=n[a].indexOf(d);if(e>-1)return d=n[a][e],n.splice(e,1),d}else delete n[a]};this.send=
function(a,e){e?d.postMessage(JSON.stringify({type:e,message:a}),"*"):d.postMessage(JSON.stringify(a),"*")};d.addEventListener("message",function(a){if(a.source===d){a=JSON.parse(a.data);if(a.type&&n[a.type])for(var e=n[a.type],h=0;h<e.length;++h)e[h](a.message);k&&k(a)}},!1)}var i={},p=this;this.bindFrame=function(e,d,k,n){d.addEventListener("load",function(a){p.bindClientWindow(e,d.contentWindow,n);k&&k(a)},!1)};this.bindWindow=function(e,d,k,n){d.addEventListener("load",function(a){p.bindClientWindow(e,
d,n);k&&k(a)},!1)};this.bindClientWindow=function(e,d,k){i[e]=new m(e,d,k)};this.listen=function(e,d,k){i[e]&&i[e].listen(d,k)};this.forget=function(e,d,k){i[e]&&i[e].forget(d,k)};this.send=function(e,d,k){i[e]&&i[e].send(d,k)}}}})})(window,document,Butter);(function(t,r,m,v){v.registerModule("plugintray",function(i){var p=[],e=0,d,k=function(d){var a=e++,k=this,h=m,d=d||{},i=d.name||"Plugin"+Date.now();this.type=d.type;this.getName=function(){return i};this.getId=function(){return a};this.setButter=function(a){h=a};this.getButter=function(){return h};this.createElement=function(a){a?(a=a.replace(/\$type/g,k.type),a=$(a)[0]):(a=r.createElement("span"),a.innerHTML=k.type+" ");a.id=k.type;a.setAttribute("data-trackliner-type","butterapp");$(a).draggable({helper:"clone",
appendTo:"body",zIndex:9001,revert:!0,revertDuration:0});return a}},i=i||{};d=r.getElementById(i.target)||i.target;this.addPlugin=function(e){e instanceof k||(e=new k(e));p.push(e);e.setButter(this);this.trigger("pluginadded",e);var a=r.createElement("span");a.innerHTML=e.type+" ";a.id=e.type;a.setAttribute("data-trackliner-type","butterapp");$(a).draggable({helper:"clone",appendTo:"body",zIndex:9001,revert:!0,revertDuration:0});d.appendChild(a);return e};this.getPlugins=function(){return p}})})(window,
document,void 0,Butter);(function(t,r,m,v){m.registerModule("eventeditor",function(i){function p(b){function e(){a[n]("editorCommLink",f,function(){q.listen("trackeventupdated",o);q.listen("targetadded",function(){a.send("editorCommLink",q.getTargets(),"domtargetsupdated")});a.listen("editorCommLink","okayclicked",function(a){b.popcornOptions=a;f.close&&f.close();f&&f.parentNode&&f.parentNode.removeChild(f);q.unlisten("trackeventupdated",o);q.trigger("trackeditclosed");q.trigger("trackeventupdated",b)});a.listen("editorCommLink",
"applyclicked",function(a){b.popcornOptions=a;q.trigger("trackeventupdated",b)});a.listen("editorCommLink","deleteclicked",function(){q.removeTrackEvent(b);f.close&&f.close();f&&f.parentNode&&f.parentNode.removeChild(f);q.unlisten("trackeventupdated",o);q.trigger("trackeditclosed")});a.listen("editorCommLink","cancelclicked",function(){f.close&&f.close();f&&f.parentNode&&f.parentNode.removeChild(f);q.unlisten("trackeventupdated",o);q.trigger("trackeditclosed")});for(var c=q.getTargets(),d=[],e=0,
l=c.length;e<l;++e)d.push([c[e].getName(),c[e].getId()]);a.send("editorCommLink",{trackEvent:b,targets:d},"edittrackevent")})}var f,q=this,i=c[b.type]||b.manifest.customEditor||k,o=function(b){a.send("editorCommLink",b.data.popcornOptions,"updatetrackevent")};if(d)for(;d.firstChild;)d.removeChild(d.firstChild);if(n==="bindWindow")f=w||t.open(i,"","width="+h+",height="+u+",menubar=no,toolbar=no,location=no,status=no"),e(),f.addEventListener("beforeunload",function(){q.unlisten("trackeventupdated",
o);q.trigger("trackeditforcedclosed")},!1);else if(n==="bindFrame")f=r.createElement("iframe"),f.style.width=h,f.style.height=u,e(),f.src=i,d.appendChild(f)}function e(a,c){return{domtarget:function(a){if(typeof a==="string")return d=r.getElementById(a)||{};else if(a)return d=a},window:function(a){if(a)return w=a}}[c](a)}var d,k,n,a,u,h,w,c={};if(!i||typeof i!=="object")throw Error("Invalid Argument");h=i.editorWidth||400;u=i.editorHeight||400;i.target&&e(i.target,"domtarget")||i.targetWindow&&e(i.targetWindow,
"window");n=d?"bindFrame":"bindWindow";k=i.defaultEditor||"defaultEditor.html";a=new m.CommServer;this.editTrackEvent=function(a){if(!a||!(a instanceof m.TrackEvent))return!1;this.trigger("trackeditstarted");p.call(this,a);return!0};this.addCustomEditor=function(a,d){if(!d||!a)return!1;return c[d]=a};this.removeCustomEditor=function(a,d){if(!d||!a)return!1;var f=c[d];c[d]=v;return f};this.changeEditorTarget=function(a,c){var f=["domtarget","window"],h;if(!a)return d=v,n="bindWindow",!0;if(!c||f.indexOf(h=
c.toLowerCase())===-1)return!1;return e(a,h)};this.setDefaultEditor=function(a){if(!a||typeof a!=="string")return!1;return k=a};this.setEditorDims=function(a){if(!a||!a.height&&!a.width)return!1;h=a.width||h;u=a.height||u;return a}})})(window,window.document,Butter);(function(t,r,m,v){m.registerModule("previewer",function(i){var m,e,d,k,n,a,u,h,t,c;h={};u=i.popcornURL||"http://popcornjs.org/code/dist/popcorn-complete.js";m=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/;t=i.layout;butterIds={};n=i.media;c={};a={};var b=this,l=r.getElementById(i.target);if(l.tagName==="DIV")target=r.getElementById(i.target),d=r.createElement("IFRAME"),d.src=t,d.width=target.style.width,d.height=target.style.height,target.appendChild(d),d.addEventListener("load",
function(){b.scraper(d,i.callback);this.removeEventListener("load",arguments.callee,!1)},!1);else if(l.tagName==="IFRAME")d=l,d.src=i.layout,l.addEventListener("load",function(){b.scraper(d,i.callback);this.removeEventListener("load",arguments.callee,!1)},!1);this.scraper=function(a,c){function d(a){for(var c=0;c<a.length;c++)a[c].getAttribute("data-butter")==="target"?b.addTarget({name:a[c].id,type:"target"}):a[c].getAttribute("data-butter")==="media"&&b.addMedia({target:a[c].id,url:n}),a[c].children.length>
0&&d(a[c].children)}var e=(a.contentWindow||a.contentDocument).document.getElementsByTagName("BODY");b=this;var l=function(){e.length<1?setTimeout(function(){l()},5):(d(e[0].children),c())};l()};this.buildPopcorn=function(b,l){e=b.getUrl();var h=(d.contentWindow||d.contentDocument).document;videoTarget=b.getTarget();h.getElementById(videoTarget).innerHTML="";k="document.addEventListener('DOMContentLoaded', function () {\n";var i=m.exec(e)||"",j=[];j.youtu=function(){h.getElementById(videoTarget).innerHTML=
"";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.youtube( '"+videoTarget+"', '"+e+"', {\nwidth: 430, height: 300\n} ) );\n"};j["vimeo "]=function(){h.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.vimeo( '"+videoTarget+"', '"+e+"', {\ncss: {\nwidth: '430px',\nheight: '300px'\n}\n} ) );\n"};j.soundcloud=function(){h.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.soundcloud( '"+videoTarget+"', '"+
e+"' ) );\n"};j.baseplayer=function(){h.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.baseplayer( '"+videoTarget+"' ) );\n"};j[v]=function(){var c=h.createElement("source"),d=h.createElement("video");c.src=e;d.style.width=h.getElementById(videoTarget).style.width;d.style.height=h.getElementById(videoTarget).style.height;d.appendChild(c);d.controls=!0;d.id=videoTarget+"-butter";h.getElementById(videoTarget).appendChild(d);c="#"+d.id;a[b.getId()]="popcorn"+
b.getId()+" = Popcorn( '"+c+"');\n"};j[i[1]]();for(video in a)k+=a[video];for(popcorn in c)if(i=c[popcorn].getTrackEvents())for(j=0;j<i.length;j++){var g=i[j]._natives.manifest.options;k+=" popcorn"+popcorn+"."+i[j]._natives.type+"({\n";for(item in g)g.hasOwnProperty(item)&&(k+=item+": '"+i[j][item]+"',\n");k+="});"}k+="}, false);";this.fillIframe(b,l)};this.getPopcorn=function(){var b="var "+a;for(popcorn in c){var d=c[popcorn].getTrackEvents();if(d)for(var e=0;e<d.length;e++){var h=d[e]._natives.manifest.options;
b+="popcorn"+popcorn+"."+d[e]._natives.type+"({\n";for(item in h)h.hasOwnProperty(item)&&(b+=item+": '"+d[e][item]+"',\n");b+="});\n"}}return b};this.getRegistry=function(){return(d.contentWindow||d.contentDocument).Popcorn.registry};this.fillIframe=function(a,b){var e,l,j=this,g=(d.contentWindow||d.contentDocument).document;e=g.createElement("script");e.innerHTML=k;g.head.appendChild(e);e="<head>"+h.innerHTML+"\n<script src='"+u+"'><\/script>\n<script>\n"+k+"<\/script>";e+="\n</head>\n";l=g.body.innerHTML;
g.open();g.write("<html>\n"+e+l+"\n</html>");g.close();var i=function(b,c){var e=(d.contentWindow||d.contentDocument)["popcorn"+a.getId()];e?c&&c(e):setTimeout(function(){i(b,c)},10)};i(null,function(c){var d=function(){c.media.readyState>=2||c.media.duration>0?(j.duration(c.media.duration),j.trigger("mediaready",a),c.media.addEventListener("timeupdate",function(){j.currentTime(c.media.currentTime);j.trigger("mediatimeupdate",a)},!1),b&&b()):setTimeout(function(){d(c)},10)};d(c)});this.teAdded=function(e){var g=
e.data;i(g,function(e){c[a.getId()]?e=c[a.getId()]:c[a.getId()]=e;e.removeTrackEvent(butterIds[g.getId()]);e[g.type]((d.contentWindow||d.contentDocument.parentWindow).Popcorn.extend({},g.popcornOptions));butterIds[g.getId()]=e.getLastTrackEventId();g.manifest=e.getTrackEvent(butterIds[g.getId()])._natives.manifest;b&&b()})};this.listen("trackeventupdated",function(a){this.teAdded(a)});this.listen("trackeventadded",function(b){b=b.data;i(b,function(e){c[a.getId()]?e=c[a.getId()]:c[a.getId()]=e;e[b.type]((d.contentWindow||
d.contentDocument).Popcorn.extend({},b.popcornOptions));butterIds[b.getId()]=e.getLastTrackEventId();b.manifest=e.getTrackEvent(butterIds[b.getId()])._natives.manifest})});this.listen("trackeventremoved",function(b){(d.contentWindow||d.contentDocument)["popcorn"+a.getId()].removeTrackEvent(butterIds[b.data.getId()])});this.listen("mediatimeupdate",function(b){d.contentWindow["popcorn"+a.getId()].currentTime(b.data.currentTime())},"timeline");this.listen("mediachanged",function(){j.buildPopcorn(j.getCurrentMedia())})}})})(window,
document,Butter);(function(t,r,m){m.registerModule("timeline",function(t){var i=function(a){var b=new Date(1970,0,1);b.setSeconds(a);a=b.toTimeString().substr(0,8);a>86399&&(a=Math.floor((b-Date.parse("1/1/70"))/36E5)+a.substr(2));return a},p=function(a){var b=curtop=0;if(a.offsetParent){do b+=a.offsetLeft,curtop+=a.offsetTop;while(a=a.offsetParent)}return[b,curtop]},e=!1,d=0,k=function(a){var b=this;this.container=r.createElement("div");this.container.style.width="100%";this.container.style.height="100%";this.container.style.position=
"relative";this.container.style.MozUserSelect="none";this.container.style.webkitUserSelect="none";this.container.style.oUserSelect="none";this.container.style.userSelect="none";u.appendChild(this.container);this.tracks=r.createElement("div");this.tracks.style.width="100%";this.tracks.style.height="100%";this.init=function(){this.duration=a.duration();this.trackLine=new TrackLiner({element:this.tracks,dynamicTrackCreation:!0,scale:1,duration:this.duration,restrictToKnownPlugins:!0});this.butterTracks=
{};this.trackLinerTracks={};this.butterTrackEvents={};this.trackLinerTrackEvents={};this.timeline=r.createElement("canvas");this.timeline.style.height="25px";this.timeline.style.width=this.container.offsetWidth+"px";this.timeline.height="25";this.timeline.width=this.container.offsetWidth;this.scrubber=r.createElement("div");this.scrubber.style.height="100%";this.scrubber.style.width="1px";this.scrubber.style.position="absolute";this.scrubber.style.top="0px";this.scrubber.style.left="0px";this.scrubber.style.zIndex=
this.timeline.style.zIndex+1;this.scrubber.style.backgroundColor="red";this.userInteract=r.createElement("div");this.userInteract.style.position="absolute";this.userInteract.style.top="0px";this.userInteract.style.left="0px";this.userInteract.style.height=this.timeline.style.height;this.userInteract.style.width="100%";this.userInteract.style.zIndex=this.scrubber.style.zIndex+1;this.userInteract.addEventListener("mousemove",function(a){d=a.rangeParent.scrollLeft},!1);this.userInteract.addEventListener("mousedown",
function(a){e=!0;h.currentTime((a.pageX-(b.container.offsetLeft-d)+b.container.scrollLeft-p(b.container)[0])/b.container.offsetWidth*b.duration);h.trigger("mediatimeupdate",h,"timeline")},!1);this.container.appendChild(this.scrubber);this.container.appendChild(this.userInteract);this.container.appendChild(this.timeline);this.container.appendChild(this.tracks);var l=this.timeline.getContext("2d"),f=this.container.offsetWidth/this.duration/4,k=[10,4,7,4],m=l.measureText(i(5)).width,n=-m/2;l.translate(0.5,
0.5);l.beginPath();for(var j=1,g=this.duration*4;j<g;j++){var s=j*f;l.moveTo(-~s,0);l.lineTo(-~s,k[j%4]);j%4===0&&s-n>m&&(n=s,l.fillText(i(j/4),-~s-m/2,21))}l.stroke();l.closePath()};this.hide=function(){this.container.style.display="none"};this.show=function(){this.container.style.display="block"}},n=[],a,u=r.getElementById(t.target)||t.target,h=this;TrackLiner.plugin("butterapp",{setup:function(c,b,d,e){if(e){d=c;if(!a.butterTracks[c.id()])a.trackLine.removeTrack(d),h.addTrack(new m.Track),d=a.lastTrack;
a.lastTrack=d;var d=b.left/a.container.offsetWidth*a.duration,i=d+4;h.addTrackEvent(a.butterTracks[a.lastTrack.id()],new m.TrackEvent({popcornOptions:{start:d,end:i},type:e.draggable[0].id}))}else return d=b.popcornOptions.start,i=b.popcornOptions.end,e=(i-d)/a.duration*c.getElement().offsetWidth,{left:d/a.duration*c.getElement().offsetWidth,innerHTML:b.type,width:e}},moved:function(c,b){var d=c;b.options.popcornOptions.start=b.element.offsetLeft/a.container.offsetWidth*a.duration;b.options.popcornOptions.end=
(b.element.offsetLeft+b.element.offsetWidth)/a.container.offsetWidth*a.duration;if(!a.butterTracks[c.id()])a.trackLine.removeTrack(d),h.addTrack(new m.Track),d=a.lastTrack,d.addTrackEvent(b);a.lastTrack=d;h.trigger("trackeventupdated",b.options)},click:function(){},dblclick:function(a,b){h.editTrackEvent&&h.editTrackEvent(b.options)}});r.addEventListener("mousemove",function(c){e&&(c.pageX-p(a.container)[0]>a.container.offsetLeft-d&&c.pageX-p(a.container)[0]<a.container.offsetLeft-d+a.container.offsetWidth?
h.currentTime((c.pageX-(a.container.offsetLeft-d)+a.container.scrollLeft-p(a.container)[0])/a.container.offsetWidth*a.duration):c.pageX-p(a.container)[0]<=a.container.offsetLeft-d?h.currentTime(0):h.currentTime(a.duration),h.trigger("mediatimeupdate",h,"timeline"))},!1);r.addEventListener("mouseup",function(){e=!1},!1);this.listen("mediatimeupdate",function(){a.scrubber.style.left=h.currentTime()/a.duration*a.container.offsetWidth+"px"});this.listen("trackadded",function(c){var c=c.data,b=a.trackLine.createTrack();
a.trackLinerTracks[c.getId()]=b;a.lastTrack=b;a.butterTracks[b.id()]=c});this.listen("trackremoved",function(c){var c=c.data,b=a.trackLinerTracks[c.getId()],d=b.getTrackEvents(),e;for(e in d)d.hasOwnProperty(e)&&h.removeTrackEvent(c,a.butterTrackEvents[d[e].element.id]);a.trackLine.removeTrack(b);delete a.butterTracks[b.id()];delete a.trackLinerTracks[c.getId()]});this.listen("trackeventadded",function(c){var c=c.data,b=a.lastTrack.createTrackEvent("butterapp",c);a.trackLinerTrackEvents[c.getId()]=
b;a.butterTrackEvents[b.element.id]=c});this.listen("trackeventremoved",function(c){var c=c.data,b=a.trackLinerTrackEvents[c.getId()],d=a.trackLine.getTrack(b.trackId);(a.lastTrack=d)&&d.removeTrackEvent(b.element.id);delete a.butterTrackEvents[b.element.id];delete a.trackLinerTrackEvents[c.getId()]});var w=this;this.listen("mediaadded",function(a){n[a.data.getId()]=new k(a.data)});this.listen("mediaready",function(a){n[a.data.getId()].init();w.trigger("timelineready",{},"timeline")});this.listen("mediachanged",
function(c){a&&a.hide();(a=n[c.data.getId()])&&a.show();w.trigger("timelineready",{},"timeline")});this.listen("mediaremoved",function(a){delete n[a.data.getId()]});this.listen("trackeventupdated",function(c){var c=c.data,b=a.trackLinerTrackEvents[c.getId()];trackLinerTrack=a.trackLine.getTrack(b.trackId);delete a.butterTrackEvents[b.element.id];trackLinerTrack.removeTrackEvent(b.element.id);b=trackLinerTrack.createTrackEvent("butterapp",c);a.butterTrackEvents[b.element.id]=c;a.trackLinerTrackEvents[c.getId()]=
b})})})(window,window.document,Butter);
